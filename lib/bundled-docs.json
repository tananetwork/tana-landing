[
  {
    "slug": [
      "tana-api",
      "blocks"
    ],
    "metadata": {
      "title": "/blocks",
      "description": "Query blockchain blocks"
    },
    "content": "\nQuery blocks on the Tana blockchain. Blocks are produced every 6 seconds and contain confirmed transactions.\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/blocks</b></code> <code>(list blocks)</code></summary>\n\n### Request\n\n```bash\ncurl \"http://localhost:8080/blocks?limit=10&offset=0\"\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**limit**</td>\n    <td>number</td>\n    <td>optional (default: 10)</td>\n  </tr>\n <tr>\n    <td>**offset**</td>\n    <td>number</td>\n    <td>optional (default: 0)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n[\n  {\n    \"id\": \"blk_xyz789\",\n    \"height\": 42,\n    \"hash\": \"0x1a2b3c...\",\n    \"previousHash\": \"0x9z8y7x...\",\n    \"stateRoot\": \"0x4d5e6f...\",\n    \"timestamp\": \"2024-11-08T12:00:06.000Z\",\n    \"transactionCount\": 5,\n    \"producerId\": \"usr_leader1\"\n  },\n  {\n    \"id\": \"blk_abc123\",\n    \"height\": 41,\n    \"hash\": \"0x9z8y7x...\",\n    \"previousHash\": \"0x6g5h4i...\",\n    \"stateRoot\": \"0x7j8k9l...\",\n    \"timestamp\": \"2024-11-08T12:00:00.000Z\",\n    \"transactionCount\": 3,\n    \"producerId\": \"usr_leader1\"\n  }\n]\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/blocks/latest</b></code> <code>(get latest block)</code></summary>\n\n### Request\n\n```bash\ncurl http://localhost:8080/blocks/latest\n```\n\n### Parameters\n\nNone\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"id\": \"blk_xyz789\",\n  \"height\": 42,\n  \"hash\": \"0x1a2b3c...\",\n  \"previousHash\": \"0x9z8y7x...\",\n  \"stateRoot\": \"0x4d5e6f...\",\n  \"timestamp\": \"2024-11-08T12:00:06.000Z\",\n  \"transactionCount\": 5,\n  \"producerId\": \"usr_leader1\",\n  \"transactions\": [\n    {\n      \"id\": \"tx_1a2b3c4d5e6f\",\n      \"type\": \"transfer\",\n      \"from\": \"usr_abc123\",\n      \"to\": \"usr_def456\"\n    }\n  ]\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"No blocks found\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/blocks/:height</b></code> <code>(get block by height)</code></summary>\n\n### Request\n\n```bash\ncurl http://localhost:8080/blocks/42\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**height**</td>\n    <td>number</td>\n    <td>required (URL param)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"id\": \"blk_xyz789\",\n  \"height\": 42,\n  \"hash\": \"0x1a2b3c...\",\n  \"previousHash\": \"0x9z8y7x...\",\n  \"stateRoot\": \"0x4d5e6f...\",\n  \"timestamp\": \"2024-11-08T12:00:06.000Z\",\n  \"transactionCount\": 5,\n  \"producerId\": \"usr_leader1\",\n  \"transactions\": [\n    {\n      \"id\": \"tx_1a2b3c4d5e6f\",\n      \"type\": \"transfer\",\n      \"from\": \"usr_abc123\",\n      \"to\": \"usr_def456\"\n    }\n  ]\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Invalid block height\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Block not found\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/blocks/hash/:hash</b></code> <code>(get block by hash)</code></summary>\n\n### Request\n\n```bash\ncurl http://localhost:8080/blocks/hash/0x1a2b3c4d5e6f...\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**hash**</td>\n    <td>string (hex)</td>\n    <td>required (URL param)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"id\": \"blk_xyz789\",\n  \"height\": 42,\n  \"hash\": \"0x1a2b3c4d5e6f...\",\n  \"previousHash\": \"0x9z8y7x...\",\n  \"stateRoot\": \"0x4d5e6f...\",\n  \"timestamp\": \"2024-11-08T12:00:06.000Z\",\n  \"transactionCount\": 5,\n  \"producerId\": \"usr_leader1\",\n  \"transactions\": [\n    {\n      \"id\": \"tx_1a2b3c4d5e6f\",\n      \"type\": \"transfer\",\n      \"from\": \"usr_abc123\",\n      \"to\": \"usr_def456\"\n    }\n  ]\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Block not found\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n### Method Not Allowed\n\nThe following methods are not supported:\n\n<code className=\"text-green-400\">POST</code> <code className=\"text-orange-400\">PUT</code> <code className=\"text-red-400\">DELETE</code> <code className=\"text-purple-400\">PATCH</code>\n"
  },
  {
    "slug": [
      "tana-api",
      "identity"
    ],
    "metadata": {
      "title": "/auth (Identity Service)",
      "description": "Mobile-first authentication and session management API"
    },
    "content": "\nThe Identity Service provides secure authentication for Tana applications using mobile-first QR code authentication (similar to WhatsApp Web). Private keys remain exclusively on mobile devices, while desktop/laptop computers receive session tokens only.\n\n**Base URL:** `http://localhost:8090` (development) or `https://auth.tana.network` (production)\n\n**Key Concepts:**\n- **Session-based authentication** - No private keys on desktop/laptop\n- **QR code login** - Mobile app scans QR from website\n- **Server-Sent Events (SSE)** - Real-time session status updates\n- **Ed25519 signatures** - Cryptographic proof of ownership\n- **Hardware security** - Private keys protected by mobile device secure enclave\n\n---\n\n## Authentication Flow\n\n```\n1. Website → POST /auth/session/create\n   Returns: sessionId, challenge, QR data\n\n2. Website → GET /auth/session/:id/events (SSE)\n   Streams: Real-time session status updates\n\n3. Mobile App → GET /auth/session/:id\n   Returns: Session details, marks as \"scanned\"\n\n4. User approves on mobile\n\n5. Mobile App → POST /auth/session/:id/approve\n   Body: Signed challenge with Ed25519\n\n6. SSE → \"approved\" event to website\n   Includes: sessionToken for authenticated requests\n\n7. Website uses sessionToken for subsequent API calls\n```\n\n---\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/auth/session/create</b></code> <code>(create QR login session)</code></summary>\n\n### Request\n\n```bash\ncurl -X POST http://localhost:8090/auth/session/create \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"returnUrl\": \"http://localhost:3000/dashboard\",\n    \"appName\": \"My Tana App\",\n    \"appIcon\": \"https://example.com/icon.png\"\n  }'\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**returnUrl**</td>\n    <td>string (URL)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**appName**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**appIcon**</td>\n    <td>string (URL)</td>\n    <td>optional</td>\n  </tr>\n</table>\n\n### Response\n\n```json\n{\n  \"sessionId\": \"sess_3ogy2lnxi0fl4rlz\",\n  \"challenge\": \"auth_chal_b92f3aed...\",\n  \"expiresAt\": 1762915859863,\n  \"expiresIn\": 300,\n  \"qrData\": \"{\\\"sessionId\\\":\\\"sess_...\\\",\\\"challenge\\\":\\\"auth_chal_...\\\",\\\"service\\\":\\\"tana-identity\\\"}\"\n}\n```\n\n**Status:** `201 Created`\n\n**Use Case:** Website initiates login flow by creating a session and displaying QR code\n\n</details>\n\n---\n\n<details>\n <summary><code className=\"text-cyan-400\">GET</code> <code><b>/auth/session/:id/events</b></code> <code>(SSE stream for real-time updates)</code></summary>\n\n### Request\n\n```bash\ncurl -N http://localhost:8090/auth/session/sess_abc123/events\n```\n\n### Server-Sent Events\n\n**Connection event:**\n```json\nevent: connected\ndata: {\"type\":\"connected\",\"sessionId\":\"sess_abc123\"}\n```\n\n**Status update event:**\n```json\nevent: status\ndata: {\"type\":\"status\",\"status\":\"waiting\",\"scannedAt\":null,\"approvedAt\":null}\n```\n\n**Scanned event:**\n```json\nevent: status\ndata: {\"type\":\"status\",\"status\":\"scanned\",\"scannedAt\":\"2025-01-11T19:00:00.000Z\",\"approvedAt\":null}\n```\n\n**Approved event (terminal):**\n```json\nevent: approved\ndata: {\n  \"type\":\"approved\",\n  \"sessionToken\":\"tana_session_abc123...\",\n  \"userId\":\"usr_alice\",\n  \"username\":\"@alice\",\n  \"returnUrl\":\"http://localhost:3000/dashboard\"\n}\n```\n\n**Rejected event (terminal):**\n```json\nevent: rejected\ndata: {\"type\":\"rejected\"}\n```\n\n**Expired event (terminal):**\n```json\nevent: expired\ndata: {\"type\":\"expired\"}\n```\n\n**Status:** `200 OK` (keeps connection open)\n\n**Use Case:** Website opens SSE connection to receive real-time status updates as user scans/approves on mobile\n\n</details>\n\n---\n\n<details>\n <summary><code className=\"text-cyan-400\">GET</code> <code><b>/auth/session/:id</b></code> <code>(get session details)</code></summary>\n\n### Request\n\n```bash\ncurl http://localhost:8090/auth/session/sess_abc123\n```\n\n### Response\n\n```json\n{\n  \"sessionId\": \"sess_abc123\",\n  \"challenge\": \"auth_chal_b92f3aed...\",\n  \"status\": \"waiting\",\n  \"appName\": \"My Tana App\",\n  \"appIcon\": \"https://example.com/icon.png\",\n  \"expiresAt\": 1762915859863\n}\n```\n\n**Status:** `200 OK`\n\n**Side Effect:** If session status is \"waiting\", automatically marks as \"scanned\"\n\n**Use Case:** Mobile app scans QR code and retrieves session details\n\n</details>\n\n---\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/auth/session/:id/approve</b></code> <code>(approve login with signature)</code></summary>\n\n### Request\n\n```bash\ncurl -X POST http://localhost:8090/auth/session/sess_abc123/approve \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"userId\": \"usr_alice\",\n    \"username\": \"@alice\",\n    \"publicKey\": \"ed25519_abc123...\",\n    \"signature\": \"0x1a2b3c...\",\n    \"message\": \"I approve this login session: auth_chal_b92f3aed...\"\n  }'\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**userId**</td>\n    <td>string (UUID)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**username**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**publicKey**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**signature**</td>\n    <td>string (hex)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**message**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n</table>\n\n### Response\n\n```json\n{\n  \"success\": true,\n  \"sessionToken\": \"tana_session_abc123...\",\n  \"returnUrl\": \"http://localhost:3000/dashboard\"\n}\n```\n\n**Status:** `200 OK`\n\n**Validation:**\n- Ed25519 signature must be valid for the provided message and public key\n- Message must contain the session challenge\n- Session must be in \"waiting\" or \"scanned\" state\n- Session must not be expired\n\n**Use Case:** User approves login on mobile app, which signs the challenge with private key\n\n</details>\n\n---\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/auth/session/:id/reject</b></code> <code>(reject login)</code></summary>\n\n### Request\n\n```bash\ncurl -X POST http://localhost:8090/auth/session/sess_abc123/reject\n```\n\n### Response\n\n```json\n{\n  \"success\": true\n}\n```\n\n**Status:** `200 OK`\n\n**Use Case:** User rejects login attempt on mobile app\n\n</details>\n\n---\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/auth/session/validate</b></code> <code>(validate session token)</code></summary>\n\n### Request\n\n```bash\ncurl -X POST http://localhost:8090/auth/session/validate \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"sessionToken\": \"tana_session_abc123...\"\n  }'\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**sessionToken**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n</table>\n\n### Response (Valid)\n\n```json\n{\n  \"valid\": true,\n  \"userId\": \"usr_alice\",\n  \"username\": \"@alice\"\n}\n```\n\n**Status:** `200 OK`\n\n### Response (Invalid)\n\n```json\n{\n  \"error\": \"Invalid or expired session token\"\n}\n```\n\n**Status:** `401 Unauthorized`\n\n**Use Case:** Backend services validate session tokens from authenticated requests\n\n</details>\n\n---\n\n## Security Model\n\n### Private Key Isolation\n\n**✅ SECURE (Mobile Device):**\n- Private keys stored in hardware-backed secure enclave (iOS) / StrongBox (Android)\n- Biometric protection (Face ID, Touch ID, fingerprint)\n- OS-level sandboxing prevents key extraction\n- Signatures generated within secure hardware\n\n**❌ INSECURE (Desktop/Laptop):**\n- No private keys - only session tokens\n- Session tokens are revocable and time-limited (30 days)\n- Tokens provide read-only blockchain access\n- Desktop computers more vulnerable to malware\n\n### Why No Browser Extensions?\n\nTana explicitly rejects the MetaMask/browser extension model:\n\n1. **Malware Risk** - Desktop computers are primary malware targets\n2. **Browser Vulnerabilities** - Extensions have broad permissions\n3. **Key Extraction** - Software-based key storage can be compromised\n4. **User Behavior** - Users install many extensions from untrusted sources\n\n### Mobile-First Advantages\n\n1. **Hardware Security** - Secure enclave protects keys at hardware level\n2. **Biometric Auth** - Face ID/Touch ID for every transaction\n3. **Smaller Attack Surface** - iOS/Android app sandboxing\n4. **User Awareness** - Mobile approval makes every action explicit\n5. **Loss Prevention** - Devices can be remotely wiped\n\n### Authentication Flow Security\n\n1. **Challenge-Response** - Random challenge prevents replay attacks\n2. **Ed25519 Signatures** - Cryptographic proof of ownership\n3. **Time Limits** - Sessions expire after 5 minutes (login) or 30 days (token)\n4. **Status Tracking** - \"waiting\" → \"scanned\" → \"approved\" state machine\n5. **SSE Updates** - Real-time feedback without polling\n\n## Session Lifecycle\n\n**Session States:**\n- `waiting` - QR code displayed, waiting for mobile scan\n- `scanned` - Mobile app has retrieved session details\n- `approved` - User approved and signature verified → token generated\n- `rejected` - User declined login attempt\n- `expired` - Session timed out (5 minutes)\n\n**Session Token Lifecycle:**\n- Generated after approval with Ed25519 signature verification\n- Expires 30 days after approval\n- Can be revoked at any time\n- Used for subsequent authenticated API requests\n\n## Error Responses\n\n**404 Not Found:**\n```json\n{\n  \"error\": \"Session not found\"\n}\n```\n\n**400 Bad Request:**\n```json\n{\n  \"error\": \"Invalid signature\"\n}\n```\n\n```json\n{\n  \"error\": \"Challenge mismatch\"\n}\n```\n\n```json\n{\n  \"error\": \"Session expired\"\n}\n```\n\n**401 Unauthorized:**\n```json\n{\n  \"error\": \"Invalid or expired session token\"\n}\n```\n\n**500 Internal Server Error:**\n```json\n{\n  \"error\": \"Failed to create session\"\n}\n```\n\n## Related Documentation\n\n- [Mobile Authentication Protocol](/docs/MOBILE_AUTH_PROTOCOL.md) - Detailed protocol specification\n- [Transaction Signing Guide](/guides/transaction-signing/) - How Ed25519 signatures work\n- [Environment Variables](/contributing/env-vars/) - Configure `IDENTITY_DB_URL` and `IDENTITY_PORT`\n- [Architecture](/contributing/architecture/) - Identity service in system design\n"
  },
  {
    "slug": [
      "tana-api",
      "contracts"
    ],
    "metadata": {
      "title": "/contracts",
      "description": "Deploy and manage smart contracts"
    },
    "content": "\nDeploy and manage TypeScript smart contracts on the Tana blockchain. Contracts are executed in a sandboxed V8 runtime.\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/contracts/deploy</b></code> <code>(deploy contract)</code></summary>\n\n### Request\n\n```bash\ncurl -X POST http://localhost:8080/contracts/deploy \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"ownerId\": \"usr_abc123\",\n    \"name\": \"token-transfer\",\n    \"sourceCode\": \"import { console } from \\\"tana:core\\\"; ...\",\n    \"description\": \"Simple token transfer contract\",\n    \"metadata\": {\n      \"version\": \"1.0.0\",\n      \"author\": \"@alice\"\n    }\n  }'\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**ownerId**</td>\n    <td>string (UUID)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**name**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**sourceCode**</td>\n    <td>string (TypeScript)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**description**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**metadata**</td>\n    <td>object</td>\n    <td>optional</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>201</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"id\": \"cnt_xyz789\",\n  \"ownerId\": \"usr_abc123\",\n  \"name\": \"token-transfer\",\n  \"sourceCode\": \"import { console } from \\\"tana:core\\\"; ...\",\n  \"description\": \"Simple token transfer contract\",\n  \"metadata\": {\n    \"version\": \"1.0.0\",\n    \"author\": \"@alice\"\n  },\n  \"status\": \"active\",\n  \"createdAt\": \"2024-11-08T12:00:00.000Z\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Missing required fields: ownerId, name, sourceCode\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/contracts</b></code> <code>(list contracts)</code></summary>\n\n### Request\n\n```bash\n# List all contracts\ncurl \"http://localhost:8080/contracts?limit=50&offset=0\"\n\n# List only active contracts\ncurl \"http://localhost:8080/contracts?active=true&limit=50&offset=0\"\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**limit**</td>\n    <td>number</td>\n    <td>optional (default: 50)</td>\n  </tr>\n <tr>\n    <td>**offset**</td>\n    <td>number</td>\n    <td>optional (default: 0)</td>\n  </tr>\n <tr>\n    <td>**active**</td>\n    <td>boolean</td>\n    <td>optional</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n[\n  {\n    \"id\": \"cnt_xyz789\",\n    \"ownerId\": \"usr_abc123\",\n    \"name\": \"token-transfer\",\n    \"description\": \"Simple token transfer contract\",\n    \"status\": \"active\",\n    \"createdAt\": \"2024-11-08T12:00:00.000Z\",\n    \"updatedAt\": \"2024-11-08T12:00:00.000Z\"\n  },\n  {\n    \"id\": \"cnt_abc123\",\n    \"ownerId\": \"usr_def456\",\n    \"name\": \"voting-system\",\n    \"description\": \"Decentralized voting contract\",\n    \"status\": \"active\",\n    \"createdAt\": \"2024-11-07T10:00:00.000Z\",\n    \"updatedAt\": \"2024-11-07T10:00:00.000Z\"\n  }\n]\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/contracts/:id</b></code> <code>(get contract by ID)</code></summary>\n\n### Request\n\n```bash\ncurl http://localhost:8080/contracts/cnt_xyz789\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**id**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"id\": \"cnt_xyz789\",\n  \"ownerId\": \"usr_abc123\",\n  \"name\": \"token-transfer\",\n  \"sourceCode\": \"import { console } from \\\"tana:core\\\"; ...\",\n  \"description\": \"Simple token transfer contract\",\n  \"metadata\": {\n    \"version\": \"1.0.0\",\n    \"author\": \"@alice\"\n  },\n  \"status\": \"active\",\n  \"createdAt\": \"2024-11-08T12:00:00.000Z\",\n  \"updatedAt\": \"2024-11-08T12:00:00.000Z\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Contract not found\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/contracts/owner/:ownerId</b></code> <code>(get contracts by owner)</code></summary>\n\n### Request\n\n```bash\ncurl \"http://localhost:8080/contracts/owner/usr_abc123?limit=50&offset=0\"\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**ownerId**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n <tr>\n    <td>**limit**</td>\n    <td>number</td>\n    <td>optional (default: 50)</td>\n  </tr>\n <tr>\n    <td>**offset**</td>\n    <td>number</td>\n    <td>optional (default: 0)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n[\n  {\n    \"id\": \"cnt_xyz789\",\n    \"ownerId\": \"usr_abc123\",\n    \"name\": \"token-transfer\",\n    \"description\": \"Simple token transfer contract\",\n    \"status\": \"active\",\n    \"createdAt\": \"2024-11-08T12:00:00.000Z\",\n    \"updatedAt\": \"2024-11-08T12:00:00.000Z\"\n  }\n]\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/contracts/:id/deactivate</b></code> <code>(deactivate contract)</code></summary>\n\n### Request\n\n```bash\ncurl -X POST http://localhost:8080/contracts/cnt_xyz789/deactivate \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"ownerId\": \"usr_abc123\"\n  }'\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**id**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n <tr>\n    <td>**ownerId**</td>\n    <td>string (UUID)</td>\n    <td>required</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"id\": \"cnt_xyz789\",\n  \"ownerId\": \"usr_abc123\",\n  \"name\": \"token-transfer\",\n  \"status\": \"inactive\",\n  \"deactivatedAt\": \"2024-11-08T13:00:00.000Z\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Missing ownerId\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>403</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Only contract owner can deactivate\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [ ] Public\n- [ ] Community\n- [ ] Team\n- [x] Self\n- [ ] Admin\n\n</details>\n\n### Method Not Allowed\n\nThe following methods are not supported:\n\n<code className=\"text-orange-400\">PUT</code> <code className=\"text-red-400\">DELETE</code> <code className=\"text-purple-400\">PATCH</code>\n"
  },
  {
    "slug": [
      "tana-api",
      "intro"
    ],
    "metadata": {
      "title": "API Overview",
      "description": "REST API reference for Tana Services",
      "sidebar": {
        "order": 1
      }
    },
    "content": "\nTana provides two main REST APIs for interacting with the blockchain and managing authentication. All endpoints return JSON responses.\n\n## Base URLs\n\n### Ledger Service (Blockchain API)\n\n```\nhttp://localhost:8080\n```\n\nHandles all blockchain operations: users, balances, transactions, blocks, and smart contracts.\n\n### Identity Service (Authentication API)\n\n```\nhttp://localhost:8090\n```\n\nHandles mobile-first QR code authentication and session management. Private keys remain exclusively on mobile devices for security.\n\nFor production deployments, replace with your server's URLs (e.g., `https://api.tana.network` and `https://auth.tana.network`).\n\n## Authentication & Signatures\n\n:::caution[Security Notice]\n**Transaction signing is NOT yet implemented.** The API currently accepts requests without signature verification. Do not use with real assets.\n:::\n\n### Transaction Signatures (Required in Production)\n\nAll state-changing operations (POST, PATCH, DELETE) **require cryptographic signatures** to prove ownership. While not currently enforced, the API is designed to verify Ed25519 signatures on all transactions.\n\n**Required Fields:**\n\n```json\n{\n  \"ownerId\": \"usr_abc123\",\n  \"...\": \"transaction data\",\n  \"signature\": \"0x1a2b3c4d5e6f...\",  // Ed25519 signature (required)\n  \"timestamp\": 1699459200,            // Unix timestamp (required)\n  \"nonce\": 42                         // Replay protection (required)\n}\n```\n\n**How Signing Works:**\n\n```typescript\n// 1. Create transaction payload\nconst payload = {\n  ownerId: \"usr_abc123\",\n  amount: \"100\",\n  currencyCode: \"USD\",\n  timestamp: Date.now(),\n  nonce: 42\n}\n\n// 2. Hash the payload\nconst hash = sha256(JSON.stringify(payload))\n\n// 3. Sign with private key\nconst signature = ed25519.sign(hash, privateKey)\n\n// 4. Send to API\nPOST /transactions {\n  ...payload,\n  signature: \"0x...\"\n}\n```\n\n**Server Verification:**\n\nThe API will verify:\n1. Signature is valid for the given payload\n2. Signature matches the public key on file for `ownerId`\n3. Timestamp is within acceptable range (prevents old transactions)\n4. Nonce hasn't been used before (prevents replay attacks)\n\n**Implementation Status:**\n- ❌ CLI signing - Not implemented\n- ❌ API verification - Not implemented\n- ❌ Ed25519 keypairs - Using placeholders\n- ⚠️ **All endpoints currently accept unsigned requests**\n\nSee the [README Security Status](https://github.com/conoda/tana#security-status) for implementation roadmap.\n\n## Response Format\n\nAll API responses follow this format:\n\n### Success Response\n\n```json\n{\n  \"data\": { ... },\n  \"status\": \"success\"\n}\n```\n\n### Error Response\n\n```json\n{\n  \"error\": \"Error message describing what went wrong\",\n  \"timestamp\": \"2024-11-07T00:00:00.000Z\"\n}\n```\n\n## HTTP Status Codes\n\n| Code | Meaning |\n|------|---------|\n| `200` | Success - Request completed successfully |\n| `201` | Created - Resource created successfully |\n| `400` | Bad Request - Invalid request parameters |\n| `404` | Not Found - Resource doesn't exist |\n| `500` | Internal Server Error - Something went wrong on the server |\n\n## Quick Start\n\n### Health Check\n\n```bash\ncurl http://localhost:8080/health\n```\n\n```json\n{\n  \"status\": \"ok\"\n}\n```\n\n### Get Service Info\n\n```bash\ncurl http://localhost:8080/\n```\n\n```json\n{\n  \"service\": \"tana-ledger\",\n  \"version\": \"0.1.0\",\n  \"status\": \"healthy\",\n  \"timestamp\": \"2024-11-07T00:00:00.000Z\"\n}\n```\n\n## API Categories\n\n### Identity & Authentication (Port 8090)\nMobile-first QR code authentication with hardware-backed security.\n\n- **POST /auth/session/create** - Create QR code login session\n- **GET /auth/session/:id/events** - SSE stream for real-time updates\n- **GET /auth/session/:id** - Get session details (mobile scans QR)\n- **POST /auth/session/:id/approve** - Approve login with Ed25519 signature\n- **POST /auth/session/:id/reject** - Reject login attempt\n- **POST /auth/session/validate** - Validate session token\n\n**Security Model:** Private keys ONLY on mobile devices. Desktop/laptop receives session tokens only.\n\n[View Identity API →](/tana-api/identity/)\n\n---\n\n### Users (Port 8080)\nManage user accounts on the blockchain.\n\n- **POST /users** - Create a new user\n- **GET /users** - List all users\n- **GET /users/:id** - Get user by ID\n- **GET /users/by-username/:username** - Get user by username\n\n[View Users API →](/tana-api/users/)\n\n### Balances (Port 8080)\nQuery and manage multi-currency balances.\n\n- **GET /balances** - Query balances\n- **POST /balances** - Set balance\n- **GET /balances/currencies** - List supported currencies\n- **POST /balances/currencies/seed** - Seed default currencies\n\n[View Balances API →](/tana-api/balances/)\n\n### Transactions (Port 8080)\nCreate and query blockchain transactions.\n\n- **POST /transactions** - Create transaction\n- **GET /transactions** - List transactions\n- **GET /transactions/:id** - Get transaction by ID\n\n[View Transactions API →](/tana-api/transactions/)\n\n### Blocks (Port 8080)\nQuery blockchain blocks and history.\n\n- **GET /blocks** - List blocks\n- **GET /blocks/latest** - Get latest block\n- **GET /blocks/:height** - Get block by height\n\n[View Blocks API →](/tana-api/blocks/)\n\n### Contracts (Port 8080)\nDeploy and manage smart contracts.\n\n- **POST /contracts** - Deploy contract\n- **GET /contracts** - List contracts\n- **GET /contracts/:id** - Get contract by ID\n\n[View Contracts API →](/tana-api/contracts/)\n\n## Rate Limiting\n\nCurrently, there are no rate limits on the development API. Production deployments should implement rate limiting at the reverse proxy level (e.g., Nginx).\n\n## CORS\n\nThe API supports CORS for all origins in development mode:\n\n```\nAccess-Control-Allow-Origin: *\nAccess-Control-Allow-Credentials: true\n```\n\n## Pagination\n\nList endpoints support pagination via query parameters:\n\n```bash\nGET /users?page=1&limit=20\n```\n\nDefault limit is 100 items per page.\n\n## Examples\n\n### Create User and Check Balance\n\n```bash\n# 1. Create user\ncurl -X POST http://localhost:8080/users \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"publicKey\": \"ed25519_abc123...\",\n    \"username\": \"@alice\",\n    \"displayName\": \"Alice Johnson\"\n  }'\n\n# Response:\n# {\n#   \"userId\": \"user_xyz789\",\n#   \"transactionId\": \"tx_abc123\",\n#   \"status\": \"pending\"\n# }\n\n# 2. Get balance (after block inclusion)\ncurl \"http://localhost:8080/balances?ownerId=user_xyz789&currencyCode=USD\"\n\n# Response:\n# {\n#   \"ownerId\": \"user_xyz789\",\n#   \"ownerType\": \"user\",\n#   \"currencyCode\": \"USD\",\n#   \"amount\": \"1000.00\",\n#   \"updatedAt\": \"2024-11-07T00:00:00.000Z\"\n# }\n```\n\n## Next Steps\n\n- [Identity API](/tana-api/identity/) - Mobile QR code authentication\n- [Users API](/tana-api/users/) - User account management\n- [Balances API](/tana-api/balances/) - Balance queries and updates\n- [Transactions API](/tana-api/transactions/) - Transaction creation and queries\n- [Blocks API](/tana-api/blocks/) - Blockchain queries\n- [Contracts API](/tana-api/contracts/) - Smart contract deployment\n- [CLI Reference](/tana-cli/intro/) - Command-line interface\n"
  },
  {
    "slug": [
      "tana-api",
      "rate-limit"
    ],
    "metadata": {
      "title": "rate limits",
      "description": "A reference page in my new Starlight docs site.",
      "sidebar": {
        "order": 2
      }
    },
    "content": "\nReference pages are ideal for outlining how things work in terse and clear terms.\nLess concerned with telling a story or addressing a specific use case, they should give a comprehensive outline of what you're documenting.\n"
  },
  {
    "slug": [
      "tana-api",
      "transactions"
    ],
    "metadata": {
      "title": "/transactions",
      "description": "Manage blockchain transactions"
    },
    "content": "\nCreate and query transactions on the blockchain. Transactions remain in a pending state until included in a block.\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/transactions</b></code> <code>(get all transactions)</code></summary>\n\n### Request\n\n```bash\ncurl \"http://localhost:8080/transactions?limit=50&offset=0\"\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**limit**</td>\n    <td>number</td>\n    <td>optional (default: 100)</td>\n  </tr>\n <tr>\n    <td>**offset**</td>\n    <td>number</td>\n    <td>optional (default: 0)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n[\n  {\n    \"id\": \"tx_1a2b3c4d5e6f\",\n    \"from\": \"usr_abc123\",\n    \"to\": \"usr_def456\",\n    \"amount\": \"100.00\",\n    \"currencyCode\": \"USD\",\n    \"type\": \"transfer\",\n    \"status\": \"confirmed\",\n    \"blockId\": \"blk_xyz789\",\n    \"signature\": \"sig_...\",\n    \"createdAt\": \"2024-11-08T12:00:00.000Z\",\n    \"confirmedAt\": \"2024-11-08T12:00:06.000Z\"\n  }\n]\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/transactions</b></code> <code>(create transaction)</code></summary>\n\n### Request\n\n```bash\ncurl -X POST http://localhost:8080/transactions \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"from\": \"usr_abc123\",\n    \"to\": \"usr_def456\",\n    \"amount\": \"100.00\",\n    \"currencyCode\": \"USD\",\n    \"type\": \"transfer\",\n    \"signature\": \"sig_...\"\n  }'\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**from**</td>\n    <td>string (UUID)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**to**</td>\n    <td>string (UUID)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**amount**</td>\n    <td>string (decimal)</td>\n    <td>optional*</td>\n  </tr>\n <tr>\n    <td>**currencyCode**</td>\n    <td>string</td>\n    <td>optional*</td>\n  </tr>\n <tr>\n    <td>**type**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**signature**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**contractId**</td>\n    <td>string (UUID)</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**contractInput**</td>\n    <td>object</td>\n    <td>optional</td>\n  </tr>\n</table>\n\n**Transaction types:** `transfer`, `deposit`, `withdraw`, `contract_call`, `user_creation`, `contract_deployment`\n\n*Required for transfer/deposit/withdraw types\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>201</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"id\": \"tx_1a2b3c4d5e6f\",\n  \"from\": \"usr_abc123\",\n  \"to\": \"usr_def456\",\n  \"amount\": \"100.00\",\n  \"currencyCode\": \"USD\",\n  \"type\": \"transfer\",\n  \"status\": \"pending\",\n  \"signature\": \"sig_...\",\n  \"createdAt\": \"2024-11-08T12:00:00.000Z\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Insufficient balance\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/transactions/:id</b></code> <code>(get transaction)</code></summary>\n\n### Request\n\n```bash\ncurl http://localhost:8080/transactions/tx_1a2b3c4d5e6f\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**id**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"id\": \"tx_1a2b3c4d5e6f\",\n  \"from\": \"usr_abc123\",\n  \"to\": \"usr_def456\",\n  \"amount\": \"100.00\",\n  \"currencyCode\": \"USD\",\n  \"type\": \"transfer\",\n  \"status\": \"confirmed\",\n  \"blockId\": \"blk_xyz789\",\n  \"signature\": \"sig_...\",\n  \"createdAt\": \"2024-11-08T12:00:00.000Z\",\n  \"confirmedAt\": \"2024-11-08T12:00:06.000Z\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Transaction not found\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/transactions/:id/confirm</b></code> <code>(confirm transaction)</code></summary>\n\n### Request\n\n```bash\ncurl -X POST http://localhost:8080/transactions/tx_1a2b3c4d5e6f/confirm \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"id\": \"tx_1a2b3c4d5e6f\",\n    \"blockId\": \"blk_xyz789\"\n  }'\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**id**</td>\n    <td>string (UUID)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**blockId**</td>\n    <td>string (UUID)</td>\n    <td>optional</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"id\": \"tx_1a2b3c4d5e6f\",\n  \"from\": \"usr_abc123\",\n  \"to\": \"usr_def456\",\n  \"amount\": \"100.00\",\n  \"currencyCode\": \"USD\",\n  \"type\": \"transfer\",\n  \"status\": \"confirmed\",\n  \"blockId\": \"blk_xyz789\",\n  \"signature\": \"sig_...\",\n  \"createdAt\": \"2024-11-08T12:00:00.000Z\",\n  \"confirmedAt\": \"2024-11-08T12:00:06.000Z\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Transaction already confirmed\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [ ] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [x] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/transactions/pending</b></code> <code>(get pending transactions)</code></summary>\n\n### Request\n\n```bash\ncurl \"http://localhost:8080/transactions/pending?limit=100\"\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**limit**</td>\n    <td>number</td>\n    <td>optional (default: 100)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n[\n  {\n    \"id\": \"tx_1a2b3c4d5e6f\",\n    \"from\": \"usr_abc123\",\n    \"to\": \"usr_def456\",\n    \"amount\": \"100.00\",\n    \"currencyCode\": \"USD\",\n    \"type\": \"transfer\",\n    \"status\": \"pending\",\n    \"signature\": \"sig_...\",\n    \"createdAt\": \"2024-11-08T12:00:00.000Z\"\n  }\n]\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/transactions/account/:accountId</b></code> <code>(get account transactions)</code></summary>\n\n### Request\n\n```bash\ncurl \"http://localhost:8080/transactions/account/usr_abc123?limit=50&offset=0\"\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**accountId**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n <tr>\n    <td>**limit**</td>\n    <td>number</td>\n    <td>optional (default: 50)</td>\n  </tr>\n <tr>\n    <td>**offset**</td>\n    <td>number</td>\n    <td>optional (default: 0)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n[\n  {\n    \"id\": \"tx_1a2b3c4d5e6f\",\n    \"from\": \"usr_abc123\",\n    \"to\": \"usr_def456\",\n    \"amount\": \"100.00\",\n    \"currencyCode\": \"USD\",\n    \"type\": \"transfer\",\n    \"status\": \"confirmed\",\n    \"blockId\": \"blk_xyz789\",\n    \"signature\": \"sig_...\",\n    \"createdAt\": \"2024-11-08T12:00:00.000Z\",\n    \"confirmedAt\": \"2024-11-08T12:00:06.000Z\"\n  }\n]\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n### Method Not Allowed\n\nThe following methods are not supported:\n\n<code className=\"text-orange-400\">PUT</code> <code className=\"text-red-400\">DELETE</code> <code className=\"text-purple-400\">PATCH</code>\n"
  },
  {
    "slug": [
      "tana-api",
      "users",
      "create"
    ],
    "metadata": {
      "title": "/users",
      "description": "Create a new user on the blockchain"
    },
    "content": "\nCreate a new user account by submitting a user creation transaction. The transaction will be pending until included in a block.\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/users</b></code> <code>(create user)</code></summary>\n\n### Request\n\n```bash\ncurl -X POST http://localhost:8080/users \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"publicKey\": \"ed25519_abc123...\",\n    \"username\": \"@alice\",\n    \"displayName\": \"Alice Johnson\",\n    \"bio\": \"Software developer\"\n  }'\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**publicKey**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**username**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**displayName**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**bio**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>201</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"userId\": \"usr_1a2b3c4d5e6f\",\n  \"transactionId\": \"tx_7g8h9i0j1k2l\",\n  \"status\": \"pending\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/users</b></code> <code>(list users)</code></summary>\n\n### Request\n\n```bash\ncurl http://localhost:8080/users\n```\n\n### Parameters\n\nNone\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n[\n  {\n    \"id\": \"usr_1a2b3c4d5e6f\",\n    \"username\": \"@alice\",\n    \"displayName\": \"Alice Johnson\",\n    \"publicKey\": \"ed25519_abc123...\",\n    \"bio\": \"Software developer\",\n    \"createdAt\": \"2024-11-07T12:00:00.000Z\"\n  }\n]\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/users/:id</b></code> <code>(get user by ID)</code></summary>\n\n### Request\n\n```bash\ncurl http://localhost:8080/users/usr_1a2b3c4d5e6f\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**id**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"id\": \"usr_1a2b3c4d5e6f\",\n  \"username\": \"@alice\",\n  \"displayName\": \"Alice Johnson\",\n  \"publicKey\": \"ed25519_abc123...\",\n  \"bio\": \"Software developer\",\n  \"createdAt\": \"2024-11-07T12:00:00.000Z\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"User not found\",\n  \"timestamp\": \"2024-11-07T12:00:00.000Z\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/users/username/:username</b></code> <code>(get user by username)</code></summary>\n\n### Request\n\n```bash\ncurl http://localhost:8080/users/username/@alice\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**username**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"id\": \"usr_1a2b3c4d5e6f\",\n  \"username\": \"@alice\",\n  \"displayName\": \"Alice Johnson\",\n  \"publicKey\": \"ed25519_abc123...\",\n  \"bio\": \"Software developer\",\n  \"createdAt\": \"2024-11-07T12:00:00.000Z\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"User not found\",\n  \"timestamp\": \"2024-11-07T12:00:00.000Z\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-purple-400\">PATCH</code> <code><b>/users/:id</b></code> <code>(update user)</code></summary>\n\n### Request\n\n```bash\ncurl -X PATCH http://localhost:8080/users/usr_1a2b3c4d5e6f \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"displayName\": \"Alice Smith\",\n    \"bio\": \"Senior Software Developer\"\n  }'\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**id**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n <tr>\n    <td>**displayName**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**bio**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**avatarData**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**landingPageId**</td>\n    <td>string (UUID)</td>\n    <td>optional</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"id\": \"usr_1a2b3c4d5e6f\",\n  \"username\": \"@alice\",\n  \"displayName\": \"Alice Smith\",\n  \"publicKey\": \"ed25519_abc123...\",\n  \"bio\": \"Senior Software Developer\",\n  \"updatedAt\": \"2024-11-08T12:00:00.000Z\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"User not found\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [ ] Public\n- [ ] Community\n- [ ] Team\n- [x] Self\n- [x] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-red-400\">DELETE</code> <code><b>/users/:id</b></code> <code>(delete user)</code></summary>\n\n### Request\n\n```bash\ncurl -X DELETE http://localhost:8080/users/usr_1a2b3c4d5e6f\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**id**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"message\": \"User deleted\",\n  \"user\": {\n    \"id\": \"usr_1a2b3c4d5e6f\",\n    \"username\": \"@alice\"\n  }\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"User not found\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [ ] Public\n- [ ] Community\n- [ ] Team\n- [x] Self\n- [x] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/users/:id/balances</b></code> <code>(get user balances)</code></summary>\n\n### Request\n\n```bash\ncurl http://localhost:8080/users/usr_1a2b3c4d5e6f/balances\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**id**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n[\n  {\n    \"ownerId\": \"usr_1a2b3c4d5e6f\",\n    \"ownerType\": \"user\",\n    \"currencyCode\": \"USD\",\n    \"balance\": \"1000.50\"\n  },\n  {\n    \"ownerId\": \"usr_1a2b3c4d5e6f\",\n    \"ownerType\": \"user\",\n    \"currencyCode\": \"ETH\",\n    \"balance\": \"2.5\"\n  }\n]\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"User not found\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n### Method Not Allowed\n\nThe following methods are not supported:\n\n<code className=\"text-orange-400\">PUT</code>\n"
  },
  {
    "slug": [
      "tana-api",
      "users",
      "signin"
    ],
    "metadata": {
      "title": "/users/signin",
      "description": "documentation for the endpoint"
    },
    "content": "\nwhen given a user identifier (username, email, or phone number) and password as input, this endpoint will return a token if the information is valid\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/users/signin</b></code> <code>(authenticate user)</code></summary>\n\n### Request\n\n```javascript\ncurl https://api.conoda.co/users/signin\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**user**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**password**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"conoda/addis\": \"v1.0.0\",\n  \"api\": \"v1\",\n  \"location\": \"seattle\",\n  \"server-id\": \"9x93jv35\",\n  \"rate-limit-remaining\": 1000,\n  \"rate-limit-reset\": 1684830400,\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [ ] Public\n- [ ] Community\n- [ ] Team\n- [x] Self\n- [x] Admin\n\n</details>\n\n### Method Not Allowed\n\nsending a request with the following methods to this endpoint will return an 405 error\n\n<code className=\"text-blue-400\">GET</code> <code className=\"text-orange-400\">PUT</code> <code className=\"text-red-400\">DELETE</code>\n"
  },
  {
    "slug": [
      "tana-api",
      "balances"
    ],
    "metadata": {
      "title": "/balances",
      "description": "Manage account balances and currencies"
    },
    "content": "\nManage balances for users and teams across multiple currencies. All balance amounts are stored as strings to preserve decimal precision.\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/balances</b></code> <code>(get all balances or specific balance)</code></summary>\n\n### Request\n\n**Get all balances:**\n```bash\ncurl http://localhost:8080/balances\n```\n\n**Get specific balance:**\n```bash\ncurl \"http://localhost:8080/balances?ownerId=usr_1a2b3c4d5e6f&ownerType=user&currencyCode=USD\"\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**ownerId**</td>\n    <td>string (UUID)</td>\n    <td>optional (query param)</td>\n  </tr>\n <tr>\n    <td>**ownerType**</td>\n    <td>string (user | team)</td>\n    <td>optional (query param)</td>\n  </tr>\n <tr>\n    <td>**currencyCode**</td>\n    <td>string</td>\n    <td>optional (query param)</td>\n  </tr>\n</table>\n\n**Note:** If any query parameter is provided, all three (ownerId, ownerType, currencyCode) are required.\n\n### Response\n\n**All balances (no query params):**\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n[\n  {\n    \"ownerId\": \"usr_1a2b3c4d5e6f\",\n    \"ownerType\": \"user\",\n    \"currencyCode\": \"USD\",\n    \"balance\": \"1000.50\",\n    \"updatedAt\": \"2024-11-08T12:00:00.000Z\"\n  },\n  {\n    \"ownerId\": \"usr_1a2b3c4d5e6f\",\n    \"ownerType\": \"user\",\n    \"currencyCode\": \"ETH\",\n    \"balance\": \"2.5\",\n    \"updatedAt\": \"2024-11-08T11:30:00.000Z\"\n  }\n]\n```\n\n</td>\n  </tr>\n</table>\n\n**Specific balance (with query params):**\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"ownerId\": \"usr_1a2b3c4d5e6f\",\n  \"ownerType\": \"user\",\n  \"currencyCode\": \"USD\",\n  \"balance\": \"1000.50\",\n  \"updatedAt\": \"2024-11-08T12:00:00.000Z\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Missing required query parameters: ownerId, ownerType, currencyCode\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n**If balance doesn't exist:**\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"balance\": \"0\",\n  \"currencyCode\": \"USD\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/balances</b></code> <code>(set balance)</code></summary>\n\n### Request\n\n```bash\ncurl -X POST http://localhost:8080/balances \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"ownerId\": \"usr_1a2b3c4d5e6f\",\n    \"ownerType\": \"user\",\n    \"currencyCode\": \"USD\",\n    \"amount\": \"1500.75\"\n  }'\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**ownerId**</td>\n    <td>string (UUID)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**ownerType**</td>\n    <td>string (user | team)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**currencyCode**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**amount**</td>\n    <td>string (decimal)</td>\n    <td>required</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>201</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"ownerId\": \"usr_1a2b3c4d5e6f\",\n  \"ownerType\": \"user\",\n  \"currencyCode\": \"USD\",\n  \"balance\": \"1500.75\",\n  \"updatedAt\": \"2024-11-08T12:00:00.000Z\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Amount must be a valid decimal number\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [ ] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [x] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/balances/currencies</b></code> <code>(list all currencies)</code></summary>\n\n### Request\n\n```bash\ncurl http://localhost:8080/balances/currencies\n```\n\n### Parameters\n\nNone\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n[\n  {\n    \"code\": \"USD\",\n    \"type\": \"fiat\",\n    \"decimals\": 2,\n    \"name\": \"US Dollar\",\n    \"symbol\": \"$\",\n    \"verified\": true\n  },\n  {\n    \"code\": \"ETH\",\n    \"type\": \"crypto\",\n    \"decimals\": 18,\n    \"name\": \"Ethereum\",\n    \"symbol\": \"Ξ\",\n    \"verified\": true\n  }\n]\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/balances/currencies</b></code> <code>(create currency)</code></summary>\n\n### Request\n\n```bash\ncurl -X POST http://localhost:8080/balances/currencies \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"code\": \"BTC\",\n    \"type\": \"crypto\",\n    \"decimals\": 8,\n    \"name\": \"Bitcoin\",\n    \"symbol\": \"₿\",\n    \"verified\": false\n  }'\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**code**</td>\n    <td>string (uppercase)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**type**</td>\n    <td>string (fiat | crypto)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**decimals**</td>\n    <td>number (0-18)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**name**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**symbol**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**verified**</td>\n    <td>boolean</td>\n    <td>optional</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>201</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"code\": \"BTC\",\n  \"type\": \"crypto\",\n  \"decimals\": 8,\n  \"name\": \"Bitcoin\",\n  \"symbol\": \"₿\",\n  \"verified\": false,\n  \"createdAt\": \"2024-11-08T12:00:00.000Z\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Currency code already exists\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [ ] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [x] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/balances/currencies/seed</b></code> <code>(seed default currencies)</code></summary>\n\n### Request\n\n```bash\ncurl -X POST http://localhost:8080/balances/currencies/seed\n```\n\n### Parameters\n\nNone\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"message\": \"Default currencies seeded\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Error seeding currencies\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [ ] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [x] Admin\n\n</details>\n\n### Method Not Allowed\n\nThe following methods are not supported:\n\n<code className=\"text-orange-400\">PUT</code> <code className=\"text-red-400\">DELETE</code> <code className=\"text-purple-400\">PATCH</code>\n"
  },
  {
    "slug": [
      "tana-api",
      "keys",
      "id"
    ],
    "metadata": {
      "title": "/keys/{:id}",
      "description": "A reference page in my new Starlight docs site."
    },
    "content": "\nReference pages are ideal for outlining how things work in terse and clear terms.\nLess concerned with telling a story or addressing a specific use case, they should give a comprehensive outline of what you're documenting.\n\n## Further reading\n\n- Read [about reference](https://diataxis.fr/reference/) in the Diátaxis framework\n"
  },
  {
    "slug": [
      "tana-api",
      "keys"
    ],
    "metadata": {
      "title": "/keys",
      "description": "A reference page in my new Starlight docs site."
    },
    "content": "\nReference pages are ideal for outlining how things work in terse and clear terms.\nLess concerned with telling a story or addressing a specific use case, they should give a comprehensive outline of what you're documenting."
  },
  {
    "slug": [
      "tana-api",
      "modules",
      "kv"
    ],
    "metadata": {
      "title": "tana/kv Module",
      "description": "KV Storage API Reference"
    },
    "content": "\nCloudflare Workers-compatible key-value storage for smart contracts.\n\n## Import\n\n```typescript\nimport { kv } from 'tana/kv'\n```\n\n## Methods\n\n### kv.get()\n\nRetrieve a value from storage.\n\n```typescript\nkv.get(key: string, options?: KVGetOptions): Promise<string | object | null>\n```\n\n**Parameters:**\n\n| Name | Type | Required | Description |\n|------|------|----------|-------------|\n| `key` | string | Yes | Storage key (max 512 bytes) |\n| `options.type` | 'text' \\| 'json' | No | Return type (default: 'text') |\n\n**Returns:** `Promise<string | object | null>`\n\n- Returns `null` if key doesn't exist\n- Returns string when `type: 'text'` (default)\n- Returns parsed object when `type: 'json'`\n\n**Examples:**\n\n```typescript\n// Get as text (default)\nconst username = await kv.get('username')\nconsole.log(username) // \"alice\"\n\n// Get as JSON\nconst user = await kv.get('user', { type: 'json' })\nconsole.log(user) // { name: \"alice\", balance: 1000 }\n\n// Handle missing key\nconst missing = await kv.get('nonexistent')\nif (missing === null) {\n  console.log('Key not found')\n}\n```\n\n---\n\n### kv.put()\n\nStore a value.\n\n```typescript\nkv.put(key: string, value: string | object, options?: KVPutOptions): Promise<void>\n```\n\n**Parameters:**\n\n| Name | Type | Required | Description |\n|------|------|----------|-------------|\n| `key` | string | Yes | Storage key (max 512 bytes) |\n| `value` | string \\| object | Yes | Value to store (max 25 MB) |\n| `options` | KVPutOptions | No | Reserved for future features |\n\n**Returns:** `Promise<void>`\n\n**Serialization:**\n- Strings: Stored as-is\n- Objects: Automatically JSON-serialized\n\n**Throws:**\n- \"KV key too long\" - Key exceeds 512 bytes\n- \"KV value too large\" - Value exceeds 25 MB\n\n**Examples:**\n\n```typescript\n// Store string\nawait kv.put('username', 'alice')\n\n// Store object (auto-serialized)\nawait kv.put('user', {\n  name: 'alice',\n  balance: 1000,\n  roles: ['admin', 'user']\n})\n\n// Overwrite existing key\nawait kv.put('username', 'bob') // Previous value replaced\n```\n\n---\n\n### kv.delete()\n\nDelete a key from storage.\n\n```typescript\nkv.delete(key: string): Promise<void>\n```\n\n**Parameters:**\n\n| Name | Type | Required | Description |\n|------|------|----------|-------------|\n| `key` | string | Yes | Key to delete |\n\n**Returns:** `Promise<void>`\n\n**Notes:**\n- No error if key doesn't exist\n- Idempotent operation\n\n**Examples:**\n\n```typescript\n// Delete existing key\nawait kv.delete('username')\n\n// Delete non-existent key (no error)\nawait kv.delete('nonexistent') // Succeeds silently\n```\n\n---\n\n### kv.list()\n\nList keys in storage with optional filtering.\n\n```typescript\nkv.list(options?: KVListOptions): Promise<KVListResult>\n```\n\n**Parameters:**\n\n| Name | Type | Required | Description |\n|------|------|----------|-------------|\n| `options.prefix` | string | No | Filter keys by prefix |\n| `options.limit` | number | No | Max keys to return (default: 1000) |\n\n**Returns:** `Promise<KVListResult>`\n\n```typescript\ninterface KVListResult {\n  keys: Array<{ name: string }>\n  list_complete: boolean\n  cursor: string | null\n}\n```\n\n**Result Fields:**\n\n| Field | Type | Description |\n|-------|------|-------------|\n| `keys` | Array<{ name: string }> | Array of matching keys |\n| `list_complete` | boolean | Whether all results returned (always `true` currently) |\n| `cursor` | string \\| null | Pagination cursor (always `null` currently, reserved for future) |\n\n**Examples:**\n\n```typescript\n// List all keys\nconst all = await kv.list()\nconsole.log(all.keys) // [{ name: \"user\" }, { name: \"config\" }]\n\n// List with prefix\nawait kv.put('user:1', { name: 'alice' })\nawait kv.put('user:2', { name: 'bob' })\nawait kv.put('config', { theme: 'dark' })\n\nconst users = await kv.list({ prefix: 'user:' })\nconsole.log(users.keys) // [{ name: \"user:1\" }, { name: \"user:2\" }]\n\n// Limit results\nconst first10 = await kv.list({ limit: 10 })\nconsole.log(first10.keys.length) // 10 or fewer\n\n// Check if more results available\nif (!first10.list_complete) {\n  // Use cursor for next page (future feature)\n  const next = await kv.list({ cursor: first10.cursor })\n}\n```\n\n---\n\n## Type Definitions\n\n### KVGetOptions\n\n```typescript\ninterface KVGetOptions {\n  type?: 'text' | 'json' | 'arrayBuffer' | 'stream'\n}\n```\n\n**Supported types:**\n- ✅ `'text'` - Return as string (default)\n- ✅ `'json'` - Parse and return as object\n- ❌ `'arrayBuffer'` - Future feature\n- ❌ `'stream'` - Future feature\n\n---\n\n### KVPutOptions\n\n```typescript\ninterface KVPutOptions {\n  metadata?: Record<string, any>\n  expirationTtl?: number\n  expiration?: number\n}\n```\n\n**Reserved for future features:**\n- `metadata` - Custom metadata for the key\n- `expirationTtl` - TTL in seconds\n- `expiration` - Absolute expiration timestamp\n\nCurrently these options are accepted but have no effect.\n\n---\n\n### KVListOptions\n\n```typescript\ninterface KVListOptions {\n  prefix?: string\n  limit?: number\n  cursor?: string\n}\n```\n\n**Fields:**\n- `prefix` - Filter keys starting with prefix (default: none)\n- `limit` - Max keys to return (default: 1000, max: 1000)\n- `cursor` - Pagination cursor (future feature)\n\n---\n\n### KVListResult\n\n```typescript\ninterface KVListResult {\n  keys: KVListResultKey[]\n  list_complete: boolean\n  cursor: string | null\n}\n```\n\n---\n\n### KVListResultKey\n\n```typescript\ninterface KVListResultKey {\n  name: string\n  expiration?: number\n  metadata?: Record<string, any>\n}\n```\n\n**Fields:**\n- `name` - The key name\n- `expiration` - Future feature (always undefined)\n- `metadata` - Future feature (always undefined)\n\n---\n\n## Constraints & Limits\n\n| Constraint | Limit | Error Message |\n|------------|-------|---------------|\n| Key length | 512 bytes | \"KV key too long: X bytes (max 512)\" |\n| Value size | 25 MB | \"KV value too large: X bytes (max 25 MB)\" |\n| Keys per list() | 1000 | Silently limited to 1000 |\n| Keys per contract | Unlimited | Subject to storage backend limits |\n\n---\n\n## Namespace Isolation\n\nKV storage is automatically isolated per-contract:\n\n```typescript\n// Contract A\nawait kv.put('username', 'alice')\n\n// Contract B\nawait kv.get('username') // Returns null, not \"alice\"\n```\n\nEach contract has its own isolated namespace. Keys are internally prefixed with the contract name to prevent conflicts.\n\n---\n\n## Cloudflare Workers Compatibility\n\nThe API is designed to match Cloudflare Workers KV:\n\n**Matching Features:**\n- ✅ `get()` / `put()` / `delete()` / `list()` methods\n- ✅ Type options ('text', 'json')\n- ✅ Prefix filtering\n- ✅ Limit parameter\n- ✅ Same return types\n\n**Differences:**\n- ❌ No `getWithMetadata()` yet\n- ❌ No TTL/expiration yet\n- ❌ No pagination cursors yet\n- ❌ No `'arrayBuffer'` / `'stream'` types yet\n\nThis allows contracts written for Tana to be easily adapted for Cloudflare Workers and vice versa.\n\n---\n\n## Examples\n\n### Counter\n\n```typescript\nimport { kv } from 'tana/kv'\n\nexport async function contract() {\n  const current = await kv.get('counter', { type: 'json' })\n  const count = (current?.count || 0) + 1\n\n  await kv.put('counter', { count, lastUpdated: Date.now() })\n\n  return { count }\n}\n```\n\n### Session Management\n\n```typescript\nimport { kv } from 'tana/kv'\nimport { context } from 'tana/context'\n\nexport async function contract() {\n  const input = context.input()\n\n  if (input.action === 'create') {\n    const session = {\n      userId: input.userId,\n      createdAt: Date.now()\n    }\n    await kv.put(`session:${input.sessionId}`, session)\n    return { success: true }\n  }\n\n  if (input.action === 'get') {\n    const session = await kv.get(`session:${input.sessionId}`, { type: 'json' })\n    return session || { error: 'Session not found' }\n  }\n\n  if (input.action === 'delete') {\n    await kv.delete(`session:${input.sessionId}`)\n    return { success: true }\n  }\n}\n```\n\n### User Preferences\n\n```typescript\nimport { kv } from 'tana/kv'\nimport { context } from 'tana/context'\n\nexport async function get(req: Request) {\n  const caller = req.tana.caller\n  if (!caller) return { error: 'Login required' }\n\n  const prefs = await kv.get(`prefs:${caller.id}`, { type: 'json' })\n\n  return prefs || {\n    theme: 'dark',\n    notifications: true,\n    language: 'en'\n  }\n}\n\nexport async function post(req: Request) {\n  const caller = req.tana.caller\n  if (!caller) return { error: 'Login required' }\n\n  const prefs = req.body\n\n  await kv.put(`prefs:${caller.id}`, prefs)\n\n  return { success: true }\n}\n```\n\n### Cache with Prefix\n\n```typescript\nimport { kv } from 'tana/kv'\n\nexport async function contract() {\n  // Cache multiple items\n  await kv.put('cache:api:users', [{ id: 1 }, { id: 2 }])\n  await kv.put('cache:api:posts', [{ id: 1 }])\n  await kv.put('cache:db:config', { host: 'localhost' })\n\n  // List only cache:api: items\n  const apiCache = await kv.list({ prefix: 'cache:api:' })\n  console.log(apiCache.keys)\n  // [{ name: \"cache:api:posts\" }, { name: \"cache:api:users\" }]\n\n  // Clear all api cache\n  for (const key of apiCache.keys) {\n    await kv.delete(key.name)\n  }\n\n  return { cleared: apiCache.keys.length }\n}\n```\n\n---\n\n## See Also\n\n- [KV Storage Guide](/guides/kv-storage) - Usage guide with patterns\n- [KV Implementation](/contributing/runtime/modules/kv) - Technical details\n- [Smart Contracts](/guides/smart-contracts) - Contract development guide\n"
  },
  {
    "slug": [
      "contributing",
      "ledger",
      "intro"
    ],
    "metadata": {
      "title": "Ledger Service",
      "description": "Account and balance management service architecture",
      "sidebar": {
        "order": 1
      }
    },
    "content": "\nThe Tana Ledger is the core account and balance management service for the blockchain. It provides a REST API for user accounts, multi-currency balances, and transaction processing.\n\n## Features\n\n- **User Accounts** - Create and manage user accounts with Ed25519 keys\n- **Team Management** - Team creation, membership, and treasury accounts\n- **Multi-Currency Balances** - Track balances across multiple currencies (USD, EUR, BTC, etc.)\n- **Transaction Processing** - Validate and process transactions through block production\n- **REST API** - HTTP API for all account operations\n\n## Architecture\n\n```\nledger/\n├── src/\n│   ├── index.ts          # Main API server (Hono)\n│   ├── accounts/\n│   │   ├── users.ts      # User account management\n│   │   └── teams.ts      # Team account management\n│   ├── balances/\n│   │   ├── index.ts      # Balance operations\n│   │   └── currencies.ts # Currency management\n│   ├── transactions/\n│   │   ├── index.ts      # Transaction processing\n│   │   └── validator.ts  # Transaction validation\n│   ├── blocks/\n│   │   └── producer.ts   # Block production logic\n│   ├── api/\n│   │   ├── routes/       # API route handlers\n│   │   └── schemas.ts    # Zod validation schemas\n│   └── db/\n│       ├── schema.ts     # Drizzle ORM schema\n│       └── index.ts      # Database connection\n└── drizzle/              # Database migrations\n```\n\n## Development Setup\n\n### Prerequisites\n\n- Bun 1.1.38+\n- PostgreSQL 16\n- Docker (for local development)\n\n### Installation\n\n```bash\ncd ledger\n\n# Install dependencies\nbun install\n\n# Start PostgreSQL (via Docker)\ndocker-compose up -d postgres\n\n# Run database migrations\nbun run db:migrate\n\n# Start development server\nbun run dev\n```\n\nThe API will be available at `http://localhost:8080`.\n\n### Database Migrations\n\n```bash\n# Generate new migration\nbun run db:generate\n\n# Run migrations\nbun run db:migrate\n\n# Drop database (destructive!)\nbun run db:drop\n\n# Push schema changes (development only)\nbun run db:push\n\n# Open Drizzle Studio (GUI)\nbun run db:studio\n```\n\n## Block Production\n\nTransactions in Tana are processed into blocks. During development, you need to manually produce blocks to finalize pending transactions.\n\n### Manual Block Production\n\n```bash\n# From project root:\nnpm run pending    # Process pending transactions\nnpm run block      # Same as above (alias)\n\n# From ledger directory:\nnpm run pending    # Short command\nnpm run blockchain:produce  # Full command name\n```\n\n**When to run:**\n- After creating users (via mobile app or CLI)\n- After submitting transactions\n- When you want to finalize pending operations\n\n**What it does:**\n1. Finds all pending transactions in the database\n2. Executes them (user creation, transfers, contract calls, etc.)\n3. Creates a new block with those transactions\n4. Updates transaction status from \"pending\" → \"confirmed\"\n5. Updates all affected balances and state\n\n**Example output:**\n```\n🔨 Producing new block...\nLatest block: 6\nFound 3 pending transaction(s)\n\nProcessing transaction tx_abc123 (user_creation)...\n  ✓ Created user: @alice (550e8400-e29b-41d4-a716-446655440000)\n\nProcessing transaction tx_def456 (transfer)...\n  ✓ Transferred 100 USD from @alice to @bob\n\nProcessing transaction tx_ghi789 (contract_call)...\n  ✓ Executed contract cnt_myapp\n\n✅ Block produced successfully!\nBlock Details:\n  Height: 7\n  Transactions: 3\n  Gas Used: 63000 / 1000000\n  Block Hash: 0xabc123...\n```\n\n### Automatic Block Production (Future)\n\nIn production, blocks will be produced automatically at regular intervals (e.g., every 6 seconds) by a background worker or consensus mechanism. This is not yet implemented.\n\n## API Endpoints\n\n### Users\n\n```\nGET  /users               # List all users\nPOST /users               # Create new user\nGET  /users/:id           # Get user by ID\nGET  /users/username/:username  # Get user by username\nPATCH /users/:id          # Update user\nDELETE /users/:id         # Delete user\nGET  /users/:id/balances  # Get user balances\n```\n\n### Balances\n\n```\nGET  /balances            # List all balances\nPOST /balances            # Set balance (admin)\nGET  /balances/:id        # Get specific balance\n```\n\n### Transactions\n\n```\nGET  /transactions        # List all transactions\nPOST /transactions        # Create transaction\nGET  /transactions/:id    # Get transaction details\n```\n\n### Blocks\n\n```\nGET  /blocks              # List all blocks\nGET  /blocks/:height      # Get block by height\nGET  /blocks/latest       # Get latest block\n```\n\n### Contracts\n\n```\nGET  /contracts           # List all contracts\nPOST /contracts           # Deploy contract\nGET  /contracts/:id       # Get contract details\n```\n\n## Environment Variables\n\n```env\n# Server Configuration\nPORT=8080\nNODE_ENV=development\n\n# Database\nDATABASE_URL=postgres://tana:tana_dev_password@localhost:5432/tana\n\n# CORS (for playground integration)\nALLOWED_ORIGINS=http://localhost:3000,http://localhost:4321\n\n# Ledger URL (for consistency with other services)\nTANA_LEDGER_URL=http://localhost:8080\n```\n\nSee [Environment Variables](/contributing/env-vars/) for more details.\n\n## Database Schema\n\nThe ledger uses PostgreSQL with Drizzle ORM. Key tables:\n\n**users** - User accounts\n- `id` (UUID, primary key)\n- `username` (unique, must start with @)\n- `publicKey` (Ed25519 public key)\n- `displayName`, `bio`, `avatarData`\n\n**balances** - Account balances\n- `id` (UUID, primary key)\n- `ownerId` (references account)\n- `ownerType` (user, team, contract, system)\n- `amount` (numeric, precise to 8 decimals)\n- `currencyCode` (USD, EUR, BTC, etc.)\n\n**transactions** - All blockchain transactions\n- `id` (UUID, primary key)\n- `type` (user_creation, transfer, contract_call, etc.)\n- `from`, `to` (account references)\n- `amount`, `currencyCode`\n- `status` (pending, confirmed, failed)\n- `blockHeight` (null if pending)\n\n**blocks** - Blockchain blocks\n- `height` (bigint, primary key)\n- `hash` (unique block hash)\n- `timestamp`\n- `gasLimit`, `gasUsed`\n- `transactionCount`\n\n**contracts** - Deployed smart contracts\n- `id` (UUID, primary key)\n- `deployedBy` (user reference)\n- `codeHash` (contract code hash)\n- `storageRoot` (contract storage root)\n\n## Testing\n\n```bash\n# Run all tests\nbun test\n\n# Run specific test file\nbun test src/accounts/users.test.ts\n\n# Watch mode\nbun test --watch\n```\n\n## Building for Production\n\n```bash\n# Build TypeScript\nbun run build\n\n# Output in dist/\nls dist/\n\n# Run production build\nNODE_ENV=production bun dist/index.js\n```\n\n## Deployment\n\nSee the [Production Deployment](/guides/deployment/) guide for deploying the ledger service.\n\nKey points:\n- Use Docker for consistent environments\n- Set `DATABASE_URL` for PostgreSQL connection\n- Configure `ALLOWED_ORIGINS` for CORS\n- Set up Nginx reverse proxy with SSL\n- Enable automated backups\n- Monitor with health checks\n\n## Related Documentation\n\n- [Environment Variables](/contributing/env-vars/) - Configuration\n- [Block Production](/contributing/ledger/blocks/) - Block production details\n- [Transactions](/contributing/ledger/transactions/) - Transaction processing\n- [API Reference](/tana-api/intro/) - Complete API documentation\n- [Deployment Guide](/guides/deployment/) - Production deployment\n"
  },
  {
    "slug": [
      "contributing",
      "architecture"
    ],
    "metadata": {
      "title": "System Architecture",
      "description": "Learn how Tana's components work together"
    },
    "content": "\n## Overview\n\nTana consists of **three compiled binaries** and integrated services working together to provide a complete blockchain platform.\n\n## Binary Structure\n\n### 1. `tana-cli` (CLI Binary)\n\n- **Built from:** `cli/` directory (TypeScript/Bun)\n- **Compiled with:** `bun build --compile`\n- **Purpose:** Main user interface and orchestrator\n\n**Contains:**\n- All commands (`new`, `deploy`, `start`, `stop`, `status`)\n- Configuration management (`~/.config/tana/`)\n- Service spawning and process management\n- Network communication\n- Most business logic\n\n### 2. `tana-runtime` (Execution Binary)\n\n- **Built from:** `runtime/` directory (Rust)\n- **Compiled with:** `cargo build --release`\n- **Purpose:** Sandboxed TypeScript contract execution for CLI\n- **Invoked by:** CLI when running contracts locally\n- **Not persistent:** One-shot execution per contract run\n\n### 3. `tana-edge` (Edge Server Binary)\n\n- **Built from:** `tana-edge/` directory (Rust)\n- **Compiled with:** `cargo build --release`\n- **Purpose:** High-performance HTTP server for off-chain contract execution\n- **Port:** 8180 (default)\n- **Persistent:** Runs as long-lived HTTP service\n- **Features:**\n  - GET/POST endpoints for smart contracts\n  - Fresh V8 isolate per request (Cloudflare Workers-style)\n  - Sub-100ms latency for blockchain queries\n  - Production-ready with subdomain routing\n  - Accesses ledger API for blockchain data\n\n## Integrated Services\n\n### Ledger Service\n\n- **Location:** `cli/services/ledger`\n- **Built into:** The `tana` CLI binary\n- **Started with:** `tana start` command\n- **Purpose:** Blockchain state management (users, balances, transactions, blocks)\n- **Port:** 8080\n- **Persistent:** Runs until Ctrl+C or `tana stop`\n\n**Stack:** TypeScript/Bun, Hono, Drizzle ORM, PostgreSQL\n\n**Responsibilities:**\n- User/Team account management\n- Multi-currency balance tracking\n- Transaction validation\n- Block storage and queries\n- REST API for all blockchain data\n\n### Queue Service\n\n- **Location:** `cli/services/queue`\n- **Package:** `@tana/queue` (independent workspace)\n- **Purpose:** High-performance transaction queue using Redis Streams\n- **Shared by:** All validators for distributed block production\n\n**Stack:** TypeScript/Bun, ioredis\n\n**Responsibilities:**\n- Transaction queueing with O(1) submission (100,000+ tx/sec)\n- Consumer groups for distributed validators\n- Exactly-once processing with XACK\n- Deterministic transaction ordering via Stream IDs\n- Pub/Sub notifications for instant updates\n\n### Identity Service\n\n- **Location:** `cli/services/identity`\n- **Package:** `@tana/identity` (independent workspace)\n- **Purpose:** User authentication and session management (NOT blockchain data)\n- **Port:** 8090\n- **Database:** Separate PostgreSQL tables (not replicated across validators)\n\n**Stack:** TypeScript/Bun, Hono, Drizzle ORM, PostgreSQL\n\n**Responsibilities:**\n- Mobile-first QR code authentication (like WhatsApp Web)\n- Session management with real-time updates (Server-Sent Events)\n- Device token management for push notifications\n- Transaction approval workflow for mobile apps\n- Secure authentication without exposing private keys to desktop/laptop\n\n**Security Model:**\n- Private keys ONLY exist on mobile devices (hardware security)\n- Desktop/laptop computers receive session tokens only (read-only interface)\n- No MetaMask-style browser extensions (protects against malware)\n- Ed25519 signature verification for all approvals\n\n## Data Flow\n\n### Contract Deployment Flow\n\n```\nUser runs: tana deploy contract\n          ↓\n    [tana CLI binary]\n          ↓\n    1. Read config from ~/.config/tana/\n    2. Determine deployment target (local/remote)\n    3. Sign transaction with Ed25519\n    4. Validate contract code\n          ↓\n    [Ledger API] ← HTTP POST /contracts\n          ↓\n    1. Verify signature\n    2. Create transaction\n    3. Queue to Redis Streams\n          ↓\n    [Redis Queue Service] ← XADD\n          ↓\n    [Block Producer] ← XREADGROUP (consumer)\n          ↓\n    1. Consume pending transactions\n    2. Sort by Stream ID (deterministic ordering)\n    3. Execute transactions\n    4. Create new block\n    5. XACK processed transactions\n          ↓\n    [tana-runtime binary] ← Execute contracts\n          ↓\n    Return state changes\n          ↓\n    [Ledger Service] ← Commit to PostgreSQL\n```\n\n### Authentication Flow (Mobile QR Login)\n\n```\nUser clicks \"Login\" on website\n          ↓\n    [Website] ← POST /auth/session/create\n          ↓\n    [Identity Service] creates session\n          ↓\n    Returns: sessionId + challenge + QR data\n          ↓\n    [Website] displays QR code\n    [Website] opens SSE connection (/auth/session/:id/events)\n          ↓\n    [User scans QR with mobile app]\n          ↓\n    [Mobile App] ← GET /auth/session/:id\n          ↓\n    [Identity Service] marks as \"scanned\"\n          ↓\n    [SSE] → \"scanned\" event to website\n          ↓\n    [User approves on mobile]\n          ↓\n    [Mobile App] signs challenge with Ed25519\n    [Mobile App] ← POST /auth/session/:id/approve\n          ↓\n    [Identity Service] verifies signature\n    [Identity Service] generates session token\n          ↓\n    [SSE] → \"approved\" event with token to website\n          ↓\n    [Website] receives session token\n    [Website] redirects to app with authentication\n```\n\n## Configuration Structure\n\n### Global Configuration\n\n```\n~/.config/tana/\n├── config.json              # Global settings (default chain, user)\n├── chains/\n│   ├── local.json          # Local chain config\n│   └── mainnet.json        # Remote chain configs\n├── nodes/\n│   └── node-xyz.json       # Node participation configs\n└── users/\n    └── alice.json          # User credentials (keys)\n```\n\n### Project Structure\n\n```\nmy-app/\n├── contract.ts             # Contract code\n└── contract.json           # Contract metadata\n```\n\n## Component Details\n\n### Ledger Service (Port 8080)\n\n**Endpoints:**\n- `GET /health` - Health check\n- `GET /users` - List users\n- `POST /users` - Create user\n- `GET /balances` - Query balances\n- `POST /balances` - Set balance\n- `GET /transactions` - List transactions\n- `POST /transactions` - Create transaction (queues to Redis)\n- `GET /blocks` - Query blocks\n- `POST /blocks` - Create block\n- `GET /contracts` - List contracts\n- `POST /contracts` - Deploy contract\n\n**Database Tables:**\n- `users` - User accounts\n- `balances` - Multi-currency balances\n- `transactions` - Transaction history (confirmed only)\n- `currencies` - Supported currencies\n- `blocks` - Blockchain blocks\n- `contracts` - Deployed smart contracts\n\n### Identity Service (Port 8090)\n\n**Endpoints:**\n- `GET /health` - Health check\n- `POST /auth/session/create` - Create QR code authentication session\n- `GET /auth/session/:id` - Get session details (mobile app scans QR)\n- `GET /auth/session/:id/events` - SSE stream for real-time session updates\n- `POST /auth/session/:id/approve` - Mobile app approves login with signature\n- `POST /auth/session/:id/reject` - Mobile app rejects login\n- `POST /auth/session/validate` - Validate session token\n\n**Database Tables (Separate from blockchain):**\n- `auth_sessions` - QR code login sessions with status tracking\n- `transaction_requests` - Pending transaction approvals from mobile\n- `device_tokens` - Push notification tokens for mobile devices\n\n**Authentication Flow:**\n1. Website creates session with `/auth/session/create` → receives session ID + challenge\n2. Website displays QR code with session data\n3. Website opens SSE connection to `/auth/session/:id/events` for real-time updates\n4. Mobile app scans QR → calls `/auth/session/:id` → marks as \"scanned\"\n5. User approves on mobile → signs challenge with Ed25519 private key\n6. Mobile calls `/auth/session/:id/approve` with signature\n7. SSE stream notifies website → session approved with token\n8. Website receives session token for subsequent authenticated requests\n\n### Rust Runtime\n\n**Purpose:** Sandboxed V8 TypeScript execution engine\n\n- Execute smart contracts in isolated environment\n- No network access, filesystem, or system calls\n- Deterministic execution\n- Gas metering\n\n**Modules Provided:**\n- `tana/core` - Console, version info\n- `tana/utils` - Whitelisted fetch API\n- `tana/block` - Block context (height, timestamp, executor, gas)\n- `tana/tx` - Transaction staging and execution\n\n## Monorepo Structure\n\n```\ntana/                        # Monorepo root\n├── runtime/                 # Rust - V8 TypeScript execution engine\n│   ├── src/                 # Rust source (deno_core)\n│   └── Cargo.toml\n│\n├── tana-edge/               # Rust - High-performance edge server\n│   ├── src/                 # Rust source (Actix Web + V8)\n│   └── Cargo.toml\n│\n├── cli/                     # TypeScript/Bun - Command-line tools\n│   ├── core/                # Core commands and logic\n│   ├── services/            # Integrated services\n│   │   ├── ledger/          # @tana/ledger - Blockchain state (port 8080)\n│   │   ├── queue/           # @tana/queue - Redis transaction queue\n│   │   └── identity/        # @tana/identity - Authentication (port 8090)\n│   └── package.json\n│\n├── websites/                # Web applications\n│   ├── playground/          # Interactive contract playground\n│   ├── landing/             # Landing page\n│   └── docs/                # Documentation site (you are here!)\n│\n├── types/                   # Shared TypeScript type definitions\n│   ├── tana-core.d.ts\n│   ├── tana-data.d.ts\n│   ├── tana-utils.d.ts\n│   ├── tana-block.d.ts\n│   └── tana-tx.d.ts\n│\n├── examples/                # Example smart contracts\n├── docs/                    # Technical documentation (markdown)\n├── mprocs.yaml              # Multi-process configuration\n└── package.json             # Workspace management\n```\n\n## Development Workflow\n\n### Database Setup\n\nPostgreSQL stores both blockchain data and authentication data in separate tables:\n\n#### Blockchain Tables (Ledger Service)\n\n```sql\n-- Users\nCREATE TABLE users (\n  id TEXT PRIMARY KEY,\n  username TEXT UNIQUE,\n  display_name TEXT,\n  public_key TEXT,\n  nonce INTEGER DEFAULT 0,\n  bio TEXT,\n  created_at TIMESTAMP\n);\n\n-- Balances\nCREATE TABLE balances (\n  owner_id TEXT,\n  owner_type TEXT,\n  currency_code TEXT,\n  amount TEXT,\n  updated_at TIMESTAMP\n);\n\n-- Transactions (confirmed only - pending in Redis queue)\nCREATE TABLE transactions (\n  id TEXT PRIMARY KEY,\n  from_id TEXT,\n  to_id TEXT,\n  amount TEXT,\n  currency_code TEXT,\n  type TEXT,\n  status TEXT,\n  metadata JSONB,\n  created_at TIMESTAMP,\n  confirmed_at TIMESTAMP\n);\n\n-- Blocks\nCREATE TABLE blocks (\n  height INTEGER PRIMARY KEY,\n  hash TEXT,\n  parent_hash TEXT,\n  state_root TEXT,\n  timestamp TIMESTAMP,\n  producer TEXT,\n  transactions JSONB\n);\n\n-- Contracts\nCREATE TABLE contracts (\n  id TEXT PRIMARY KEY,\n  code TEXT,\n  code_hash TEXT,\n  owner_id TEXT,\n  created_at TIMESTAMP\n);\n```\n\n#### Authentication Tables (Identity Service)\n\n**Note:** These tables are separate from blockchain data and NOT replicated across validators.\n\n```sql\n-- Auth Sessions (QR code login)\nCREATE TABLE auth_sessions (\n  id TEXT PRIMARY KEY,\n  challenge TEXT NOT NULL UNIQUE,\n  status auth_session_status NOT NULL DEFAULT 'waiting',\n  user_id TEXT,\n  username TEXT,\n  public_key TEXT,\n  session_token TEXT UNIQUE,\n  return_url TEXT NOT NULL,\n  app_name TEXT,\n  app_icon TEXT,\n  created_at TIMESTAMP NOT NULL DEFAULT NOW(),\n  expires_at TIMESTAMP NOT NULL,\n  approved_at TIMESTAMP,\n  scanned_at TIMESTAMP\n);\n\n-- Transaction Requests (mobile approval)\nCREATE TABLE transaction_requests (\n  id TEXT PRIMARY KEY,\n  session_id TEXT NOT NULL REFERENCES auth_sessions(id),\n  user_id TEXT NOT NULL,\n  transaction_type TEXT NOT NULL,\n  transaction_data TEXT NOT NULL,\n  status transaction_request_status NOT NULL DEFAULT 'pending',\n  transaction_id TEXT,\n  created_at TIMESTAMP NOT NULL DEFAULT NOW(),\n  expires_at TIMESTAMP NOT NULL,\n  responded_at TIMESTAMP\n);\n\n-- Device Tokens (push notifications)\nCREATE TABLE device_tokens (\n  id TEXT PRIMARY KEY,\n  user_id TEXT NOT NULL,\n  push_token TEXT NOT NULL UNIQUE,\n  device_name TEXT,\n  platform TEXT,\n  app_version TEXT,\n  is_active TEXT NOT NULL DEFAULT 'true',\n  created_at TIMESTAMP NOT NULL DEFAULT NOW(),\n  last_used_at TIMESTAMP NOT NULL DEFAULT NOW()\n);\n```\n\n### Environment Configuration\n\nAll sensitive configuration is stored in `.env` files:\n\n```bash\n# .env\n\n# Database URLs\nDATABASE_URL='postgres://tana:[PASSWORD]@localhost:5432/tana'\nIDENTITY_DB_URL='postgres://tana:[PASSWORD]@localhost:5432/tana'  # Can use same DB\nREDIS_URL='redis://localhost:6379'\n\n# Service Ports\nPORT=8080                    # Ledger service\nIDENTITY_PORT=8090           # Identity service\nEDGE_PORT=8180              # Edge server (tana-edge)\n\n# Environment\nNODE_ENV=development\n```\n\n**Environment Variable Reference:**\n\n- `DATABASE_URL` - PostgreSQL connection string for blockchain data (ledger service)\n- `IDENTITY_DB_URL` - PostgreSQL connection string for authentication data (identity service)\n  - Can use the same database as `DATABASE_URL` (tables are separate)\n  - Identity data is NOT replicated across validators\n- `REDIS_URL` - Redis connection string for transaction queue\n  - Shared by all validators\n  - Must support Redis Streams\n- `PORT` - HTTP port for ledger service API (default: 8080)\n- `IDENTITY_PORT` - HTTP port for identity service API (default: 8090)\n- `EDGE_PORT` - HTTP port for edge server (default: 8180)\n\n## Security Model\n\n### Sandbox Isolation\n\nThe Rust runtime provides complete isolation:\n\n- No filesystem access\n- No network access (except whitelisted fetch via `tana/utils`)\n- No process spawning\n- No system calls\n- Memory limits enforced\n- Gas metering for execution costs\n\n### API Security\n\n- CORS enabled for allowed origins\n- Rate limiting on all endpoints\n- Input validation with Zod schemas\n- SQL injection protection via Drizzle ORM\n- Environment-based configuration\n\n## Deployment Architecture\n\n### Development\n\n```\nmprocs → Multiple services in one terminal\n  ├── PostgreSQL (Docker) - Blockchain + Auth data\n  ├── Redis (Docker) - Transaction queue\n  ├── Ledger Service (Bun:8080) - Blockchain API\n  ├── Identity Service (Bun:8090) - Authentication API\n  ├── Edge Server (Rust:8180) - Contract execution\n  └── Docs/Playground (Astro/Node)\n```\n\n### Production - Single Node\n\n```\nSingle VPS:\n  ├── Nginx (Reverse proxy, SSL)\n  │   ├── /api → Ledger Service (8080)\n  │   ├── /auth → Identity Service (8090)\n  │   └── /edge → Edge Server (8180)\n  ├── Docker Compose\n  │   ├── Ledger Service (port 8080)\n  │   ├── Identity Service (port 8090)\n  │   ├── PostgreSQL (blockchain + auth)\n  │   └── Redis (transaction queue)\n  ├── tana-runtime (Binary)\n  └── tana-edge (Binary on 8180)\n```\n\n### Production - Multi-Validator Network\n\n```\nNetwork Topology:\n\n[Queue Service Node]\n  └── Redis (shared by all validators)\n\n[Validator Node 1]\n  ├── PostgreSQL (own copy)\n  ├── Ledger Service (8080)\n  └── Block Producer (consumes from shared Redis)\n\n[Validator Node 2]\n  ├── PostgreSQL (own copy)\n  ├── Ledger Service (8080)\n  └── Block Producer (consumes from shared Redis)\n\n[API Node] (public-facing, read-only)\n  ├── PostgreSQL (synced via consensus)\n  ├── Ledger Service (8080)\n  ├── Identity Service (8090)\n  └── Edge Server (8180)\n\n[Mobile App]\n  └── Connects to Identity Service for auth\n```\n\n**Key Points:**\n- Each validator runs its own PostgreSQL (database replication via blockchain consensus)\n- Redis queue is shared by all validators\n- Identity service typically runs on API nodes (not validators)\n- Mobile apps connect to identity service for authentication\n- Deterministic transaction ordering ensures consensus\n\n## Next Steps\n\n- [Quick Start Guide](/guides/quickstart/) - Set up your development environment\n- [CLI Reference](/tana-cli/intro/) - Learn the CLI commands\n- [API Reference](/tana-api/intro/) - Explore the REST API\n"
  },
  {
    "slug": [
      "contributing",
      "core",
      "blocks"
    ],
    "metadata": {
      "title": "Blocks & Blockchain",
      "description": "Understanding Tana's block structure and production"
    },
    "content": "\nBlocks are the fundamental unit of Tana's blockchain, packaging transactions and establishing a tamper-proof history of all state changes.\n\n## Block Structure\n\n### Database Schema\n\n```sql\nCREATE TABLE blocks (\n  -- Block identification\n  height        BIGINT PRIMARY KEY,           -- 0 for genesis, then 1, 2, 3...\n  hash          VARCHAR(64) NOT NULL UNIQUE,  -- SHA256 of block contents\n  parent_hash   VARCHAR(64) NOT NULL,         -- Hash of previous block\n\n  -- Block metadata\n  timestamp     TIMESTAMP NOT NULL,           -- Block creation time\n  producer      UUID NOT NULL,                -- Node/user that produced this block\n\n  -- Block contents\n  transactions  JSONB NOT NULL,               -- Array of transaction IDs\n  state_root    VARCHAR(64) NOT NULL,         -- Merkle root of state\n\n  -- Execution\n  gas_used      BIGINT NOT NULL DEFAULT 0,    -- Total gas consumed\n  gas_limit     BIGINT NOT NULL,              -- Maximum gas allowed\n\n  -- Timestamps\n  created_at    TIMESTAMP NOT NULL DEFAULT NOW()\n);\n```\n\n### TypeScript Interface\n\n```typescript\ninterface Block {\n  // Identity\n  height: number          // Block number (0 = genesis)\n  hash: string           // Block hash\n  previousHash: string   // Previous block hash\n\n  // Metadata\n  timestamp: number      // Unix timestamp (ms)\n  producer: string       // Producer ID\n\n  // Contents\n  transactions: string[] // Array of transaction IDs\n  stateRoot: string      // State merkle root\n\n  // Execution\n  gasUsed: number        // Gas consumed\n  gasLimit: number       // Gas limit\n\n  // Timestamps\n  createdAt: Date\n}\n```\n\n## Genesis Block (Block 0)\n\nThe **genesis block** is block #0 - the first block in the blockchain. It establishes the initial state and network parameters.\n\n### Genesis Block Example\n\n```typescript\n{\n  // Identity\n  height: 0,\n  hash: \"0xa1b2c3d4e5f6...\",\n  previousHash: \"0x0000000000000000000000000000000000000000000000000000000000000000\",\n\n  // Metadata\n  timestamp: 1730678400000,  // Launch date\n  producer: \"tana:genesis\",\n\n  // Contents\n  transactions: [],\n  stateRoot: \"0x...\",\n\n  // Execution\n  gasUsed: 0,\n  gasLimit: 1000000,\n\n  // Genesis metadata\n  metadata: {\n    version: \"0.1.0\",\n    networkName: \"tana\",\n    chainId: 1,\n    genesisMessage: \"Tana blockchain - TypeScript smart contracts\",\n    blockTime: 6000,  // 6 second blocks\n  }\n}\n```\n\n## Block Production Flow\n\n### Current State (Development)\n\n```\nTransaction submitted\n    ↓\nDirectly applied to database\n    ↓\nBlock created with transaction\n    ↓\nState root calculated\n    ↓\nBlock finalized\n```\n\n### Future State (Production)\n\n```\n1. Transactions submitted to mempool\n    ↓\n2. Block producer selects transactions\n    ↓\n3. Execute transactions in order\n    ↓\n4. Calculate state root\n    ↓\n5. Create block with:\n   - Transactions included\n   - State root\n   - Gas used\n    ↓\n6. Sign block\n    ↓\n7. Insert block into database\n    ↓\n8. Propagate to network\n```\n\n## Block Hash Calculation\n\nBlocks are identified by the hash of their contents:\n\n```typescript\nfunction calculateBlockHash(block: Block): string {\n  const data = JSON.stringify({\n    height: block.height,\n    previousHash: block.previousHash,\n    timestamp: block.timestamp,\n    stateRoot: block.stateRoot,\n    transactions: block.transactions,\n    gasUsed: block.gasUsed,\n  })\n\n  return crypto.createHash('sha256')\n    .update(data)\n    .digest('hex')\n}\n```\n\n## State Root\n\nThe state root is a Merkle root of all account states after executing the block's transactions. This allows:\n\n- **Efficient verification** - Prove account state without full blockchain\n- **Light clients** - Verify transactions without downloading everything\n- **State snapshots** - Quick sync for new nodes\n- **Fraud proofs** - Prove invalid state transitions\n\n### State Root Calculation\n\n```typescript\nfunction calculateStateRoot(accounts: Account[]): string {\n  // Sort accounts by ID for deterministic hashing\n  const sorted = accounts.sort((a, b) => a.id.localeCompare(b.id))\n\n  // Hash each account state\n  const accountHashes = sorted.map(account => {\n    const state = {\n      id: account.id,\n      balances: account.balances,\n      nonce: account.nonce,\n    }\n    return hash(JSON.stringify(state))\n  })\n\n  // Build Merkle tree and return root\n  return buildMerkleRoot(accountHashes)\n}\n```\n\n## Block Queries\n\n### Get Latest Block\n\n```typescript\n// Via API\nGET /blocks/latest\n\n// Response\n{\n  \"height\": 12345,\n  \"hash\": \"0xa1b2c3d4...\",\n  \"timestamp\": 1699999999000,\n  \"transactions\": [\"tx1\", \"tx2\", \"tx3\"],\n  \"stateRoot\": \"0x...\",\n  \"gasUsed\": 150000,\n  \"gasLimit\": 1000000\n}\n```\n\n### Get Specific Block\n\n```typescript\n// Via API\nGET /blocks/12345\n\n// Or by hash\nGET /blocks/0xa1b2c3d4...\n```\n\n### Get Block Range\n\n```typescript\n// Via API\nGET /blocks?from=100&to=200\n\n// Returns array of blocks\n```\n\n## Block Context in Contracts\n\nSmart contracts can access block information:\n\n```typescript\nimport { console } from 'tana/core'\nimport { block } from 'tana/block'\n\n// Current block context\nconsole.log('Block height:', block.height)\nconsole.log('Block hash:', block.hash)\nconsole.log('Block timestamp:', block.timestamp)\nconsole.log('Block producer:', block.producer)\nconsole.log('Gas limit:', block.gasLimit)\n\n// Query historical blocks (future)\nconst genesis = await block.getBlock(0)\nconsole.log('Genesis message:', genesis.metadata.genesisMessage)\n```\n\n## Block Explorer\n\nQuery blocks via the API or CLI:\n\n```bash\n# Get latest block\ncurl http://localhost:8080/blocks/latest\n\n# Get specific block\ncurl http://localhost:8080/blocks/12345\n\n# Get block transactions\ncurl http://localhost:8080/blocks/12345/transactions\n```\n\n## Development Roadmap\n\n### Phase 1: Basic Blocks (Current)\n- ✅ Blocks table\n- ✅ Genesis block\n- ✅ Block creation on transaction\n- ✅ Block queries via API\n\n### Phase 2: Block Production\n- ⏳ Mempool for pending transactions\n- ⏳ Block producer service\n- ⏳ Transaction selection\n- ⏳ Automated block creation\n\n### Phase 3: Consensus\n- ⏳ Multiple validators\n- ⏳ Consensus mechanism\n- ⏳ Fork resolution\n- ⏳ Finality rules\n\n## Next Steps\n\n- [Data Model](/guides/core/data-model/) - Learn about Tana's data structures\n- [Contract Execution](/guides/core/contract-execution/) - How contracts interact with blocks\n- [API Reference](/tana-api/intro/) - Query blocks via the REST API\n"
  },
  {
    "slug": [
      "contributing",
      "core",
      "system-flows"
    ],
    "metadata": {
      "title": "System Flows",
      "description": "How data flows through Tana's services"
    },
    "content": "\nThis guide maps out the key user actions and how they flow through Tana's services.\n\n## Core User Actions\n\n### 1. User Creates Account\n\n```\nUser submits:\n  - username\n  - display_name\n  - public_key\n    ↓\nPOST /users\n    ↓\nLedger Service validates:\n  - username unique?\n  - valid format?\n    ↓\nPostgreSQL INSERT\n    ↓\nReturns: user object with ID\n```\n\n**Services Required:**\n- ✅ Ledger API\n- ✅ PostgreSQL\n\n**Status:** ✅ **READY**\n\n### 2. User Checks Balance\n\n```\nUser queries: GET /balances?ownerId=alice&currencyCode=USD\n    ↓\nLedger Service queries DB\n    ↓\nPostgreSQL SELECT\n    ↓\nReturns: { amount: \"1000.00\", currencyCode: \"USD\" }\n```\n\n**Services Required:**\n- ✅ Ledger API\n- ✅ PostgreSQL\n\n**Status:** ✅ **READY**\n\n### 3. User Sends Funds\n\n```\nUser submits: POST /transactions\n  {\n    from: \"alice\",\n    to: \"bob\",\n    amount: \"100.00\",\n    currency: \"USD\"\n  }\n    ↓\nLedger Service validates:\n  - Alice has balance >= 100?\n  - Bob exists?\n    ↓\nBEGIN TRANSACTION\n  UPDATE balances SET amount = amount - 100 WHERE owner_id = 'alice'\n  UPDATE balances SET amount = amount + 100 WHERE owner_id = 'bob'\n  INSERT INTO transactions (...)\nCOMMIT\n    ↓\nReturns: transaction ID\n```\n\n**Services Required:**\n- ✅ Ledger API\n- ✅ PostgreSQL\n\n**Status:** ✅ **READY**\n\n### 4. User Tests Contract in Playground\n\n```\nUser writes TypeScript in browser\n    ↓\nClicks \"Run\"\n    ↓\nBrowser sandbox executes:\n  - Transpiles TS → JS\n  - Runs in isolated context\n  - tana/* modules available\n    ↓\nContract reads data:\n  GET /balances (read-only)\n    ↓\nContract simulates writes:\n  tx.transfer() - staged locally\n  tx.execute() - returns mock result\n    ↓\nBrowser displays output\n```\n\n**Services Required:**\n- ✅ Playground Website\n- ✅ Ledger API (read-only)\n- ✅ Browser Sandbox\n\n**Status:** ✅ **READY**\n\n### 5. User Deploys Contract (via CLI)\n\n```\nUser runs: tana deploy contract ./my-contract.ts\n    ↓\nCLI validates contract code\n    ↓\nPOST /contracts\n  {\n    code: \"...\",\n    owner: \"alice\"\n  }\n    ↓\nLedger Service:\n  - Stores contract code\n  - Generates contract ID\n    ↓\nPostgreSQL INSERT\n    ↓\nReturns: contract_id\n```\n\n**Services Required:**\n- ✅ CLI\n- ✅ Ledger API\n- ✅ PostgreSQL\n\n**Status:** ⏳ **IN PROGRESS**\n\n### 6. User Executes Contract (Future)\n\n```\nUser calls: POST /contracts/:id/execute { args: {...} }\n    ↓\nContracts Service:\n  - Loads contract code from DB\n  - Spawns Rust runtime process\n    ↓\nRuntime executes:\n  - Reads state via tana/block\n  - Stages changes via tana/tx\n  - Returns execution result\n    ↓\nContracts Service validates:\n  - Gas limit not exceeded?\n  - Valid state transitions?\n    ↓\nIf valid:\n  POST /transactions (apply changes)\n    ↓\nReturns: execution result\n```\n\n**Services Required:**\n- ⏳ Contracts Service\n- ✅ Rust Runtime\n- ✅ Ledger API\n\n**Status:** ⏳ **PLANNED**\n\n## Data Flow Patterns\n\n### Pattern 1: Read-Only Query\n\n```\nUser → API → PostgreSQL → Response\n```\n\n**Example:** Get balance, list users, query transactions\n\n**Status:** ✅ Working\n\n### Pattern 2: Direct State Change\n\n```\nUser → API → Validate → PostgreSQL Transaction → Response\n```\n\n**Example:** Create user, transfer funds\n\n**Status:** ✅ Working\n\n### Pattern 3: Contract Execution (Future)\n\n```\nUser → API → Runtime → Validate → PostgreSQL → Response\n         ↓        ↓\n    Load Code  Execute\n```\n\n**Example:** Deploy contract, execute contract\n\n**Status:** ⏳ Planned\n\n## Service Dependencies\n\n### Current Architecture\n\n```\nCLI/Playground\n    ↓ HTTP\nLedger Service\n    ↓ TCP\nPostgreSQL\n```\n\n**Status:** ✅ Fully operational\n\n### Future Architecture\n\n```\nCLI/Playground\n    ↓ HTTP\nLedger Service\n    ↓ Subprocess\nRuntime (Rust)\n    ↓ HTTP\nLedger Service\n    ↓ TCP\nPostgreSQL + Redis\n```\n\n**Status:** ⏳ Partially implemented\n\n## Transaction Lifecycle\n\n### 1. Submission\n\n```\nUser creates transaction\n    ↓\nValidate locally (signature, format)\n    ↓\nSubmit to ledger API\n```\n\n### 2. Validation\n\n```\nLedger receives transaction\n    ↓\nValidate:\n  - Valid signature?\n  - Sufficient balance?\n  - Valid recipient?\n    ↓\nIf invalid: Reject\nIf valid: Continue\n```\n\n### 3. Execution\n\n```\nBegin database transaction\n    ↓\nUpdate balances\n    ↓\nInsert transaction record\n    ↓\nCommit\n```\n\n### 4. Confirmation\n\n```\nTransaction included in block\n    ↓\nState root updated\n    ↓\nTransaction confirmed\n```\n\n## Next Steps\n\n- [Data Model](/guides/core/data-model/) - Understand the data structures\n- [Blocks & Blockchain](/guides/core/blocks/) - Learn about block production\n- [CLI Reference](/tana-cli/intro/) - Use the command-line interface\n"
  },
  {
    "slug": [
      "contributing",
      "core",
      "data-model"
    ],
    "metadata": {
      "title": "Data Model",
      "description": "Core data structures in Tana blockchain"
    },
    "content": "\nTana's blockchain stores users, balances, transactions, contracts, and blocks. This page describes the core data model.\n\n## Primary Objects\n\n### User\n\nUser accounts are the foundation of Tana. Each user has a unique ID, public key for signatures, and multi-currency balances.\n\n```typescript\ninterface User {\n  id: string                    // Unique ID (address)\n  publicKey: string             // Ed25519 public key\n  username: string              // @alice\n  displayName: string           // \"Alice Johnson\"\n  metadata: {\n    bio?: string\n    avatarData?: string         // Small image stored on-chain (<100KB base64)\n    avatarHash?: string         // Or content hash if stored off-chain\n  }\n  balances: Map<Currency, Decimal>  // Multi-currency\n  createdAt: timestamp\n  stateHash: string             // Merkle root of account state\n}\n```\n\n### Transaction\n\nAll blockchain state changes are recorded as transactions.\n\n```typescript\ninterface Transaction {\n  id: string                    // Tx hash\n  from: string                  // User/Team ID\n  to: string                    // User/Team ID\n  amount: Decimal\n  currency: Currency            // USD, BTC, ETH, etc.\n  type: 'transfer' | 'deposit' | 'withdraw' | 'contract_call' | 'user_creation'\n  contractId?: string           // If contract execution\n  contractInput?: any           // Arguments\n  signature: string             // Ed25519\n  timestamp: timestamp\n  blockHeight: number           // Block inclusion\n  status: 'pending' | 'confirmed' | 'failed'\n}\n```\n\n### Currency\n\nTana supports multi-currency balances without requiring a native token.\n\n```typescript\ninterface Currency {\n  code: string                  // \"USD\", \"BTC\", \"ETH\"\n  name: string                  // \"US Dollar\", \"Bitcoin\"\n  symbol: string                // \"$\", \"₿\"\n  decimals: number              // Precision (e.g., 2 for USD, 8 for BTC)\n  type: 'fiat' | 'crypto'\n  verified: boolean             // Is this a recognized currency?\n}\n```\n\n### Smart Contract\n\nContracts are TypeScript code deployed on-chain with isolated key-value storage.\n\n```typescript\ninterface SmartContract {\n  id: string                    // Contract address\n  codeHash: string              // SHA-256 of code\n  code: string                  // TypeScript source\n  author: string                // User ID\n  deployedAt: timestamp\n  storage: Map<string, string>  // Key-value state (tana/data)\n  metadata: {\n    name?: string\n    description?: string\n    version?: string\n  }\n}\n```\n\n### Block\n\nBlocks package transactions and establish blockchain state.\n\n```typescript\ninterface Block {\n  id: string                    // Block hash\n  height: number                // Block number (0 = genesis)\n  timestamp: timestamp\n  previousHash: string          // Previous block\n  transactions: string[]        // Tx hashes\n  stateRoot: string             // Merkle root of all account states\n  validatorSignature: string    // Block producer signature\n  gasUsed: number              // Gas consumed\n  gasLimit: number             // Gas limit\n}\n```\n\n## Database Schema\n\n### Users Table\n\n```sql\nCREATE TABLE users (\n  id TEXT PRIMARY KEY,\n  username TEXT UNIQUE NOT NULL,\n  display_name TEXT,\n  public_key TEXT NOT NULL,\n  bio TEXT,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n### Balances Table\n\n```sql\nCREATE TABLE balances (\n  owner_id TEXT NOT NULL,\n  owner_type TEXT NOT NULL,\n  currency_code TEXT NOT NULL,\n  amount TEXT NOT NULL,  -- Stored as string for precision\n  updated_at TIMESTAMP DEFAULT NOW(),\n  PRIMARY KEY (owner_id, currency_code)\n);\n```\n\n### Transactions Table\n\n```sql\nCREATE TABLE transactions (\n  id TEXT PRIMARY KEY,\n  from_id TEXT,\n  to_id TEXT,\n  amount TEXT,\n  currency_code TEXT NOT NULL,\n  type TEXT NOT NULL,\n  status TEXT NOT NULL DEFAULT 'pending',\n  block_height INTEGER,\n  metadata JSONB,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n### Currencies Table\n\n```sql\nCREATE TABLE currencies (\n  code TEXT PRIMARY KEY,\n  name TEXT NOT NULL,\n  symbol TEXT NOT NULL,\n  decimals INTEGER NOT NULL,\n  is_active BOOLEAN DEFAULT true,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n### Blocks Table\n\n```sql\nCREATE TABLE blocks (\n  height INTEGER PRIMARY KEY,\n  hash TEXT UNIQUE NOT NULL,\n  parent_hash TEXT NOT NULL,\n  state_root TEXT NOT NULL,\n  timestamp TIMESTAMP NOT NULL,\n  producer TEXT NOT NULL,\n  transactions JSONB NOT NULL,\n  gas_used BIGINT DEFAULT 0,\n  gas_limit BIGINT NOT NULL,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n### Contracts Table\n\n```sql\nCREATE TABLE contracts (\n  id TEXT PRIMARY KEY,\n  code TEXT NOT NULL,\n  owner_id TEXT NOT NULL,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n### KV Storage Table\n\nPer-contract key-value storage for `tana/kv` module.\n\n```sql\nCREATE TABLE kv_storage (\n  contract_name TEXT NOT NULL,\n  key TEXT NOT NULL,\n  value TEXT NOT NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (contract_name, key)\n);\n\nCREATE INDEX idx_kv_contract ON kv_storage(contract_name);\n```\n\n**Notes:**\n- Each contract has isolated namespace via `contract_name`\n- Keys automatically prefixed: `\"{contract_name}:{key}\"`\n- Max key length: 512 bytes\n- Max value size: 25 MB\n- Used by `tana/kv` module (Cloudflare Workers-compatible API)\n\n## State Management\n\n### Account State\n\nEach user and team has a state hash that represents their complete state:\n\n- All balances across all currencies\n- Account metadata\n- Contract storage (if applicable)\n\n### State Root\n\nEach block has a state root - a Merkle root of all account state hashes. This allows:\n\n- Efficient state verification\n- Light client support\n- State snapshots\n- Fraud proofs\n\n### Transaction Flow\n\n```\nUser submits transaction\n    ↓\nValidate (signature, balance, etc.)\n    ↓\nAdd to pending transactions\n    ↓\nBlock producer includes in block\n    ↓\nExecute transaction\n    ↓\nUpdate account states\n    ↓\nCalculate new state root\n    ↓\nFinalize block\n```\n\n## Next Steps\n\n- [Blocks & Blockchain](/guides/core/blocks/) - Learn about block structure\n- [Contract Execution](/guides/core/contract-execution/) - How contracts interact with state\n- [API Reference](/tana-api/intro/) - Interact with the data model via API\n"
  },
  {
    "slug": [
      "contributing",
      "setup"
    ],
    "metadata": {
      "title": "Development Setup",
      "description": "Build Tana from source for development",
      "sidebar": {
        "order": 2
      }
    },
    "content": "\nThis guide is for **contributors** who want to build Tana from source. If you just want to use Tana, see the [Quick Start](/guides/quickstart/) instead.\n\n## Prerequisites\n\n- [Bun](https://bun.sh) >= 1.0 (TypeScript runtime)\n- [Rust](https://rustup.rs) >= 1.70 (for runtime binary)\n- [Docker](https://docker.com) (for PostgreSQL and Redis)\n- [mprocs](https://github.com/pvolok/mprocs) (optional, for multi-process management)\n\n## Clone Repository\n\n```bash\ngit clone https://github.com/conoda/tana.git\ncd tana\n```\n\n## Install Dependencies\n\n```bash\n# Install all workspace dependencies\nbun install\n```\n\n## Build Rust Runtime\n\n```bash\ncd runtime\ncargo build --release\ncd ..\n```\n\nThis creates the `tana-runtime` binary at `runtime/target/release/tana-runtime`.\n\n## Build CLI (Optional)\n\n```bash\ncd cli\nbun run make\ncd ..\n```\n\nThis creates a standalone `tana` binary at `cli/dist/tana`.\n\n## Start Development Environment\n\n### Option 1: All Services with mprocs (Recommended)\n\n```bash\nnpm run dev\n# or\n./dev.sh\n```\n\nThis starts:\n- ✅ PostgreSQL (auto)\n- ✅ Redis (auto)\n- ✅ Ledger Service (auto) - http://localhost:8080\n- ✅ Playground (auto) - http://localhost:4321\n- ⏸️ Contracts Service (manual)\n- ⏸️ Node Service (manual)\n\n**mprocs shortcuts:**\n- `Tab` - Switch between processes\n- `Space` - Start/stop a process\n- `Ctrl+A` then `Q` - Quit all processes\n- `Ctrl+A` then `K` - Kill a process\n- `Arrow keys` - Navigate\n\n### Option 2: Individual Services\n\n```bash\n# Start database infrastructure\nnpm run db:up\n\n# Start individual services\nbun cli/main.ts start      # Ledger service (port 8080)\nnpm run dev:contracts       # Contracts (port 8081)\nnpm run dev:node            # Blockchain node (port 9933)\nnpm run dev:playground      # Playground (port 4321)\n```\n\n## Environment Configuration\n\nCreate a `.env` file in the project root:\n\n```bash\ncp .env.example .env\n```\n\nEdit `.env` to configure:\n\n```bash\n# Database\nDATABASE_URL='postgres://tana:[PASSWORD]@localhost:5432/tana'\n\n# Redis\nREDIS_URL='redis://localhost:6379'\n\n# Service Ports\nLEDGER_PORT=8080\nCONTRACTS_PORT=8081\nNODE_PORT=9933\n\n# Environment\nNODE_ENV=development\n```\n\n## Testing\n\n```bash\n# Run all tests\nbun test\n\n# Test specific service\nbun run --filter @tana/ledger test\n\n# Test Rust runtime\ncd runtime && cargo test\n```\n\n## Common Development Tasks\n\n### Database Management\n\n```bash\n# Start databases\nnpm run db:up\n\n# Stop databases\nnpm run db:down\n\n# View logs\nnpm run db:logs\n\n# Reset databases (warning: deletes all data)\ndocker compose down -v && npm run db:up\n```\n\n### Building\n\n```bash\n# Build all services\nnpm run build\n\n# Build Rust runtime\nnpm run build:runtime\n\n# Build CLI binary\ncd cli && bun run make\n```\n\n### Running Examples\n\n```bash\n# Test the runtime\nbun run chaintest\n\n# Run a contract\ncd runtime\ncargo run -- ../examples/default.ts\n```\n\n## Troubleshooting\n\n### Port Already in Use\n\n```bash\n# Kill process on port 8080\nlsof -ti:8080 | xargs kill -9\n\n# Check what's using a port\nlsof -i :8080\n```\n\n### Database Connection Errors\n\n```bash\n# Restart PostgreSQL\ndocker compose restart postgres\n\n# Check logs\ndocker compose logs postgres\n\n# Verify DATABASE_URL in .env\ncat .env | grep DATABASE_URL\n```\n\n### Build Errors\n\n```bash\n# Clean and rebuild\nrm -rf node_modules\nbun install\n\n# Rust\ncd runtime\ncargo clean\ncargo build --release\n```\n\n## Project Structure\n\n```\ntana/\n├── cli/             # CLI binary (TypeScript/Bun)\n├── runtime/         # Contract execution (Rust)\n├── ledger/          # Ledger service (TypeScript/Bun)\n├── contracts/       # Contract executor (TypeScript/Bun)\n├── node/            # Blockchain node (TypeScript/Bun)\n├── websites/\n│   ├── docs/        # Documentation (Astro/Starlight)\n│   ├── playground/  # Contract playground (Astro/Svelte)\n│   └── landing/     # Landing page (Next.js)\n├── types/           # Shared TypeScript types\n├── examples/        # Example contracts\n└── docs/            # Technical documentation\n```\n\n## Next Steps\n\n- Read [System Architecture](/contributing/architecture/) to understand how Tana works\n- Explore [Core Concepts](/contributing/core/data-model/) for technical details\n- Check out [Testing Guide](/contributing/testing/) for writing tests\n"
  },
  {
    "slug": [
      "contributing",
      "intro"
    ],
    "metadata": {
      "title": "Contributing",
      "description": "Guide for contributing to Tana development",
      "sidebar": {
        "order": 1
      }
    },
    "content": "\nThank you for your interest in contributing to Tana! This section contains documentation for developers who want to contribute to the project.\n\n## For Users vs Contributors\n\n**If you're a user** looking to use Tana:\n- See [Quick Start](/guides/quickstart/) for installation\n- See [CLI Reference](/tana-cli/intro/) for commands\n- See [API Reference](/tana-api/intro/) for API endpoints\n\n**If you're a contributor** looking to develop Tana:\n- Continue reading this section\n- See [Development Setup](/contributing/setup/) to build from source\n- See [System Architecture](/contributing/architecture/) to understand the codebase\n\n## What's in This Section\n\n### Development\n- [Development Setup](/contributing/setup/) - Build Tana from source\n- [System Architecture](/contributing/architecture/) - How Tana works internally\n- [Testing](/contributing/testing/) - Running tests\n\n### Technical Details\n- [Data Model](/contributing/core/data-model/) - Database schemas and structures\n- [Blocks & Blockchain](/contributing/core/blocks/) - Block production and validation\n- [System Flows](/contributing/core/system-flows/) - Internal data flows\n\n## Ways to Contribute\n\n### Code Contributions\n- Fix bugs\n- Add features\n- Improve performance\n- Write tests\n\n### Documentation\n- Improve existing docs\n- Add examples\n- Fix typos\n- Translate documentation\n\n### Community\n- Help others in discussions\n- Report bugs\n- Suggest features\n- Write blog posts or tutorials\n\n## Getting Help\n\n- **GitHub Issues**: Report bugs or request features\n- **GitHub Discussions**: Ask questions and share ideas\n- **Discord**: Join the community (coming soon)\n\n## Code of Conduct\n\nBe respectful, inclusive, and professional. We're all here to learn and build together.\n"
  },
  {
    "slug": [
      "contributing",
      "runtime",
      "intro"
    ],
    "metadata": {
      "title": "Runtime Architecture",
      "description": "V8-based TypeScript runtime for smart contracts",
      "sidebar": {
        "order": 1
      }
    },
    "content": "\nTana Runtime is a lightweight JavaScript/TypeScript runtime built on **deno_core** (Deno's V8 engine). It provides a sandboxed execution environment for TypeScript smart contracts, similar to Cloudflare Workers.\n\n## Overview\n\nThe runtime creates a secure sandbox for executing TypeScript with:\n\n1. **V8 JavaScript Engine** - Via deno_core for native performance\n2. **TypeScript Compiler** - Dynamically transpiles TypeScript to JavaScript\n3. **Custom Module System** - Virtual modules like `tana:core`, `tana:data`, `tana:utils`\n4. **Sandbox Isolation** - Hides Deno API, exposes only whitelisted functionality\n5. **Dual Environment Support** - Same code runs in CLI runtime and browser playground\n\n## Quick Start\n\n```bash\n# Run the Rust CLI runtime\ncd runtime\ncargo run\n\n# Or run a specific script\ncargo run example.ts\n```\n\n## Architecture\n\n### Runtime Stack\n\n```\n┌─────────────────────────────────────┐\n│   TypeScript Smart Contracts        │\n├─────────────────────────────────────┤\n│   Virtual Modules (tana:core, etc)  │\n├─────────────────────────────────────┤\n│   TypeScript Compiler (typescript.js)│\n├─────────────────────────────────────┤\n│   Sandboxed V8 Runtime (deno_core)  │\n├─────────────────────────────────────┤\n│   Rust Runtime / Browser Playground │\n└─────────────────────────────────────┘\n```\n\n### Core Components\n\n**src/main.rs** - Main runtime entry point\n- Initializes `JsRuntime` with deno_core\n- Loads internal modules\n- Defines ops (Rust↔JavaScript bridge)\n- Bootstraps V8 with tana-globals.ts\n\n**src/lib.rs** - Library exports for WASM builds\n\n**build.rs** - Build script\n- Extracts version info (Tana, Deno Core, V8)\n- Embeds metadata at compile time\n\n**tana-globals.ts** - Bootstrap code\n- Defines `globalThis.tana`\n- Hides `Deno` API for isolation\n- Sets up module loader\n\n**typescript.js** - Embedded TypeScript compiler\n- Bundled compiler for `.ts` → `.js` transpilation\n- Loaded into V8 at runtime\n\n### Execution Flow\n\n1. `main.rs` bootstraps V8 + deno_core runtime\n2. Loads `typescript.js` compiler into V8\n3. Injects `tana-globals.ts` and hides `Deno` API\n4. Registers virtual modules (`tana:core`, `tana:data`, etc.)\n5. Reads user script (e.g., `example.ts`)\n6. Transpiles TypeScript → JavaScript\n7. Executes in sandbox with isolated state\n\n## Implemented Features\n\n### Storage API (`tana:data`)\n\n**Status:** ✅ Feature parity achieved (works identically in both environments)\n\n```typescript\nimport { data } from 'tana:data'\n\n// Set values (staged, not committed yet)\nawait data.set('counter', 42)\nawait data.set('user', { name: 'Alice', balance: 1000 })\n\n// Read values\nconst count = await data.get('counter')  // 42\nconst user = await data.get('user')      // { name: 'Alice', balance: 1000 }\n\n// Pattern matching\nawait data.set('user:1:name', 'Bob')\nawait data.set('user:2:name', 'Charlie')\nconst userKeys = await data.keys('user:*')  // ['user:1:name', 'user:2:name']\n\n// Atomic commit (all or nothing)\nawait data.commit()\n```\n\n**Implementation:**\n- **Playground:** localStorage backend with full persistence\n- **Rust Runtime:** In-memory HashMap (resets each run)\n- **Planned:** Redis backend for production persistence\n\n**Storage Limits:**\n- Max key size: 256 bytes\n- Max value size: 10 KB\n- Max total size: 100 KB per contract\n- Max keys: 1000\n\n**Key Features:**\n- Staging buffer with atomic commits\n- Size validation before persistence\n- JSON auto-serialization\n- Glob pattern matching support\n\n### Fetch API (`tana:utils`)\n\n**Status:** ✅ Working in both environments\n\n```typescript\nimport { fetch } from 'tana:utils'\n\n// Whitelisted domains only\nconst data = await fetch('https://pokeapi.co/api/v2/pokemon/ditto')\nconsole.log(data)\n```\n\n**Security:**\n- Domain whitelist: `pokeapi.co`, `tana.dev`, `localhost`, etc.\n- Rust: reqwest + tokio async runtime\n- Playground: browser fetch with same whitelist\n\n### Console API (`tana:core`)\n\n**Status:** ✅ Working in both environments\n\n```typescript\nimport { console } from 'tana:core'\n\nconsole.log('Hello from Tana!')\nconsole.error('Error message')\n\n// Runtime version info\nimport { version } from 'tana:core'\nconsole.log(version.tana)       // \"0.1.0\"\nconsole.log(version.deno_core)  // \"0.338\"\nconsole.log(version.v8)         // \"13.2.281.5\"\n```\n\n## Feature Parity Strategy\n\n**Dual Environment Support:**\n\n1. **Rust CLI Runtime** (`cargo run`) - Production-ready V8 sandbox\n2. **Browser Playground** (Astro/Svelte web app) - Development/testing UI\n\n**Synchronization Points:**\n- `src/main.rs` - Rust ops definitions\n- `playground/src/pages/sandbox.astro` - JavaScript module implementations\n- `types/*.d.ts` - Shared TypeScript definitions\n- `playground/src/components/Editor.svelte` - Monaco type definitions\n\n**Rule:** If it's in the type definitions, it MUST work in BOTH environments.\n\n## File Structure\n\n### Core Runtime Files\n\n| File | Description |\n|------|-------------|\n| **src/main.rs** | Main entry point, initializes JsRuntime, defines ops |\n| **src/lib.rs** | Library exports for WASM builds |\n| **build.rs** | Build script extracting version info |\n| **Cargo.toml** | Rust dependencies and package configuration |\n| **typescript.js** | Embedded TypeScript compiler |\n| **tana-globals.ts** | Bootstrap defining `globalThis.tana` |\n\n### TypeScript & Type Definitions\n\n| File | Description |\n|------|-------------|\n| **types/tana.d.ts** | Type declarations for `tana` and `tana:core` |\n| **types/tana-data.d.ts** | Type declarations for `tana:data` storage |\n| **types/tana-utils.d.ts** | Type declarations for `tana:utils` |\n| **tsconfig.json** | TypeScript config mapping `\"tana:*\"` paths |\n\n### Example & Test Files\n\n| File | Description |\n|------|-------------|\n| **example.ts** | Example TypeScript program |\n| **counter-test.ts** | Simple counter demonstrating storage API |\n| **test-storage.ts** | Comprehensive storage API tests |\n| **test-fetch.ts** | Fetch API tests |\n\n## Technical Stack\n\n### Rust Dependencies\n\n```toml\ndeno_core = \"0.338\"          # V8 runtime\ndeno_error = \"0.5.7\"         # Error handling\nreqwest = \"0.12\"             # HTTP client\ntokio = \"1\"                  # Async runtime\nredis = \"0.27\"               # Database client (planned)\nserde_json = \"1.0\"           # JSON handling\nwasm-bindgen = \"0.2\"         # WASM support\n```\n\n## Example Smart Contract\n\n```typescript\nimport { console } from 'tana:core'\nimport { data } from 'tana:data'\n\n// Simple token transfer contract\nasync function transfer(from: string, to: string, amount: number) {\n  // Read current balances\n  const fromBalance = parseInt((await data.get(`balance:${from}`)) as string)\n  const toBalance = parseInt((await data.get(`balance:${to}`)) as string)\n\n  // Validate\n  if (fromBalance < amount) {\n    throw new Error('Insufficient balance')\n  }\n\n  // Update balances\n  await data.set(`balance:${from}`, String(fromBalance - amount))\n  await data.set(`balance:${to}`, String(toBalance + amount))\n\n  // Commit atomically (both balances updated or neither)\n  await data.commit()\n\n  console.log(`Transferred ${amount} from ${from} to ${to}`)\n}\n\n// Initialize balances\nawait data.set('balance:alice', '1000')\nawait data.set('balance:bob', '500')\nawait data.commit()\n\n// Execute transfer\nawait transfer('alice', 'bob', 200)\n\n// Check new balances\nconsole.log('Alice:', await data.get('balance:alice'))  // '800'\nconsole.log('Bob:', await data.get('balance:bob'))      // '700'\n```\n\n## Testing\n\n### CLI Runtime\n\n```bash\n# Run example script\ncargo run\n\n# Run specific test\ncargo run counter-test.ts\ncargo run test-storage.ts\ncargo run test-fetch.ts\n```\n\n### Browser Playground\n\n```bash\ncd playground\nnpm install\nnpm run dev\n```\n\nOpen http://localhost:4322/ and use the Monaco editor to write and run TypeScript contracts.\n\n**Inspect Storage:**\n1. Open Browser DevTools (F12)\n2. Go to **Application > Local Storage**\n3. Look for keys starting with `tana:data:`\n\n## Development Status\n\n### Working ✅\n\n- V8 runtime bootstrapping\n- TypeScript transpilation\n- Module system (`tana:core`, `tana:data`, `tana:utils`)\n- Storage API with staging + atomic commits\n- Fetch API with domain whitelist\n- Browser playground with Monaco editor\n- Feature parity between CLI and playground\n- JSON auto-serialization for storage\n- Glob pattern matching for keys\n\n### In Progress 🚧\n\n- Redis backend for persistent storage (Rust runtime)\n- Docker setup for database services\n- Blockchain integration (`tana:blockchain` module)\n- Data View tab in playground UI\n- Gas costs and storage rent model\n\n### Planned 📋\n\n- PostgreSQL integration for ledger state\n- Ed25519 signature verification\n- Block batching and Merkle proofs\n- Multi-currency account system\n- Contract deployment and versioning\n- API endpoints for network access\n\n## Next Steps\n\n1. **Redis Integration** - Add persistent storage backend to Rust runtime\n2. **Docker Compose** - Setup Redis + PostgreSQL services\n3. **Data View Tab** - Add UI to visualize storage in playground\n4. **Blockchain Module** - Implement `tana:blockchain` API\n5. **Gas Costs** - Add metering for storage operations\n6. **Contract Deployment** - Support uploading and versioning contracts\n\n## Important Notes\n\n- `globalThis.Deno` is deleted to ensure true sandbox isolation\n- The current module system will be replaced by a Rust `ModuleLoader`\n- Storage limits prevent abuse (similar to Ethereum gas model)\n- Same TypeScript code runs in CLI and browser playground\n- Contracts are deterministic state machines identified by code hash\n\n## Related Documentation\n\n- [Smart Contract Examples](/guides/smart-contracts/) - Writing contracts\n- [Edge Server](/contributing/edge/intro/) - Production contract execution\n- [Environment Variables](/contributing/env-vars/) - Configuration\n"
  },
  {
    "slug": [
      "contributing",
      "runtime",
      "modules",
      "kv"
    ],
    "metadata": {
      "title": "KV Storage Implementation",
      "description": "Technical details of tana/kv module across all runtimes"
    },
    "content": "\nTechnical reference for the `tana/kv` module implementation across tana-runtime, tana-edge, and playground environments.\n\n## Architecture Overview\n\nKV storage provides Cloudflare Workers-compatible key-value storage with automatic per-contract namespace isolation.\n\n### Namespace Isolation\n\nAll keys are internally prefixed with the contract name:\n```\nStored Key Format: \"{contract_name}:{user_key}\"\nExample: \"my_contract:username\" → \"alice\"\n```\n\nThis ensures contracts cannot access each other's data.\n\n## Runtime Implementations\n\n### tana-runtime (Rust CLI)\n\n**Location:** `runtime/src/tana_kv.rs`, `runtime/src/main.rs`\n\n**Storage Backend:** PostgreSQL (migration `0011_kv_storage.sql`)\n\n**Schema:**\n```sql\nCREATE TABLE kv_storage (\n  contract_name TEXT NOT NULL,\n  key TEXT NOT NULL,\n  value TEXT NOT NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (contract_name, key)\n);\n```\n\n**Rust Ops:**\n```rust\n#[op2]\n#[string]\nfn op_kv_get_raw(\n    state: &OpState,\n    #[string] key: String,\n) -> Result<Option<String>, JsErrorBox>\n\n#[op2(fast)]\nfn op_kv_put_raw(\n    state: &OpState,\n    #[string] key: String,\n    #[string] value: String,\n) -> Result<(), JsErrorBox>\n\n#[op2(fast)]\nfn op_kv_delete_raw(\n    state: &OpState,\n    #[string] key: String,\n) -> Result<(), JsErrorBox>\n\n#[op2]\n#[serde]\nfn op_kv_list_keys(\n    state: &OpState,\n    #[string] prefix: Option<String>,\n    #[serde] limit: Option<usize>,\n) -> Result<Vec<String>, JsErrorBox>\n```\n\n**JavaScript Bridge:**\n```typescript\n// Uses context.contract_name() from OpState\nconst contractName = globalThis.__tanaCore.ops.op_context_contract_name()\nglobalThis.__tanaCore.ops.op_kv_get_raw(key) // Automatically namespaced\n```\n\n**Characteristics:**\n- ✅ Persistent across restarts\n- ✅ ACID transactions via PostgreSQL\n- ✅ Production-ready\n- 📊 Performance: ~1-5ms per operation\n\n---\n\n### tana-edge (Rust HTTP Server)\n\n**Location:** `tana-edge/src/main.rs` (lines 41-49, 335-460, 1163-1196)\n\n**Storage Backend:** In-memory HashMap (Redis-ready)\n\n**Data Structure:**\n```rust\nstatic KV_STORAGE: Mutex<Option<HashMap<String, String>>> = Mutex::new(None);\n```\n\n**Rust Ops:**\n```rust\n// Same signatures as tana-runtime, but contract_name passed as parameter\n#[op2]\n#[string]\nfn op_kv_get_raw(\n    #[string] contract_name: String,\n    #[string] key: String,\n) -> Result<Option<String>, JsErrorBox>\n\n// ... put, delete, list ops similar\n```\n\n**JavaScript Bridge:**\n```typescript\n// Hardcoded contract name for development\nconst contractName = \"edge_contract\"\nconst rawValue = globalThis.__tanaCore.ops.op_kv_get_raw(contractName, key)\n```\n\n**Characteristics:**\n- ⚡ Very fast (in-memory)\n- ❌ Not persistent (resets on restart)\n- 🔧 Development/testing use\n- 🚀 Production: Replace with Redis backend\n- 📊 Performance: <0.1ms per operation\n\n---\n\n### playground (Browser/TypeScript)\n\n**Location:**\n- `websites/playground/src/pages/sandbox.astro` (lines 691-811)\n- `websites/playground/src/components/Editor.svelte` (lines 277-318)\n\n**Storage Backend:** Browser localStorage\n\n**Key Format:**\n```\nlocalStorage Key: \"tana_kv_playground:playground_contract:{user_key}\"\nExample: \"tana_kv_playground:playground_contract:username\"\n```\n\n**Implementation:**\n```typescript\nconst kv = {\n  async get(key: string, options?: KVGetOptions) {\n    const storageKey = `tana_kv_playground:playground_contract:${key}`\n    const value = localStorage.getItem(storageKey)\n    if (!value) return null\n\n    const type = options?.type || 'text'\n    return type === 'json' ? JSON.parse(value) : value\n  },\n\n  async put(key: string, value: string | object) {\n    const storageKey = `tana_kv_playground:playground_contract:${key}`\n    const serialized = typeof value === 'string' ? value : JSON.stringify(value)\n    localStorage.setItem(storageKey, serialized)\n  },\n\n  async delete(key: string) {\n    const storageKey = `tana_kv_playground:playground_contract:${key}`\n    localStorage.removeItem(storageKey)\n  },\n\n  async list(options?: KVListOptions): Promise<KVListResult> {\n    const prefix = `tana_kv_playground:playground_contract:${options?.prefix || ''}`\n    const limit = options?.limit || 1000\n    const keys: string[] = []\n\n    for (let i = 0; i < localStorage.length; i++) {\n      const fullKey = localStorage.key(i)\n      if (fullKey?.startsWith(prefix)) {\n        const userKey = fullKey.replace('tana_kv_playground:playground_contract:', '')\n        keys.push(userKey)\n        if (keys.length >= limit) break\n      }\n    }\n\n    keys.sort()\n    return {\n      keys: keys.map(name => ({ name })),\n      list_complete: true,\n      cursor: null\n    }\n  }\n}\n```\n\n**Characteristics:**\n- 💾 Persistent per-browser\n- 🚀 Instant execution\n- 📏 Limited to ~5-10MB total\n- 🧪 Great for experimentation\n- 📊 Performance: <0.1ms per operation\n\n## API Consistency\n\nAll three runtimes implement identical JavaScript API:\n\n```typescript\ninterface KV {\n  get(key: string, options?: { type?: 'text' | 'json' }): Promise<string | object | null>\n  put(key: string, value: string | object, options?: KVPutOptions): Promise<void>\n  delete(key: string): Promise<void>\n  list(options?: { prefix?: string, limit?: number }): Promise<KVListResult>\n}\n```\n\nThis ensures contracts are **portable** - code written in playground works identically in tana-runtime and tana-edge.\n\n## Validation & Limits\n\nAll runtimes enforce:\n\n| Constraint | Value | Error |\n|------------|-------|-------|\n| Max key length | 512 bytes | \"KV key too long\" |\n| Max value size | 25 MB | \"KV value too large\" |\n| Max list() keys | 1000 | Silently limited |\n\nValidation happens in Rust ops before storage:\n\n```rust\nif key.len() > MAX_KV_KEY_LENGTH {\n    return Err(JsErrorBox::new(\"Error\",\n        format!(\"KV key too long: {} bytes (max {})\", key.len(), MAX_KV_KEY_LENGTH)\n    ));\n}\n\nif value.len() > MAX_KV_VALUE_SIZE {\n    return Err(JsErrorBox::new(\"Error\",\n        format!(\"KV value too large: {} bytes (max {})\", value.len(), MAX_KV_VALUE_SIZE)\n    ));\n}\n```\n\n## Type Definitions\n\n**Location:** `types/tana-kv.d.ts`\n\nProvides full TypeScript definitions with:\n- Method overloads for type inference\n- JSDoc documentation\n- Cloudflare Workers compatibility notes\n\nExample type inference:\n```typescript\n// TypeScript knows this returns string | null\nconst text = await kv.get('key')\n\n// TypeScript knows this returns any | null\nconst json = await kv.get('key', { type: 'json' })\n```\n\n## Performance Characteristics\n\n| Operation | Runtime | Edge | Playground |\n|-----------|---------|------|------------|\n| get() | 1-5ms | <0.1ms | <0.1ms |\n| put() | 2-10ms | <0.1ms | <0.1ms |\n| delete() | 1-5ms | <0.1ms | <0.1ms |\n| list(100) | 5-20ms | <1ms | <1ms |\n| list(1000) | 20-100ms | 1-5ms | 5-10ms |\n\n**Notes:**\n- Runtime: PostgreSQL network + query time\n- Edge: Pure in-memory HashMap lookups\n- Playground: localStorage DOM API overhead\n\n## Future Enhancements\n\n### Planned Features\n- ⏰ **TTL Support** - Automatic expiration\n- 📊 **Metadata** - Custom key metadata\n- 📄 **Pagination** - Cursor-based list()\n- 🔄 **Bulk Operations** - Batch get/put/delete\n- 🔍 **Range Queries** - Key range scans\n\n### Implementation Notes\n\n**TTL (expirationTtl/expiration):**\n```sql\n-- PostgreSQL schema addition\nALTER TABLE kv_storage ADD COLUMN expires_at TIMESTAMP;\nCREATE INDEX idx_kv_expires ON kv_storage(expires_at) WHERE expires_at IS NOT NULL;\n```\n\n**Metadata:**\n```sql\nALTER TABLE kv_storage ADD COLUMN metadata JSONB;\n```\n\n**Pagination:**\n```typescript\n// Return cursor in list() results\nreturn {\n  keys: [...],\n  list_complete: false,\n  cursor: \"offset:1000\" // For next page\n}\n```\n\n## Testing\n\nRun KV storage tests:\n\n```bash\n# tana-runtime\n./target/release/tana-runtime examples/kv-test.ts\n\n# tana-edge\n./target/release/tana-edge\ncurl -X POST http://localhost:8082/test \\\n  -H \"Content-Type: text/plain\" \\\n  -d \"$(cat examples/kv-test.ts)\"\n\n# playground\n# Open browser, paste code from examples/kv-test.ts\n```\n\n## Common Issues\n\n**\"KV key too long\"**\n- Key exceeds 512 bytes\n- Solution: Use shorter keys or hash long identifiers\n\n**\"KV value too large\"**\n- Value exceeds 25 MB\n- Solution: Split large data across multiple keys\n\n**Namespace collision**\n- Different contracts trying to access same data\n- This is prevented by automatic namespacing\n\n**list() returns empty**\n- No keys match prefix\n- Check prefix syntax (no wildcards, exact string match)\n\n## Migration Guide\n\n### From tana/data to tana/kv\n\n```typescript\n// OLD: tana/data (synchronous)\nimport { data } from 'tana/data'\ndata.set('key', 'value')\nconst value = data.get('key')\n\n// NEW: tana/kv (async)\nimport { kv } from 'tana/kv'\nawait kv.put('key', 'value')\nconst value = await kv.get('key')\n```\n\n**Key differences:**\n- `kv.*` is async (returns Promises)\n- `kv.put()` auto-serializes objects\n- `kv.list()` provides structured results\n- `kv.get()` supports type hints\n\nBoth modules remain available. Use `tana/data` for simple synchronous storage, `tana/kv` for Cloudflare-compatible async patterns.\n"
  },
  {
    "slug": [
      "contributing",
      "env-vars"
    ],
    "metadata": {
      "title": "Environment Variables",
      "description": "Configuration via environment variables",
      "sidebar": {
        "order": 3
      }
    },
    "content": "\nTana uses environment variables for configuration across all components. This provides a simple, consistent way to configure development, testing, and production environments.\n\n## TANA_LEDGER_URL\n\n**Purpose:** Configures the ledger API endpoint for all Tana components\n\n**Default:** `http://localhost:8080`\n\n**Usage:**\n```bash\n# Development (default - no env var needed)\ntana new user @alice\n\n# Remote chain\nexport TANA_LEDGER_URL=https://mainnet.tana.network\ntana new user @alice\n\n# Per-command override\nTANA_LEDGER_URL=https://testnet.tana.network tana deploy user @alice\n```\n\n### Components That Use This Variable\n\n**CLI (TypeScript/Bun):**\n```typescript\n// cli/utils/config.ts\nexport function getLedgerUrl(): string {\n  return process.env.TANA_LEDGER_URL || 'http://localhost:8080'\n}\n```\n\n**Contract Runner Script:**\n```typescript\n// scripts/run-contract.ts\nconst LEDGER_URL = process.env.TANA_LEDGER_URL || 'http://localhost:8080';\n```\n\n**Edge Server (Rust):**\n```rust\n// tana-edge/src/main.rs\nuse std::env;\nlet ledger_url = env::var(\"TANA_LEDGER_URL\")\n    .unwrap_or_else(|_| \"http://localhost:8080\".to_string());\n```\n\n**Mobile App (React Native/Expo):**\n```javascript\n// mobile/app.config.js\nextra: {\n  ledgerApiUrl: process.env.TANA_LEDGER_URL || 'http://localhost:8080'\n}\n```\n\n### Framework-Specific Considerations\n\nDifferent frameworks access environment variables differently:\n\n**Bun/Node.js:**\n```typescript\nprocess.env.TANA_LEDGER_URL\n```\n\n**Astro:**\n```typescript\nimport.meta.env.TANA_LEDGER_URL\n// Add to .env file in project root\n```\n\n**Next.js:**\n```typescript\n// Server-side\nprocess.env.TANA_LEDGER_URL\n\n// Client-side (requires NEXT_PUBLIC_ prefix)\nprocess.env.NEXT_PUBLIC_TANA_LEDGER_URL\n```\n\n**Vite:**\n```typescript\nimport.meta.env.VITE_TANA_LEDGER_URL\n// Add to .env file with VITE_ prefix\n```\n\n**Rust:**\n```rust\nuse std::env;\nenv::var(\"TANA_LEDGER_URL\").unwrap_or_else(|_| \"default\".to_string())\n```\n\n## Development Workflows\n\n### Local Development\n\nFor local development, the default value (`http://localhost:8080`) works automatically:\n\n```bash\n# Start the ledger\ntana start\n\n# Use CLI (automatically connects to localhost:8080)\ntana new user @alice\ntana deploy user @alice\n```\n\n### Multi-Chain Development\n\nSwitch between chains by setting the environment variable:\n\n```bash\n# Work on local development chain\nTANA_LEDGER_URL=http://localhost:8080 tana status\n\n# Work on testnet\nTANA_LEDGER_URL=https://testnet.tana.network tana status\n\n# Work on custom community chain\nTANA_LEDGER_URL=https://my-chain.example.com tana status\n```\n\n### Docker/Container Deployment\n\n**Dockerfile:**\n```dockerfile\nENV TANA_LEDGER_URL=https://mainnet.tana.network\n```\n\n**docker-compose.yml:**\n```yaml\nservices:\n  tana-edge:\n    environment:\n      - TANA_LEDGER_URL=https://mainnet.tana.network\n```\n\n**Kubernetes:**\n```yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: tana-config\ndata:\n  TANA_LEDGER_URL: \"https://mainnet.tana.network\"\n```\n\n### CI/CD Pipelines\n\n**GitHub Actions:**\n```yaml\nenv:\n  TANA_LEDGER_URL: https://testnet.tana.network\n\nsteps:\n  - name: Run tests\n    run: bun test\n    env:\n      TANA_LEDGER_URL: http://localhost:8080\n```\n\n**GitLab CI:**\n```yaml\nvariables:\n  TANA_LEDGER_URL: \"https://testnet.tana.network\"\n```\n\n## Production Configuration\n\n### Managed Hosting (tana.network)\n\nWhen using the official tana.network hosted service:\n\n```bash\nexport TANA_LEDGER_URL=https://api.tana.network\n```\n\n### Self-Hosted\n\nWhen running your own blockchain infrastructure:\n\n```bash\n# Single instance\nexport TANA_LEDGER_URL=https://ledger.mycompany.com\n\n# Load balanced\nexport TANA_LEDGER_URL=https://ledger-lb.mycompany.com\n\n# Internal network\nexport TANA_LEDGER_URL=http://ledger.internal:8080\n```\n\n## Validation and Debugging\n\n### Check Current Configuration\n\n**CLI Status:**\n```bash\ntana status\n# Shows: Ledger: ● Running on http://localhost:8080\n```\n\n**Environment Check:**\n```bash\necho $TANA_LEDGER_URL\n# Should output the URL or be empty (uses default)\n```\n\n### Common Issues\n\n**Issue:** CLI can't connect to ledger\n```bash\n# Check if ledger is reachable\ncurl $TANA_LEDGER_URL/health\n\n# Verify environment variable is set correctly\necho $TANA_LEDGER_URL\n```\n\n**Issue:** Wrong chain being targeted\n```bash\n# Check current configuration\ntana status\n\n# Override temporarily\nTANA_LEDGER_URL=https://correct-chain.com tana status\n```\n\n**Issue:** Docker container can't reach localhost\n```bash\n# In Docker, localhost refers to the container\n# Use host.docker.internal on Mac/Windows or host network mode on Linux\n\n# Docker for Mac/Windows\nexport TANA_LEDGER_URL=http://host.docker.internal:8080\n\n# Docker for Linux (use host network)\ndocker run --network host -e TANA_LEDGER_URL=http://localhost:8080 ...\n```\n\n## DATABASE_URL\n\n**Purpose:** PostgreSQL connection string for blockchain data (ledger service)\n\n**Default:** None (required for ledger service)\n\n**Format:** `postgres://username:password@host:port/database`\n\n**Usage:**\n```bash\n# Development\nexport DATABASE_URL='postgres://tana:tana_dev_password@localhost:5432/tana'\n\n# Production\nexport DATABASE_URL='postgres://prod_user:secure_password@db.example.com:5432/tana_prod'\n```\n\n**Used by:**\n- Ledger service (blockchain state storage)\n- Block producer scripts\n- Database migration tools\n\n## IDENTITY_DB_URL\n\n**Purpose:** PostgreSQL connection string for authentication data (identity service)\n\n**Default:** Falls back to `DATABASE_URL` if not set\n\n**Format:** `postgres://username:password@host:port/database`\n\n**Usage:**\n```bash\n# Development (can use same database as blockchain)\nexport IDENTITY_DB_URL='postgres://tana:tana_dev_password@localhost:5432/tana'\n\n# Production (recommended: separate database for security)\nexport IDENTITY_DB_URL='postgres://identity_user:secure_password@identity-db.example.com:5432/tana_identity'\n```\n\n**Notes:**\n- Authentication tables are separate from blockchain data\n- NOT replicated across validators\n- Can use same database as `DATABASE_URL` (tables don't overlap)\n- Identity service only runs on API nodes (not validators)\n\n**Used by:**\n- Identity service (QR authentication, session management)\n\n## REDIS_URL\n\n**Purpose:** Redis connection string for transaction queue\n\n**Default:** `redis://localhost:6379`\n\n**Format:** `redis://[username:password@]host:port[/database]`\n\n**Usage:**\n```bash\n# Development\nexport REDIS_URL='redis://localhost:6379'\n\n# Production with authentication\nexport REDIS_URL='redis://username:password@redis.example.com:6379'\n\n# Redis Cluster\nexport REDIS_URL='redis://redis-cluster.example.com:6379'\n```\n\n**Requirements:**\n- Redis 7+ required (Redis Streams support)\n- Must support XADD, XREADGROUP, XACK commands\n- Shared by all validators in the network\n\n**Used by:**\n- Ledger service (transaction submission)\n- Queue service (transaction queueing)\n- Block producer scripts (transaction consumption)\n\n## PORT\n\n**Purpose:** HTTP port for ledger service API\n\n**Default:** `8080`\n\n**Usage:**\n```bash\n# Development (default)\nexport PORT=8080\n\n# Production (custom port)\nexport PORT=3000\n```\n\n**Used by:**\n- Ledger service HTTP server\n\n## IDENTITY_PORT\n\n**Purpose:** HTTP port for identity service API\n\n**Default:** `8090`\n\n**Usage:**\n```bash\n# Development (default)\nexport IDENTITY_PORT=8090\n\n# Production (custom port)\nexport IDENTITY_PORT=3001\n```\n\n**Used by:**\n- Identity service HTTP server\n\n## EDGE_PORT\n\n**Purpose:** HTTP port for edge server (contract execution)\n\n**Default:** `8180`\n\n**Usage:**\n```bash\n# Development (default)\nexport EDGE_PORT=8180\n\n# Production (custom port)\nexport EDGE_PORT=8000\n```\n\n**Used by:**\n- Tana Edge server (Rust binary)\n\n## Service URLs for Client Applications\n\n**Purpose:** Configure client apps to connect to Tana services\n\n### TANA_IDENTITY_URL\n\n**Default:** `http://localhost:8090`\n\n**Usage:**\n```bash\n# Development\nexport TANA_IDENTITY_URL=http://localhost:8090\n\n# Production\nexport TANA_IDENTITY_URL=https://auth.tana.network\n```\n\n**Used by:**\n- Website applications (QR login pages)\n- Mobile apps (authentication flows)\n\n### TANA_EDGE_URL\n\n**Default:** `http://localhost:8180`\n\n**Usage:**\n```bash\n# Development\nexport TANA_EDGE_URL=http://localhost:8180\n\n# Production\nexport TANA_EDGE_URL=https://edge.tana.network\n```\n\n**Used by:**\n- Applications calling contract endpoints\n- Edge function deployments\n\n## Complete Development Setup\n\nFor local development, create a `.env` file in your project root:\n\n```bash\n# .env\n\n# Database connections\nDATABASE_URL='postgres://tana:tana_dev_password@localhost:5432/tana'\nIDENTITY_DB_URL='postgres://tana:tana_dev_password@localhost:5432/tana'\nREDIS_URL='redis://localhost:6379'\n\n# Service ports\nPORT=8080                    # Ledger service\nIDENTITY_PORT=8090           # Identity service\nEDGE_PORT=8180              # Edge server\n\n# Client URLs (for connecting to services)\nTANA_LEDGER_URL=http://localhost:8080\nTANA_IDENTITY_URL=http://localhost:8090\nTANA_EDGE_URL=http://localhost:8180\n\n# Environment\nNODE_ENV=development\n```\n\n## Complete Production Setup\n\nFor production deployment:\n\n```bash\n# .env.production\n\n# Database connections (use secure passwords!)\nDATABASE_URL='postgres://prod_user:SECURE_PASSWORD@db.internal:5432/tana_prod'\nIDENTITY_DB_URL='postgres://identity_user:SECURE_PASSWORD@identity-db.internal:5432/tana_identity'\nREDIS_URL='redis://redis_user:SECURE_PASSWORD@redis.internal:6379'\n\n# Service ports (behind reverse proxy)\nPORT=8080\nIDENTITY_PORT=8090\nEDGE_PORT=8180\n\n# Public URLs (with SSL)\nTANA_LEDGER_URL=https://api.tana.network\nTANA_IDENTITY_URL=https://auth.tana.network\nTANA_EDGE_URL=https://edge.tana.network\n\n# Environment\nNODE_ENV=production\n```\n\n## Best Practices\n\n1. **Never commit `.env` files with secrets** - Use `.env.example` instead\n2. **Use different values per environment** - dev, staging, production\n3. **Validate URLs before deployment** - Ensure endpoints are reachable\n4. **Document custom chains** - Keep track of which URL points where\n5. **Use HTTPS in production** - Never use `http://` for production chains\n6. **Set sensible defaults** - localhost:8080 works for most development\n\n## Related Documentation\n\n- [Development Setup](/contributing/setup/) - Initial environment configuration\n- [Architecture](/contributing/architecture/) - System design overview\n- [Deployment Guide](#) - Production deployment best practices (coming soon)\n"
  },
  {
    "slug": [],
    "metadata": {
      "title": "Tana Documentation",
      "description": "A blockchain with smart contracts written in TypeScript",
      "template": "splash",
      "hero": {
        "tagline": "User-owned blockchain with TypeScript smart contracts. No native token required.",
        "image": {
          "file": "../../assets/houston.webp"
        },
        "actions": [
          {
            "text": "Quick Start",
            "link": "/guides/quickstart/",
            "icon": "right-arrow",
            "variant": "primary"
          },
          {
            "text": "View on GitHub",
            "link": "https://github.com/conoda/tana",
            "icon": "external",
            "variant": "minimal"
          }
        ]
      }
    },
    "content": "\nimport { Card, CardGrid } from '@astrojs/starlight/components';\n\n## What is Tana?\n\nTana is a blockchain platform designed to be **user-owned and operated**. Anyone can start their own blockchain or join existing networks as a validator node. Smart contracts are written in familiar **TypeScript** and executed in a sandboxed V8 environment.\n\n## Key Features\n\n<CardGrid>\n  <Card title=\"TypeScript Contracts\" icon=\"seti:typescript\">\n    Write smart contracts in TypeScript - no new language to learn. Full type safety and familiar tooling.\n  </Card>\n\n  <Card title=\"Multi-Currency Support\" icon=\"puzzle\">\n    No native token required. Create and manage any currency directly in your contracts.\n  </Card>\n\n  <Card title=\"CLI-First Design\" icon=\"laptop\">\n    Everything controllable from the terminal. Deploy, manage, and monitor your blockchain from the command line.\n  </Card>\n\n  <Card title=\"Decentralized Nodes\" icon=\"setting\">\n    Start your own chain or join existing networks. Full validator node capabilities.\n  </Card>\n</CardGrid>\n\n## Quick Example\n\n```typescript\nimport { console } from 'tana/core'\n\n// Simple counter contract\nconst current = await data.get('counter')\nconst count = current ? parseInt(current) : 0\n\nawait data.set('counter', String(count + 1))\nawait data.commit()\n\nconsole.log('Counter:', count + 1)\n```\n\n## For Users\n\n<CardGrid>\n  <Card title=\"Quick Start\" icon=\"rocket\">\n    Install Tana and start using the blockchain.\n\n    [Get Started →](/guides/quickstart/)\n  </Card>\n\n  <Card title=\"CLI Reference\" icon=\"laptop\">\n    Complete command reference for the Tana CLI.\n\n    [View Commands →](/tana-cli/intro/)\n  </Card>\n\n  <Card title=\"API Reference\" icon=\"open-book\">\n    REST API documentation for the ledger service.\n\n    [View API →](/tana-api/intro/)\n  </Card>\n</CardGrid>\n\n## For Contributors\n\n<CardGrid>\n  <Card title=\"Development Setup\" icon=\"setting\">\n    Build Tana from source and set up your dev environment.\n\n    [Get Started →](/contributing/setup/)\n  </Card>\n\n  <Card title=\"System Architecture\" icon=\"puzzle\">\n    Learn how Tana's components work together internally.\n\n    [Learn More →](/contributing/architecture/)\n  </Card>\n\n  <Card title=\"Core Concepts\" icon=\"document\">\n    Deep dive into data models, blocks, and system flows.\n\n    [Technical Docs →](/contributing/core/data-model/)\n  </Card>\n</CardGrid>\n\n## Architecture Overview\n\nTana consists of **three compiled binaries** and integrated services:\n\n- **`tana-cli`** - Main user interface built with TypeScript/Bun\n- **`tana-runtime`** - Rust-based V8 execution engine for CLI contract execution\n- **`tana-edge`** - High-performance HTTP server for off-chain contract APIs\n- **Ledger Service** - Integrated blockchain state management\n\nAll orchestrated through a simple, powerful CLI:\n\n```bash\n# Create a new blockchain\ntana new chain my-chain\n\n# Start your chain\ntana start\n\n# Deploy a smart contract\ntana deploy contract ./my-contract.ts\n```\n\n---\n\n**Status:** Early development - Not production ready\n\nBuilt with Rust (deno_core), TypeScript, Bun, PostgreSQL, and Astro.\n"
  },
  {
    "slug": [
      "cli",
      "commands"
    ],
    "metadata": {
      "title": "CLI Commands",
      "description": "Complete reference for all tana CLI commands"
    },
    "content": "\n# CLI Commands\n\nThe tana CLI provides commands for managing your blockchain, deploying contracts, and interacting with the network.\n\n## Installation\n\nInstall the tana CLI globally:\n\n```bash\nnpm install -g @tana/cli\n```\n\n## Global Options\n\nThese options work with all commands:\n\n- `--help` - Show help for a command\n- `--version` - Show CLI version\n- `--config <path>` - Use custom config file\n\n## Commands\n\n### `tana new`\n\nCreate new blockchain entities.\n\n#### `tana new chain`\n\nInitialize a new blockchain.\n\n```bash\ntana new chain [name]\n```\n\n**Options:**\n- `--port <number>` - HTTP port (default: 8080)\n- `--no-autostart` - Don't start services automatically\n\n**Example:**\n```bash\ntana new chain my-blockchain\n```\n\n#### `tana new user`\n\nCreate a new user account.\n\n```bash\ntana new user <username>\n```\n\n**Example:**\n```bash\ntana new user alice\n```\n\n#### `tana new contract`\n\nGenerate a contract template.\n\n```bash\ntana new contract <name>\n```\n\n**Example:**\n```bash\ntana new contract token\n```\n\n### `tana deploy`\n\nDeploy entities to the blockchain.\n\n#### `tana deploy user`\n\nDeploy a user to the blockchain.\n\n```bash\ntana deploy user <username>\n```\n\n**Example:**\n```bash\ntana deploy user alice\n```\n\n#### `tana deploy contract`\n\nDeploy a smart contract.\n\n```bash\ntana deploy contract <file>\n```\n\n**Options:**\n- `--owner <userId>` - Contract owner (default: current user)\n\n**Example:**\n```bash\ntana deploy contract ./token.ts\n```\n\n### `tana start`\n\nStart all tana services.\n\n```bash\ntana start\n```\n\nThis starts:\n- Ledger service (port 8080)\n- Identity service (port 8090)\n- Edge server (port 8180)\n- Block producer\n- Event listener\n\n**Options:**\n- `--ledger-port <number>` - Ledger port\n- `--identity-port <number>` - Identity port\n- `--edge-port <number>` - Edge server port\n\n### `tana stop`\n\nStop all running services.\n\n```bash\ntana stop\n```\n\n### `tana status`\n\nCheck service status.\n\n```bash\ntana status\n```\n\nShows:\n- Running services\n- Port numbers\n- Process IDs\n\n### `tana call`\n\nCall a contract function.\n\n```bash\ntana call <contractId> [input]\n```\n\n**Example:**\n```bash\ntana call ctr_abc123 '{\"amount\": 100}'\n```\n\n## Configuration\n\nConfig file location: `~/.config/tana/config.json`\n\n**Example config:**\n```json\n{\n  \"ledgerPort\": 8080,\n  \"identityPort\": 8090,\n  \"edgePort\": 8180,\n  \"databaseUrl\": \"postgres://localhost:5432/tana\"\n}\n```\n\n## Environment Variables\n\n- `DATABASE_URL` - PostgreSQL connection string\n- `REDIS_URL` - Redis connection string\n- `PORT` - Default service port\n- `NODE_ENV` - Environment (development/production)\n\n## Next Steps\n\n- [Deploy your first contract](/docs/guides/quickstart)\n- [Smart contract structure](/docs/guides/smart-contracts)\n- [API Reference](/docs/api/intro)\n"
  },
  {
    "slug": [
      "tana-app",
      "intro"
    ],
    "metadata": {
      "title": "Mobile App",
      "description": "Secure wallet and signing approvals for Tana",
      "sidebar": {
        "order": 1
      }
    },
    "content": "\nTana Mobile is a React Native application built with Expo that provides secure wallet storage, balance visibility, and transaction signing for the Tana blockchain.\n\n## Features\n\n- **Secure Key Storage** - Ed25519 wallet keys stored entirely on-device using secure storage\n- **Balance Visibility** - View your current ledger balances linked to wallet addresses\n- **Transaction Signing** - Authorize external requests (web, CLI) by signing challenge payloads\n- **Automatic Registration** - Wallets are automatically registered on the blockchain when created\n- **Multi-Platform** - iOS, Android, and Web support via Expo\n\n## Getting Started\n\n### Installation\n\n```bash\ncd mobile\nnpm install\nnpm run start  # Opens Expo Dev Tools\n```\n\nLaunch directly on a platform:\n```bash\nnpm run ios      # iOS simulator\nnpm run android  # Android emulator\nnpm run web      # Web browser\n```\n\n### Environment Configuration\n\nBy default, the app connects to your local development ledger at `http://localhost:8080`.\n\nMake sure your local ledger service is running:\n\n```bash\n# Start the app (defaults to localhost:8080)\nnpm start\n```\n\nThen press `i` for iOS simulator or `a` for Android emulator.\n\n**To connect to production:**\n\n```bash\n# Option 1: Use the convenience script\nnpm run start:prod\n\n# Option 2: Set TANA_LEDGER_URL manually\nTANA_LEDGER_URL=https://mainnet.tana.network npm start\n```\n\nSee [Environment Variables](/contributing/env-vars/) for more configuration options.\n\n## Using the App\n\n### Creating a Wallet\n\n1. **Open the Vault screen** - Your main wallet dashboard\n2. **Tap \"Add Wallet\"**\n3. **Choose an option:**\n   - **Generate New** - Creates a new Ed25519 keypair\n   - **Import Existing** - Import from private key\n4. **Enter details:**\n   - Display name (your public blockchain name)\n   - Username (unique blockchain handle, must start with @)\n5. **Tap \"Generate & Register\" or \"Import & Register\"**\n\nYour wallet is automatically registered on the blockchain with your public key!\n\n### Blockchain Registration\n\nEvery wallet creation automatically registers on the blockchain:\n- Username must be unique (app will error if taken)\n- Display name and username are required fields\n- Backend creates a `user_creation` transaction immediately\n- **Registration completes when the next block is produced**\n\n**Transaction Flow:**\n- Wallet is saved locally immediately with a pre-assigned user ID\n- The user creation transaction is marked as \"pending\"\n- User appears on blockchain after block production\n- In production, blocks are produced automatically (e.g., every 6 seconds)\n\n### Viewing Balances\n\nFrom the Vault screen:\n- See all your wallets and their balances\n- Tap a wallet to view details\n- Copy public keys or export private keys (securely!)\n\n### Signing Transactions\n\nThe approval screen accepts QR codes or manual challenges:\n1. Scan a QR code or paste a challenge\n2. Choose which wallet to sign with\n3. Review the transaction details\n4. Approve to generate an Ed25519 signature\n\nYour signature can then be used to authorize transactions on the blockchain.\n\n## Security\n\n- **Wallet metadata** stored in `AsyncStorage`\n- **Private keys** stored in secure storage (`expo-secure-store`)\n- **Keys never leave your device** - all signing happens locally\n- **Export keys before uninstalling** - secure storage is cleared on uninstall\n\n:::caution\nAlways back up your private keys! If you lose your device and haven't exported your keys, they cannot be recovered.\n:::\n\n## Troubleshooting\n\n### White Screen on Launch\n\nIf you see a white screen, ensure all dependencies are installed:\n\n```bash\nnpx expo-doctor  # Check for issues\nnpx expo install --fix  # Fix package versions\n```\n\nCommon fixes:\n- Install `expo-font`: `npx expo install expo-font`\n- Remove `@types/react-native` if installed (types are included with react-native)\n\n### Xcode Version\n\nExpo SDK 51+ requires Xcode ≤16.2.0. If you have a newer version:\n- Downgrade Xcode for iOS builds\n- Use the Expo Go app for testing instead of building locally\n\n### Connection Issues\n\nIf the app can't connect to the ledger:\n- Verify the ledger is running: `tana status`\n- Check the `TANA_LEDGER_URL` environment variable\n- For local development on a physical device, use your computer's IP address instead of `localhost`\n\n## Technical Details\n\n### Project Structure\n\n```\nmobile/\n├── App.tsx                     # Entry point with navigation\n├── app.config.js               # Expo configuration + env vars\n├── src/\n│   ├── components/\n│   │   └── KeyCard.tsx         # Wallet summary display\n│   ├── contexts/\n│   │   └── KeyStoreContext.tsx # Wallet vault + secure storage\n│   ├── lib/\n│   │   └── ledgerApi.ts        # REST API client\n│   ├── screens/\n│   │   ├── AddKeyScreen.tsx    # Generate/import wallets\n│   │   ├── LoginApprovalScreen.tsx # Challenge signing\n│   │   └── VaultScreen.tsx     # Wallet list, balances\n│   └── utils/\n│       └── crypto.ts           # Ed25519 cryptography\n```\n\n### Compatibility\n\n- React Native 0.81 / Expo SDK 54\n- TypeScript strict mode enabled\n- Ed25519 via `@noble/ed25519`\n- QR scanning via `expo-camera`\n\n## Future Enhancements\n\n- Biometric authentication for transaction signing\n- QR-powered challenges for easier approvals\n- Push/deep link handling for automatic approval requests\n- Encrypted backup/export flows for device migration\n- Multi-network support with configurable endpoints\n\n## Related Documentation\n\n- [CLI Commands](/tana-cli/commands/) - Command-line interface\n- [API Reference](/tana-api/intro/) - Ledger API endpoints\n- [Environment Variables](/contributing/env-vars/) - Configuration options\n"
  },
  {
    "slug": [
      "guides",
      "patterns",
      "kv-patterns"
    ],
    "metadata": {
      "title": "KV Design Patterns",
      "description": "Advanced patterns and techniques for KV storage"
    },
    "content": "\nCommon patterns and techniques for building sophisticated applications with KV storage.\n\n## Indexing with Prefixes\n\nUse key prefixes to create queryable \"indexes\" without a separate index system.\n\n```typescript\nimport { kv } from 'tana/kv'\n\n// Store user data with multiple access patterns\nasync function createUser(id: string, email: string, username: string) {\n  const user = { id, email, username, created: Date.now() }\n\n  // Primary key: user ID\n  await kv.put(`user:${id}`, user)\n\n  // Secondary indexes\n  await kv.put(`email:${email}`, id)  // Email → ID lookup\n  await kv.put(`username:${username}`, id)  // Username → ID lookup\n\n  return user\n}\n\n// Lookup by email\nasync function getUserByEmail(email: string) {\n  const userId = await kv.get(`email:${email}`)\n  if (!userId) return null\n\n  return await kv.get(`user:${userId}`, { type: 'json' })\n}\n\n// List all users\nasync function listUsers() {\n  const result = await kv.list({ prefix: 'user:' })\n  const users = []\n\n  for (const key of result.keys) {\n    const user = await kv.get(key.name, { type: 'json' })\n    users.push(user)\n  }\n\n  return users\n}\n```\n\n## Atomic Counters\n\nImplement counters that increment atomically.\n\n```typescript\nimport { kv } from 'tana/kv'\n\nasync function incrementCounter(name: string): Promise<number> {\n  const current = await kv.get(`counter:${name}`, { type: 'json' })\n  const newCount = (current?.value || 0) + 1\n\n  await kv.put(`counter:${name}`, {\n    value: newCount,\n    lastUpdated: Date.now()\n  })\n\n  return newCount\n}\n\n// Track page views\nexport async function get(req: Request) {\n  const page = req.url\n  const views = await incrementCounter(`views:${page}`)\n\n  return { page, views }\n}\n```\n\n## TTL Simulation\n\nManually implement time-to-live expiration.\n\n```typescript\nimport { kv } from 'tana/kv'\n\nasync function putWithTTL(key: string, value: any, ttlSeconds: number) {\n  const expiresAt = Date.now() + (ttlSeconds * 1000)\n\n  await kv.put(key, {\n    value,\n    expiresAt\n  })\n}\n\nasync function getWithTTL(key: string) {\n  const data = await kv.get(key, { type: 'json' })\n\n  if (!data) return null\n\n  // Check expiration\n  if (data.expiresAt && Date.now() > data.expiresAt) {\n    await kv.delete(key)  // Clean up expired key\n    return null\n  }\n\n  return data.value\n}\n\n// Cache with 5 minute TTL\nawait putWithTTL('cache:api:users', users, 300)\n```\n\n## Pagination\n\nImplement cursor-based pagination for large datasets.\n\n```typescript\nimport { kv } from 'tana/kv'\n\ninterface PaginatedResult<T> {\n  items: T[]\n  nextCursor: string | null\n  hasMore: boolean\n}\n\nasync function paginateUsers(\n  cursor: string | null,\n  limit: number = 10\n): Promise<PaginatedResult<any>> {\n  // List with limit + 1 to detect if more items exist\n  const result = await kv.list({\n    prefix: 'user:',\n    limit: limit + 1\n  })\n\n  // Fetch actual data\n  const items = []\n  for (let i = 0; i < Math.min(limit, result.keys.length); i++) {\n    const user = await kv.get(result.keys[i].name, { type: 'json' })\n    items.push(user)\n  }\n\n  // Check if more items exist\n  const hasMore = result.keys.length > limit\n  const nextCursor = hasMore ? result.keys[limit - 1].name : null\n\n  return { items, nextCursor, hasMore }\n}\n\n// Usage\nexport async function get(req: Request) {\n  const cursor = req.query.cursor || null\n  const page = await paginateUsers(cursor, 10)\n\n  return page\n}\n```\n\n## Rate Limiting\n\nTrack request rates per user or IP.\n\n```typescript\nimport { kv } from 'tana/kv'\n\nasync function checkRateLimit(\n  identifier: string,\n  maxRequests: number,\n  windowSeconds: number\n): Promise<{ allowed: boolean; remaining: number }> {\n  const key = `ratelimit:${identifier}`\n  const now = Date.now()\n  const windowStart = now - (windowSeconds * 1000)\n\n  // Get request log\n  const data = await kv.get(key, { type: 'json' })\n  const requests = data?.requests || []\n\n  // Filter to current window\n  const recentRequests = requests.filter((ts: number) => ts > windowStart)\n\n  // Check limit\n  const allowed = recentRequests.length < maxRequests\n\n  if (allowed) {\n    recentRequests.push(now)\n    await kv.put(key, { requests: recentRequests })\n  }\n\n  return {\n    allowed,\n    remaining: Math.max(0, maxRequests - recentRequests.length)\n  }\n}\n\n// Apply rate limit\nexport async function post(req: Request, body: any) {\n  const userId = req.tana.caller?.id\n\n  if (!userId) {\n    return { error: 'Login required' }\n  }\n\n  const limit = await checkRateLimit(userId, 100, 60)  // 100 req/min\n\n  if (!limit.allowed) {\n    return {\n      error: 'Rate limit exceeded',\n      remaining: limit.remaining\n    }\n  }\n\n  // Process request...\n  return { success: true }\n}\n```\n\n## Cache Invalidation\n\nImplement cache with manual invalidation.\n\n```typescript\nimport { kv } from 'tana/kv'\n\nclass Cache {\n  // Set with version tag\n  async set(key: string, value: any, tags: string[] = []) {\n    await kv.put(`cache:${key}`, { value, tags, cachedAt: Date.now() })\n\n    // Track keys by tag\n    for (const tag of tags) {\n      const tagData = await kv.get(`tag:${tag}`, { type: 'json' })\n      const keys = tagData?.keys || []\n\n      if (!keys.includes(key)) {\n        keys.push(key)\n        await kv.put(`tag:${tag}`, { keys })\n      }\n    }\n  }\n\n  // Get from cache\n  async get(key: string) {\n    const data = await kv.get(`cache:${key}`, { type: 'json' })\n    return data?.value || null\n  }\n\n  // Invalidate by tag\n  async invalidateTag(tag: string) {\n    const tagData = await kv.get(`tag:${tag}`, { type: 'json' })\n    if (!tagData) return\n\n    // Delete all keys with this tag\n    for (const key of tagData.keys) {\n      await kv.delete(`cache:${key}`)\n    }\n\n    await kv.delete(`tag:${tag}`)\n  }\n}\n\nconst cache = new Cache()\n\n// Cache user data with tag\nawait cache.set('user:123', userData, ['users', 'user:123'])\n\n// Invalidate all user caches\nawait cache.invalidateTag('users')\n```\n\n## Batch Operations\n\nEfficiently handle multiple KV operations.\n\n```typescript\nimport { kv } from 'tana/kv'\n\nasync function batchGet(keys: string[]) {\n  const promises = keys.map(key => kv.get(key, { type: 'json' }))\n  return await Promise.all(promises)\n}\n\nasync function batchPut(entries: Record<string, any>) {\n  const promises = Object.entries(entries).map(([key, value]) =>\n    kv.put(key, value)\n  )\n  await Promise.all(promises)\n}\n\nasync function batchDelete(keys: string[]) {\n  const promises = keys.map(key => kv.delete(key))\n  await Promise.all(promises)\n}\n\n// Usage\nexport async function post(req: Request, body: any) {\n  // Batch create users\n  await batchPut({\n    'user:1': { name: 'alice' },\n    'user:2': { name: 'bob' },\n    'user:3': { name: 'charlie' }\n  })\n\n  // Batch fetch\n  const users = await batchGet(['user:1', 'user:2', 'user:3'])\n\n  return { users }\n}\n```\n\n## Session Storage\n\nComplete session management implementation.\n\n```typescript\nimport { kv } from 'tana/kv'\nimport { randomBytes } from 'crypto'\n\nclass SessionStore {\n  private ttl = 3600  // 1 hour\n\n  async create(userId: string): Promise<string> {\n    const sessionId = randomBytes(32).toString('hex')\n    const session = {\n      id: sessionId,\n      userId,\n      createdAt: Date.now(),\n      expiresAt: Date.now() + (this.ttl * 1000)\n    }\n\n    await kv.put(`session:${sessionId}`, session)\n    await kv.put(`user_session:${userId}`, sessionId)\n\n    return sessionId\n  }\n\n  async get(sessionId: string) {\n    const session = await kv.get(`session:${sessionId}`, { type: 'json' })\n\n    if (!session) return null\n\n    // Check expiration\n    if (Date.now() > session.expiresAt) {\n      await this.destroy(sessionId)\n      return null\n    }\n\n    return session\n  }\n\n  async refresh(sessionId: string) {\n    const session = await this.get(sessionId)\n    if (!session) return false\n\n    session.expiresAt = Date.now() + (this.ttl * 1000)\n    await kv.put(`session:${sessionId}`, session)\n\n    return true\n  }\n\n  async destroy(sessionId: string) {\n    const session = await this.get(sessionId)\n    if (session) {\n      await kv.delete(`user_session:${session.userId}`)\n    }\n    await kv.delete(`session:${sessionId}`)\n  }\n\n  async getByUserId(userId: string): Promise<string | null> {\n    return await kv.get(`user_session:${userId}`)\n  }\n}\n```\n\n## Feature Flags\n\nDynamic feature flag system.\n\n```typescript\nimport { kv } from 'tana/kv'\n\nasync function setFlag(name: string, enabled: boolean, config: any = {}) {\n  await kv.put(`flag:${name}`, {\n    enabled,\n    config,\n    updatedAt: Date.now()\n  })\n}\n\nasync function isEnabled(name: string, context: any = {}): Promise<boolean> {\n  const flag = await kv.get(`flag:${name}`, { type: 'json' })\n\n  if (!flag) return false\n  if (!flag.enabled) return false\n\n  // Percentage rollout\n  if (flag.config.percentage) {\n    const hash = hashString(context.userId || '')\n    return (hash % 100) < flag.config.percentage\n  }\n\n  // User whitelist\n  if (flag.config.userIds) {\n    return flag.config.userIds.includes(context.userId)\n  }\n\n  return true\n}\n\n// Usage\nexport async function get(req: Request) {\n  const userId = req.tana.caller?.id\n\n  const newUIEnabled = await isEnabled('new_ui', { userId })\n\n  return {\n    features: {\n      newUI: newUIEnabled\n    }\n  }\n}\n```\n\n## Best Practices\n\n### ✅ Key Naming Conventions\n\n```typescript\n// Good: Hierarchical, predictable\n'user:123'\n'user:123:profile'\n'user:123:settings'\n'cache:api:users'\n'session:abc123'\n\n// Bad: Inconsistent, hard to query\n'123_user'\n'user_profile_123'\n'apiCacheUsers'\n```\n\n### ✅ Efficient Listing\n\n```typescript\n// Good: Use prefix to limit scope\nconst users = await kv.list({ prefix: 'user:', limit: 100 })\n\n// Bad: List everything then filter\nconst all = await kv.list()\nconst users = all.keys.filter(k => k.name.startsWith('user:'))\n```\n\n### ✅ Error Handling\n\n```typescript\n// Good: Handle null and errors\ntry {\n  const data = await kv.get('key', { type: 'json' })\n  if (!data) {\n    return { error: 'Not found' }\n  }\n  // Use data\n} catch (err) {\n  return { error: 'Invalid JSON' }\n}\n\n// Bad: Assume data exists\nconst data = await kv.get('key', { type: 'json' })\nreturn { value: data.someField }  // Crashes if null\n```\n\n### ✅ Avoid Large Values\n\n```typescript\n// Good: Split large objects\nawait kv.put('user:123:profile', profile)\nawait kv.put('user:123:preferences', prefs)\nawait kv.put('user:123:activity', activity)\n\n// Bad: Store everything together\nawait kv.put('user:123', {\n  profile,\n  preferences,\n  activity,\n  history,  // This could grow unbounded\n  logs      // This could exceed 25MB limit\n})\n```\n\n## See Also\n\n- [KV Storage Guide](/guides/kv-storage) - Basic usage\n- [KV API Reference](/tana-api/modules/kv) - Complete API documentation\n- [Smart Contracts](/guides/smart-contracts) - Contract development\n"
  },
  {
    "slug": [
      "guides",
      "quickstart"
    ],
    "metadata": {
      "title": "Quick Start",
      "description": "Get up and running with Tana in minutes"
    },
    "content": "\n## Prerequisites\n\n- macOS, Linux, or Windows (WSL)\n- [Docker](https://docker.com) (for PostgreSQL database)\n\n## Installation\n\n### Download Binaries\n\n**Coming soon:** Pre-built binaries for all platforms.\n\nFor now, see the [Contributing Guide](/contributing/setup/) for building from source.\n\n## Usage\n\nOnce you have the `tana` binary installed:\n\n```bash\n# Start the ledger service\ntana start\n\n# In another terminal, create a user\ntana new user @alice --name \"Alice Johnson\"\n\n# Deploy user to blockchain\ntana deploy user @alice\n\n# Check status\ntana status\n```\n\n## Basic Workflow\n\n### 1. Start the Ledger\n\n```bash\ntana start\n```\n\nThis starts the ledger service on port 8080.\n\n### 2. Create a User\n\n```bash\ntana new user @alice --name \"Alice Johnson\"\n```\n\nThis creates a user configuration locally with a generated keypair.\n\n### 3. Deploy User to Blockchain\n\n```bash\ntana deploy user @alice\n```\n\nThis creates a transaction on the blockchain to register the user.\n\n### 4. Check Balance\n\n```bash\ntana balance @alice USD\n```\n\nView the user's balance in a specific currency.\n\n### 5. Transfer Funds\n\n```bash\ntana transfer @alice @bob 100 USD\n```\n\nTransfer currency between users.\n\n## Using the API\n\nThe ledger service provides a REST API:\n\n```bash\n# Health check\ncurl http://localhost:8080/health\n\n# List users\ncurl http://localhost:8080/users\n\n# Get latest block\ncurl http://localhost:8080/blocks/latest\n```\n\nSee the [API Reference](/tana-api/intro/) for complete documentation.\n\n## Next Steps\n\n1. ✅ Ledger service is working\n2. 🔨 Build CLI commands to interact with ledger\n3. 🔨 Implement smart contracts service\n4. 🔨 Create blockchain node with P2P\n5. 🔨 Build landing pages feature\n\nCheck out the [CLI Reference](/tana-cli/intro/) to learn more about available commands.\n"
  },
  {
    "slug": [
      "guides",
      "smart-contracts"
    ],
    "metadata": {
      "title": "Smart Contracts",
      "description": "Learn to write TypeScript smart contracts for Tana",
      "sidebar": {
        "order": 3
      }
    },
    "content": "\nTana smart contracts are TypeScript files that export up to 4 functions: `init()`, `contract()`, `get()`, and `post()`. All functions must return JSON-serializable data.\n\n## Quick Start\n\n### 1. Create a Contract\n\nCreate a single TypeScript file with your contract logic:\n\n```typescript\n// mycontract.ts\nimport type { Request, JsonValue } from 'tana/net'\nimport { context } from 'tana/context'\nimport { console } from 'tana/core'\nimport { data } from 'tana/data'\n\nexport function init(): JsonValue {\n  console.log('Contract initialized')\n  data.set('deployed_at', Date.now().toString())\n\n  return { initialized: true }\n}\n\nexport function contract(): JsonValue {\n  const caller = context.caller()\n  const owner = context.owner()\n\n  if (!caller || caller.id !== owner.id) {\n    return { error: 'Unauthorized' }\n  }\n\n  return { success: true, caller: caller.username }\n}\n\nexport function get(req: Request): JsonValue {\n  const caller = req.tana.caller\n\n  return {\n    message: 'Hello from Tana!',\n    caller: caller?.username || 'anonymous',\n    timestamp: Date.now()\n  }\n}\n\nexport function post(req: Request): JsonValue {\n  if (!req.tana.caller) {\n    return { error: 'Authentication required' }\n  }\n\n  return {\n    success: true,\n    received: req.body\n  }\n}\n```\n\n### 2. Deploy to Blockchain\n\n```bash\ntana deploy contract mycontract.ts\n```\n\n### 3. Call Your Contract\n\n**HTTP Requests (get/post):**\n```bash\n# GET request\ncurl http://localhost:8180/mycontract\n\n# POST request\ncurl -X POST http://localhost:8180/mycontract \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"data\":\"test\"}'\n```\n\n**On-Chain Execution (contract):**\n```bash\n# Via transaction (coming soon via CLI)\ntana call contract mycontract\n```\n\n## Contract Structure\n\nEvery contract exports up to 4 functions. Only `contract()` is required.\n\n### init() - Optional\nRuns **once** when the contract is deployed to the blockchain.\n\n**Use for:**\n- Setting initial state\n- Storing deployment metadata\n- One-time configuration\n\n```typescript\nexport function init(): JsonValue {\n  const owner = context.owner()\n  const block = context.block()\n\n  // Store deployment info\n  data.set('owner_id', owner.id)\n  data.set('deployed_at', block.timestamp.toString())\n\n  return {\n    initialized: true,\n    owner: owner.username,\n    block: block.height\n  }\n}\n```\n\n**Context Available:**\n- `context.owner()` - Contract owner (same as deployer)\n- `context.block()` - Deployment block info\n- `context.caller()` - Returns null (no caller in init)\n- `context.input()` - Returns null (no input in init)\n\n### contract() - Required\nRuns on-chain via blockchain transactions.\n\n**Use for:**\n- State-changing operations\n- Authorization checks\n- Business logic that needs consensus\n\n```typescript\nexport function contract(): JsonValue {\n  const caller = context.caller()\n  const owner = context.owner()\n  const input = context.input()\n\n  // Authorization\n  if (!caller || caller.id !== owner.id) {\n    return { error: 'Unauthorized: owner only' }\n  }\n\n  // Business logic\n  const count = parseInt(data.get('count') || '0')\n  data.set('count', (count + 1).toString())\n\n  return {\n    success: true,\n    count: count + 1,\n    caller: caller.username,\n    input\n  }\n}\n```\n\n**Context Available:**\n- `context.owner()` - Contract owner\n- `context.caller()` - Transaction sender\n- `context.block()` - Current block info\n- `context.input()` - Contract call parameters\n\n### get() - Optional\nHandles HTTP GET requests via tana-edge.\n\n**Use for:**\n- Reading contract state\n- Public APIs\n- Query endpoints\n\n```typescript\nexport function get(req: Request): JsonValue {\n  // Parse query parameters\n  const url = new URL(req.url)\n  const name = url.searchParams.get('name')\n\n  // Access Tana context\n  const caller = req.tana.caller\n  const owner = req.tana.contract.owner\n\n  // Read state\n  const count = data.get('count') || '0'\n\n  return {\n    message: name ? `Hello, ${name}!` : 'Hello!',\n    count: parseInt(count),\n    caller: caller?.username || 'anonymous',\n    isOwner: caller?.id === owner.id\n  }\n}\n```\n\n**Request Object:**\n- `req.url` - Full URL\n- `req.method` - HTTP method\n- `req.headers` - Request headers\n- `req.tana.caller` - Authenticated user (or null)\n- `req.tana.contract` - Contract metadata\n- `req.tana.session` - Session info (or null)\n\n### post() - Optional\nHandles HTTP POST requests via tana-edge.\n\n**Use for:**\n- Creating resources\n- Submitting data\n- Authenticated actions\n\n```typescript\nexport function post(req: Request): JsonValue {\n  const caller = req.tana.caller\n\n  // Require authentication\n  if (!caller) {\n    return { error: 'Login required' }\n  }\n\n  // Only owner can post\n  const owner = req.tana.contract.owner\n  if (caller.id !== owner.id) {\n    return { error: 'Unauthorized: owner only' }\n  }\n\n  // Process body\n  const body = req.body as any\n\n  // Update state\n  data.set('last_post', JSON.stringify(body))\n\n  return {\n    success: true,\n    received: body,\n    caller: caller.username\n  }\n}\n```\n\n**Request Object:**\nSame as `get()`, plus:\n- `req.body` - Parsed JSON body\n\n## JSON-Only Returns\n\n**All functions MUST return JSON-serializable data.** This is enforced for security and simplicity.\n\n```typescript\n// ✅ Valid JSON returns\nreturn { success: true }\nreturn { items: [1, 2, 3], count: 3 }\nreturn { user: { name: 'Alice', age: 30 } }\nreturn { value: null }  // null is valid\n\n// ❌ Invalid (will cause errors)\nreturn { fn: () => {} }  // Functions not allowed\nreturn { undef: undefined }  // undefined not allowed\nreturn { date: new Date() }  // Objects must be plain\nreturn undefined  // Use null instead\n```\n\n## Available Modules\n\n### tana/net - HTTP APIs\n```typescript\nimport type { Request, JsonValue } from 'tana/net'\n\n// Type definitions for HTTP functions\n```\n\n### tana/context - On-Chain Context\n```typescript\nimport { context } from 'tana/context'\n\nconst owner = context.owner()      // Contract owner\nconst caller = context.caller()    // Transaction sender\nconst block = context.block()      // Block info\nconst input = context.input()      // Call parameters\n```\n\n### tana/core - Console Logging\n```typescript\nimport { console } from 'tana/core'\n\nconsole.log('Message')  // Appears in logs\n```\n\n### tana/kv - Cloudflare Workers KV Storage\n```typescript\nimport { kv } from 'tana/kv'\n\nawait kv.put('username', 'alice')\nconst name = await kv.get('username')\n\n// JSON support\nawait kv.put('user', { id: 1, balance: 100 })\nconst user = await kv.get('user', { type: 'json' })\n\n// List and delete\nconst keys = await kv.list({ prefix: 'user:' })\nawait kv.delete('username')\n```\n\nSee [KV Storage Guide](/guides/kv-storage) for complete documentation.\n\n### tana/utils - External HTTP (Coming Soon)\n```typescript\nimport { fetch } from 'tana/utils'\n\nconst response = await fetch('https://api.example.com')\nconst json = await response.json()\n```\n\n## Validation with Zod\n\nUse Zod for type-safe input validation:\n\n```typescript\nimport { z } from 'zod'\n\nconst UserSchema = z.object({\n  username: z.string().min(2).max(50),\n  email: z.string().email(),\n  age: z.number().int().min(13)\n})\n\nexport function contract(): JsonValue {\n  const input = context.input()\n\n  // Validate input\n  const validation = UserSchema.safeParse(input)\n\n  if (!validation.success) {\n    return {\n      error: 'Invalid input',\n      details: validation.error.flatten()\n    }\n  }\n\n  // Use validated data\n  const user = validation.data\n\n  return {\n    success: true,\n    user\n  }\n}\n```\n\n## Authorization Patterns\n\n### Owner-Only Contract\n```typescript\nexport function contract(): JsonValue {\n  const caller = context.caller()\n  const owner = context.owner()\n\n  if (!caller || caller.id !== owner.id) {\n    return { error: 'Unauthorized' }\n  }\n\n  // Owner-only logic\n  return { success: true }\n}\n```\n\n### Authenticated HTTP\n```typescript\nexport function post(req: Request): JsonValue {\n  if (!req.tana.caller) {\n    return { error: 'Login required' }\n  }\n\n  // Authenticated logic\n  return { success: true }\n}\n```\n\n### Public Read, Private Write\n```typescript\nexport function get(req: Request): JsonValue {\n  // Anyone can read\n  return { data: data.get('public_data') }\n}\n\nexport function post(req: Request): JsonValue {\n  const caller = req.tana.caller\n  const owner = req.tana.contract.owner\n\n  // Only owner can write\n  if (!caller || caller.id !== owner.id) {\n    return { error: 'Unauthorized' }\n  }\n\n  data.set('public_data', req.body.data)\n  return { success: true }\n}\n```\n\n## Example Contracts\n\n### Hello World\nBasic contract with all 4 functions:\n\n```bash\n# View source\ncat contracts/examples/hello-world.ts\n\n# Deploy\ntana deploy contract contracts/examples/hello-world.ts\n```\n\n### User Registry\nAdvanced contract with Zod validation:\n\n```bash\n# View source\ncat contracts/examples/user-registry.ts\n\n# Deploy\ntana deploy contract contracts/examples/user-registry.ts\n```\n\n## Best Practices\n\n### ✅ Do\n\n- **Validate all input** - Use Zod schemas\n- **Return JSON only** - No undefined, functions, or complex objects\n- **Check authorization** - Verify caller permissions\n- **Handle errors gracefully** - Return error objects with messages\n- **Use storage wisely** - data.get/set for persistence\n- **Log important events** - console.log() for debugging\n\n### ❌ Don't\n\n- **Don't return undefined** - Use null instead\n- **Don't assume caller exists** - Always check for null\n- **Don't hardcode IDs** - Use context/req.tana for dynamic values\n- **Don't skip validation** - Always validate untrusted input\n- **Don't expose secrets** - Never log or return sensitive data\n\n## Testing Locally\n\n```bash\n# 1. Start local chain\ntana start\n\n# 2. Deploy contract\ntana deploy contract mycontract.ts\n\n# 3. Test HTTP endpoints\ncurl http://localhost:8180/mycontract\ncurl -X POST http://localhost:8180/mycontract -d '{\"test\":\"data\"}'\n\n# 4. View logs\n# Contract console.log() appears in block producer logs\n```\n\n## Deployment Flow\n\n1. **Write contract** - Single TypeScript file with exports\n2. **CLI validates** - Checks for required exports, validates structure\n3. **CLI extracts** - Separates init/contract/get/post functions\n4. **CLI signs** - Creates signed transaction with Ed25519\n5. **Ledger stores** - Saves to PostgreSQL with all extracted functions\n6. **Block producer** - Executes init() on deployment\n7. **Filesystem write** - Writes get.ts/post.ts for tana-edge\n8. **Ready** - Contract available for execution\n\n## Security\n\n### Sandboxed Execution\n- No filesystem access\n- Limited network access (whitelisted only)\n- No system calls\n- Memory limits enforced\n- Gas metering (coming soon)\n\n### Transaction Signing\n- All deployments require Ed25519 signatures\n- Owner tracked in database\n- Replay protection via nonces\n- Timestamp validation\n\n### JSON Enforcement\n- Runtime validates all returns are JSON\n- Prevents serialization bugs\n- Easy to audit and inspect\n- Consistent API surface\n\n## Next Steps\n\n- [Transaction Signing](/guides/transaction-signing/) - How signatures work\n- [API Reference](/tana-api/contracts/) - Contract API endpoints\n- [CLI Commands](/tana-cli/commands/) - Deploy and manage contracts\n- [Example Contracts](/contracts/examples/README.md) - More examples\n"
  },
  {
    "slug": [
      "guides",
      "install"
    ],
    "metadata": {
      "title": "install coco",
      "description": "A guide in my new Starlight docs site."
    },
    "content": "\nGuides lead a user through a specific task they want to accomplish, often with a sequence of steps.\nWriting a good guide requires thinking about what your users are trying to do.\n\n## Further reading\n\n- Read [about how-to guides](https://diataxis.fr/how-to-guides/) in the Diátaxis framework\n"
  },
  {
    "slug": [
      "guides",
      "transaction-signing"
    ],
    "metadata": {
      "title": "Transaction Signing",
      "description": "How to sign and verify transactions with Ed25519",
      "sidebar": {
        "order": 4
      }
    },
    "content": "\nAll transactions on Tana require Ed25519 cryptographic signatures to ensure authenticity and prevent unauthorized actions.\n\n## Overview\n\nEvery transaction must be signed by the private key of the account initiating the transaction. This prevents:\n\n- **Impersonation** - No one can create transactions on your behalf\n- **Replay attacks** - Transactions cannot be reused (thanks to nonces)\n- **Tampering** - Transaction data cannot be modified after signing\n\n## Signature Requirements\n\nEvery transaction (except user creation) must include:\n\n1. **Signature** - Ed25519 signature (hex string with `ed25519_` prefix)\n2. **Timestamp** - Unix timestamp in milliseconds (must be within 5 minutes of current time)\n3. **Nonce** - Sequential number that increments with each transaction\n\n## How Signing Works\n\n### 1. Get Your Current Nonce\n\nBefore creating a transaction, fetch your current nonce:\n\n```bash\n# Get nonce for user\ncurl http://localhost:8080/users/{userId}/nonce\n\n# Response:\n{\n  \"userId\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"username\": \"@alice\",\n  \"currentNonce\": 5,\n  \"nextNonce\": 6,\n  \"message\": \"Use nextNonce for your next transaction\"\n}\n```\n\n**Important:** Use `nextNonce` for your transaction, not `currentNonce`.\n\n### 2. Create Transaction Message\n\nBuild a canonical message for signing:\n\n```typescript\nimport { createTransactionMessage } from '@tana/cli/utils/crypto'\n\nconst transactionData = {\n  type: 'transfer',\n  from: '550e8400-e29b-41d4-a716-446655440000', // Your user ID\n  to: '7c9e6679-7425-40de-944b-e07fc1f90ae7',   // Recipient ID\n  amount: '100.00',\n  currencyCode: 'USD',\n  timestamp: Date.now(),\n  nonce: 6 // The nextNonce from step 1\n}\n\nconst message = createTransactionMessage(transactionData)\n```\n\n### 3. Sign the Message\n\nSign with your private key:\n\n```typescript\nimport { signMessage } from '@tana/cli/utils/crypto'\n\nconst signature = await signMessage(\n  message,\n  userConfig.privateKey // From ~/.config/tana/users/@alice.json\n)\n\n// signature: \"ed25519_a7f3b2c1d4e5f6a7b8c9d0e1f2a3b4c5...\"\n```\n\n### 4. Submit Transaction\n\nSend the signed transaction to the ledger:\n\n```typescript\nconst response = await fetch('http://localhost:8080/transactions', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({\n    type: 'transfer',\n    from: '550e8400-e29b-41d4-a716-446655440000',\n    to: '7c9e6679-7425-40de-944b-e07fc1f90ae7',\n    amount: '100.00',\n    currencyCode: 'USD',\n    signature, // Include the signature\n    timestamp: transactionData.timestamp,\n    nonce: transactionData.nonce\n  })\n})\n```\n\n## Signature Verification\n\nWhen the ledger receives a transaction, it:\n\n1. **Validates timestamp** - Must be within 5 minutes\n2. **Fetches user** - Gets user record by `from` field\n3. **Checks nonce** - Must be exactly `currentNonce + 1`\n4. **Verifies signature** - Recreates message and verifies with user's public key\n5. **Checks balances** - Ensures sufficient funds (for transfers)\n\nIf any check fails, the transaction is rejected.\n\n## Transaction Types\n\n### User Creation\n\n**Special case:** User creation doesn't require signature verification (no user exists yet to verify against). Instead:\n\n- Nonce is always `0`\n- Signature is verified against the `publicKey` field in the request itself\n- This proves you control the private key for the public key you're registering\n\n```typescript\nconst transactionData = {\n  type: 'user_creation',\n  from: '00000000-0000-0000-0000-000000000000', // System\n  to: '00000000-0000-0000-0000-000000000000',   // Will be assigned\n  timestamp: Date.now(),\n  nonce: 0, // Always 0 for user creation\n  contractInput: {\n    username: '@alice',\n    displayName: 'Alice',\n    publicKey: 'ed25519_abc123...',\n    bio: '',\n    role: 'user'\n  }\n}\n```\n\n### Transfers\n\nTransfer currency between accounts:\n\n```typescript\n{\n  type: 'transfer',\n  from: userId,\n  to: recipientId,\n  amount: '50.00',\n  currencyCode: 'USD',\n  signature: 'ed25519_...',\n  timestamp: Date.now(),\n  nonce: nextNonce\n}\n```\n\n### Deposits\n\nRequest to deposit fiat currency into blockchain:\n\n```typescript\n{\n  type: 'deposit',\n  from: userId, // The requestor\n  to: userId,   // Same (depositing to self)\n  amount: '1000.00',\n  currencyCode: 'CAD',\n  signature: 'ed25519_...',\n  timestamp: Date.now(),\n  nonce: nextNonce,\n  metadata: {\n    // Optional: e-transfer details\n  }\n}\n```\n\n**Note:** Deposits create a pending transaction that must be confirmed by the sovereign user after receiving the actual fiat currency.\n\n### Withdraws\n\nRequest to withdraw currency from blockchain to fiat:\n\n```typescript\n{\n  type: 'withdraw',\n  from: userId, // Your account (will be debited)\n  to: userId,   // Same\n  amount: '500.00',\n  currencyCode: 'USD',\n  signature: 'ed25519_...',\n  timestamp: Date.now(),\n  nonce: nextNonce,\n  metadata: {\n    email: 'alice@example.com' // Where to send e-transfer\n  }\n}\n```\n\n**Note:** Withdraws also require sovereign confirmation before the fiat currency is sent.\n\n## Nonce Management\n\n### What is a Nonce?\n\nA **nonce** (number used once) is a counter that prevents replay attacks. Each user has their own nonce that:\n\n- Starts at `0` when the user is created\n- Increments by `1` every time a transaction is confirmed\n- Must be sequential (can't skip numbers)\n\n### Why Nonces Matter\n\nWithout nonces, an attacker could:\n1. Capture a valid signed transaction\n2. Re-submit it multiple times\n3. Drain your account\n\nWith nonces, each transaction has a unique sequence number, so replays are detected and rejected.\n\n### Handling Nonce Errors\n\nIf you get a nonce mismatch error:\n\n```json\n{\n  \"error\": \"Invalid nonce. Expected 7, got 6\"\n}\n```\n\n**Solutions:**\n\n1. **Fetch fresh nonce** - Call `GET /users/:id/nonce` again\n2. **Don't parallelize** - Wait for each transaction to be confirmed before submitting the next\n3. **Check pending transactions** - Your transaction might be pending, increasing the nonce\n\n### Pending Transactions\n\nNonces only increment when transactions are **confirmed** in a block. If you have pending transactions:\n\n- Your `currentNonce` hasn't changed yet\n- Use `nextNonce` based on the pending transaction count\n- Wait for block production to confirm transactions\n\n## CLI Signing Example\n\nThe `tana-cli` handles all signing automatically:\n\n```bash\n# Create user (signs automatically)\ntana new user @alice\ntana deploy user @alice\n\n# Transfers (coming soon - will sign automatically)\ntana transfer @alice @bob 50 USD\n```\n\n## TypeScript Library Example\n\n```typescript\nimport * as ed from '@noble/ed25519'\nimport { createTransactionMessage, signMessage } from '@tana/cli/utils/crypto'\n\n// 1. Load user config\nconst userConfig = readUserConfig('@alice')\n\n// 2. Get current nonce\nconst nonceResponse = await fetch(`http://localhost:8080/users/${userConfig.id}/nonce`)\nconst { nextNonce } = await nonceResponse.json()\n\n// 3. Create transaction data\nconst txData = {\n  type: 'transfer',\n  from: userConfig.id,\n  to: recipientId,\n  amount: '100.00',\n  currencyCode: 'USD',\n  timestamp: Date.now(),\n  nonce: nextNonce\n}\n\n// 4. Sign the transaction\nconst message = createTransactionMessage(txData)\nconst signature = await signMessage(message, userConfig.privateKey)\n\n// 5. Submit\nawait fetch('http://localhost:8080/transactions', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({ ...txData, signature })\n})\n```\n\n## Security Best Practices\n\n### Keep Private Keys Safe\n\n- **Never share** your private key\n- **Never commit** private keys to git\n- **Store securely** in `~/.config/tana/users/` with proper permissions\n- **Backup** to encrypted storage\n\n### Verify Timestamps\n\nAlways use current timestamps:\n\n```typescript\nconst timestamp = Date.now() // Current time in milliseconds\n```\n\n**Don't:**\n- Use hardcoded timestamps\n- Reuse old timestamps\n- Set timestamps in the future\n\n### Handle Nonces Carefully\n\n- Always fetch fresh nonces before signing\n- Wait for transactions to confirm before submitting more\n- Don't parallelize transactions from the same account\n\n### Verify Before Signing\n\nAlways review transaction details before signing:\n\n```typescript\nconsole.log('Transaction to sign:')\nconsole.log(`  Type: ${txData.type}`)\nconsole.log(`  To: ${txData.to}`)\nconsole.log(`  Amount: ${txData.amount} ${txData.currencyCode}`)\nconsole.log(`  Nonce: ${txData.nonce}`)\n\n// Only sign if everything looks correct\nconst signature = await signMessage(message, privateKey)\n```\n\n## Error Reference\n\nCommon signature-related errors:\n\n| Error | Cause | Solution |\n|-------|-------|----------|\n| `Invalid transaction signature` | Signature doesn't match | Regenerate signature with correct private key |\n| `Invalid nonce. Expected X, got Y` | Wrong nonce | Fetch fresh nonce from `/users/:id/nonce` |\n| `Transaction timestamp is too old` | Timestamp > 5 minutes old | Use current timestamp `Date.now()` |\n| `Sender user not found` | Invalid `from` user ID | Verify user ID is correct |\n| `Insufficient balance` | Not enough funds | Check balance before transferring |\n\n## Next Steps\n\n- **[Smart Contracts](/guides/smart-contracts/)** - Sign and deploy contracts\n- **[API Reference](/tana-api/transactions/)** - Full transaction API docs\n- **[CLI Commands](/tana-cli/intro/)** - Using the CLI for signed operations\n"
  },
  {
    "slug": [
      "guides",
      "deployment"
    ],
    "metadata": {
      "title": "Production Deployment",
      "description": "Deploy Tana blockchain to production",
      "sidebar": {
        "order": 4
      }
    },
    "content": "\nThis guide covers deploying the Tana blockchain infrastructure to production.\n\n## Prerequisites\n\n### Server Requirements\n- **CPU:** 4+ cores\n- **RAM:** 8GB+ minimum, 16GB recommended\n- **Storage:** 100GB+ SSD\n- **OS:** Ubuntu 22.04 LTS (recommended)\n- **Network:** Static IP, ports 80/443/8080 accessible\n\n### Software Requirements\n- Docker 24.0+\n- Docker Compose 2.0+\n- Bun 1.1.38+ (for migrations)\n- PostgreSQL 16 (via Docker)\n- Redis 7 (via Docker)\n\n### Domain Configuration\nConfigure DNS records for your domain:\n```\nA     blockchain.yourdomain.com    → <SERVER_IP>\nAAAA  blockchain.yourdomain.com    → <SERVER_IPv6>  (optional)\n```\n\n## Architecture\n\n```\n┌─────────────────────────────────────────────────────────────┐\n│                     yourdomain.com                           │\n│                  (Main Website/Playground)                   │\n└─────────────────────────────────────────────────────────────┘\n                            │\n                            ↓ HTTPS\n┌─────────────────────────────────────────────────────────────┐\n│         blockchain.yourdomain.com (Load Balancer)           │\n└─────────────────────────────────────────────────────────────┘\n                            │\n           ┌────────────────┼────────────────┐\n           ↓                ↓                ↓\n    ┌──────────┐    ┌──────────┐    ┌──────────┐\n    │ Ledger   │    │  Edge    │    │ Runtime  │\n    │ Service  │    │ Server   │    │ Service  │\n    │  :8080   │    │  :8180   │    │          │\n    └──────────┘    └──────────┘    └──────────┘\n           │                │\n           └────────────────┘\n                    ↓\n            ┌──────────────┐\n            │  PostgreSQL  │\n            │     :5432    │\n            └──────────────┘\n                    │\n            ┌──────────────┐\n            │    Redis     │\n            │     :6379    │\n            └──────────────┘\n```\n\n## Services Overview\n\n### Ledger Service (Port 8080)\n**Purpose:** Blockchain data API - users, balances, transactions\n\n**Key Endpoints:**\n- `GET /health` - Health check\n- `GET /users` - List all users\n- `POST /users` - Create user\n- `GET /balances` - Get all balances\n- `GET /transactions` - Get all transactions\n- `POST /transactions` - Create transaction\n\n### Edge Server (Port 8180)\n**Purpose:** Fast HTTP execution of smart contracts\n\n**Features:**\n- TypeScript contract execution\n- V8 isolate per request\n- Cloudflare Workers-style architecture\n- Sub-100ms response times\n\n## Installation\n\n### 1. Clone Repository\n```bash\ngit clone https://github.com/yourusername/tana.git\ncd tana\n```\n\n### 2. Create Production Environment File\n```bash\ncp .env.example .env.production\n```\n\nEdit `.env.production`:\n```bash\n# Database Configuration\nPOSTGRES_DB=tana\nPOSTGRES_USER=tana\nPOSTGRES_PASSWORD=<STRONG_PASSWORD_HERE>\n\n# Ledger URL (for all services)\nTANA_LEDGER_URL=https://blockchain.yourdomain.com\n\n# Service Configuration\nNODE_ENV=production\nLOG_LEVEL=info\n\n# CORS Origins\nALLOWED_ORIGINS=https://yourdomain.com,https://blockchain.yourdomain.com\n```\n\n### 3. Build Docker Images\n```bash\n# Build all services\ndocker-compose -f docker-compose.prod.yml build\n\n# Or build specific service\ndocker-compose -f docker-compose.prod.yml build tana-ledger\n```\n\n### 4. Initialize Database\n```bash\n# Start database services\ndocker-compose -f docker-compose.prod.yml up -d postgres redis\n\n# Wait for postgres to be ready\ndocker-compose -f docker-compose.prod.yml exec postgres pg_isready\n\n# Run migrations\ncd ledger\nbun run db:migrate\n\n# Seed default data\ncurl -X POST http://localhost:8080/balances/currencies/seed\n```\n\n### 5. Start Services\n```bash\n# Start all services\ndocker-compose -f docker-compose.prod.yml up -d\n\n# Check status\ndocker-compose -f docker-compose.prod.yml ps\n\n# View logs\ndocker-compose -f docker-compose.prod.yml logs -f\n```\n\n### 6. Verify Deployment\n```bash\n# Test ledger service\ncurl http://localhost:8080/health\ncurl http://localhost:8080/\n\n# Test endpoints\ncurl http://localhost:8080/users\ncurl http://localhost:8080/balances\ncurl http://localhost:8080/transactions\n```\n\n## Reverse Proxy Configuration\n\n### Using Nginx\n\nCreate `/etc/nginx/sites-available/blockchain.yourdomain.com`:\n\n```nginx\n# HTTP -> HTTPS redirect\nserver {\n    listen 80;\n    listen [::]:80;\n    server_name blockchain.yourdomain.com;\n\n    location / {\n        return 301 https://$server_name$request_uri;\n    }\n}\n\n# HTTPS\nserver {\n    listen 443 ssl http2;\n    listen [::]:443 ssl http2;\n    server_name blockchain.yourdomain.com;\n\n    # SSL certificates (Let's Encrypt)\n    ssl_certificate /etc/letsencrypt/live/blockchain.yourdomain.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/blockchain.yourdomain.com/privkey.pem;\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers HIGH:!aNULL:!MD5;\n\n    # Security headers\n    add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\" always;\n    add_header X-Frame-Options \"SAMEORIGIN\" always;\n    add_header X-Content-Type-Options \"nosniff\" always;\n    add_header X-XSS-Protection \"1; mode=block\" always;\n\n    # CORS headers\n    add_header Access-Control-Allow-Origin \"https://yourdomain.com\" always;\n    add_header Access-Control-Allow-Methods \"GET, POST, OPTIONS\" always;\n    add_header Access-Control-Allow-Headers \"Content-Type, Authorization\" always;\n\n    # Rate limiting\n    limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;\n    limit_req zone=api_limit burst=20 nodelay;\n\n    # Proxy to ledger service\n    location / {\n        proxy_pass http://localhost:8080;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_cache_bypass $http_upgrade;\n\n        # Timeouts\n        proxy_connect_timeout 30s;\n        proxy_send_timeout 30s;\n        proxy_read_timeout 30s;\n    }\n\n    # Health check endpoint (no rate limiting)\n    location /health {\n        proxy_pass http://localhost:8080/health;\n        access_log off;\n    }\n}\n```\n\nEnable and test:\n```bash\n# Enable site\nsudo ln -s /etc/nginx/sites-available/blockchain.yourdomain.com /etc/nginx/sites-enabled/\n\n# Test configuration\nsudo nginx -t\n\n# Reload nginx\nsudo systemctl reload nginx\n```\n\n### SSL Certificate (Let's Encrypt)\n```bash\n# Install certbot\nsudo apt update\nsudo apt install certbot python3-certbot-nginx\n\n# Get certificate\nsudo certbot --nginx -d blockchain.yourdomain.com\n\n# Auto-renewal is enabled by default\n# Test renewal\nsudo certbot renew --dry-run\n```\n\n## Monitoring & Maintenance\n\n### View Logs\n```bash\n# All services\ndocker-compose -f docker-compose.prod.yml logs -f\n\n# Specific service\ndocker-compose -f docker-compose.prod.yml logs -f tana-ledger\n\n# Last 100 lines\ndocker-compose -f docker-compose.prod.yml logs --tail=100 tana-ledger\n```\n\n### Database Backups\nCreate a backup script `/usr/local/bin/backup-tana.sh`:\n\n```bash\n#!/bin/bash\nBACKUP_DIR=\"/var/backups/tana\"\nTIMESTAMP=$(date +%Y%m%d_%H%M%S)\nmkdir -p $BACKUP_DIR\n\n# Backup database\ndocker-compose -f /path/to/tana/docker-compose.prod.yml exec -T postgres \\\n  pg_dump -U tana tana | gzip > \"$BACKUP_DIR/tana_$TIMESTAMP.sql.gz\"\n\n# Keep only last 7 days\nfind $BACKUP_DIR -name \"tana_*.sql.gz\" -mtime +7 -delete\n```\n\nAdd to crontab:\n```bash\n# Daily backup at 2 AM\n0 2 * * * /usr/local/bin/backup-tana.sh\n```\n\n### Health Monitoring\n```bash\n# Check service health\ncurl https://blockchain.yourdomain.com/health\n\n# Monitor container stats\ndocker stats\n\n# Check service status\ndocker-compose -f docker-compose.prod.yml ps\n```\n\n### Updates & Upgrades\n```bash\n# Pull latest code\ngit pull origin main\n\n# Rebuild images\ndocker-compose -f docker-compose.prod.yml build\n\n# Run database migrations\ncd ledger && bun run db:migrate && cd ..\n\n# Restart services (zero downtime)\ndocker-compose -f docker-compose.prod.yml up -d --no-deps --build tana-ledger\ndocker-compose -f docker-compose.prod.yml up -d --no-deps --build tana-edge\n```\n\n## Security Checklist\n\n- [ ] Strong PostgreSQL password set\n- [ ] SSL certificates installed and valid\n- [ ] Firewall configured (UFW or iptables)\n- [ ] Rate limiting enabled in Nginx\n- [ ] Services running as non-root user\n- [ ] Database not exposed to public internet\n- [ ] Redis not exposed to public internet\n- [ ] CORS properly configured\n- [ ] Security headers enabled\n- [ ] Regular backups configured\n- [ ] Monitoring and alerting set up\n- [ ] Secrets stored securely (not in git)\n- [ ] `TANA_LEDGER_URL` environment variable set correctly\n\n## Troubleshooting\n\n### Service Won't Start\n```bash\n# Check logs\ndocker-compose -f docker-compose.prod.yml logs tana-ledger\n\n# Check container status\ndocker-compose -f docker-compose.prod.yml ps\n\n# Restart specific service\ndocker-compose -f docker-compose.prod.yml restart tana-ledger\n```\n\n### Database Connection Issues\n```bash\n# Check postgres is running\ndocker-compose -f docker-compose.prod.yml ps postgres\n\n# Test connection manually\ndocker-compose -f docker-compose.prod.yml exec postgres \\\n  psql -U tana -d tana -c \"SELECT version();\"\n```\n\n### High Memory Usage\n```bash\n# Check resource usage\ndocker stats\n\n# Adjust resource limits in docker-compose.prod.yml\nservices:\n  tana-ledger:\n    deploy:\n      resources:\n        limits:\n          memory: 512M\n```\n\n### CORS Errors\nCheck `ALLOWED_ORIGINS` in `.env.production` includes all necessary domains:\n```bash\nALLOWED_ORIGINS=https://yourdomain.com,https://blockchain.yourdomain.com\n```\n\n## Performance Tuning\n\n### PostgreSQL Optimization\nEdit `docker-compose.prod.yml` to add PostgreSQL performance settings:\n\n```yaml\npostgres:\n  command: >\n    postgres\n    -c shared_buffers=256MB\n    -c effective_cache_size=1GB\n    -c maintenance_work_mem=128MB\n    -c checkpoint_completion_target=0.9\n    -c wal_buffers=16MB\n    -c default_statistics_target=100\n    -c random_page_cost=1.1\n    -c effective_io_concurrency=200\n    -c work_mem=16MB\n    -c min_wal_size=1GB\n    -c max_wal_size=4GB\n```\n\n## Cost Estimation\n\n### Minimum Setup (2 core VPS)\n- **DigitalOcean:** $12-24/month\n- **Hetzner:** €5-15/month\n- **Linode:** $12-24/month\n\n### Recommended Setup (4 core VPS)\n- **DigitalOcean:** $48/month\n- **Hetzner:** €20/month\n- **AWS Lightsail:** $40/month\n\n### Additional Costs\n- Domain: $10-20/year\n- Backups: $5-10/month (optional)\n- Monitoring: Free (self-hosted) or $20/month\n\n## Next Steps\n\nAfter successful deployment:\n1. Monitor logs for the first 24 hours\n2. Set up automated backups\n3. Configure uptime monitoring\n4. Test all API endpoints from your application\n5. Review and optimize performance\n\n## Related Documentation\n\n- [Environment Variables](/contributing/env-vars/) - Configuration options\n- [API Reference](/tana-api/intro/) - Ledger API endpoints\n- [Edge Server](/tana-edge/intro/) - Edge server documentation\n- [Development Setup](/contributing/setup/) - Local development guide\n"
  },
  {
    "slug": [
      "guides",
      "quickstart"
    ],
    "metadata": {
      "title": "Quick Start",
      "description": "Deploy your first tana smart contract in 5 minutes"
    },
    "content": "\n# Quick Start\n\nThis guide will help you deploy your first tana smart contract in just a few minutes.\n\n## Prerequisites\n\nBefore you begin, make sure you have:\n\n- Node.js 18+ installed\n- Bun runtime installed\n- A terminal/command line\n\n## Installation\n\nInstall the tana CLI globally:\n\n```bash\nnpm install -g @tana/cli\n```\n\nVerify the installation:\n\n```bash\ntana --version\n```\n\n## Create Your First Contract\n\nCreate a new file called `hello.ts`:\n\n```typescript\n// hello.ts\nexport async function contract() {\n  const caller = context.caller()\n  return {\n    message: `Hello, ${caller.username}!`,\n    timestamp: Date.now()\n  }\n}\n\nexport async function get(req: Request) {\n  return {\n    message: \"Hello from HTTP GET!\"\n  }\n}\n```\n\n## Deploy the Contract\n\nDeploy your contract to the blockchain:\n\n```bash\ntana deploy contract hello.ts\n```\n\nYou'll see output like:\n\n```\n✓ Contract deployed successfully\n  Contract ID: ctr_abc123\n  Owner: usr_youruser\n  Block: 42\n```\n\n## Test Your Contract\n\nCall your contract:\n\n```bash\ntana call ctr_abc123\n```\n\nOutput:\n\n```json\n{\n  \"message\": \"Hello, youruser!\",\n  \"timestamp\": 1699564800000\n}\n```\n\n## Next Steps\n\nNow that you've deployed your first contract, learn more:\n\n- [Smart Contract Guide](/docs/guides/smart-contracts) - Learn the 4-function structure\n- [CLI Commands](/docs/cli/commands) - Explore all CLI commands\n- [API Reference](/docs/api/contracts) - Use the REST API\n\n## Common Issues\n\n### \"Command not found: tana\"\n\nMake sure you installed the CLI globally with the `-g` flag:\n\n```bash\nnpm install -g @tana/cli\n```\n\n### \"No blockchain running\"\n\nStart the ledger service:\n\n```bash\ntana start\n```\n\nThis starts all required services on your local machine.\n"
  },
  {
    "slug": [
      "guides",
      "kv-storage"
    ],
    "metadata": {
      "title": "KV Storage",
      "description": "Fast key-value storage for smart contracts"
    },
    "content": "\nTana provides Cloudflare Workers-compatible KV storage for smart contracts. Each contract gets isolated storage with automatic namespacing.\n\n## Quick Start\n\n```typescript\nimport { kv } from 'tana/kv'\n\n// Store text\nawait kv.put('username', 'alice')\n\n// Retrieve text\nconst name = await kv.get('username')\nconsole.log(name) // \"alice\"\n\n// Store JSON\nawait kv.put('user', { name: 'alice', balance: 1000 })\n\n// Retrieve JSON\nconst user = await kv.get('user', { type: 'json' })\nconsole.log(user.balance) // 1000\n\n// Delete\nawait kv.delete('username')\n\n// List keys\nconst result = await kv.list()\nconsole.log(result.keys) // [{ name: \"user\" }]\n```\n\n## API Reference\n\n### `kv.get(key, options?)`\n\nRetrieve a value.\n\n**Parameters:**\n- `key` (string): Storage key\n- `options.type` ('text' | 'json'): Return type (default: 'text')\n\n**Returns:** `Promise<string | object | null>`\n\n```typescript\n// Get as text (default)\nconst text = await kv.get('message')\n\n// Get as JSON\nconst data = await kv.get('config', { type: 'json' })\n\n// Missing key returns null\nconst missing = await kv.get('nonexistent') // null\n```\n\n### `kv.put(key, value, options?)`\n\nStore a value. Objects are automatically JSON-serialized.\n\n**Parameters:**\n- `key` (string): Storage key (max 512 bytes)\n- `value` (string | object): Value to store (max 25 MB)\n- `options` (optional): Reserved for future features (TTL, metadata)\n\n**Returns:** `Promise<void>`\n\n```typescript\n// Store string\nawait kv.put('status', 'active')\n\n// Store object (auto-serialized)\nawait kv.put('user', { id: 1, name: 'alice' })\n```\n\n### `kv.delete(key)`\n\nDelete a key. No error if key doesn't exist.\n\n**Parameters:**\n- `key` (string): Key to delete\n\n**Returns:** `Promise<void>`\n\n```typescript\nawait kv.delete('session')\n```\n\n### `kv.list(options?)`\n\nList keys, optionally filtered by prefix.\n\n**Parameters:**\n- `options.prefix` (string): Filter by prefix\n- `options.limit` (number): Max keys to return (default: 1000)\n\n**Returns:** `Promise<{ keys: Array<{ name: string }>, list_complete: boolean, cursor: string | null }>`\n\n```typescript\n// List all keys\nconst all = await kv.list()\n\n// List with prefix\nconst users = await kv.list({ prefix: 'user:' })\n\n// Limit results\nconst first10 = await kv.list({ limit: 10 })\n```\n\n## Common Patterns\n\n### Counter\n\n```typescript\nconst current = await kv.get('counter', { type: 'json' })\nconst count = (current?.count || 0) + 1\nawait kv.put('counter', { count })\n```\n\n### Session Storage\n\n```typescript\n// Create session\nawait kv.put(`session:${sessionId}`, {\n  userId: 'alice',\n  createdAt: Date.now()\n})\n\n// Get session\nconst session = await kv.get(`session:${sessionId}`, { type: 'json' })\n\n// Delete session\nawait kv.delete(`session:${sessionId}`)\n```\n\n### Cache with Prefix\n\n```typescript\n// Store multiple items\nawait kv.put('cache:user:1', { name: 'alice' })\nawait kv.put('cache:user:2', { name: 'bob' })\nawait kv.put('cache:post:1', { title: 'Hello' })\n\n// List only cache:user: items\nconst users = await kv.list({ prefix: 'cache:user:' })\n// Result: [{ name: \"cache:user:1\" }, { name: \"cache:user:2\" }]\n```\n\n### User Preferences\n\n```typescript\nimport { context } from 'tana/context'\nimport { kv } from 'tana/kv'\n\nexport async function get() {\n  const caller = context.caller()\n  const prefs = await kv.get(`prefs:${caller}`, { type: 'json' })\n\n  return prefs || { theme: 'dark', notifications: true }\n}\n\nexport async function post(req) {\n  const caller = context.caller()\n  const prefs = req.body\n\n  await kv.put(`prefs:${caller}`, prefs)\n  return { success: true }\n}\n```\n\n## Limits & Constraints\n\n- **Key length:** 512 bytes max\n- **Value size:** 25 MB max\n- **Keys per list():** 1000 max (use prefix to narrow)\n- **Namespace:** Automatic per-contract isolation\n- **TTL:** Not yet supported (coming soon)\n- **Metadata:** Not yet supported (coming soon)\n\n## Storage Backends\n\nKV storage uses different backends depending on environment:\n\n| Environment | Backend | Notes |\n|-------------|---------|-------|\n| tana-runtime | PostgreSQL | Persistent across restarts |\n| tana-edge | In-memory | Fast but not persistent |\n| Playground | localStorage | Browser-based, persistent per-browser |\n\nAll backends provide identical API and behavior.\n\n## Best Practices\n\n✅ **Use prefixes** to organize related keys:\n```typescript\nawait kv.put('user:1:profile', data)\nawait kv.put('user:1:settings', data)\n```\n\n✅ **Check for null** when retrieving:\n```typescript\nconst data = await kv.get('key', { type: 'json' })\nif (!data) {\n  // Handle missing key\n}\n```\n\n✅ **Use type parameter** for JSON to get proper typing:\n```typescript\nconst user = await kv.get('user', { type: 'json' }) as User\n```\n\n❌ **Don't exceed limits:**\n```typescript\n// BAD: Key too long\nawait kv.put('x'.repeat(1000), 'value') // Error!\n\n// GOOD: Keep keys short\nawait kv.put('user:1', 'value')\n```\n\n❌ **Don't store sensitive data** without encryption:\n```typescript\n// BAD: Plain text password\nawait kv.put('password', 'secret123')\n\n// GOOD: Hash or encrypt first\nawait kv.put('password_hash', hashPassword('secret123'))\n```\n\n## Next Steps\n\n- See [Smart Contracts](/guides/smart-contracts) for full contract development guide\n- Check [examples/kv-demo.ts](https://github.com/yourusername/tana/blob/main/examples/kv-demo.ts) for complete examples\n- Read [KV Patterns](/guides/patterns/kv-patterns) for advanced techniques\n"
  },
  {
    "slug": [
      "tana-cli",
      "intro"
    ],
    "metadata": {
      "title": "CLI Overview",
      "description": "Introduction to the Tana command-line interface",
      "sidebar": {
        "order": 1
      }
    },
    "content": "\nThe Tana CLI is your primary tool for managing blockchains, user accounts, and TypeScript smart contracts. It provides everything you need to create, deploy, and interact with the Tana blockchain.\n\n## Installation\n\n```bash\n# Clone repository\ngit clone https://github.com/conoda/tana.git\ncd tana\n\n# Install dependencies\nbun install\n\n# Build CLI (optional - for standalone binary)\ncd cli\nbun run make\n```\n\n## Usage\n\n```bash\n# Development (from project root)\nbun cli/main.ts <command> [options]\n\n# Or after building standalone binary\n./cli/dist/tana <command> [options]\n```\n\n## Quick Start\n\n```bash\n# 1. Start the ledger service\nbun cli/main.ts start\n\n# 2. Create a new user\nbun cli/main.ts new user @alice --name \"Alice Johnson\"\n\n# 3. Deploy the user to blockchain\nbun cli/main.ts deploy user @alice\n\n# 4. Check status\nbun cli/main.ts status\n```\n\n## Command Categories\n\nThe CLI is organized into logical groups:\n\n- **Service Management** - Start, stop, and monitor the ledger service\n- **Creation** - Create chains, users, nodes, and contracts\n- **Deployment** - Deploy users and contracts to the blockchain\n- **Blockchain Operations** - Run contracts, check balances, transfer funds\n- **System** - Validate configuration and requirements\n\nSee the [Commands](/tana-cli/commands/) reference for detailed documentation of all available commands.\n\n## Configuration\n\nTana stores its configuration in `~/.config/tana/`:\n\n```\n~/.config/tana/\n├── config.json              # Global settings (default chain, user)\n├── chains/\n│   └── *.json              # Chain configurations\n├── users/\n│   └── *.json              # User credentials and keys\n└── nodes/\n    └── *.json              # Node configurations\n```\n\n**Environment Variables:**\n\n```bash\nDATABASE_URL='postgres://tana:[PASSWORD]@localhost:5432/tana'\nLEDGER_PORT=8080\nNODE_ENV=development\n```\n\n## Next Steps\n\n- **[Commands Reference](/tana-cli/commands/)** - Complete command documentation\n- **[API Reference](/tana-api/intro/)** - REST API endpoints\n- **[Quick Start Guide](/guides/quickstart/)** - Get up and running\n- **[System Architecture](/guides/architecture/)** - Understand how Tana works\n"
  },
  {
    "slug": [
      "tana-cli",
      "commands"
    ],
    "metadata": {
      "title": "Commands",
      "description": "Complete reference for all Tana CLI commands",
      "sidebar": {
        "order": 2
      }
    },
    "content": "\nComplete reference for the Tana command-line interface.\n\n## Service Management\n\n### start\n\nStart the ledger service.\n\n```bash\ntana start\n```\n\n**Options:**\n- `-c, --chain <name>` - Specific chain to start (default: local)\n\n**Examples:**\n\n```bash\ntana start\n```\n\n```bash\ntana start --chain my-chain\n```\n\n**Output:**\n```\n🚀 Starting Tana...\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nStarting Ledger Service...\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n✓ Ledger service started\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nService Running:\n  URL:     http://localhost:8080\n  Chain:   local\n  PID:     12345\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\nPress Ctrl+C to stop\n```\n\n### stop\n\nStop all running services.\n\n```bash\ntana stop\n```\n\n**Output:**\n```\nStopping services...\n✓ Ledger service stopped\n```\n\n### status\n\nShow status of running services and chains.\n\n```bash\ntana status\n```\n\n**Output:**\n```\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTana Status\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\nServices:\n  ✓ Ledger running on http://localhost:8080\n\nChains:\n  • local (default)\n    Genesis: 0x1a2b3c...\n\nUsers:\n  • @alice (Alice Johnson)\n  • @bob (Bob Smith)\n\nDefault Chain: local\nDefault User: @alice\n```\n\n## Creation\n\n### new chain\n\nCreate a new blockchain (you become the genesis leader).\n\n```bash\ntana new chain <name>\n```\n\n**Arguments:**\n- `<name>` - Chain name\n\n**Examples:**\n\n```bash\ntana new chain my-chain\n```\n\n```bash\ntana new chain testnet\n```\n\n**Output:**\n```\nCreating new blockchain: my-chain\n\n✓ Genesis block created\n✓ Chain config saved to ~/.config/tana/chains/my-chain.json\n✓ Set as default chain\n\nChain ID: my-chain\nGenesis Hash: 0x1a2b3c4d5e6f7890...\n```\n\n### new node\n\nCreate a new node to join an existing chain.\n\n```bash\ntana new node\n```\n\n**Options:**\n- `--connect <url>` - Chain URL to connect to\n\n**Examples:**\n```bash\ntana new node --connect https://chain.example.com\n```\n\n**Output:**\n```\nConnecting to chain at https://chain.example.com...\n\n✓ Chain validated\n✓ Node config saved to ~/.config/tana/nodes/node-xyz.json\n\nNode ID: node-xyz\nChain: mainnet\nReady to start syncing\n```\n\n### new user\n\nCreate a new user account locally.\n\n```bash\ntana new user <username>\n```\n\n**Arguments:**\n- `<username>` - Username (must start with @)\n\n**Options:**\n- `-n, --name <name>` - Display name\n- `-b, --bio <bio>` - User bio\n\n**Examples:**\n\n```bash\ntana new user @alice --name \"Alice Johnson\"\n```\n\n```bash\ntana new user @bob --name \"Bob Smith\" --bio \"Developer\"\n```\n\n**Output:**\n```\nCreating user: @alice\n\n✓ Keypair generated\n✓ User config saved to ~/.config/tana/users/@alice.json\n\nUsername: @alice\nDisplay Name: Alice Johnson\nPublic Key: ed25519_abc123...\n\n⚠ User created locally. Run 'tana deploy user @alice' to add to blockchain.\n```\n\n### new contract\n\nScaffold a new smart contract.\n\n```bash\ntana new contract [name]\n```\n\n**Arguments:**\n- `[name]` - Contract name (optional)\n\n**Examples:**\n\n```bash\ntana new contract\n```\n\n```bash\ntana new contract token-transfer\n```\n\n**Output:**\n```\nCreating smart contract...\n\n✓ Created contract.ts\n✓ Created contract.json\n\nContract template includes:\n  • tana:core (console, version)\n  • tana:data (key-value storage)\n  • tana:block (blockchain queries)\n  • tana:tx (transaction staging)\n```\n\n## Deployment\n\n### deploy user\n\nDeploy user account to blockchain.\n\n```bash\ntana deploy user <username>\n```\n\n**Arguments:**\n- `<username>` - Username to deploy\n\n**Options:**\n- `-t, --target <url>` - Target chain URL\n\n**Examples:**\n\n```bash\ntana deploy user @alice\n```\n\n```bash\ntana deploy user @alice --target https://chain.example.com\n```\n\n**Output:**\n```\nDeploying user @alice to blockchain...\n\n✓ Transaction created\n✓ Transaction submitted\n⏳ Waiting for block confirmation...\n✓ User deployed successfully\n\nUser ID: usr_1a2b3c4d5e6f\nTransaction ID: tx_7g8h9i0j1k2l\nBlock: #42\n```\n\n### deploy contract\n\nDeploy smart contract to blockchain.\n\n```bash\ntana deploy contract <path>\n```\n\n**Arguments:**\n- `<path>` - Path to contract file\n\n**Options:**\n- `-t, --target <url>` - Target chain URL\n\n**Examples:**\n\n```bash\ntana deploy contract ./contract.ts\n```\n\n```bash\ntana deploy contract ./token.ts --target https://chain.example.com\n```\n\n**Output:**\n```\nDeploying contract: ./contract.ts\n\n✓ Contract validated\n✓ Transaction created\n✓ Transaction submitted\n⏳ Waiting for block confirmation...\n✓ Contract deployed successfully\n\nContract ID: cnt_xyz789\nTransaction ID: tx_abc123\nBlock: #43\nContract Address: @alice/token-transfer\n```\n\n## Blockchain Operations\n\n### run\n\nTest run a contract locally.\n\n```bash\ntana run <contract>\n```\n\n**Arguments:**\n- `<contract>` - Path to contract file\n\n**Examples:**\n\n```bash\ntana run examples/alice-to-bob.ts\n```\n\n```bash\ntana run ./my-contract.ts\n```\n\n**Output:**\n```\nRunning contract: examples/alice-to-bob.ts\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nContract Output:\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\nTransferring 100 USD from @alice to @bob\n✓ Balance checked\n✓ Transaction staged\n✓ Transfer complete\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nExecution Summary:\n  Status: Success\n  Runtime: 45ms\n  Gas Used: 0.002\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n```\n\n### balance\n\nCheck user balance.\n\n```bash\ntana balance <user>\n```\n\n**Arguments:**\n- `<user>` - Username or user ID\n\n**Options:**\n- `-c, --currency <code>` - Currency code (default: USD)\n\n**Examples:**\n\n```bash\ntana balance @alice\n```\n\n```bash\ntana balance @alice --currency ETH\n```\n\n**Output:**\n```\nBalances for @alice:\n\n  USD    1,000.50\n  ETH    2.5\n  BTC    0.01\n\nTotal currencies: 3\n```\n\n### transfer\n\nTransfer funds between users.\n\n```bash\ntana transfer <from> <to> <amount> <currency>\n```\n\n**Arguments:**\n- `<from>` - Sender username\n- `<to>` - Recipient username\n- `<amount>` - Amount to transfer\n- `<currency>` - Currency code\n\n**Examples:**\n\n```bash\ntana transfer @alice @bob 100 USD\n```\n\n```bash\ntana transfer @alice @bob 0.5 ETH\n```\n\n**Output:**\n```\nTransferring 100 USD from @alice to @bob...\n\n✓ Balance verified\n✓ Transaction created\n✓ Transaction submitted\n⏳ Waiting for block confirmation...\n✓ Transfer complete\n\nTransaction ID: tx_1a2b3c4d\nBlock: #44\nNew Balances:\n  @alice: 900.50 USD\n  @bob: 100.00 USD\n```\n\n## System\n\n### check\n\nValidate system requirements and configuration.\n\n```bash\ntana check\n```\n\n**Output:**\n```\nChecking system requirements...\n\n✓ Bun installed (v1.0.25)\n✓ PostgreSQL running (v15.3)\n✓ Database connected\n✓ Rust toolchain available (v1.75.0)\n✓ Configuration valid\n\nSystem ready for Tana\n```\n\n## Global Options\n\nAll commands support these options:\n\n- `--help` - Show help for a command\n- `--version` - Show version information\n"
  },
  {
    "slug": [
      "tana-edge",
      "examples"
    ],
    "metadata": {
      "title": "Edge Examples",
      "description": "Complete examples for building contracts with tana-edge",
      "sidebar": {
        "order": 2
      }
    },
    "content": "\nReal-world examples of building HTTP APIs with tana-edge.\n\n## Hello World\n\nThe simplest possible edge contract:\n\n```typescript title=\"contracts/hello/get.ts\"\nimport { Request, Response } from 'tana/net'\n\nexport function Get(req: Request) {\n  return Response.json({\n    message: 'Hello from tana-edge!',\n    timestamp: Date.now()\n  })\n}\n```\n\n**Test it:**\n```bash\ncurl http://localhost:8082/hello\n```\n\n## POST with JSON Body\n\nHandle POST requests with JSON data:\n\n```typescript title=\"contracts/echo/post.ts\"\nimport { Request, Response } from 'tana/net'\nimport { console } from 'tana/core'\n\nexport function Post(req: Request, body: any) {\n  console.log('Received:', body)\n\n  return Response.json({\n    echo: body,\n    received: Date.now()\n  })\n}\n```\n\n**Test it:**\n```bash\ncurl -X POST http://localhost:8082/echo \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"name\":\"test\",\"value\":42}'\n```\n\n## Blockchain Queries\n\nQuery blockchain state from your contract:\n\n```typescript title=\"contracts/account/get.ts\"\nimport { Request, Response } from 'tana/net'\nimport { block } from 'tana/block'\n\nexport async function Get(req: Request) {\n  // Get user balance from blockchain\n  const balance = await block.getBalance('alice', 'USD')\n\n  // Get blockchain context\n  const height = block.getHeight()\n  const timestamp = block.getTimestamp()\n\n  return Response.json({\n    user: 'alice',\n    balance,\n    blockHeight: Number(height),\n    timestamp\n  })\n}\n```\n\n**Response:**\n```json\n{\n  \"status\": 200,\n  \"body\": {\n    \"user\": \"alice\",\n    \"balance\": 1000,\n    \"blockHeight\": 12345,\n    \"timestamp\": 1762631458341\n  }\n}\n```\n\n## Persistent Storage\n\n\n```typescript title=\"contracts/counter/get.ts\"\nimport { Request, Response } from 'tana/net'\n\nexport async function Get(req: Request) {\n  // Get current count\n  const count = await data.get('count') || 0\n\n  // Increment\n  await data.set('count', count + 1)\n  await data.commit()\n\n  return Response.json({\n    count: count + 1,\n    message: 'Counter incremented!'\n  })\n}\n```\n\nEvery request increments the counter, and the value persists!\n\n## KV Storage\n\nModern key-value storage with Cloudflare Workers API:\n\n```typescript title=\"contracts/sessions/get.ts\"\nimport { Request, Response } from 'tana/net'\nimport { kv } from 'tana/kv'\n\nexport async function Get(req: Request) {\n  const sessionId = req.query.id\n\n  if (!sessionId) {\n    return Response.json({ error: 'Missing session ID' }, 400)\n  }\n\n  // Get session from KV\n  const session = await kv.get(`session:${sessionId}`, { type: 'json' })\n\n  if (!session) {\n    return Response.json({ error: 'Session not found' }, 404)\n  }\n\n  return Response.json({ session })\n}\n```\n\n```typescript title=\"contracts/sessions/post.ts\"\nimport { Request, Response } from 'tana/net'\nimport { kv } from 'tana/kv'\n\nexport async function Post(req: Request, body: any) {\n  const { action, sessionId, userId } = body\n\n  if (action === 'create') {\n    const session = {\n      userId,\n      createdAt: Date.now(),\n      lastActivity: Date.now()\n    }\n    await kv.put(`session:${sessionId}`, session)\n    return Response.json({ success: true, session })\n  }\n\n  if (action === 'delete') {\n    await kv.delete(`session:${sessionId}`)\n    return Response.json({ success: true })\n  }\n\n  return Response.json({ error: 'Unknown action' }, 400)\n}\n```\n\n**Test it:**\n```bash\n# Create session\ncurl -X POST http://localhost:8082/sessions \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"action\":\"create\",\"sessionId\":\"xyz123\",\"userId\":\"alice\"}'\n\n# Get session\ncurl http://localhost:8082/sessions?id=xyz123\n\n# Delete session\ncurl -X POST http://localhost:8082/sessions \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"action\":\"delete\",\"sessionId\":\"xyz123\"}'\n```\n\n## Transaction Staging\n\nStage blockchain transactions from edge:\n\n```typescript title=\"contracts/transfer/post.ts\"\nimport { Request, Response } from 'tana/net'\nimport { tx } from 'tana/tx'\nimport { console } from 'tana/core'\n\nexport function Post(req: Request, body: any) {\n  const { from, to, amount, currency } = body\n\n  // Stage a transfer transaction\n  tx.transfer(from, to, amount, currency)\n\n  // Get staged changes\n  const changes = tx.getChanges()\n\n  console.log('Staged changes:', changes)\n\n  return Response.json({\n    message: 'Transfer staged',\n    changes,\n    note: 'Call tx.execute() to commit to blockchain'\n  })\n}\n```\n\n**Test it:**\n```bash\ncurl -X POST http://localhost:8082/transfer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"from\":\"alice\",\"to\":\"bob\",\"amount\":100,\"currency\":\"USD\"}'\n```\n\n## External API Calls\n\nFetch data from external services:\n\n```typescript title=\"contracts/pokemon/get.ts\"\nimport { Request, Response } from 'tana/net'\nimport { fetch } from 'tana/utils'\n\nexport async function Get(req: Request) {\n  // Fetch from external API (whitelisted domain)\n  const response = await fetch('https://pokeapi.co/api/v2/pokemon/pikachu')\n  const pokemon = await response.json()\n\n  return Response.json({\n    name: pokemon.name,\n    height: pokemon.height,\n    weight: pokemon.weight,\n    abilities: pokemon.abilities.map(a => a.ability.name)\n  })\n}\n```\n\n**Note:** Only whitelisted domains are allowed (pokeapi.co, tana.dev, localhost)\n\n## Custom Status Codes\n\nReturn appropriate HTTP status codes:\n\n```typescript title=\"contracts/users/get.ts\"\nimport { Request, Response } from 'tana/net'\nimport { block } from 'tana/block'\n\nexport async function Get(req: Request) {\n  const userId = req.query.id\n\n  if (!userId) {\n    return Response.json(\n      { error: 'Missing user ID' },\n      400  // Bad Request\n    )\n  }\n\n  const user = await block.getUser(userId)\n\n  if (!user) {\n    return Response.json(\n      { error: 'User not found' },\n      404  // Not Found\n    )\n  }\n\n  return Response.json({ user })  // 200 OK\n}\n```\n\n## Complete Example: API with All Features\n\nA full-featured contract using all available modules:\n\n```typescript title=\"contracts/api/get.ts\"\nimport { Request, Response } from 'tana/net'\nimport { console } from 'tana/core'\nimport { block } from 'tana/block'\nimport { tx } from 'tana/tx'\n\nexport async function Get(req: Request) {\n  console.log('API request received')\n\n  try {\n    // 1. Read analytics (read-only in GET)\n    const visits = (await kv.get('visits', { type: 'json' })) || 0\n    const lastVisit = await kv.get('lastVisit', { type: 'json' })\n\n    // 2. Get blockchain context\n    const height = Number(block.getHeight())\n    const gasLimit = Number(block.getGasLimit())\n    const timestamp = block.getTimestamp()\n\n    // 3. Query user balance\n    const balance = await block.getBalance('alice', 'USD')\n\n    // 4. Stage a transaction (for demo)\n    tx.transfer('alice', 'bob', 10, 'USD')\n    const stagedTx = tx.getChanges()\n\n    // 5. Return comprehensive response\n    return Response.json({\n      api: {\n        version: '1.0.0',\n        totalVisits: visits + 1,\n        lastVisit: Date.now()\n      },\n      blockchain: {\n        height,\n        timestamp,\n        gasLimit\n      },\n      user: {\n        id: 'alice',\n        balance\n      },\n      transactions: {\n        staged: stagedTx.length,\n        preview: stagedTx\n      }\n    })\n  } catch (error) {\n    console.error('Error:', error)\n    return Response.json(\n      { error: error.message },\n      500\n    )\n  }\n}\n```\n\n**Response:**\n```json\n{\n  \"status\": 200,\n  \"body\": {\n    \"api\": {\n      \"version\": \"1.0.0\",\n      \"totalVisits\": 5,\n      \"lastVisit\": 1762631458341\n    },\n    \"blockchain\": {\n      \"height\": 12345,\n      \"timestamp\": 1762631458341,\n      \"gasLimit\": 1000000\n    },\n    \"user\": {\n      \"id\": \"alice\",\n      \"balance\": 1000\n    },\n    \"transactions\": {\n      \"staged\": 1,\n      \"preview\": [\n        {\n          \"type\": \"transfer\",\n          \"from\": \"alice\",\n          \"to\": \"bob\",\n          \"amount\": 10,\n          \"currency\": \"USD\"\n        }\n      ]\n    }\n  }\n}\n```\n\n## Module Reference\n\nQuick reference for all available modules:\n\n```typescript\n// tana/core - Logging and version info\nimport { console } from 'tana/core'\nconsole.log('message')\nconsole.error('error')\n\n// tana/net - HTTP primitives\nimport { Request, Response } from 'tana/net'\nResponse.json(data, 200)\nResponse.text('hello', 200)\n\n// tana/block - Blockchain queries\nimport { block } from 'tana/block'\nawait block.getBalance(userId, currency)\nawait block.getUser(userId)\nawait block.getTransaction(txId)\nblock.getHeight()\nblock.getTimestamp()\nblock.getHash()\n\n// tana/kv - Cloudflare Workers KV\nimport { kv } from 'tana/kv'\nawait kv.put(key, value)\nawait kv.get(key, { type: 'json' })\nawait kv.delete(key)\nawait kv.list({ prefix: 'user:' })\n\n// tana/tx - Transaction staging\nimport { tx } from 'tana/tx'\ntx.transfer(from, to, amount, currency)\ntx.setBalance(userId, amount, currency)\ntx.getChanges()\ntx.execute()\n\n// tana/utils - External HTTP\nimport { fetch } from 'tana/utils'\nconst response = await fetch(url)\nconst data = await response.json()\n```\n\n## Next Steps\n\n- **[API Reference](/tana-api/modules/)** - Detailed module documentation\n- **[Architecture](/guides/architecture/)** - Understanding the hybrid model\n- **[CLI Guide](/tana-cli/intro/)** - Deploy contracts to blockchain\n"
  },
  {
    "slug": [
      "tana-edge",
      "intro"
    ],
    "metadata": {
      "title": "Edge Server Overview",
      "description": "Introduction to the Tana Edge HTTP server for off-chain contract execution",
      "sidebar": {
        "order": 1
      }
    },
    "content": "\nThe Tana Edge server (`tana-edge`) is a high-performance HTTP server that executes TypeScript smart contracts off-chain, enabling fast API endpoints while maintaining blockchain integration for critical operations.\n\n## Architecture\n\nEdge follows a **hybrid on-chain/off-chain model** inspired by Cloudflare Workers:\n\n- **On-chain** (`Init()`, `Contract()`) - Deployed via blockchain consensus, stores critical state\n- **Off-chain** (`Get()`, `Post()`) - Executed on edge servers, handles HTTP requests at millisecond latency\n\nEach HTTP request spawns a fresh V8 isolate (Cloudflare-style), ensuring security and isolation between requests.\n\n## Why Edge?\n\nTraditional blockchains are too slow for real-time applications. Edge solves this by:\n\n- ⚡ **Speed** - HTTP requests complete in <100ms vs blockchain's seconds\n- 💰 **Cost** - No gas fees for queries\n- 🔄 **Flexibility** - Read data, compose responses, call external APIs\n- 🔒 **Security** - Still backed by blockchain for critical operations\n\n**Use Cases:**\n- REST APIs for blockchain data\n- Real-time dashboards and analytics\n- File uploads and processing\n- Comment systems, notifications\n- Anything requiring fast reads with occasional writes\n\n## Installation\n\n```bash\n# Build tana-edge from source\ncd tana-edge\ncargo build --release\n\n# Binary will be at: ./target/release/tana-edge\n```\n\n## Quick Start\n\n**1. Create a contract:**\n\n```bash\n# Create contract directory\nmkdir -p contracts/hello\n\n# Create GET endpoint\ncat > contracts/hello/get.ts << 'EOF'\nimport { Request, Response } from 'tana/net'\nimport { console } from 'tana/core'\n\nexport function Get(req: Request) {\n  console.log('Request received!')\n\n  return Response.json({\n    message: 'Hello from tana-edge!',\n    timestamp: Date.now()\n  })\n}\nEOF\n```\n\n**2. Start the server:**\n\n```bash\ncd tana-edge\n./target/release/tana-edge\n```\n\n**3. Test your endpoint:**\n\n```bash\ncurl http://localhost:8082/hello\n\n# Response:\n# {\n#   \"status\": 200,\n#   \"body\": {\n#     \"message\": \"Hello from tana-edge!\",\n#     \"timestamp\": 1762631458341\n#   }\n# }\n```\n\n## Contract Structure\n\nContracts live in `contracts/{contractId}/`:\n\n```\ncontracts/\n└── myapp/\n    ├── get.ts   # Handles GET  /myapp\n    └── post.ts  # Handles POST /myapp\n```\n\nEach file exports a function that receives a `Request` and returns a `Response`.\n\n## Available Modules\n\nEdge contracts have access to all Tana modules:\n\n| Module | Purpose | Example |\n|--------|---------|---------|\n| `tana/core` | Console, version info | `console.log('hi')` |\n| `tana/net` | HTTP requests/responses | `Response.json({...})` |\n| `tana/block` | Blockchain queries | `block.getHeight()` |\n| `tana/tx` | Transaction staging | `tx.transfer('alice', 'bob', 100)` |\n| `tana/utils` | External HTTP calls | `await fetch('http://...')` |\n\nSee [Examples](/tana-edge/examples/) for complete code samples.\n\n## Configuration\n\n**Default Settings:**\n- **Port:** 8082\n- **Contracts Directory:** `../contracts/` (relative to binary)\n- **CORS:** Permissive (all origins)\n\n**Environment Variables:**\n```bash\nDATABASE_URL='postgres://tana:[PASSWORD]@localhost:5432/tana'  # For blockchain queries\n```\n\n## Production Deployment\n\nEdge is designed for self-hosting:\n\n```bash\n# 1. Build optimized binary\ncargo build --release\n\n# 2. Run as systemd service\nsudo systemctl start tana-edge\n\n# 3. Map subdomains in reverse proxy\n# Production routing:\n# cnt_abc123.tana.network → localhost:8082/cnt_abc123\n```\n\n**Subdomain Routing:**\n\nIn production, contracts are accessed via subdomains:\n- Dev: `localhost:8082/myapp` (path-based)\n- Prod: `myapp.tana.network` (subdomain)\n\n## Performance\n\n- **Latency:** <100ms per request (fresh V8 isolate per request)\n- **Throughput:** Thousands of requests/second\n- **Memory:** Isolated per-request (no state leakage)\n- **Scaling:** Horizontal (stateless design)\n\n## Next Steps\n\n- **[Examples](/tana-edge/examples/)** - Complete code examples\n- **[API Reference](/tana-api/modules/)** - Available Tana modules\n- **[Architecture Guide](/guides/architecture/)** - System design\n"
  }
]