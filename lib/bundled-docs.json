[
  {
    "slug": [
      "tana-api",
      "blocks"
    ],
    "metadata": {
      "title": "/blocks",
      "description": "Query blockchain blocks"
    },
    "content": "\nQuery blocks on the Tana blockchain. Blocks are produced every 6 seconds and contain confirmed transactions.\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/blocks</b></code> <code>(list blocks)</code></summary>\n\n### Request\n\n```bash\ncurl \"http://localhost:8080/blocks?limit=10&offset=0\"\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**limit**</td>\n    <td>number</td>\n    <td>optional (default: 10)</td>\n  </tr>\n <tr>\n    <td>**offset**</td>\n    <td>number</td>\n    <td>optional (default: 0)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n[\n  {\n    \"id\": \"blk_xyz789\",\n    \"height\": 42,\n    \"hash\": \"0x1a2b3c...\",\n    \"previousHash\": \"0x9z8y7x...\",\n    \"stateRoot\": \"0x4d5e6f...\",\n    \"timestamp\": \"2024-11-08T12:00:06.000Z\",\n    \"transactionCount\": 5,\n    \"producerId\": \"usr_leader1\"\n  },\n  {\n    \"id\": \"blk_abc123\",\n    \"height\": 41,\n    \"hash\": \"0x9z8y7x...\",\n    \"previousHash\": \"0x6g5h4i...\",\n    \"stateRoot\": \"0x7j8k9l...\",\n    \"timestamp\": \"2024-11-08T12:00:00.000Z\",\n    \"transactionCount\": 3,\n    \"producerId\": \"usr_leader1\"\n  }\n]\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/blocks/latest</b></code> <code>(get latest block)</code></summary>\n\n### Request\n\n```bash\ncurl http://localhost:8080/blocks/latest\n```\n\n### Parameters\n\nNone\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"id\": \"blk_xyz789\",\n  \"height\": 42,\n  \"hash\": \"0x1a2b3c...\",\n  \"previousHash\": \"0x9z8y7x...\",\n  \"stateRoot\": \"0x4d5e6f...\",\n  \"timestamp\": \"2024-11-08T12:00:06.000Z\",\n  \"transactionCount\": 5,\n  \"producerId\": \"usr_leader1\",\n  \"transactions\": [\n    {\n      \"id\": \"tx_1a2b3c4d5e6f\",\n      \"type\": \"transfer\",\n      \"from\": \"usr_abc123\",\n      \"to\": \"usr_def456\"\n    }\n  ]\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"No blocks found\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/blocks/:height</b></code> <code>(get block by height)</code></summary>\n\n### Request\n\n```bash\ncurl http://localhost:8080/blocks/42\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**height**</td>\n    <td>number</td>\n    <td>required (URL param)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"id\": \"blk_xyz789\",\n  \"height\": 42,\n  \"hash\": \"0x1a2b3c...\",\n  \"previousHash\": \"0x9z8y7x...\",\n  \"stateRoot\": \"0x4d5e6f...\",\n  \"timestamp\": \"2024-11-08T12:00:06.000Z\",\n  \"transactionCount\": 5,\n  \"producerId\": \"usr_leader1\",\n  \"transactions\": [\n    {\n      \"id\": \"tx_1a2b3c4d5e6f\",\n      \"type\": \"transfer\",\n      \"from\": \"usr_abc123\",\n      \"to\": \"usr_def456\"\n    }\n  ]\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Invalid block height\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Block not found\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/blocks/hash/:hash</b></code> <code>(get block by hash)</code></summary>\n\n### Request\n\n```bash\ncurl http://localhost:8080/blocks/hash/0x1a2b3c4d5e6f...\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**hash**</td>\n    <td>string (hex)</td>\n    <td>required (URL param)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"id\": \"blk_xyz789\",\n  \"height\": 42,\n  \"hash\": \"0x1a2b3c4d5e6f...\",\n  \"previousHash\": \"0x9z8y7x...\",\n  \"stateRoot\": \"0x4d5e6f...\",\n  \"timestamp\": \"2024-11-08T12:00:06.000Z\",\n  \"transactionCount\": 5,\n  \"producerId\": \"usr_leader1\",\n  \"transactions\": [\n    {\n      \"id\": \"tx_1a2b3c4d5e6f\",\n      \"type\": \"transfer\",\n      \"from\": \"usr_abc123\",\n      \"to\": \"usr_def456\"\n    }\n  ]\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Block not found\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n### Method Not Allowed\n\nThe following methods are not supported:\n\n<code className=\"text-green-400\">POST</code> <code className=\"text-orange-400\">PUT</code> <code className=\"text-red-400\">DELETE</code> <code className=\"text-purple-400\">PATCH</code>\n",
    "html": "<p>Query blocks on the Tana blockchain. Blocks are produced every 6 seconds and contain confirmed transactions.</p>\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/blocks</b></code> <code>(list blocks)</code></summary>\n\n<h3 id=\"request\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> \"http://localhost:8080/blocks?limit=10&#x26;offset=0\"</span></span></code></pre>\n</code></pre><h3 id=\"parameters\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**limit**</td>\n    <td>number</td>\n    <td>optional (default: 10)</td>\n  </tr>\n <tr>\n    <td>**offset**</td>\n    <td>number</td>\n    <td>optional (default: 0)</td>\n  </tr>\n</table>\n\n<h3 id=\"response\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">[</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"blk_xyz789\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"height\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">42</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"hash\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"0x1a2b3c...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"previousHash\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"0x9z8y7x...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"stateRoot\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"0x4d5e6f...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"timestamp\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:06.000Z\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"transactionCount\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">5</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"producerId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_leader1\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"blk_abc123\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"height\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">41</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"hash\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"0x9z8y7x...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"previousHash\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"0x6g5h4i...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"stateRoot\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"0x7j8k9l...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"timestamp\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:00.000Z\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"transactionCount\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">3</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"producerId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_leader1\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">]</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level\">Access Level</h3>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/blocks/latest</b></code> <code>(get latest block)</code></summary>\n\n<h3 id=\"request-1\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8080/blocks/latest</span></span></code></pre>\n</code></pre><h3 id=\"parameters-1\">Parameters</h3>\n<p>None</p>\n<h3 id=\"response-1\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"blk_xyz789\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"height\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">42</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"hash\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"0x1a2b3c...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"previousHash\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"0x9z8y7x...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"stateRoot\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"0x4d5e6f...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"timestamp\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:06.000Z\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"transactionCount\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">5</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"producerId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_leader1\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"transactions\"</span><span style=\"color:#E1E4E8\">: [</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"tx_1a2b3c4d5e6f\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      \"type\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"transfer\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      \"from\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_abc123\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      \"to\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_def456\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  ]</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"No blocks found\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level-1\">Access Level</h3>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/blocks/:height</b></code> <code>(get block by height)</code></summary>\n\n<h3 id=\"request-2\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8080/blocks/42</span></span></code></pre>\n</code></pre><h3 id=\"parameters-2\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**height**</td>\n    <td>number</td>\n    <td>required (URL param)</td>\n  </tr>\n</table>\n\n<h3 id=\"response-2\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"blk_xyz789\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"height\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">42</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"hash\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"0x1a2b3c...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"previousHash\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"0x9z8y7x...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"stateRoot\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"0x4d5e6f...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"timestamp\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:06.000Z\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"transactionCount\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">5</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"producerId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_leader1\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"transactions\"</span><span style=\"color:#E1E4E8\">: [</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"tx_1a2b3c4d5e6f\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      \"type\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"transfer\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      \"from\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_abc123\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      \"to\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_def456\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  ]</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Invalid block height\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Block not found\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level-2\">Access Level</h3>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/blocks/hash/:hash</b></code> <code>(get block by hash)</code></summary>\n\n<h3 id=\"request-3\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8080/blocks/hash/0x1a2b3c4d5e6f...</span></span></code></pre>\n</code></pre><h3 id=\"parameters-3\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**hash**</td>\n    <td>string (hex)</td>\n    <td>required (URL param)</td>\n  </tr>\n</table>\n\n<h3 id=\"response-3\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"blk_xyz789\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"height\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">42</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"hash\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"0x1a2b3c4d5e6f...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"previousHash\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"0x9z8y7x...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"stateRoot\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"0x4d5e6f...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"timestamp\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:06.000Z\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"transactionCount\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">5</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"producerId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_leader1\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"transactions\"</span><span style=\"color:#E1E4E8\">: [</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"tx_1a2b3c4d5e6f\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      \"type\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"transfer\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      \"from\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_abc123\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      \"to\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_def456\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  ]</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Block not found\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level-3\">Access Level</h3>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<h3 id=\"method-not-allowed\">Method Not Allowed</h3>\n<p>The following methods are not supported:</p>\n<p><code className=\"text-green-400\">POST</code> <code className=\"text-orange-400\">PUT</code> <code className=\"text-red-400\">DELETE</code> <code className=\"text-purple-400\">PATCH</code></p>\n"
  },
  {
    "slug": [
      "tana-api",
      "identity"
    ],
    "metadata": {
      "title": "/auth (Identity Service)",
      "description": "Mobile-first authentication and session management API"
    },
    "content": "\nThe Identity Service provides secure authentication for Tana applications using mobile-first QR code authentication (similar to WhatsApp Web). Private keys remain exclusively on mobile devices, while desktop/laptop computers receive session tokens only.\n\n**Base URL:** `http://localhost:8090` (development) or `https://auth.tana.network` (production)\n\n**Key Concepts:**\n- **Session-based authentication** - No private keys on desktop/laptop\n- **QR code login** - Mobile app scans QR from website\n- **Server-Sent Events (SSE)** - Real-time session status updates\n- **Ed25519 signatures** - Cryptographic proof of ownership\n- **Hardware security** - Private keys protected by mobile device secure enclave\n\n---\n\n## Authentication Flow\n\n```\n1. Website → POST /auth/session/create\n   Returns: sessionId, challenge, QR data\n\n2. Website → GET /auth/session/:id/events (SSE)\n   Streams: Real-time session status updates\n\n3. Mobile App → GET /auth/session/:id\n   Returns: Session details, marks as \"scanned\"\n\n4. User approves on mobile\n\n5. Mobile App → POST /auth/session/:id/approve\n   Body: Signed challenge with Ed25519\n\n6. SSE → \"approved\" event to website\n   Includes: sessionToken for authenticated requests\n\n7. Website uses sessionToken for subsequent API calls\n```\n\n---\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/auth/session/create</b></code> <code>(create QR login session)</code></summary>\n\n### Request\n\n```bash\ncurl -X POST http://localhost:8090/auth/session/create \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"returnUrl\": \"http://localhost:3000/dashboard\",\n    \"appName\": \"My Tana App\",\n    \"appIcon\": \"https://example.com/icon.png\"\n  }'\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**returnUrl**</td>\n    <td>string (URL)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**appName**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**appIcon**</td>\n    <td>string (URL)</td>\n    <td>optional</td>\n  </tr>\n</table>\n\n### Response\n\n```json\n{\n  \"sessionId\": \"sess_3ogy2lnxi0fl4rlz\",\n  \"challenge\": \"auth_chal_b92f3aed...\",\n  \"expiresAt\": 1762915859863,\n  \"expiresIn\": 300,\n  \"qrData\": \"{\\\"sessionId\\\":\\\"sess_...\\\",\\\"challenge\\\":\\\"auth_chal_...\\\",\\\"service\\\":\\\"tana-identity\\\"}\"\n}\n```\n\n**Status:** `201 Created`\n\n**Use Case:** Website initiates login flow by creating a session and displaying QR code\n\n</details>\n\n---\n\n<details>\n <summary><code className=\"text-cyan-400\">GET</code> <code><b>/auth/session/:id/events</b></code> <code>(SSE stream for real-time updates)</code></summary>\n\n### Request\n\n```bash\ncurl -N http://localhost:8090/auth/session/sess_abc123/events\n```\n\n### Server-Sent Events\n\n**Connection event:**\n```json\nevent: connected\ndata: {\"type\":\"connected\",\"sessionId\":\"sess_abc123\"}\n```\n\n**Status update event:**\n```json\nevent: status\ndata: {\"type\":\"status\",\"status\":\"waiting\",\"scannedAt\":null,\"approvedAt\":null}\n```\n\n**Scanned event:**\n```json\nevent: status\ndata: {\"type\":\"status\",\"status\":\"scanned\",\"scannedAt\":\"2025-01-11T19:00:00.000Z\",\"approvedAt\":null}\n```\n\n**Approved event (terminal):**\n```json\nevent: approved\ndata: {\n  \"type\":\"approved\",\n  \"sessionToken\":\"tana_session_abc123...\",\n  \"userId\":\"usr_alice\",\n  \"username\":\"@alice\",\n  \"returnUrl\":\"http://localhost:3000/dashboard\"\n}\n```\n\n**Rejected event (terminal):**\n```json\nevent: rejected\ndata: {\"type\":\"rejected\"}\n```\n\n**Expired event (terminal):**\n```json\nevent: expired\ndata: {\"type\":\"expired\"}\n```\n\n**Status:** `200 OK` (keeps connection open)\n\n**Use Case:** Website opens SSE connection to receive real-time status updates as user scans/approves on mobile\n\n</details>\n\n---\n\n<details>\n <summary><code className=\"text-cyan-400\">GET</code> <code><b>/auth/session/:id</b></code> <code>(get session details)</code></summary>\n\n### Request\n\n```bash\ncurl http://localhost:8090/auth/session/sess_abc123\n```\n\n### Response\n\n```json\n{\n  \"sessionId\": \"sess_abc123\",\n  \"challenge\": \"auth_chal_b92f3aed...\",\n  \"status\": \"waiting\",\n  \"appName\": \"My Tana App\",\n  \"appIcon\": \"https://example.com/icon.png\",\n  \"expiresAt\": 1762915859863\n}\n```\n\n**Status:** `200 OK`\n\n**Side Effect:** If session status is \"waiting\", automatically marks as \"scanned\"\n\n**Use Case:** Mobile app scans QR code and retrieves session details\n\n</details>\n\n---\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/auth/session/:id/approve</b></code> <code>(approve login with signature)</code></summary>\n\n### Request\n\n```bash\ncurl -X POST http://localhost:8090/auth/session/sess_abc123/approve \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"userId\": \"usr_alice\",\n    \"username\": \"@alice\",\n    \"publicKey\": \"ed25519_abc123...\",\n    \"signature\": \"0x1a2b3c...\",\n    \"message\": \"I approve this login session: auth_chal_b92f3aed...\"\n  }'\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**userId**</td>\n    <td>string (UUID)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**username**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**publicKey**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**signature**</td>\n    <td>string (hex)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**message**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n</table>\n\n### Response\n\n```json\n{\n  \"success\": true,\n  \"sessionToken\": \"tana_session_abc123...\",\n  \"returnUrl\": \"http://localhost:3000/dashboard\"\n}\n```\n\n**Status:** `200 OK`\n\n**Validation:**\n- Ed25519 signature must be valid for the provided message and public key\n- Message must contain the session challenge\n- Session must be in \"waiting\" or \"scanned\" state\n- Session must not be expired\n\n**Use Case:** User approves login on mobile app, which signs the challenge with private key\n\n</details>\n\n---\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/auth/session/:id/reject</b></code> <code>(reject login)</code></summary>\n\n### Request\n\n```bash\ncurl -X POST http://localhost:8090/auth/session/sess_abc123/reject\n```\n\n### Response\n\n```json\n{\n  \"success\": true\n}\n```\n\n**Status:** `200 OK`\n\n**Use Case:** User rejects login attempt on mobile app\n\n</details>\n\n---\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/auth/session/validate</b></code> <code>(validate session token)</code></summary>\n\n### Request\n\n```bash\ncurl -X POST http://localhost:8090/auth/session/validate \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"sessionToken\": \"tana_session_abc123...\"\n  }'\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**sessionToken**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n</table>\n\n### Response (Valid)\n\n```json\n{\n  \"valid\": true,\n  \"userId\": \"usr_alice\",\n  \"username\": \"@alice\"\n}\n```\n\n**Status:** `200 OK`\n\n### Response (Invalid)\n\n```json\n{\n  \"error\": \"Invalid or expired session token\"\n}\n```\n\n**Status:** `401 Unauthorized`\n\n**Use Case:** Backend services validate session tokens from authenticated requests\n\n</details>\n\n---\n\n## Security Model\n\n### Private Key Isolation\n\n**✅ SECURE (Mobile Device):**\n- Private keys stored in hardware-backed secure enclave (iOS) / StrongBox (Android)\n- Biometric protection (Face ID, Touch ID, fingerprint)\n- OS-level sandboxing prevents key extraction\n- Signatures generated within secure hardware\n\n**❌ INSECURE (Desktop/Laptop):**\n- No private keys - only session tokens\n- Session tokens are revocable and time-limited (30 days)\n- Tokens provide read-only blockchain access\n- Desktop computers more vulnerable to malware\n\n### Why No Browser Extensions?\n\nTana explicitly rejects the MetaMask/browser extension model:\n\n1. **Malware Risk** - Desktop computers are primary malware targets\n2. **Browser Vulnerabilities** - Extensions have broad permissions\n3. **Key Extraction** - Software-based key storage can be compromised\n4. **User Behavior** - Users install many extensions from untrusted sources\n\n### Mobile-First Advantages\n\n1. **Hardware Security** - Secure enclave protects keys at hardware level\n2. **Biometric Auth** - Face ID/Touch ID for every transaction\n3. **Smaller Attack Surface** - iOS/Android app sandboxing\n4. **User Awareness** - Mobile approval makes every action explicit\n5. **Loss Prevention** - Devices can be remotely wiped\n\n### Authentication Flow Security\n\n1. **Challenge-Response** - Random challenge prevents replay attacks\n2. **Ed25519 Signatures** - Cryptographic proof of ownership\n3. **Time Limits** - Sessions expire after 5 minutes (login) or 30 days (token)\n4. **Status Tracking** - \"waiting\" → \"scanned\" → \"approved\" state machine\n5. **SSE Updates** - Real-time feedback without polling\n\n## Session Lifecycle\n\n**Session States:**\n- `waiting` - QR code displayed, waiting for mobile scan\n- `scanned` - Mobile app has retrieved session details\n- `approved` - User approved and signature verified → token generated\n- `rejected` - User declined login attempt\n- `expired` - Session timed out (5 minutes)\n\n**Session Token Lifecycle:**\n- Generated after approval with Ed25519 signature verification\n- Expires 30 days after approval\n- Can be revoked at any time\n- Used for subsequent authenticated API requests\n\n## Error Responses\n\n**404 Not Found:**\n```json\n{\n  \"error\": \"Session not found\"\n}\n```\n\n**400 Bad Request:**\n```json\n{\n  \"error\": \"Invalid signature\"\n}\n```\n\n```json\n{\n  \"error\": \"Challenge mismatch\"\n}\n```\n\n```json\n{\n  \"error\": \"Session expired\"\n}\n```\n\n**401 Unauthorized:**\n```json\n{\n  \"error\": \"Invalid or expired session token\"\n}\n```\n\n**500 Internal Server Error:**\n```json\n{\n  \"error\": \"Failed to create session\"\n}\n```\n\n## Related Documentation\n\n- [Mobile Authentication Protocol](/docs/MOBILE_AUTH_PROTOCOL.md) - Detailed protocol specification\n- [Transaction Signing Guide](/guides/transaction-signing/) - How Ed25519 signatures work\n- [Environment Variables](/contributing/env-vars/) - Configure `IDENTITY_DB_URL` and `IDENTITY_PORT`\n- [Architecture](/contributing/architecture/) - Identity service in system design\n",
    "html": "<p>The Identity Service provides secure authentication for Tana applications using mobile-first QR code authentication (similar to WhatsApp Web). Private keys remain exclusively on mobile devices, while desktop/laptop computers receive session tokens only.</p>\n<p><strong>Base URL:</strong> <code>http://localhost:8090</code> (development) or <code>https://auth.tana.network</code> (production)</p>\n<p><strong>Key Concepts:</strong></p>\n<ul>\n<li><strong>Session-based authentication</strong> - No private keys on desktop/laptop</li>\n<li><strong>QR code login</strong> - Mobile app scans QR from website</li>\n<li><strong>Server-Sent Events (SSE)</strong> - Real-time session status updates</li>\n<li><strong>Ed25519 signatures</strong> - Cryptographic proof of ownership</li>\n<li><strong>Hardware security</strong> - Private keys protected by mobile device secure enclave</li>\n</ul>\n<hr>\n<h2 id=\"authentication-flow\">Authentication Flow</h2>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>1. Website → POST /auth/session/create</span></span>\n<span class=\"line\"><span>   Returns: sessionId, challenge, QR data</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>2. Website → GET /auth/session/:id/events (SSE)</span></span>\n<span class=\"line\"><span>   Streams: Real-time session status updates</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>3. Mobile App → GET /auth/session/:id</span></span>\n<span class=\"line\"><span>   Returns: Session details, marks as \"scanned\"</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>4. User approves on mobile</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>5. Mobile App → POST /auth/session/:id/approve</span></span>\n<span class=\"line\"><span>   Body: Signed challenge with Ed25519</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>6. SSE → \"approved\" event to website</span></span>\n<span class=\"line\"><span>   Includes: sessionToken for authenticated requests</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>7. Website uses sessionToken for subsequent API calls</span></span></code></pre>\n</code></pre><hr>\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/auth/session/create</b></code> <code>(create QR login session)</code></summary>\n\n<h3 id=\"request\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -X</span><span style=\"color:#9ECBFF\"> POST</span><span style=\"color:#9ECBFF\"> http://localhost:8090/auth/session/create</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -H</span><span style=\"color:#9ECBFF\"> \"Content-Type: application/json\"</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -d</span><span style=\"color:#9ECBFF\"> '{</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"returnUrl\": \"http://localhost:3000/dashboard\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"appName\": \"My Tana App\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"appIcon\": \"https://example.com/icon.png\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  }'</span></span></code></pre>\n</code></pre><h3 id=\"parameters\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**returnUrl**</td>\n    <td>string (URL)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**appName**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**appIcon**</td>\n    <td>string (URL)</td>\n    <td>optional</td>\n  </tr>\n</table>\n\n<h3 id=\"response\">Response</h3>\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"sessionId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"sess_3ogy2lnxi0fl4rlz\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"challenge\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"auth_chal_b92f3aed...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"expiresAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">1762915859863</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"expiresIn\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">300</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"qrData\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"{</span><span style=\"color:#79B8FF\">\\\"</span><span style=\"color:#9ECBFF\">sessionId</span><span style=\"color:#79B8FF\">\\\"</span><span style=\"color:#9ECBFF\">:</span><span style=\"color:#79B8FF\">\\\"</span><span style=\"color:#9ECBFF\">sess_...</span><span style=\"color:#79B8FF\">\\\"</span><span style=\"color:#9ECBFF\">,</span><span style=\"color:#79B8FF\">\\\"</span><span style=\"color:#9ECBFF\">challenge</span><span style=\"color:#79B8FF\">\\\"</span><span style=\"color:#9ECBFF\">:</span><span style=\"color:#79B8FF\">\\\"</span><span style=\"color:#9ECBFF\">auth_chal_...</span><span style=\"color:#79B8FF\">\\\"</span><span style=\"color:#9ECBFF\">,</span><span style=\"color:#79B8FF\">\\\"</span><span style=\"color:#9ECBFF\">service</span><span style=\"color:#79B8FF\">\\\"</span><span style=\"color:#9ECBFF\">:</span><span style=\"color:#79B8FF\">\\\"</span><span style=\"color:#9ECBFF\">tana-identity</span><span style=\"color:#79B8FF\">\\\"</span><span style=\"color:#9ECBFF\">}\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Status:</strong> <code>201 Created</code></p>\n<p><strong>Use Case:</strong> Website initiates login flow by creating a session and displaying QR code</p>\n</details>\n\n<hr>\n<details>\n <summary><code className=\"text-cyan-400\">GET</code> <code><b>/auth/session/:id/events</b></code> <code>(SSE stream for real-time updates)</code></summary>\n\n<h3 id=\"request-1\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -N</span><span style=\"color:#9ECBFF\"> http://localhost:8090/auth/session/sess_abc123/events</span></span></code></pre>\n</code></pre><h3 id=\"server-sent-events\">Server-Sent Events</h3>\n<p><strong>Connection event:</strong></p>\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">event: connected</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">data: {</span><span style=\"color:#79B8FF\">\"type\"</span><span style=\"color:#E1E4E8\">:</span><span style=\"color:#9ECBFF\">\"connected\"</span><span style=\"color:#E1E4E8\">,</span><span style=\"color:#79B8FF\">\"sessionId\"</span><span style=\"color:#E1E4E8\">:</span><span style=\"color:#9ECBFF\">\"sess_abc123\"</span><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Status update event:</strong></p>\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">event: status</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">data: {</span><span style=\"color:#79B8FF\">\"type\"</span><span style=\"color:#E1E4E8\">:</span><span style=\"color:#9ECBFF\">\"status\"</span><span style=\"color:#E1E4E8\">,</span><span style=\"color:#79B8FF\">\"status\"</span><span style=\"color:#E1E4E8\">:</span><span style=\"color:#9ECBFF\">\"waiting\"</span><span style=\"color:#E1E4E8\">,</span><span style=\"color:#79B8FF\">\"scannedAt\"</span><span style=\"color:#E1E4E8\">:</span><span style=\"color:#79B8FF\">null</span><span style=\"color:#E1E4E8\">,</span><span style=\"color:#79B8FF\">\"approvedAt\"</span><span style=\"color:#E1E4E8\">:</span><span style=\"color:#79B8FF\">null</span><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Scanned event:</strong></p>\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">event: status</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">data: {</span><span style=\"color:#79B8FF\">\"type\"</span><span style=\"color:#E1E4E8\">:</span><span style=\"color:#9ECBFF\">\"status\"</span><span style=\"color:#E1E4E8\">,</span><span style=\"color:#79B8FF\">\"status\"</span><span style=\"color:#E1E4E8\">:</span><span style=\"color:#9ECBFF\">\"scanned\"</span><span style=\"color:#E1E4E8\">,</span><span style=\"color:#79B8FF\">\"scannedAt\"</span><span style=\"color:#E1E4E8\">:</span><span style=\"color:#9ECBFF\">\"2025-01-11T19:00:00.000Z\"</span><span style=\"color:#E1E4E8\">,</span><span style=\"color:#79B8FF\">\"approvedAt\"</span><span style=\"color:#E1E4E8\">:</span><span style=\"color:#79B8FF\">null</span><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Approved event (terminal):</strong></p>\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">event: approved</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">data: {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"type\"</span><span style=\"color:#E1E4E8\">:</span><span style=\"color:#9ECBFF\">\"approved\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"sessionToken\"</span><span style=\"color:#E1E4E8\">:</span><span style=\"color:#9ECBFF\">\"tana_session_abc123...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"userId\"</span><span style=\"color:#E1E4E8\">:</span><span style=\"color:#9ECBFF\">\"usr_alice\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"username\"</span><span style=\"color:#E1E4E8\">:</span><span style=\"color:#9ECBFF\">\"@alice\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"returnUrl\"</span><span style=\"color:#E1E4E8\">:</span><span style=\"color:#9ECBFF\">\"http://localhost:3000/dashboard\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Rejected event (terminal):</strong></p>\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">event: rejected</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">data: {</span><span style=\"color:#79B8FF\">\"type\"</span><span style=\"color:#E1E4E8\">:</span><span style=\"color:#9ECBFF\">\"rejected\"</span><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Expired event (terminal):</strong></p>\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">event: expired</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">data: {</span><span style=\"color:#79B8FF\">\"type\"</span><span style=\"color:#E1E4E8\">:</span><span style=\"color:#9ECBFF\">\"expired\"</span><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Status:</strong> <code>200 OK</code> (keeps connection open)</p>\n<p><strong>Use Case:</strong> Website opens SSE connection to receive real-time status updates as user scans/approves on mobile</p>\n</details>\n\n<hr>\n<details>\n <summary><code className=\"text-cyan-400\">GET</code> <code><b>/auth/session/:id</b></code> <code>(get session details)</code></summary>\n\n<h3 id=\"request-2\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8090/auth/session/sess_abc123</span></span></code></pre>\n</code></pre><h3 id=\"response-1\">Response</h3>\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"sessionId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"sess_abc123\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"challenge\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"auth_chal_b92f3aed...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"status\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"waiting\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"appName\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"My Tana App\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"appIcon\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"https://example.com/icon.png\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"expiresAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">1762915859863</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Status:</strong> <code>200 OK</code></p>\n<p><strong>Side Effect:</strong> If session status is &quot;waiting&quot;, automatically marks as &quot;scanned&quot;</p>\n<p><strong>Use Case:</strong> Mobile app scans QR code and retrieves session details</p>\n</details>\n\n<hr>\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/auth/session/:id/approve</b></code> <code>(approve login with signature)</code></summary>\n\n<h3 id=\"request-3\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -X</span><span style=\"color:#9ECBFF\"> POST</span><span style=\"color:#9ECBFF\"> http://localhost:8090/auth/session/sess_abc123/approve</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -H</span><span style=\"color:#9ECBFF\"> \"Content-Type: application/json\"</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -d</span><span style=\"color:#9ECBFF\"> '{</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"userId\": \"usr_alice\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"username\": \"@alice\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"publicKey\": \"ed25519_abc123...\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"signature\": \"0x1a2b3c...\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"message\": \"I approve this login session: auth_chal_b92f3aed...\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  }'</span></span></code></pre>\n</code></pre><h3 id=\"parameters-1\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**userId**</td>\n    <td>string (UUID)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**username**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**publicKey**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**signature**</td>\n    <td>string (hex)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**message**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n</table>\n\n<h3 id=\"response-2\">Response</h3>\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"success\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"sessionToken\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"tana_session_abc123...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"returnUrl\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"http://localhost:3000/dashboard\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Status:</strong> <code>200 OK</code></p>\n<p><strong>Validation:</strong></p>\n<ul>\n<li>Ed25519 signature must be valid for the provided message and public key</li>\n<li>Message must contain the session challenge</li>\n<li>Session must be in &quot;waiting&quot; or &quot;scanned&quot; state</li>\n<li>Session must not be expired</li>\n</ul>\n<p><strong>Use Case:</strong> User approves login on mobile app, which signs the challenge with private key</p>\n</details>\n\n<hr>\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/auth/session/:id/reject</b></code> <code>(reject login)</code></summary>\n\n<h3 id=\"request-4\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -X</span><span style=\"color:#9ECBFF\"> POST</span><span style=\"color:#9ECBFF\"> http://localhost:8090/auth/session/sess_abc123/reject</span></span></code></pre>\n</code></pre><h3 id=\"response-3\">Response</h3>\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"success\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">true</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Status:</strong> <code>200 OK</code></p>\n<p><strong>Use Case:</strong> User rejects login attempt on mobile app</p>\n</details>\n\n<hr>\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/auth/session/validate</b></code> <code>(validate session token)</code></summary>\n\n<h3 id=\"request-5\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -X</span><span style=\"color:#9ECBFF\"> POST</span><span style=\"color:#9ECBFF\"> http://localhost:8090/auth/session/validate</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -H</span><span style=\"color:#9ECBFF\"> \"Content-Type: application/json\"</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -d</span><span style=\"color:#9ECBFF\"> '{</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"sessionToken\": \"tana_session_abc123...\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  }'</span></span></code></pre>\n</code></pre><h3 id=\"parameters-2\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**sessionToken**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n</table>\n\n<h3 id=\"response-valid\">Response (Valid)</h3>\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"valid\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"userId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_alice\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"username\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"@alice\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Status:</strong> <code>200 OK</code></p>\n<h3 id=\"response-invalid\">Response (Invalid)</h3>\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Invalid or expired session token\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Status:</strong> <code>401 Unauthorized</code></p>\n<p><strong>Use Case:</strong> Backend services validate session tokens from authenticated requests</p>\n</details>\n\n<hr>\n<h2 id=\"security-model\">Security Model</h2>\n<h3 id=\"private-key-isolation\">Private Key Isolation</h3>\n<p><strong>✅ SECURE (Mobile Device):</strong></p>\n<ul>\n<li>Private keys stored in hardware-backed secure enclave (iOS) / StrongBox (Android)</li>\n<li>Biometric protection (Face ID, Touch ID, fingerprint)</li>\n<li>OS-level sandboxing prevents key extraction</li>\n<li>Signatures generated within secure hardware</li>\n</ul>\n<p><strong>❌ INSECURE (Desktop/Laptop):</strong></p>\n<ul>\n<li>No private keys - only session tokens</li>\n<li>Session tokens are revocable and time-limited (30 days)</li>\n<li>Tokens provide read-only blockchain access</li>\n<li>Desktop computers more vulnerable to malware</li>\n</ul>\n<h3 id=\"why-no-browser-extensions\">Why No Browser Extensions?</h3>\n<p>Tana explicitly rejects the MetaMask/browser extension model:</p>\n<ol>\n<li><strong>Malware Risk</strong> - Desktop computers are primary malware targets</li>\n<li><strong>Browser Vulnerabilities</strong> - Extensions have broad permissions</li>\n<li><strong>Key Extraction</strong> - Software-based key storage can be compromised</li>\n<li><strong>User Behavior</strong> - Users install many extensions from untrusted sources</li>\n</ol>\n<h3 id=\"mobile-first-advantages\">Mobile-First Advantages</h3>\n<ol>\n<li><strong>Hardware Security</strong> - Secure enclave protects keys at hardware level</li>\n<li><strong>Biometric Auth</strong> - Face ID/Touch ID for every transaction</li>\n<li><strong>Smaller Attack Surface</strong> - iOS/Android app sandboxing</li>\n<li><strong>User Awareness</strong> - Mobile approval makes every action explicit</li>\n<li><strong>Loss Prevention</strong> - Devices can be remotely wiped</li>\n</ol>\n<h3 id=\"authentication-flow-security\">Authentication Flow Security</h3>\n<ol>\n<li><strong>Challenge-Response</strong> - Random challenge prevents replay attacks</li>\n<li><strong>Ed25519 Signatures</strong> - Cryptographic proof of ownership</li>\n<li><strong>Time Limits</strong> - Sessions expire after 5 minutes (login) or 30 days (token)</li>\n<li><strong>Status Tracking</strong> - &quot;waiting&quot; → &quot;scanned&quot; → &quot;approved&quot; state machine</li>\n<li><strong>SSE Updates</strong> - Real-time feedback without polling</li>\n</ol>\n<h2 id=\"session-lifecycle\">Session Lifecycle</h2>\n<p><strong>Session States:</strong></p>\n<ul>\n<li><code>waiting</code> - QR code displayed, waiting for mobile scan</li>\n<li><code>scanned</code> - Mobile app has retrieved session details</li>\n<li><code>approved</code> - User approved and signature verified → token generated</li>\n<li><code>rejected</code> - User declined login attempt</li>\n<li><code>expired</code> - Session timed out (5 minutes)</li>\n</ul>\n<p><strong>Session Token Lifecycle:</strong></p>\n<ul>\n<li>Generated after approval with Ed25519 signature verification</li>\n<li>Expires 30 days after approval</li>\n<li>Can be revoked at any time</li>\n<li>Used for subsequent authenticated API requests</li>\n</ul>\n<h2 id=\"error-responses\">Error Responses</h2>\n<p><strong>404 Not Found:</strong></p>\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Session not found\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>400 Bad Request:</strong></p>\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Invalid signature\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Challenge mismatch\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Session expired\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>401 Unauthorized:</strong></p>\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Invalid or expired session token\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>500 Internal Server Error:</strong></p>\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Failed to create session\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h2 id=\"related-documentation\">Related Documentation</h2>\n<ul>\n<li><a href=\"/docs/MOBILE_AUTH_PROTOCOL.md\">Mobile Authentication Protocol</a> - Detailed protocol specification</li>\n<li><a href=\"/guides/transaction-signing/\">Transaction Signing Guide</a> - How Ed25519 signatures work</li>\n<li><a href=\"/contributing/env-vars/\">Environment Variables</a> - Configure <code>IDENTITY_DB_URL</code> and <code>IDENTITY_PORT</code></li>\n<li><a href=\"/contributing/architecture/\">Architecture</a> - Identity service in system design</li>\n</ul>\n"
  },
  {
    "slug": [
      "tana-api",
      "contracts"
    ],
    "metadata": {
      "title": "/contracts",
      "description": "Deploy and manage smart contracts"
    },
    "content": "\nDeploy and manage TypeScript smart contracts on the Tana blockchain. Contracts are executed in a sandboxed V8 runtime.\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/contracts/deploy</b></code> <code>(deploy contract)</code></summary>\n\n### Request\n\n```bash\ncurl -X POST http://localhost:8080/contracts/deploy \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"ownerId\": \"usr_abc123\",\n    \"name\": \"token-transfer\",\n    \"sourceCode\": \"import { console } from \\\"tana:core\\\"; ...\",\n    \"description\": \"Simple token transfer contract\",\n    \"metadata\": {\n      \"version\": \"1.0.0\",\n      \"author\": \"@alice\"\n    }\n  }'\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**ownerId**</td>\n    <td>string (UUID)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**name**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**sourceCode**</td>\n    <td>string (TypeScript)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**description**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**metadata**</td>\n    <td>object</td>\n    <td>optional</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>201</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"id\": \"cnt_xyz789\",\n  \"ownerId\": \"usr_abc123\",\n  \"name\": \"token-transfer\",\n  \"sourceCode\": \"import { console } from \\\"tana:core\\\"; ...\",\n  \"description\": \"Simple token transfer contract\",\n  \"metadata\": {\n    \"version\": \"1.0.0\",\n    \"author\": \"@alice\"\n  },\n  \"status\": \"active\",\n  \"createdAt\": \"2024-11-08T12:00:00.000Z\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Missing required fields: ownerId, name, sourceCode\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/contracts</b></code> <code>(list contracts)</code></summary>\n\n### Request\n\n```bash\n# List all contracts\ncurl \"http://localhost:8080/contracts?limit=50&offset=0\"\n\n# List only active contracts\ncurl \"http://localhost:8080/contracts?active=true&limit=50&offset=0\"\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**limit**</td>\n    <td>number</td>\n    <td>optional (default: 50)</td>\n  </tr>\n <tr>\n    <td>**offset**</td>\n    <td>number</td>\n    <td>optional (default: 0)</td>\n  </tr>\n <tr>\n    <td>**active**</td>\n    <td>boolean</td>\n    <td>optional</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n[\n  {\n    \"id\": \"cnt_xyz789\",\n    \"ownerId\": \"usr_abc123\",\n    \"name\": \"token-transfer\",\n    \"description\": \"Simple token transfer contract\",\n    \"status\": \"active\",\n    \"createdAt\": \"2024-11-08T12:00:00.000Z\",\n    \"updatedAt\": \"2024-11-08T12:00:00.000Z\"\n  },\n  {\n    \"id\": \"cnt_abc123\",\n    \"ownerId\": \"usr_def456\",\n    \"name\": \"voting-system\",\n    \"description\": \"Decentralized voting contract\",\n    \"status\": \"active\",\n    \"createdAt\": \"2024-11-07T10:00:00.000Z\",\n    \"updatedAt\": \"2024-11-07T10:00:00.000Z\"\n  }\n]\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/contracts/:id</b></code> <code>(get contract by ID)</code></summary>\n\n### Request\n\n```bash\ncurl http://localhost:8080/contracts/cnt_xyz789\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**id**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"id\": \"cnt_xyz789\",\n  \"ownerId\": \"usr_abc123\",\n  \"name\": \"token-transfer\",\n  \"sourceCode\": \"import { console } from \\\"tana:core\\\"; ...\",\n  \"description\": \"Simple token transfer contract\",\n  \"metadata\": {\n    \"version\": \"1.0.0\",\n    \"author\": \"@alice\"\n  },\n  \"status\": \"active\",\n  \"createdAt\": \"2024-11-08T12:00:00.000Z\",\n  \"updatedAt\": \"2024-11-08T12:00:00.000Z\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Contract not found\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/contracts/owner/:ownerId</b></code> <code>(get contracts by owner)</code></summary>\n\n### Request\n\n```bash\ncurl \"http://localhost:8080/contracts/owner/usr_abc123?limit=50&offset=0\"\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**ownerId**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n <tr>\n    <td>**limit**</td>\n    <td>number</td>\n    <td>optional (default: 50)</td>\n  </tr>\n <tr>\n    <td>**offset**</td>\n    <td>number</td>\n    <td>optional (default: 0)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n[\n  {\n    \"id\": \"cnt_xyz789\",\n    \"ownerId\": \"usr_abc123\",\n    \"name\": \"token-transfer\",\n    \"description\": \"Simple token transfer contract\",\n    \"status\": \"active\",\n    \"createdAt\": \"2024-11-08T12:00:00.000Z\",\n    \"updatedAt\": \"2024-11-08T12:00:00.000Z\"\n  }\n]\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/contracts/:id/deactivate</b></code> <code>(deactivate contract)</code></summary>\n\n### Request\n\n```bash\ncurl -X POST http://localhost:8080/contracts/cnt_xyz789/deactivate \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"ownerId\": \"usr_abc123\"\n  }'\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**id**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n <tr>\n    <td>**ownerId**</td>\n    <td>string (UUID)</td>\n    <td>required</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"id\": \"cnt_xyz789\",\n  \"ownerId\": \"usr_abc123\",\n  \"name\": \"token-transfer\",\n  \"status\": \"inactive\",\n  \"deactivatedAt\": \"2024-11-08T13:00:00.000Z\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Missing ownerId\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>403</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Only contract owner can deactivate\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [ ] Public\n- [ ] Community\n- [ ] Team\n- [x] Self\n- [ ] Admin\n\n</details>\n\n### Method Not Allowed\n\nThe following methods are not supported:\n\n<code className=\"text-orange-400\">PUT</code> <code className=\"text-red-400\">DELETE</code> <code className=\"text-purple-400\">PATCH</code>\n",
    "html": "<p>Deploy and manage TypeScript smart contracts on the Tana blockchain. Contracts are executed in a sandboxed V8 runtime.</p>\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/contracts/deploy</b></code> <code>(deploy contract)</code></summary>\n\n<h3 id=\"request\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -X</span><span style=\"color:#9ECBFF\"> POST</span><span style=\"color:#9ECBFF\"> http://localhost:8080/contracts/deploy</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -H</span><span style=\"color:#9ECBFF\"> \"Content-Type: application/json\"</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -d</span><span style=\"color:#9ECBFF\"> '{</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"ownerId\": \"usr_abc123\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"name\": \"token-transfer\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"sourceCode\": \"import { console } from \\\"tana:core\\\"; ...\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"description\": \"Simple token transfer contract\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"metadata\": {</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">      \"version\": \"1.0.0\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">      \"author\": \"@alice\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    }</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  }'</span></span></code></pre>\n</code></pre><h3 id=\"parameters\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**ownerId**</td>\n    <td>string (UUID)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**name**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**sourceCode**</td>\n    <td>string (TypeScript)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**description**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**metadata**</td>\n    <td>object</td>\n    <td>optional</td>\n  </tr>\n</table>\n\n<h3 id=\"response\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>201</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"cnt_xyz789\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"ownerId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_abc123\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"name\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"token-transfer\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"sourceCode\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"import { console } from </span><span style=\"color:#79B8FF\">\\\"</span><span style=\"color:#9ECBFF\">tana:core</span><span style=\"color:#79B8FF\">\\\"</span><span style=\"color:#9ECBFF\">; ...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"description\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Simple token transfer contract\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"metadata\"</span><span style=\"color:#E1E4E8\">: {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"version\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"1.0.0\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"author\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"@alice\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"status\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"active\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"createdAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:00.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Missing required fields: ownerId, name, sourceCode\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level\">Access Level</h3>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/contracts</b></code> <code>(list contracts)</code></summary>\n\n<h3 id=\"request-1\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># List all contracts</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> \"http://localhost:8080/contracts?limit=50&#x26;offset=0\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># List only active contracts</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> \"http://localhost:8080/contracts?active=true&#x26;limit=50&#x26;offset=0\"</span></span></code></pre>\n</code></pre><h3 id=\"parameters-1\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**limit**</td>\n    <td>number</td>\n    <td>optional (default: 50)</td>\n  </tr>\n <tr>\n    <td>**offset**</td>\n    <td>number</td>\n    <td>optional (default: 0)</td>\n  </tr>\n <tr>\n    <td>**active**</td>\n    <td>boolean</td>\n    <td>optional</td>\n  </tr>\n</table>\n\n<h3 id=\"response-1\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">[</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"cnt_xyz789\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"ownerId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_abc123\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"name\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"token-transfer\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"description\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Simple token transfer contract\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"status\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"active\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"createdAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:00.000Z\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"updatedAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:00.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"cnt_abc123\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"ownerId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_def456\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"name\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"voting-system\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"description\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Decentralized voting contract\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"status\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"active\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"createdAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-07T10:00:00.000Z\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"updatedAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-07T10:00:00.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">]</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level-1\">Access Level</h3>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/contracts/:id</b></code> <code>(get contract by ID)</code></summary>\n\n<h3 id=\"request-2\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8080/contracts/cnt_xyz789</span></span></code></pre>\n</code></pre><h3 id=\"parameters-2\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**id**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n</table>\n\n<h3 id=\"response-2\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"cnt_xyz789\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"ownerId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_abc123\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"name\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"token-transfer\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"sourceCode\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"import { console } from </span><span style=\"color:#79B8FF\">\\\"</span><span style=\"color:#9ECBFF\">tana:core</span><span style=\"color:#79B8FF\">\\\"</span><span style=\"color:#9ECBFF\">; ...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"description\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Simple token transfer contract\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"metadata\"</span><span style=\"color:#E1E4E8\">: {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"version\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"1.0.0\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"author\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"@alice\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"status\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"active\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"createdAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:00.000Z\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"updatedAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:00.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Contract not found\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level-2\">Access Level</h3>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/contracts/owner/:ownerId</b></code> <code>(get contracts by owner)</code></summary>\n\n<h3 id=\"request-3\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> \"http://localhost:8080/contracts/owner/usr_abc123?limit=50&#x26;offset=0\"</span></span></code></pre>\n</code></pre><h3 id=\"parameters-3\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**ownerId**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n <tr>\n    <td>**limit**</td>\n    <td>number</td>\n    <td>optional (default: 50)</td>\n  </tr>\n <tr>\n    <td>**offset**</td>\n    <td>number</td>\n    <td>optional (default: 0)</td>\n  </tr>\n</table>\n\n<h3 id=\"response-3\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">[</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"cnt_xyz789\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"ownerId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_abc123\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"name\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"token-transfer\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"description\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Simple token transfer contract\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"status\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"active\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"createdAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:00.000Z\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"updatedAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:00.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">]</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level-3\">Access Level</h3>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/contracts/:id/deactivate</b></code> <code>(deactivate contract)</code></summary>\n\n<h3 id=\"request-4\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -X</span><span style=\"color:#9ECBFF\"> POST</span><span style=\"color:#9ECBFF\"> http://localhost:8080/contracts/cnt_xyz789/deactivate</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -H</span><span style=\"color:#9ECBFF\"> \"Content-Type: application/json\"</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -d</span><span style=\"color:#9ECBFF\"> '{</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"ownerId\": \"usr_abc123\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  }'</span></span></code></pre>\n</code></pre><h3 id=\"parameters-4\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**id**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n <tr>\n    <td>**ownerId**</td>\n    <td>string (UUID)</td>\n    <td>required</td>\n  </tr>\n</table>\n\n<h3 id=\"response-4\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"cnt_xyz789\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"ownerId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_abc123\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"name\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"token-transfer\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"status\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"inactive\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"deactivatedAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T13:00:00.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Missing ownerId\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n  <tr>\n    <td>403</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Only contract owner can deactivate\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level-4\">Access Level</h3>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<h3 id=\"method-not-allowed\">Method Not Allowed</h3>\n<p>The following methods are not supported:</p>\n<p><code className=\"text-orange-400\">PUT</code> <code className=\"text-red-400\">DELETE</code> <code className=\"text-purple-400\">PATCH</code></p>\n"
  },
  {
    "slug": [
      "tana-api",
      "intro"
    ],
    "metadata": {
      "title": "API Overview",
      "description": "REST API reference for Tana Services",
      "sidebar": {
        "order": 1
      }
    },
    "content": "\nTana provides two main REST APIs for interacting with the blockchain and managing authentication. All endpoints return JSON responses.\n\n## Base URLs\n\n### Ledger Service (Blockchain API)\n\n```\nhttp://localhost:8080\n```\n\nHandles all blockchain operations: users, balances, transactions, blocks, and smart contracts.\n\n### Identity Service (Authentication API)\n\n```\nhttp://localhost:8090\n```\n\nHandles mobile-first QR code authentication and session management. Private keys remain exclusively on mobile devices for security.\n\nFor production deployments, replace with your server's URLs (e.g., `https://api.tana.network` and `https://auth.tana.network`).\n\n## Authentication & Signatures\n\n:::caution[Security Notice]\n**Transaction signing is NOT yet implemented.** The API currently accepts requests without signature verification. Do not use with real assets.\n:::\n\n### Transaction Signatures (Required in Production)\n\nAll state-changing operations (POST, PATCH, DELETE) **require cryptographic signatures** to prove ownership. While not currently enforced, the API is designed to verify Ed25519 signatures on all transactions.\n\n**Required Fields:**\n\n```json\n{\n  \"ownerId\": \"usr_abc123\",\n  \"...\": \"transaction data\",\n  \"signature\": \"0x1a2b3c4d5e6f...\",  // Ed25519 signature (required)\n  \"timestamp\": 1699459200,            // Unix timestamp (required)\n  \"nonce\": 42                         // Replay protection (required)\n}\n```\n\n**How Signing Works:**\n\n```typescript\n// 1. Create transaction payload\nconst payload = {\n  ownerId: \"usr_abc123\",\n  amount: \"100\",\n  currencyCode: \"USD\",\n  timestamp: Date.now(),\n  nonce: 42\n}\n\n// 2. Hash the payload\nconst hash = sha256(JSON.stringify(payload))\n\n// 3. Sign with private key\nconst signature = ed25519.sign(hash, privateKey)\n\n// 4. Send to API\nPOST /transactions {\n  ...payload,\n  signature: \"0x...\"\n}\n```\n\n**Server Verification:**\n\nThe API will verify:\n1. Signature is valid for the given payload\n2. Signature matches the public key on file for `ownerId`\n3. Timestamp is within acceptable range (prevents old transactions)\n4. Nonce hasn't been used before (prevents replay attacks)\n\n**Implementation Status:**\n- ❌ CLI signing - Not implemented\n- ❌ API verification - Not implemented\n- ❌ Ed25519 keypairs - Using placeholders\n- ⚠️ **All endpoints currently accept unsigned requests**\n\nSee the [README Security Status](https://github.com/conoda/tana#security-status) for implementation roadmap.\n\n## Response Format\n\nAll API responses follow this format:\n\n### Success Response\n\n```json\n{\n  \"data\": { ... },\n  \"status\": \"success\"\n}\n```\n\n### Error Response\n\n```json\n{\n  \"error\": \"Error message describing what went wrong\",\n  \"timestamp\": \"2024-11-07T00:00:00.000Z\"\n}\n```\n\n## HTTP Status Codes\n\n| Code | Meaning |\n|------|---------|\n| `200` | Success - Request completed successfully |\n| `201` | Created - Resource created successfully |\n| `400` | Bad Request - Invalid request parameters |\n| `404` | Not Found - Resource doesn't exist |\n| `500` | Internal Server Error - Something went wrong on the server |\n\n## Quick Start\n\n### Health Check\n\n```bash\ncurl http://localhost:8080/health\n```\n\n```json\n{\n  \"status\": \"ok\"\n}\n```\n\n### Get Service Info\n\n```bash\ncurl http://localhost:8080/\n```\n\n```json\n{\n  \"service\": \"tana-ledger\",\n  \"version\": \"0.1.0\",\n  \"status\": \"healthy\",\n  \"timestamp\": \"2024-11-07T00:00:00.000Z\"\n}\n```\n\n## API Categories\n\n### Identity & Authentication (Port 8090)\nMobile-first QR code authentication with hardware-backed security.\n\n- **POST /auth/session/create** - Create QR code login session\n- **GET /auth/session/:id/events** - SSE stream for real-time updates\n- **GET /auth/session/:id** - Get session details (mobile scans QR)\n- **POST /auth/session/:id/approve** - Approve login with Ed25519 signature\n- **POST /auth/session/:id/reject** - Reject login attempt\n- **POST /auth/session/validate** - Validate session token\n\n**Security Model:** Private keys ONLY on mobile devices. Desktop/laptop receives session tokens only.\n\n[View Identity API →](/tana-api/identity/)\n\n---\n\n### Users (Port 8080)\nManage user accounts on the blockchain.\n\n- **POST /users** - Create a new user\n- **GET /users** - List all users\n- **GET /users/:id** - Get user by ID\n- **GET /users/by-username/:username** - Get user by username\n\n[View Users API →](/tana-api/users/)\n\n### Balances (Port 8080)\nQuery and manage multi-currency balances.\n\n- **GET /balances** - Query balances\n- **POST /balances** - Set balance\n- **GET /balances/currencies** - List supported currencies\n- **POST /balances/currencies/seed** - Seed default currencies\n\n[View Balances API →](/tana-api/balances/)\n\n### Transactions (Port 8080)\nCreate and query blockchain transactions.\n\n- **POST /transactions** - Create transaction\n- **GET /transactions** - List transactions\n- **GET /transactions/:id** - Get transaction by ID\n\n[View Transactions API →](/tana-api/transactions/)\n\n### Blocks (Port 8080)\nQuery blockchain blocks and history.\n\n- **GET /blocks** - List blocks\n- **GET /blocks/latest** - Get latest block\n- **GET /blocks/:height** - Get block by height\n\n[View Blocks API →](/tana-api/blocks/)\n\n### Contracts (Port 8080)\nDeploy and manage smart contracts.\n\n- **POST /contracts** - Deploy contract\n- **GET /contracts** - List contracts\n- **GET /contracts/:id** - Get contract by ID\n\n[View Contracts API →](/tana-api/contracts/)\n\n## Rate Limiting\n\nCurrently, there are no rate limits on the development API. Production deployments should implement rate limiting at the reverse proxy level (e.g., Nginx).\n\n## CORS\n\nThe API supports CORS for all origins in development mode:\n\n```\nAccess-Control-Allow-Origin: *\nAccess-Control-Allow-Credentials: true\n```\n\n## Pagination\n\nList endpoints support pagination via query parameters:\n\n```bash\nGET /users?page=1&limit=20\n```\n\nDefault limit is 100 items per page.\n\n## Examples\n\n### Create User and Check Balance\n\n```bash\n# 1. Create user\ncurl -X POST http://localhost:8080/users \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"publicKey\": \"ed25519_abc123...\",\n    \"username\": \"@alice\",\n    \"displayName\": \"Alice Johnson\"\n  }'\n\n# Response:\n# {\n#   \"userId\": \"user_xyz789\",\n#   \"transactionId\": \"tx_abc123\",\n#   \"status\": \"pending\"\n# }\n\n# 2. Get balance (after block inclusion)\ncurl \"http://localhost:8080/balances?ownerId=user_xyz789&currencyCode=USD\"\n\n# Response:\n# {\n#   \"ownerId\": \"user_xyz789\",\n#   \"ownerType\": \"user\",\n#   \"currencyCode\": \"USD\",\n#   \"amount\": \"1000.00\",\n#   \"updatedAt\": \"2024-11-07T00:00:00.000Z\"\n# }\n```\n\n## Next Steps\n\n- [Identity API](/tana-api/identity/) - Mobile QR code authentication\n- [Users API](/tana-api/users/) - User account management\n- [Balances API](/tana-api/balances/) - Balance queries and updates\n- [Transactions API](/tana-api/transactions/) - Transaction creation and queries\n- [Blocks API](/tana-api/blocks/) - Blockchain queries\n- [Contracts API](/tana-api/contracts/) - Smart contract deployment\n- [CLI Reference](/tana-cli/intro/) - Command-line interface\n",
    "html": "<p>Tana provides two main REST APIs for interacting with the blockchain and managing authentication. All endpoints return JSON responses.</p>\n<h2 id=\"base-urls\">Base URLs</h2>\n<h3 id=\"ledger-service-blockchain-api\">Ledger Service (Blockchain API)</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>http://localhost:8080</span></span></code></pre>\n</code></pre><p>Handles all blockchain operations: users, balances, transactions, blocks, and smart contracts.</p>\n<h3 id=\"identity-service-authentication-api\">Identity Service (Authentication API)</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>http://localhost:8090</span></span></code></pre>\n</code></pre><p>Handles mobile-first QR code authentication and session management. Private keys remain exclusively on mobile devices for security.</p>\n<p>For production deployments, replace with your server&#39;s URLs (e.g., <code>https://api.tana.network</code> and <code>https://auth.tana.network</code>).</p>\n<h2 id=\"authentication--signatures\">Authentication &amp; Signatures</h2>\n<p>:::caution[Security Notice]\n<strong>Transaction signing is NOT yet implemented.</strong> The API currently accepts requests without signature verification. Do not use with real assets.\n:::</p>\n<h3 id=\"transaction-signatures-required-in-production\">Transaction Signatures (Required in Production)</h3>\n<p>All state-changing operations (POST, PATCH, DELETE) <strong>require cryptographic signatures</strong> to prove ownership. While not currently enforced, the API is designed to verify Ed25519 signatures on all transactions.</p>\n<p><strong>Required Fields:</strong></p>\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"ownerId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_abc123\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"...\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"transaction data\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"signature\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"0x1a2b3c4d5e6f...\"</span><span style=\"color:#E1E4E8\">,  </span><span style=\"color:#6A737D\">// Ed25519 signature (required)</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"timestamp\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">1699459200</span><span style=\"color:#E1E4E8\">,            </span><span style=\"color:#6A737D\">// Unix timestamp (required)</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"nonce\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">42</span><span style=\"color:#6A737D\">                         // Replay protection (required)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>How Signing Works:</strong></p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// 1. Create transaction payload</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> payload</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  ownerId: </span><span style=\"color:#9ECBFF\">\"usr_abc123\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  amount: </span><span style=\"color:#9ECBFF\">\"100\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  currencyCode: </span><span style=\"color:#9ECBFF\">\"USD\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  timestamp: Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">(),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  nonce: </span><span style=\"color:#79B8FF\">42</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// 2. Hash the payload</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> hash</span><span style=\"color:#F97583\"> =</span><span style=\"color:#B392F0\"> sha256</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">JSON</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">stringify</span><span style=\"color:#E1E4E8\">(payload))</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// 3. Sign with private key</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> signature</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> ed25519.</span><span style=\"color:#B392F0\">sign</span><span style=\"color:#E1E4E8\">(hash, privateKey)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// 4. Send to API</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">POST</span><span style=\"color:#F97583\"> /</span><span style=\"color:#E1E4E8\">transactions {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  ...</span><span style=\"color:#E1E4E8\">payload,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  signature</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"0x...\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Server Verification:</strong></p>\n<p>The API will verify:</p>\n<ol>\n<li>Signature is valid for the given payload</li>\n<li>Signature matches the public key on file for <code>ownerId</code></li>\n<li>Timestamp is within acceptable range (prevents old transactions)</li>\n<li>Nonce hasn&#39;t been used before (prevents replay attacks)</li>\n</ol>\n<p><strong>Implementation Status:</strong></p>\n<ul>\n<li>❌ CLI signing - Not implemented</li>\n<li>❌ API verification - Not implemented</li>\n<li>❌ Ed25519 keypairs - Using placeholders</li>\n<li>⚠️ <strong>All endpoints currently accept unsigned requests</strong></li>\n</ul>\n<p>See the <a href=\"https://github.com/conoda/tana#security-status\">README Security Status</a> for implementation roadmap.</p>\n<h2 id=\"response-format\">Response Format</h2>\n<p>All API responses follow this format:</p>\n<h3 id=\"success-response\">Success Response</h3>\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"data\"</span><span style=\"color:#E1E4E8\">: { </span><span style=\"color:#FDAEB7;font-style:italic\">...</span><span style=\"color:#E1E4E8\"> },</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"status\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"success\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h3 id=\"error-response\">Error Response</h3>\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Error message describing what went wrong\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"timestamp\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-07T00:00:00.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h2 id=\"http-status-codes\">HTTP Status Codes</h2>\n<table>\n<thead>\n<tr>\n<th>Code</th>\n<th>Meaning</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>200</code></td>\n<td>Success - Request completed successfully</td>\n</tr>\n<tr>\n<td><code>201</code></td>\n<td>Created - Resource created successfully</td>\n</tr>\n<tr>\n<td><code>400</code></td>\n<td>Bad Request - Invalid request parameters</td>\n</tr>\n<tr>\n<td><code>404</code></td>\n<td>Not Found - Resource doesn&#39;t exist</td>\n</tr>\n<tr>\n<td><code>500</code></td>\n<td>Internal Server Error - Something went wrong on the server</td>\n</tr>\n</tbody></table>\n<h2 id=\"quick-start\">Quick Start</h2>\n<h3 id=\"health-check\">Health Check</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8080/health</span></span></code></pre>\n</code></pre><pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"status\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"ok\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h3 id=\"get-service-info\">Get Service Info</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8080/</span></span></code></pre>\n</code></pre><pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"service\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"tana-ledger\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"version\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"0.1.0\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"status\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"healthy\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"timestamp\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-07T00:00:00.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h2 id=\"api-categories\">API Categories</h2>\n<h3 id=\"identity--authentication-port-8090\">Identity &amp; Authentication (Port 8090)</h3>\n<p>Mobile-first QR code authentication with hardware-backed security.</p>\n<ul>\n<li><strong>POST /auth/session/create</strong> - Create QR code login session</li>\n<li><strong>GET /auth/session/:id/events</strong> - SSE stream for real-time updates</li>\n<li><strong>GET /auth/session/:id</strong> - Get session details (mobile scans QR)</li>\n<li><strong>POST /auth/session/:id/approve</strong> - Approve login with Ed25519 signature</li>\n<li><strong>POST /auth/session/:id/reject</strong> - Reject login attempt</li>\n<li><strong>POST /auth/session/validate</strong> - Validate session token</li>\n</ul>\n<p><strong>Security Model:</strong> Private keys ONLY on mobile devices. Desktop/laptop receives session tokens only.</p>\n<p><a href=\"/tana-api/identity/\">View Identity API →</a></p>\n<hr>\n<h3 id=\"users-port-8080\">Users (Port 8080)</h3>\n<p>Manage user accounts on the blockchain.</p>\n<ul>\n<li><strong>POST /users</strong> - Create a new user</li>\n<li><strong>GET /users</strong> - List all users</li>\n<li><strong>GET /users/:id</strong> - Get user by ID</li>\n<li><strong>GET /users/by-username/:username</strong> - Get user by username</li>\n</ul>\n<p><a href=\"/tana-api/users/\">View Users API →</a></p>\n<h3 id=\"balances-port-8080\">Balances (Port 8080)</h3>\n<p>Query and manage multi-currency balances.</p>\n<ul>\n<li><strong>GET /balances</strong> - Query balances</li>\n<li><strong>POST /balances</strong> - Set balance</li>\n<li><strong>GET /balances/currencies</strong> - List supported currencies</li>\n<li><strong>POST /balances/currencies/seed</strong> - Seed default currencies</li>\n</ul>\n<p><a href=\"/tana-api/balances/\">View Balances API →</a></p>\n<h3 id=\"transactions-port-8080\">Transactions (Port 8080)</h3>\n<p>Create and query blockchain transactions.</p>\n<ul>\n<li><strong>POST /transactions</strong> - Create transaction</li>\n<li><strong>GET /transactions</strong> - List transactions</li>\n<li><strong>GET /transactions/:id</strong> - Get transaction by ID</li>\n</ul>\n<p><a href=\"/tana-api/transactions/\">View Transactions API →</a></p>\n<h3 id=\"blocks-port-8080\">Blocks (Port 8080)</h3>\n<p>Query blockchain blocks and history.</p>\n<ul>\n<li><strong>GET /blocks</strong> - List blocks</li>\n<li><strong>GET /blocks/latest</strong> - Get latest block</li>\n<li><strong>GET /blocks/:height</strong> - Get block by height</li>\n</ul>\n<p><a href=\"/tana-api/blocks/\">View Blocks API →</a></p>\n<h3 id=\"contracts-port-8080\">Contracts (Port 8080)</h3>\n<p>Deploy and manage smart contracts.</p>\n<ul>\n<li><strong>POST /contracts</strong> - Deploy contract</li>\n<li><strong>GET /contracts</strong> - List contracts</li>\n<li><strong>GET /contracts/:id</strong> - Get contract by ID</li>\n</ul>\n<p><a href=\"/tana-api/contracts/\">View Contracts API →</a></p>\n<h2 id=\"rate-limiting\">Rate Limiting</h2>\n<p>Currently, there are no rate limits on the development API. Production deployments should implement rate limiting at the reverse proxy level (e.g., Nginx).</p>\n<h2 id=\"cors\">CORS</h2>\n<p>The API supports CORS for all origins in development mode:</p>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Access-Control-Allow-Origin: *</span></span>\n<span class=\"line\"><span>Access-Control-Allow-Credentials: true</span></span></code></pre>\n</code></pre><h2 id=\"pagination\">Pagination</h2>\n<p>List endpoints support pagination via query parameters:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">GET</span><span style=\"color:#9ECBFF\"> /users?page=</span><span style=\"color:#79B8FF\">1</span><span style=\"color:#E1E4E8\">&#x26;limit</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">20</span></span></code></pre>\n</code></pre><p>Default limit is 100 items per page.</p>\n<h2 id=\"examples\">Examples</h2>\n<h3 id=\"create-user-and-check-balance\">Create User and Check Balance</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># 1. Create user</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -X</span><span style=\"color:#9ECBFF\"> POST</span><span style=\"color:#9ECBFF\"> http://localhost:8080/users</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -H</span><span style=\"color:#9ECBFF\"> \"Content-Type: application/json\"</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -d</span><span style=\"color:#9ECBFF\"> '{</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"publicKey\": \"ed25519_abc123...\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"username\": \"@alice\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"displayName\": \"Alice Johnson\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  }'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Response:</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">#   \"userId\": \"user_xyz789\",</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">#   \"transactionId\": \"tx_abc123\",</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">#   \"status\": \"pending\"</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># 2. Get balance (after block inclusion)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> \"http://localhost:8080/balances?ownerId=user_xyz789&#x26;currencyCode=USD\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Response:</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">#   \"ownerId\": \"user_xyz789\",</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">#   \"ownerType\": \"user\",</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">#   \"currencyCode\": \"USD\",</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">#   \"amount\": \"1000.00\",</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">#   \"updatedAt\": \"2024-11-07T00:00:00.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># }</span></span></code></pre>\n</code></pre><h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li><a href=\"/tana-api/identity/\">Identity API</a> - Mobile QR code authentication</li>\n<li><a href=\"/tana-api/users/\">Users API</a> - User account management</li>\n<li><a href=\"/tana-api/balances/\">Balances API</a> - Balance queries and updates</li>\n<li><a href=\"/tana-api/transactions/\">Transactions API</a> - Transaction creation and queries</li>\n<li><a href=\"/tana-api/blocks/\">Blocks API</a> - Blockchain queries</li>\n<li><a href=\"/tana-api/contracts/\">Contracts API</a> - Smart contract deployment</li>\n<li><a href=\"/tana-cli/intro/\">CLI Reference</a> - Command-line interface</li>\n</ul>\n"
  },
  {
    "slug": [
      "tana-api",
      "rate-limit"
    ],
    "metadata": {
      "title": "rate limits",
      "description": "A reference page in my new Starlight docs site.",
      "sidebar": {
        "order": 2
      }
    },
    "content": "\nReference pages are ideal for outlining how things work in terse and clear terms.\nLess concerned with telling a story or addressing a specific use case, they should give a comprehensive outline of what you're documenting.\n",
    "html": "<p>Reference pages are ideal for outlining how things work in terse and clear terms.\nLess concerned with telling a story or addressing a specific use case, they should give a comprehensive outline of what you&#39;re documenting.</p>\n"
  },
  {
    "slug": [
      "tana-api",
      "transactions"
    ],
    "metadata": {
      "title": "/transactions",
      "description": "Manage blockchain transactions"
    },
    "content": "\nCreate and query transactions on the blockchain. Transactions remain in a pending state until included in a block.\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/transactions</b></code> <code>(get all transactions)</code></summary>\n\n### Request\n\n```bash\ncurl \"http://localhost:8080/transactions?limit=50&offset=0\"\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**limit**</td>\n    <td>number</td>\n    <td>optional (default: 100)</td>\n  </tr>\n <tr>\n    <td>**offset**</td>\n    <td>number</td>\n    <td>optional (default: 0)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n[\n  {\n    \"id\": \"tx_1a2b3c4d5e6f\",\n    \"from\": \"usr_abc123\",\n    \"to\": \"usr_def456\",\n    \"amount\": \"100.00\",\n    \"currencyCode\": \"USD\",\n    \"type\": \"transfer\",\n    \"status\": \"confirmed\",\n    \"blockId\": \"blk_xyz789\",\n    \"signature\": \"sig_...\",\n    \"createdAt\": \"2024-11-08T12:00:00.000Z\",\n    \"confirmedAt\": \"2024-11-08T12:00:06.000Z\"\n  }\n]\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/transactions</b></code> <code>(create transaction)</code></summary>\n\n### Request\n\n```bash\ncurl -X POST http://localhost:8080/transactions \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"from\": \"usr_abc123\",\n    \"to\": \"usr_def456\",\n    \"amount\": \"100.00\",\n    \"currencyCode\": \"USD\",\n    \"type\": \"transfer\",\n    \"signature\": \"sig_...\"\n  }'\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**from**</td>\n    <td>string (UUID)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**to**</td>\n    <td>string (UUID)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**amount**</td>\n    <td>string (decimal)</td>\n    <td>optional*</td>\n  </tr>\n <tr>\n    <td>**currencyCode**</td>\n    <td>string</td>\n    <td>optional*</td>\n  </tr>\n <tr>\n    <td>**type**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**signature**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**contractId**</td>\n    <td>string (UUID)</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**contractInput**</td>\n    <td>object</td>\n    <td>optional</td>\n  </tr>\n</table>\n\n**Transaction types:** `transfer`, `deposit`, `withdraw`, `contract_call`, `user_creation`, `contract_deployment`\n\n*Required for transfer/deposit/withdraw types\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>201</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"id\": \"tx_1a2b3c4d5e6f\",\n  \"from\": \"usr_abc123\",\n  \"to\": \"usr_def456\",\n  \"amount\": \"100.00\",\n  \"currencyCode\": \"USD\",\n  \"type\": \"transfer\",\n  \"status\": \"pending\",\n  \"signature\": \"sig_...\",\n  \"createdAt\": \"2024-11-08T12:00:00.000Z\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Insufficient balance\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/transactions/:id</b></code> <code>(get transaction)</code></summary>\n\n### Request\n\n```bash\ncurl http://localhost:8080/transactions/tx_1a2b3c4d5e6f\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**id**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"id\": \"tx_1a2b3c4d5e6f\",\n  \"from\": \"usr_abc123\",\n  \"to\": \"usr_def456\",\n  \"amount\": \"100.00\",\n  \"currencyCode\": \"USD\",\n  \"type\": \"transfer\",\n  \"status\": \"confirmed\",\n  \"blockId\": \"blk_xyz789\",\n  \"signature\": \"sig_...\",\n  \"createdAt\": \"2024-11-08T12:00:00.000Z\",\n  \"confirmedAt\": \"2024-11-08T12:00:06.000Z\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Transaction not found\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/transactions/:id/confirm</b></code> <code>(confirm transaction)</code></summary>\n\n### Request\n\n```bash\ncurl -X POST http://localhost:8080/transactions/tx_1a2b3c4d5e6f/confirm \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"id\": \"tx_1a2b3c4d5e6f\",\n    \"blockId\": \"blk_xyz789\"\n  }'\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**id**</td>\n    <td>string (UUID)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**blockId**</td>\n    <td>string (UUID)</td>\n    <td>optional</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"id\": \"tx_1a2b3c4d5e6f\",\n  \"from\": \"usr_abc123\",\n  \"to\": \"usr_def456\",\n  \"amount\": \"100.00\",\n  \"currencyCode\": \"USD\",\n  \"type\": \"transfer\",\n  \"status\": \"confirmed\",\n  \"blockId\": \"blk_xyz789\",\n  \"signature\": \"sig_...\",\n  \"createdAt\": \"2024-11-08T12:00:00.000Z\",\n  \"confirmedAt\": \"2024-11-08T12:00:06.000Z\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Transaction already confirmed\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [ ] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [x] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/transactions/pending</b></code> <code>(get pending transactions)</code></summary>\n\n### Request\n\n```bash\ncurl \"http://localhost:8080/transactions/pending?limit=100\"\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**limit**</td>\n    <td>number</td>\n    <td>optional (default: 100)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n[\n  {\n    \"id\": \"tx_1a2b3c4d5e6f\",\n    \"from\": \"usr_abc123\",\n    \"to\": \"usr_def456\",\n    \"amount\": \"100.00\",\n    \"currencyCode\": \"USD\",\n    \"type\": \"transfer\",\n    \"status\": \"pending\",\n    \"signature\": \"sig_...\",\n    \"createdAt\": \"2024-11-08T12:00:00.000Z\"\n  }\n]\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/transactions/account/:accountId</b></code> <code>(get account transactions)</code></summary>\n\n### Request\n\n```bash\ncurl \"http://localhost:8080/transactions/account/usr_abc123?limit=50&offset=0\"\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**accountId**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n <tr>\n    <td>**limit**</td>\n    <td>number</td>\n    <td>optional (default: 50)</td>\n  </tr>\n <tr>\n    <td>**offset**</td>\n    <td>number</td>\n    <td>optional (default: 0)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n[\n  {\n    \"id\": \"tx_1a2b3c4d5e6f\",\n    \"from\": \"usr_abc123\",\n    \"to\": \"usr_def456\",\n    \"amount\": \"100.00\",\n    \"currencyCode\": \"USD\",\n    \"type\": \"transfer\",\n    \"status\": \"confirmed\",\n    \"blockId\": \"blk_xyz789\",\n    \"signature\": \"sig_...\",\n    \"createdAt\": \"2024-11-08T12:00:00.000Z\",\n    \"confirmedAt\": \"2024-11-08T12:00:06.000Z\"\n  }\n]\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n### Method Not Allowed\n\nThe following methods are not supported:\n\n<code className=\"text-orange-400\">PUT</code> <code className=\"text-red-400\">DELETE</code> <code className=\"text-purple-400\">PATCH</code>\n",
    "html": "<p>Create and query transactions on the blockchain. Transactions remain in a pending state until included in a block.</p>\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/transactions</b></code> <code>(get all transactions)</code></summary>\n\n<h3 id=\"request\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> \"http://localhost:8080/transactions?limit=50&#x26;offset=0\"</span></span></code></pre>\n</code></pre><h3 id=\"parameters\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**limit**</td>\n    <td>number</td>\n    <td>optional (default: 100)</td>\n  </tr>\n <tr>\n    <td>**offset**</td>\n    <td>number</td>\n    <td>optional (default: 0)</td>\n  </tr>\n</table>\n\n<h3 id=\"response\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">[</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"tx_1a2b3c4d5e6f\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"from\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_abc123\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"to\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_def456\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"amount\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"100.00\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"currencyCode\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"USD\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"type\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"transfer\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"status\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"confirmed\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"blockId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"blk_xyz789\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"signature\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"sig_...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"createdAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:00.000Z\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"confirmedAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:06.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">]</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level\">Access Level</h3>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/transactions</b></code> <code>(create transaction)</code></summary>\n\n<h3 id=\"request-1\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -X</span><span style=\"color:#9ECBFF\"> POST</span><span style=\"color:#9ECBFF\"> http://localhost:8080/transactions</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -H</span><span style=\"color:#9ECBFF\"> \"Content-Type: application/json\"</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -d</span><span style=\"color:#9ECBFF\"> '{</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"from\": \"usr_abc123\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"to\": \"usr_def456\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"amount\": \"100.00\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"currencyCode\": \"USD\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"type\": \"transfer\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"signature\": \"sig_...\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  }'</span></span></code></pre>\n</code></pre><h3 id=\"parameters-1\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**from**</td>\n    <td>string (UUID)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**to**</td>\n    <td>string (UUID)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**amount**</td>\n    <td>string (decimal)</td>\n    <td>optional*</td>\n  </tr>\n <tr>\n    <td>**currencyCode**</td>\n    <td>string</td>\n    <td>optional*</td>\n  </tr>\n <tr>\n    <td>**type**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**signature**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**contractId**</td>\n    <td>string (UUID)</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**contractInput**</td>\n    <td>object</td>\n    <td>optional</td>\n  </tr>\n</table>\n\n<p><strong>Transaction types:</strong> <code>transfer</code>, <code>deposit</code>, <code>withdraw</code>, <code>contract_call</code>, <code>user_creation</code>, <code>contract_deployment</code></p>\n<p>*Required for transfer/deposit/withdraw types</p>\n<h3 id=\"response-1\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>201</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"tx_1a2b3c4d5e6f\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"from\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_abc123\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"to\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_def456\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"amount\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"100.00\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"currencyCode\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"USD\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"type\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"transfer\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"status\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"pending\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"signature\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"sig_...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"createdAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:00.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Insufficient balance\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level-1\">Access Level</h3>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/transactions/:id</b></code> <code>(get transaction)</code></summary>\n\n<h3 id=\"request-2\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8080/transactions/tx_1a2b3c4d5e6f</span></span></code></pre>\n</code></pre><h3 id=\"parameters-2\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**id**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n</table>\n\n<h3 id=\"response-2\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"tx_1a2b3c4d5e6f\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"from\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_abc123\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"to\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_def456\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"amount\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"100.00\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"currencyCode\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"USD\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"type\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"transfer\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"status\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"confirmed\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"blockId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"blk_xyz789\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"signature\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"sig_...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"createdAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:00.000Z\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"confirmedAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:06.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Transaction not found\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level-2\">Access Level</h3>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/transactions/:id/confirm</b></code> <code>(confirm transaction)</code></summary>\n\n<h3 id=\"request-3\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -X</span><span style=\"color:#9ECBFF\"> POST</span><span style=\"color:#9ECBFF\"> http://localhost:8080/transactions/tx_1a2b3c4d5e6f/confirm</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -H</span><span style=\"color:#9ECBFF\"> \"Content-Type: application/json\"</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -d</span><span style=\"color:#9ECBFF\"> '{</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"id\": \"tx_1a2b3c4d5e6f\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"blockId\": \"blk_xyz789\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  }'</span></span></code></pre>\n</code></pre><h3 id=\"parameters-3\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**id**</td>\n    <td>string (UUID)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**blockId**</td>\n    <td>string (UUID)</td>\n    <td>optional</td>\n  </tr>\n</table>\n\n<h3 id=\"response-3\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"tx_1a2b3c4d5e6f\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"from\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_abc123\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"to\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_def456\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"amount\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"100.00\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"currencyCode\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"USD\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"type\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"transfer\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"status\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"confirmed\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"blockId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"blk_xyz789\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"signature\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"sig_...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"createdAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:00.000Z\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"confirmedAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:06.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Transaction already confirmed\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level-3\">Access Level</h3>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/transactions/pending</b></code> <code>(get pending transactions)</code></summary>\n\n<h3 id=\"request-4\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> \"http://localhost:8080/transactions/pending?limit=100\"</span></span></code></pre>\n</code></pre><h3 id=\"parameters-4\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**limit**</td>\n    <td>number</td>\n    <td>optional (default: 100)</td>\n  </tr>\n</table>\n\n<h3 id=\"response-4\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">[</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"tx_1a2b3c4d5e6f\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"from\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_abc123\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"to\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_def456\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"amount\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"100.00\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"currencyCode\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"USD\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"type\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"transfer\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"status\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"pending\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"signature\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"sig_...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"createdAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:00.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">]</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level-4\">Access Level</h3>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/transactions/account/:accountId</b></code> <code>(get account transactions)</code></summary>\n\n<h3 id=\"request-5\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> \"http://localhost:8080/transactions/account/usr_abc123?limit=50&#x26;offset=0\"</span></span></code></pre>\n</code></pre><h3 id=\"parameters-5\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**accountId**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n <tr>\n    <td>**limit**</td>\n    <td>number</td>\n    <td>optional (default: 50)</td>\n  </tr>\n <tr>\n    <td>**offset**</td>\n    <td>number</td>\n    <td>optional (default: 0)</td>\n  </tr>\n</table>\n\n<h3 id=\"response-5\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">[</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"tx_1a2b3c4d5e6f\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"from\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_abc123\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"to\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_def456\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"amount\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"100.00\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"currencyCode\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"USD\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"type\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"transfer\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"status\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"confirmed\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"blockId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"blk_xyz789\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"signature\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"sig_...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"createdAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:00.000Z\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"confirmedAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:06.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">]</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level-5\">Access Level</h3>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<h3 id=\"method-not-allowed\">Method Not Allowed</h3>\n<p>The following methods are not supported:</p>\n<p><code className=\"text-orange-400\">PUT</code> <code className=\"text-red-400\">DELETE</code> <code className=\"text-purple-400\">PATCH</code></p>\n"
  },
  {
    "slug": [
      "tana-api",
      "users",
      "create"
    ],
    "metadata": {
      "title": "/users",
      "description": "Create a new user on the blockchain"
    },
    "content": "\nCreate a new user account by submitting a user creation transaction. The transaction will be pending until included in a block.\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/users</b></code> <code>(create user)</code></summary>\n\n### Request\n\n```bash\ncurl -X POST http://localhost:8080/users \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"publicKey\": \"ed25519_abc123...\",\n    \"username\": \"@alice\",\n    \"displayName\": \"Alice Johnson\",\n    \"bio\": \"Software developer\"\n  }'\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**publicKey**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**username**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**displayName**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**bio**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>201</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"userId\": \"usr_1a2b3c4d5e6f\",\n  \"transactionId\": \"tx_7g8h9i0j1k2l\",\n  \"status\": \"pending\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/users</b></code> <code>(list users)</code></summary>\n\n### Request\n\n```bash\ncurl http://localhost:8080/users\n```\n\n### Parameters\n\nNone\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n[\n  {\n    \"id\": \"usr_1a2b3c4d5e6f\",\n    \"username\": \"@alice\",\n    \"displayName\": \"Alice Johnson\",\n    \"publicKey\": \"ed25519_abc123...\",\n    \"bio\": \"Software developer\",\n    \"createdAt\": \"2024-11-07T12:00:00.000Z\"\n  }\n]\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/users/:id</b></code> <code>(get user by ID)</code></summary>\n\n### Request\n\n```bash\ncurl http://localhost:8080/users/usr_1a2b3c4d5e6f\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**id**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"id\": \"usr_1a2b3c4d5e6f\",\n  \"username\": \"@alice\",\n  \"displayName\": \"Alice Johnson\",\n  \"publicKey\": \"ed25519_abc123...\",\n  \"bio\": \"Software developer\",\n  \"createdAt\": \"2024-11-07T12:00:00.000Z\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"User not found\",\n  \"timestamp\": \"2024-11-07T12:00:00.000Z\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/users/username/:username</b></code> <code>(get user by username)</code></summary>\n\n### Request\n\n```bash\ncurl http://localhost:8080/users/username/@alice\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**username**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"id\": \"usr_1a2b3c4d5e6f\",\n  \"username\": \"@alice\",\n  \"displayName\": \"Alice Johnson\",\n  \"publicKey\": \"ed25519_abc123...\",\n  \"bio\": \"Software developer\",\n  \"createdAt\": \"2024-11-07T12:00:00.000Z\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"User not found\",\n  \"timestamp\": \"2024-11-07T12:00:00.000Z\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-purple-400\">PATCH</code> <code><b>/users/:id</b></code> <code>(update user)</code></summary>\n\n### Request\n\n```bash\ncurl -X PATCH http://localhost:8080/users/usr_1a2b3c4d5e6f \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"displayName\": \"Alice Smith\",\n    \"bio\": \"Senior Software Developer\"\n  }'\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**id**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n <tr>\n    <td>**displayName**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**bio**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**avatarData**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**landingPageId**</td>\n    <td>string (UUID)</td>\n    <td>optional</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"id\": \"usr_1a2b3c4d5e6f\",\n  \"username\": \"@alice\",\n  \"displayName\": \"Alice Smith\",\n  \"publicKey\": \"ed25519_abc123...\",\n  \"bio\": \"Senior Software Developer\",\n  \"updatedAt\": \"2024-11-08T12:00:00.000Z\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"User not found\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [ ] Public\n- [ ] Community\n- [ ] Team\n- [x] Self\n- [x] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-red-400\">DELETE</code> <code><b>/users/:id</b></code> <code>(delete user)</code></summary>\n\n### Request\n\n```bash\ncurl -X DELETE http://localhost:8080/users/usr_1a2b3c4d5e6f\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**id**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"message\": \"User deleted\",\n  \"user\": {\n    \"id\": \"usr_1a2b3c4d5e6f\",\n    \"username\": \"@alice\"\n  }\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"User not found\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [ ] Public\n- [ ] Community\n- [ ] Team\n- [x] Self\n- [x] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/users/:id/balances</b></code> <code>(get user balances)</code></summary>\n\n### Request\n\n```bash\ncurl http://localhost:8080/users/usr_1a2b3c4d5e6f/balances\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**id**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n[\n  {\n    \"ownerId\": \"usr_1a2b3c4d5e6f\",\n    \"ownerType\": \"user\",\n    \"currencyCode\": \"USD\",\n    \"balance\": \"1000.50\"\n  },\n  {\n    \"ownerId\": \"usr_1a2b3c4d5e6f\",\n    \"ownerType\": \"user\",\n    \"currencyCode\": \"ETH\",\n    \"balance\": \"2.5\"\n  }\n]\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"User not found\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n### Method Not Allowed\n\nThe following methods are not supported:\n\n<code className=\"text-orange-400\">PUT</code>\n",
    "html": "<p>Create a new user account by submitting a user creation transaction. The transaction will be pending until included in a block.</p>\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/users</b></code> <code>(create user)</code></summary>\n\n<h3 id=\"request\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -X</span><span style=\"color:#9ECBFF\"> POST</span><span style=\"color:#9ECBFF\"> http://localhost:8080/users</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -H</span><span style=\"color:#9ECBFF\"> \"Content-Type: application/json\"</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -d</span><span style=\"color:#9ECBFF\"> '{</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"publicKey\": \"ed25519_abc123...\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"username\": \"@alice\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"displayName\": \"Alice Johnson\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"bio\": \"Software developer\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  }'</span></span></code></pre>\n</code></pre><h3 id=\"parameters\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**publicKey**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**username**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**displayName**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**bio**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n</table>\n\n<h3 id=\"response\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>201</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"userId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_1a2b3c4d5e6f\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"transactionId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"tx_7g8h9i0j1k2l\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"status\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"pending\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level\">Access Level</h3>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/users</b></code> <code>(list users)</code></summary>\n\n<h3 id=\"request-1\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8080/users</span></span></code></pre>\n</code></pre><h3 id=\"parameters-1\">Parameters</h3>\n<p>None</p>\n<h3 id=\"response-1\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">[</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_1a2b3c4d5e6f\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"username\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"@alice\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"displayName\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Alice Johnson\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"publicKey\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"ed25519_abc123...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"bio\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Software developer\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"createdAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-07T12:00:00.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">]</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level-1\">Access Level</h3>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/users/:id</b></code> <code>(get user by ID)</code></summary>\n\n<h3 id=\"request-2\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8080/users/usr_1a2b3c4d5e6f</span></span></code></pre>\n</code></pre><h3 id=\"parameters-2\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**id**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n</table>\n\n<h3 id=\"response-2\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_1a2b3c4d5e6f\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"username\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"@alice\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"displayName\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Alice Johnson\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"publicKey\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"ed25519_abc123...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"bio\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Software developer\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"createdAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-07T12:00:00.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"User not found\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"timestamp\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-07T12:00:00.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level-2\">Access Level</h3>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/users/username/:username</b></code> <code>(get user by username)</code></summary>\n\n<h3 id=\"request-3\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8080/users/username/@alice</span></span></code></pre>\n</code></pre><h3 id=\"parameters-3\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**username**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n</table>\n\n<h3 id=\"response-3\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_1a2b3c4d5e6f\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"username\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"@alice\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"displayName\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Alice Johnson\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"publicKey\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"ed25519_abc123...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"bio\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Software developer\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"createdAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-07T12:00:00.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"User not found\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"timestamp\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-07T12:00:00.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level-3\">Access Level</h3>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<details>\n <summary><code className=\"text-purple-400\">PATCH</code> <code><b>/users/:id</b></code> <code>(update user)</code></summary>\n\n<h3 id=\"request-4\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -X</span><span style=\"color:#9ECBFF\"> PATCH</span><span style=\"color:#9ECBFF\"> http://localhost:8080/users/usr_1a2b3c4d5e6f</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -H</span><span style=\"color:#9ECBFF\"> \"Content-Type: application/json\"</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -d</span><span style=\"color:#9ECBFF\"> '{</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"displayName\": \"Alice Smith\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"bio\": \"Senior Software Developer\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  }'</span></span></code></pre>\n</code></pre><h3 id=\"parameters-4\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**id**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n <tr>\n    <td>**displayName**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**bio**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**avatarData**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**landingPageId**</td>\n    <td>string (UUID)</td>\n    <td>optional</td>\n  </tr>\n</table>\n\n<h3 id=\"response-4\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_1a2b3c4d5e6f\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"username\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"@alice\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"displayName\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Alice Smith\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"publicKey\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"ed25519_abc123...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"bio\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Senior Software Developer\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"updatedAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:00.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"User not found\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level-4\">Access Level</h3>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<details>\n <summary><code className=\"text-red-400\">DELETE</code> <code><b>/users/:id</b></code> <code>(delete user)</code></summary>\n\n<h3 id=\"request-5\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -X</span><span style=\"color:#9ECBFF\"> DELETE</span><span style=\"color:#9ECBFF\"> http://localhost:8080/users/usr_1a2b3c4d5e6f</span></span></code></pre>\n</code></pre><h3 id=\"parameters-5\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**id**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n</table>\n\n<h3 id=\"response-5\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"message\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"User deleted\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"user\"</span><span style=\"color:#E1E4E8\">: {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_1a2b3c4d5e6f\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"username\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"@alice\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"User not found\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level-5\">Access Level</h3>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/users/:id/balances</b></code> <code>(get user balances)</code></summary>\n\n<h3 id=\"request-6\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8080/users/usr_1a2b3c4d5e6f/balances</span></span></code></pre>\n</code></pre><h3 id=\"parameters-6\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**id**</td>\n    <td>string</td>\n    <td>required (URL param)</td>\n  </tr>\n</table>\n\n<h3 id=\"response-6\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">[</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"ownerId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_1a2b3c4d5e6f\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"ownerType\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"user\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"currencyCode\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"USD\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"balance\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"1000.50\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"ownerId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_1a2b3c4d5e6f\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"ownerType\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"user\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"currencyCode\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"ETH\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"balance\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2.5\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">]</span></span></code></pre>\n</code></pre></td>\n  </tr>\n  <tr>\n    <td>404</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"User not found\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level-6\">Access Level</h3>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<h3 id=\"method-not-allowed\">Method Not Allowed</h3>\n<p>The following methods are not supported:</p>\n<p><code className=\"text-orange-400\">PUT</code></p>\n"
  },
  {
    "slug": [
      "tana-api",
      "users",
      "signin"
    ],
    "metadata": {
      "title": "/users/signin",
      "description": "documentation for the endpoint"
    },
    "content": "\nwhen given a user identifier (username, email, or phone number) and password as input, this endpoint will return a token if the information is valid\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/users/signin</b></code> <code>(authenticate user)</code></summary>\n\n### Request\n\n```javascript\ncurl https://api.conoda.co/users/signin\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**user**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**password**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"conoda/addis\": \"v1.0.0\",\n  \"api\": \"v1\",\n  \"location\": \"seattle\",\n  \"server-id\": \"9x93jv35\",\n  \"rate-limit-remaining\": 1000,\n  \"rate-limit-reset\": 1684830400,\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [ ] Public\n- [ ] Community\n- [ ] Team\n- [x] Self\n- [x] Admin\n\n</details>\n\n### Method Not Allowed\n\nsending a request with the following methods to this endpoint will return an 405 error\n\n<code className=\"text-blue-400\">GET</code> <code className=\"text-orange-400\">PUT</code> <code className=\"text-red-400\">DELETE</code>\n",
    "html": "<p>when given a user identifier (username, email, or phone number) and password as input, this endpoint will return a token if the information is valid</p>\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/users/signin</b></code> <code>(authenticate user)</code></summary>\n\n<h3 id=\"request\">Request</h3>\n<pre><code class=\"language-javascript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">curl </span><span style=\"color:#B392F0\">https</span><span style=\"color:#E1E4E8\">:</span><span style=\"color:#6A737D\">//api.conoda.co/users/signin</span></span></code></pre>\n</code></pre><h3 id=\"parameters\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**user**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**password**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n</table>\n\n<h3 id=\"response\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"conoda/addis\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"v1.0.0\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"api\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"v1\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"location\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"seattle\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"server-id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"9x93jv35\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"rate-limit-remaining\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">1000</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"rate-limit-reset\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">1684830400</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level\">Access Level</h3>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<h3 id=\"method-not-allowed\">Method Not Allowed</h3>\n<p>sending a request with the following methods to this endpoint will return an 405 error</p>\n<p><code className=\"text-blue-400\">GET</code> <code className=\"text-orange-400\">PUT</code> <code className=\"text-red-400\">DELETE</code></p>\n"
  },
  {
    "slug": [
      "tana-api",
      "balances"
    ],
    "metadata": {
      "title": "/balances",
      "description": "Manage account balances and currencies"
    },
    "content": "\nManage balances for users and teams across multiple currencies. All balance amounts are stored as strings to preserve decimal precision.\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/balances</b></code> <code>(get all balances or specific balance)</code></summary>\n\n### Request\n\n**Get all balances:**\n```bash\ncurl http://localhost:8080/balances\n```\n\n**Get specific balance:**\n```bash\ncurl \"http://localhost:8080/balances?ownerId=usr_1a2b3c4d5e6f&ownerType=user&currencyCode=USD\"\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**ownerId**</td>\n    <td>string (UUID)</td>\n    <td>optional (query param)</td>\n  </tr>\n <tr>\n    <td>**ownerType**</td>\n    <td>string (user | team)</td>\n    <td>optional (query param)</td>\n  </tr>\n <tr>\n    <td>**currencyCode**</td>\n    <td>string</td>\n    <td>optional (query param)</td>\n  </tr>\n</table>\n\n**Note:** If any query parameter is provided, all three (ownerId, ownerType, currencyCode) are required.\n\n### Response\n\n**All balances (no query params):**\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n[\n  {\n    \"ownerId\": \"usr_1a2b3c4d5e6f\",\n    \"ownerType\": \"user\",\n    \"currencyCode\": \"USD\",\n    \"balance\": \"1000.50\",\n    \"updatedAt\": \"2024-11-08T12:00:00.000Z\"\n  },\n  {\n    \"ownerId\": \"usr_1a2b3c4d5e6f\",\n    \"ownerType\": \"user\",\n    \"currencyCode\": \"ETH\",\n    \"balance\": \"2.5\",\n    \"updatedAt\": \"2024-11-08T11:30:00.000Z\"\n  }\n]\n```\n\n</td>\n  </tr>\n</table>\n\n**Specific balance (with query params):**\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"ownerId\": \"usr_1a2b3c4d5e6f\",\n  \"ownerType\": \"user\",\n  \"currencyCode\": \"USD\",\n  \"balance\": \"1000.50\",\n  \"updatedAt\": \"2024-11-08T12:00:00.000Z\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Missing required query parameters: ownerId, ownerType, currencyCode\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n**If balance doesn't exist:**\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"balance\": \"0\",\n  \"currencyCode\": \"USD\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/balances</b></code> <code>(set balance)</code></summary>\n\n### Request\n\n```bash\ncurl -X POST http://localhost:8080/balances \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"ownerId\": \"usr_1a2b3c4d5e6f\",\n    \"ownerType\": \"user\",\n    \"currencyCode\": \"USD\",\n    \"amount\": \"1500.75\"\n  }'\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**ownerId**</td>\n    <td>string (UUID)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**ownerType**</td>\n    <td>string (user | team)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**currencyCode**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**amount**</td>\n    <td>string (decimal)</td>\n    <td>required</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>201</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"ownerId\": \"usr_1a2b3c4d5e6f\",\n  \"ownerType\": \"user\",\n  \"currencyCode\": \"USD\",\n  \"balance\": \"1500.75\",\n  \"updatedAt\": \"2024-11-08T12:00:00.000Z\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Amount must be a valid decimal number\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [ ] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [x] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/balances/currencies</b></code> <code>(list all currencies)</code></summary>\n\n### Request\n\n```bash\ncurl http://localhost:8080/balances/currencies\n```\n\n### Parameters\n\nNone\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n[\n  {\n    \"code\": \"USD\",\n    \"type\": \"fiat\",\n    \"decimals\": 2,\n    \"name\": \"US Dollar\",\n    \"symbol\": \"$\",\n    \"verified\": true\n  },\n  {\n    \"code\": \"ETH\",\n    \"type\": \"crypto\",\n    \"decimals\": 18,\n    \"name\": \"Ethereum\",\n    \"symbol\": \"Ξ\",\n    \"verified\": true\n  }\n]\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [x] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [ ] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/balances/currencies</b></code> <code>(create currency)</code></summary>\n\n### Request\n\n```bash\ncurl -X POST http://localhost:8080/balances/currencies \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"code\": \"BTC\",\n    \"type\": \"crypto\",\n    \"decimals\": 8,\n    \"name\": \"Bitcoin\",\n    \"symbol\": \"₿\",\n    \"verified\": false\n  }'\n```\n\n### Parameters\n\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**code**</td>\n    <td>string (uppercase)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**type**</td>\n    <td>string (fiat | crypto)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**decimals**</td>\n    <td>number (0-18)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**name**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**symbol**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**verified**</td>\n    <td>boolean</td>\n    <td>optional</td>\n  </tr>\n</table>\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>201</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"code\": \"BTC\",\n  \"type\": \"crypto\",\n  \"decimals\": 8,\n  \"name\": \"Bitcoin\",\n  \"symbol\": \"₿\",\n  \"verified\": false,\n  \"createdAt\": \"2024-11-08T12:00:00.000Z\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Currency code already exists\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [ ] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [x] Admin\n\n</details>\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/balances/currencies/seed</b></code> <code>(seed default currencies)</code></summary>\n\n### Request\n\n```bash\ncurl -X POST http://localhost:8080/balances/currencies/seed\n```\n\n### Parameters\n\nNone\n\n### Response\n\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"message\": \"Default currencies seeded\"\n}\n```\n\n</td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n```json\n{\n  \"error\": \"Error seeding currencies\"\n}\n```\n\n</td>\n  </tr>\n</table>\n\n### Access Level\n\n- [ ] Public\n- [ ] Community\n- [ ] Team\n- [ ] Self\n- [x] Admin\n\n</details>\n\n### Method Not Allowed\n\nThe following methods are not supported:\n\n<code className=\"text-orange-400\">PUT</code> <code className=\"text-red-400\">DELETE</code> <code className=\"text-purple-400\">PATCH</code>\n",
    "html": "<p>Manage balances for users and teams across multiple currencies. All balance amounts are stored as strings to preserve decimal precision.</p>\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/balances</b></code> <code>(get all balances or specific balance)</code></summary>\n\n<h3 id=\"request\">Request</h3>\n<p><strong>Get all balances:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8080/balances</span></span></code></pre>\n</code></pre><p><strong>Get specific balance:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> \"http://localhost:8080/balances?ownerId=usr_1a2b3c4d5e6f&#x26;ownerType=user&#x26;currencyCode=USD\"</span></span></code></pre>\n</code></pre><h3 id=\"parameters\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**ownerId**</td>\n    <td>string (UUID)</td>\n    <td>optional (query param)</td>\n  </tr>\n <tr>\n    <td>**ownerType**</td>\n    <td>string (user | team)</td>\n    <td>optional (query param)</td>\n  </tr>\n <tr>\n    <td>**currencyCode**</td>\n    <td>string</td>\n    <td>optional (query param)</td>\n  </tr>\n</table>\n\n<p><strong>Note:</strong> If any query parameter is provided, all three (ownerId, ownerType, currencyCode) are required.</p>\n<h3 id=\"response\">Response</h3>\n<p><strong>All balances (no query params):</strong></p>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">[</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"ownerId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_1a2b3c4d5e6f\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"ownerType\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"user\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"currencyCode\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"USD\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"balance\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"1000.50\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"updatedAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:00.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"ownerId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_1a2b3c4d5e6f\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"ownerType\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"user\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"currencyCode\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"ETH\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"balance\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2.5\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"updatedAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T11:30:00.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">]</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<p><strong>Specific balance (with query params):</strong></p>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"ownerId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_1a2b3c4d5e6f\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"ownerType\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"user\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"currencyCode\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"USD\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"balance\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"1000.50\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"updatedAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:00.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Missing required query parameters: ownerId, ownerType, currencyCode\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<p><strong>If balance doesn&#39;t exist:</strong></p>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"balance\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"0\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"currencyCode\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"USD\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level\">Access Level</h3>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/balances</b></code> <code>(set balance)</code></summary>\n\n<h3 id=\"request-1\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -X</span><span style=\"color:#9ECBFF\"> POST</span><span style=\"color:#9ECBFF\"> http://localhost:8080/balances</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -H</span><span style=\"color:#9ECBFF\"> \"Content-Type: application/json\"</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -d</span><span style=\"color:#9ECBFF\"> '{</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"ownerId\": \"usr_1a2b3c4d5e6f\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"ownerType\": \"user\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"currencyCode\": \"USD\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"amount\": \"1500.75\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  }'</span></span></code></pre>\n</code></pre><h3 id=\"parameters-1\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**ownerId**</td>\n    <td>string (UUID)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**ownerType**</td>\n    <td>string (user | team)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**currencyCode**</td>\n    <td>string</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**amount**</td>\n    <td>string (decimal)</td>\n    <td>required</td>\n  </tr>\n</table>\n\n<h3 id=\"response-1\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>201</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"ownerId\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"usr_1a2b3c4d5e6f\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"ownerType\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"user\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"currencyCode\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"USD\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"balance\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"1500.75\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"updatedAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:00.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Amount must be a valid decimal number\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level-1\">Access Level</h3>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<details>\n <summary><code className=\"text-blue-400\">GET</code> <code><b>/balances/currencies</b></code> <code>(list all currencies)</code></summary>\n\n<h3 id=\"request-2\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8080/balances/currencies</span></span></code></pre>\n</code></pre><h3 id=\"parameters-2\">Parameters</h3>\n<p>None</p>\n<h3 id=\"response-2\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">[</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"code\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"USD\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"type\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"fiat\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"decimals\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">2</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"name\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"US Dollar\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"symbol\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"$\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"verified\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">true</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"code\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"ETH\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"type\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"crypto\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"decimals\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">18</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"name\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Ethereum\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"symbol\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Ξ\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"verified\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">true</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">]</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level-2\">Access Level</h3>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/balances/currencies</b></code> <code>(create currency)</code></summary>\n\n<h3 id=\"request-3\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -X</span><span style=\"color:#9ECBFF\"> POST</span><span style=\"color:#9ECBFF\"> http://localhost:8080/balances/currencies</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -H</span><span style=\"color:#9ECBFF\"> \"Content-Type: application/json\"</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -d</span><span style=\"color:#9ECBFF\"> '{</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"code\": \"BTC\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"type\": \"crypto\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"decimals\": 8,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"name\": \"Bitcoin\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"symbol\": \"₿\",</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    \"verified\": false</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  }'</span></span></code></pre>\n</code></pre><h3 id=\"parameters-3\">Parameters</h3>\n<table>\n <tr>\n    <td>_parameter_</td>\n    <td>_type_</td>\n    <td>_necessity_</td>\n  </tr>\n <tr>\n    <td>**code**</td>\n    <td>string (uppercase)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**type**</td>\n    <td>string (fiat | crypto)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**decimals**</td>\n    <td>number (0-18)</td>\n    <td>required</td>\n  </tr>\n <tr>\n    <td>**name**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**symbol**</td>\n    <td>string</td>\n    <td>optional</td>\n  </tr>\n <tr>\n    <td>**verified**</td>\n    <td>boolean</td>\n    <td>optional</td>\n  </tr>\n</table>\n\n<h3 id=\"response-3\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>201</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"code\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"BTC\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"type\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"crypto\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"decimals\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">8</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"name\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Bitcoin\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"symbol\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"₿\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"verified\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">false</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"createdAt\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"2024-11-08T12:00:00.000Z\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Currency code already exists\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level-3\">Access Level</h3>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<details>\n <summary><code className=\"text-green-400\">POST</code> <code><b>/balances/currencies/seed</b></code> <code>(seed default currencies)</code></summary>\n\n<h3 id=\"request-4\">Request</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -X</span><span style=\"color:#9ECBFF\"> POST</span><span style=\"color:#9ECBFF\"> http://localhost:8080/balances/currencies/seed</span></span></code></pre>\n</code></pre><h3 id=\"parameters-4\">Parameters</h3>\n<p>None</p>\n<h3 id=\"response-4\">Response</h3>\n<table>\n <tr>\n    <td>http code</td>\n    <td>content-type</td>\n    <td>body</td>\n  </tr>\n  <tr>\n    <td>200</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"message\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Default currencies seeded\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n  <tr>\n    <td>400</td>\n    <td>application/json</td>\n<td>\n\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Error seeding currencies\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre></td>\n  </tr>\n</table>\n\n<h3 id=\"access-level-4\">Access Level</h3>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> Public</li>\n<li><input disabled=\"\" type=\"checkbox\"> Community</li>\n<li><input disabled=\"\" type=\"checkbox\"> Team</li>\n<li><input disabled=\"\" type=\"checkbox\"> Self</li>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> Admin</li>\n</ul>\n</details>\n\n<h3 id=\"method-not-allowed\">Method Not Allowed</h3>\n<p>The following methods are not supported:</p>\n<p><code className=\"text-orange-400\">PUT</code> <code className=\"text-red-400\">DELETE</code> <code className=\"text-purple-400\">PATCH</code></p>\n"
  },
  {
    "slug": [
      "tana-api",
      "keys",
      "id"
    ],
    "metadata": {
      "title": "/keys/{:id}",
      "description": "A reference page in my new Starlight docs site."
    },
    "content": "\nReference pages are ideal for outlining how things work in terse and clear terms.\nLess concerned with telling a story or addressing a specific use case, they should give a comprehensive outline of what you're documenting.\n\n## Further reading\n\n- Read [about reference](https://diataxis.fr/reference/) in the Diátaxis framework\n",
    "html": "<p>Reference pages are ideal for outlining how things work in terse and clear terms.\nLess concerned with telling a story or addressing a specific use case, they should give a comprehensive outline of what you&#39;re documenting.</p>\n<h2 id=\"further-reading\">Further reading</h2>\n<ul>\n<li>Read <a href=\"https://diataxis.fr/reference/\">about reference</a> in the Diátaxis framework</li>\n</ul>\n"
  },
  {
    "slug": [
      "tana-api",
      "keys"
    ],
    "metadata": {
      "title": "/keys",
      "description": "A reference page in my new Starlight docs site."
    },
    "content": "\nReference pages are ideal for outlining how things work in terse and clear terms.\nLess concerned with telling a story or addressing a specific use case, they should give a comprehensive outline of what you're documenting.",
    "html": "<p>Reference pages are ideal for outlining how things work in terse and clear terms.\nLess concerned with telling a story or addressing a specific use case, they should give a comprehensive outline of what you&#39;re documenting.</p>\n"
  },
  {
    "slug": [
      "tana-api",
      "modules",
      "kv"
    ],
    "metadata": {
      "title": "tana/kv Module",
      "description": "KV Storage API Reference"
    },
    "content": "\nCloudflare Workers-compatible key-value storage for smart contracts.\n\n## Import\n\n```typescript\nimport { kv } from 'tana/kv'\n```\n\n## Methods\n\n### kv.get()\n\nRetrieve a value from storage.\n\n```typescript\nkv.get(key: string, options?: KVGetOptions): Promise<string | object | null>\n```\n\n**Parameters:**\n\n| Name | Type | Required | Description |\n|------|------|----------|-------------|\n| `key` | string | Yes | Storage key (max 512 bytes) |\n| `options.type` | 'text' \\| 'json' | No | Return type (default: 'text') |\n\n**Returns:** `Promise<string | object | null>`\n\n- Returns `null` if key doesn't exist\n- Returns string when `type: 'text'` (default)\n- Returns parsed object when `type: 'json'`\n\n**Examples:**\n\n```typescript\n// Get as text (default)\nconst username = await kv.get('username')\nconsole.log(username) // \"alice\"\n\n// Get as JSON\nconst user = await kv.get('user', { type: 'json' })\nconsole.log(user) // { name: \"alice\", balance: 1000 }\n\n// Handle missing key\nconst missing = await kv.get('nonexistent')\nif (missing === null) {\n  console.log('Key not found')\n}\n```\n\n---\n\n### kv.put()\n\nStore a value.\n\n```typescript\nkv.put(key: string, value: string | object, options?: KVPutOptions): Promise<void>\n```\n\n**Parameters:**\n\n| Name | Type | Required | Description |\n|------|------|----------|-------------|\n| `key` | string | Yes | Storage key (max 512 bytes) |\n| `value` | string \\| object | Yes | Value to store (max 25 MB) |\n| `options` | KVPutOptions | No | Reserved for future features |\n\n**Returns:** `Promise<void>`\n\n**Serialization:**\n- Strings: Stored as-is\n- Objects: Automatically JSON-serialized\n\n**Throws:**\n- \"KV key too long\" - Key exceeds 512 bytes\n- \"KV value too large\" - Value exceeds 25 MB\n\n**Examples:**\n\n```typescript\n// Store string\nawait kv.put('username', 'alice')\n\n// Store object (auto-serialized)\nawait kv.put('user', {\n  name: 'alice',\n  balance: 1000,\n  roles: ['admin', 'user']\n})\n\n// Overwrite existing key\nawait kv.put('username', 'bob') // Previous value replaced\n```\n\n---\n\n### kv.delete()\n\nDelete a key from storage.\n\n```typescript\nkv.delete(key: string): Promise<void>\n```\n\n**Parameters:**\n\n| Name | Type | Required | Description |\n|------|------|----------|-------------|\n| `key` | string | Yes | Key to delete |\n\n**Returns:** `Promise<void>`\n\n**Notes:**\n- No error if key doesn't exist\n- Idempotent operation\n\n**Examples:**\n\n```typescript\n// Delete existing key\nawait kv.delete('username')\n\n// Delete non-existent key (no error)\nawait kv.delete('nonexistent') // Succeeds silently\n```\n\n---\n\n### kv.list()\n\nList keys in storage with optional filtering.\n\n```typescript\nkv.list(options?: KVListOptions): Promise<KVListResult>\n```\n\n**Parameters:**\n\n| Name | Type | Required | Description |\n|------|------|----------|-------------|\n| `options.prefix` | string | No | Filter keys by prefix |\n| `options.limit` | number | No | Max keys to return (default: 1000) |\n\n**Returns:** `Promise<KVListResult>`\n\n```typescript\ninterface KVListResult {\n  keys: Array<{ name: string }>\n  list_complete: boolean\n  cursor: string | null\n}\n```\n\n**Result Fields:**\n\n| Field | Type | Description |\n|-------|------|-------------|\n| `keys` | Array<{ name: string }> | Array of matching keys |\n| `list_complete` | boolean | Whether all results returned (always `true` currently) |\n| `cursor` | string \\| null | Pagination cursor (always `null` currently, reserved for future) |\n\n**Examples:**\n\n```typescript\n// List all keys\nconst all = await kv.list()\nconsole.log(all.keys) // [{ name: \"user\" }, { name: \"config\" }]\n\n// List with prefix\nawait kv.put('user:1', { name: 'alice' })\nawait kv.put('user:2', { name: 'bob' })\nawait kv.put('config', { theme: 'dark' })\n\nconst users = await kv.list({ prefix: 'user:' })\nconsole.log(users.keys) // [{ name: \"user:1\" }, { name: \"user:2\" }]\n\n// Limit results\nconst first10 = await kv.list({ limit: 10 })\nconsole.log(first10.keys.length) // 10 or fewer\n\n// Check if more results available\nif (!first10.list_complete) {\n  // Use cursor for next page (future feature)\n  const next = await kv.list({ cursor: first10.cursor })\n}\n```\n\n---\n\n## Type Definitions\n\n### KVGetOptions\n\n```typescript\ninterface KVGetOptions {\n  type?: 'text' | 'json' | 'arrayBuffer' | 'stream'\n}\n```\n\n**Supported types:**\n- ✅ `'text'` - Return as string (default)\n- ✅ `'json'` - Parse and return as object\n- ❌ `'arrayBuffer'` - Future feature\n- ❌ `'stream'` - Future feature\n\n---\n\n### KVPutOptions\n\n```typescript\ninterface KVPutOptions {\n  metadata?: Record<string, any>\n  expirationTtl?: number\n  expiration?: number\n}\n```\n\n**Reserved for future features:**\n- `metadata` - Custom metadata for the key\n- `expirationTtl` - TTL in seconds\n- `expiration` - Absolute expiration timestamp\n\nCurrently these options are accepted but have no effect.\n\n---\n\n### KVListOptions\n\n```typescript\ninterface KVListOptions {\n  prefix?: string\n  limit?: number\n  cursor?: string\n}\n```\n\n**Fields:**\n- `prefix` - Filter keys starting with prefix (default: none)\n- `limit` - Max keys to return (default: 1000, max: 1000)\n- `cursor` - Pagination cursor (future feature)\n\n---\n\n### KVListResult\n\n```typescript\ninterface KVListResult {\n  keys: KVListResultKey[]\n  list_complete: boolean\n  cursor: string | null\n}\n```\n\n---\n\n### KVListResultKey\n\n```typescript\ninterface KVListResultKey {\n  name: string\n  expiration?: number\n  metadata?: Record<string, any>\n}\n```\n\n**Fields:**\n- `name` - The key name\n- `expiration` - Future feature (always undefined)\n- `metadata` - Future feature (always undefined)\n\n---\n\n## Constraints & Limits\n\n| Constraint | Limit | Error Message |\n|------------|-------|---------------|\n| Key length | 512 bytes | \"KV key too long: X bytes (max 512)\" |\n| Value size | 25 MB | \"KV value too large: X bytes (max 25 MB)\" |\n| Keys per list() | 1000 | Silently limited to 1000 |\n| Keys per contract | Unlimited | Subject to storage backend limits |\n\n---\n\n## Namespace Isolation\n\nKV storage is automatically isolated per-contract:\n\n```typescript\n// Contract A\nawait kv.put('username', 'alice')\n\n// Contract B\nawait kv.get('username') // Returns null, not \"alice\"\n```\n\nEach contract has its own isolated namespace. Keys are internally prefixed with the contract name to prevent conflicts.\n\n---\n\n## Cloudflare Workers Compatibility\n\nThe API is designed to match Cloudflare Workers KV:\n\n**Matching Features:**\n- ✅ `get()` / `put()` / `delete()` / `list()` methods\n- ✅ Type options ('text', 'json')\n- ✅ Prefix filtering\n- ✅ Limit parameter\n- ✅ Same return types\n\n**Differences:**\n- ❌ No `getWithMetadata()` yet\n- ❌ No TTL/expiration yet\n- ❌ No pagination cursors yet\n- ❌ No `'arrayBuffer'` / `'stream'` types yet\n\nThis allows contracts written for Tana to be easily adapted for Cloudflare Workers and vice versa.\n\n---\n\n## Examples\n\n### Counter\n\n```typescript\nimport { kv } from 'tana/kv'\n\nexport async function contract() {\n  const current = await kv.get('counter', { type: 'json' })\n  const count = (current?.count || 0) + 1\n\n  await kv.put('counter', { count, lastUpdated: Date.now() })\n\n  return { count }\n}\n```\n\n### Session Management\n\n```typescript\nimport { kv } from 'tana/kv'\nimport { context } from 'tana/context'\n\nexport async function contract() {\n  const input = context.input()\n\n  if (input.action === 'create') {\n    const session = {\n      userId: input.userId,\n      createdAt: Date.now()\n    }\n    await kv.put(`session:${input.sessionId}`, session)\n    return { success: true }\n  }\n\n  if (input.action === 'get') {\n    const session = await kv.get(`session:${input.sessionId}`, { type: 'json' })\n    return session || { error: 'Session not found' }\n  }\n\n  if (input.action === 'delete') {\n    await kv.delete(`session:${input.sessionId}`)\n    return { success: true }\n  }\n}\n```\n\n### User Preferences\n\n```typescript\nimport { kv } from 'tana/kv'\nimport { context } from 'tana/context'\n\nexport async function get(req: Request) {\n  const caller = req.tana.caller\n  if (!caller) return { error: 'Login required' }\n\n  const prefs = await kv.get(`prefs:${caller.id}`, { type: 'json' })\n\n  return prefs || {\n    theme: 'dark',\n    notifications: true,\n    language: 'en'\n  }\n}\n\nexport async function post(req: Request) {\n  const caller = req.tana.caller\n  if (!caller) return { error: 'Login required' }\n\n  const prefs = req.body\n\n  await kv.put(`prefs:${caller.id}`, prefs)\n\n  return { success: true }\n}\n```\n\n### Cache with Prefix\n\n```typescript\nimport { kv } from 'tana/kv'\n\nexport async function contract() {\n  // Cache multiple items\n  await kv.put('cache:api:users', [{ id: 1 }, { id: 2 }])\n  await kv.put('cache:api:posts', [{ id: 1 }])\n  await kv.put('cache:db:config', { host: 'localhost' })\n\n  // List only cache:api: items\n  const apiCache = await kv.list({ prefix: 'cache:api:' })\n  console.log(apiCache.keys)\n  // [{ name: \"cache:api:posts\" }, { name: \"cache:api:users\" }]\n\n  // Clear all api cache\n  for (const key of apiCache.keys) {\n    await kv.delete(key.name)\n  }\n\n  return { cleared: apiCache.keys.length }\n}\n```\n\n---\n\n## See Also\n\n- [KV Storage Guide](/guides/kv-storage) - Usage guide with patterns\n- [KV Implementation](/contributing/runtime/modules/kv) - Technical details\n- [Smart Contracts](/guides/smart-contracts) - Contract development guide\n",
    "html": "<p>Cloudflare Workers-compatible key-value storage for smart contracts.</p>\n<h2 id=\"import\">Import</h2>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { kv } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/kv'</span></span></code></pre>\n</code></pre><h2 id=\"methods\">Methods</h2>\n<h3 id=\"kvget\">kv.get()</h3>\n<p>Retrieve a value from storage.</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(key: string, options</span><span style=\"color:#F97583\">?:</span><span style=\"color:#E1E4E8\"> KVGetOptions): </span><span style=\"color:#79B8FF\">Promise</span><span style=\"color:#F97583\">&#x3C;</span><span style=\"color:#E1E4E8\">string </span><span style=\"color:#F97583\">|</span><span style=\"color:#E1E4E8\"> object </span><span style=\"color:#F97583\">|</span><span style=\"color:#79B8FF\"> null</span><span style=\"color:#F97583\">></span></span></code></pre>\n</code></pre><p><strong>Parameters:</strong></p>\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Type</th>\n<th>Required</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>key</code></td>\n<td>string</td>\n<td>Yes</td>\n<td>Storage key (max 512 bytes)</td>\n</tr>\n<tr>\n<td><code>options.type</code></td>\n<td>&#39;text&#39; | &#39;json&#39;</td>\n<td>No</td>\n<td>Return type (default: &#39;text&#39;)</td>\n</tr>\n</tbody></table>\n<p><strong>Returns:</strong> <code>Promise&lt;string | object | null&gt;</code></p>\n<ul>\n<li>Returns <code>null</code> if key doesn&#39;t exist</li>\n<li>Returns string when <code>type: &#39;text&#39;</code> (default)</li>\n<li>Returns parsed object when <code>type: &#39;json&#39;</code></li>\n</ul>\n<p><strong>Examples:</strong></p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Get as text (default)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> username</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'username'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(username) </span><span style=\"color:#6A737D\">// \"alice\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Get as JSON</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> user</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'user'</span><span style=\"color:#E1E4E8\">, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(user) </span><span style=\"color:#6A737D\">// { name: \"alice\", balance: 1000 }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Handle missing key</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> missing</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'nonexistent'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">if</span><span style=\"color:#E1E4E8\"> (missing </span><span style=\"color:#F97583\">===</span><span style=\"color:#79B8FF\"> null</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Key not found'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><hr>\n<h3 id=\"kvput\">kv.put()</h3>\n<p>Store a value.</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(key: string, value: string </span><span style=\"color:#F97583\">|</span><span style=\"color:#E1E4E8\"> object, options</span><span style=\"color:#F97583\">?:</span><span style=\"color:#E1E4E8\"> KVPutOptions): </span><span style=\"color:#79B8FF\">Promise</span><span style=\"color:#F97583\">&#x3C;void></span></span></code></pre>\n</code></pre><p><strong>Parameters:</strong></p>\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Type</th>\n<th>Required</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>key</code></td>\n<td>string</td>\n<td>Yes</td>\n<td>Storage key (max 512 bytes)</td>\n</tr>\n<tr>\n<td><code>value</code></td>\n<td>string | object</td>\n<td>Yes</td>\n<td>Value to store (max 25 MB)</td>\n</tr>\n<tr>\n<td><code>options</code></td>\n<td>KVPutOptions</td>\n<td>No</td>\n<td>Reserved for future features</td>\n</tr>\n</tbody></table>\n<p><strong>Returns:</strong> <code>Promise&lt;void&gt;</code></p>\n<p><strong>Serialization:</strong></p>\n<ul>\n<li>Strings: Stored as-is</li>\n<li>Objects: Automatically JSON-serialized</li>\n</ul>\n<p><strong>Throws:</strong></p>\n<ul>\n<li>&quot;KV key too long&quot; - Key exceeds 512 bytes</li>\n<li>&quot;KV value too large&quot; - Value exceeds 25 MB</li>\n</ul>\n<p><strong>Examples:</strong></p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Store string</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'username'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'alice'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Store object (auto-serialized)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'user'</span><span style=\"color:#E1E4E8\">, {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  name: </span><span style=\"color:#9ECBFF\">'alice'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  balance: </span><span style=\"color:#79B8FF\">1000</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  roles: [</span><span style=\"color:#9ECBFF\">'admin'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'user'</span><span style=\"color:#E1E4E8\">]</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">})</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Overwrite existing key</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'username'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'bob'</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#6A737D\">// Previous value replaced</span></span></code></pre>\n</code></pre><hr>\n<h3 id=\"kvdelete\">kv.delete()</h3>\n<p>Delete a key from storage.</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">kv.</span><span style=\"color:#B392F0\">delete</span><span style=\"color:#E1E4E8\">(key: string): </span><span style=\"color:#79B8FF\">Promise</span><span style=\"color:#F97583\">&#x3C;void></span></span></code></pre>\n</code></pre><p><strong>Parameters:</strong></p>\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Type</th>\n<th>Required</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>key</code></td>\n<td>string</td>\n<td>Yes</td>\n<td>Key to delete</td>\n</tr>\n</tbody></table>\n<p><strong>Returns:</strong> <code>Promise&lt;void&gt;</code></p>\n<p><strong>Notes:</strong></p>\n<ul>\n<li>No error if key doesn&#39;t exist</li>\n<li>Idempotent operation</li>\n</ul>\n<p><strong>Examples:</strong></p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Delete existing key</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">delete</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'username'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Delete non-existent key (no error)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">delete</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'nonexistent'</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#6A737D\">// Succeeds silently</span></span></code></pre>\n</code></pre><hr>\n<h3 id=\"kvlist\">kv.list()</h3>\n<p>List keys in storage with optional filtering.</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">kv.</span><span style=\"color:#B392F0\">list</span><span style=\"color:#E1E4E8\">(options</span><span style=\"color:#F97583\">?:</span><span style=\"color:#E1E4E8\"> KVListOptions): </span><span style=\"color:#79B8FF\">Promise</span><span style=\"color:#F97583\">&#x3C;</span><span style=\"color:#E1E4E8\">KVListResult</span><span style=\"color:#F97583\">></span></span></code></pre>\n</code></pre><p><strong>Parameters:</strong></p>\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Type</th>\n<th>Required</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>options.prefix</code></td>\n<td>string</td>\n<td>No</td>\n<td>Filter keys by prefix</td>\n</tr>\n<tr>\n<td><code>options.limit</code></td>\n<td>number</td>\n<td>No</td>\n<td>Max keys to return (default: 1000)</td>\n</tr>\n</tbody></table>\n<p><strong>Returns:</strong> <code>Promise&lt;KVListResult&gt;</code></p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">interface</span><span style=\"color:#B392F0\"> KVListResult</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  keys</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Array</span><span style=\"color:#E1E4E8\">&#x3C;{ </span><span style=\"color:#FFAB70\">name</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\"> }></span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  list_complete</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> boolean</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  cursor</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#F97583\"> |</span><span style=\"color:#79B8FF\"> null</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Result Fields:</strong></p>\n<table>\n<thead>\n<tr>\n<th>Field</th>\n<th>Type</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>keys</code></td>\n<td>Array&lt;{ name: string }&gt;</td>\n<td>Array of matching keys</td>\n</tr>\n<tr>\n<td><code>list_complete</code></td>\n<td>boolean</td>\n<td>Whether all results returned (always <code>true</code> currently)</td>\n</tr>\n<tr>\n<td><code>cursor</code></td>\n<td>string | null</td>\n<td>Pagination cursor (always <code>null</code> currently, reserved for future)</td>\n</tr>\n</tbody></table>\n<p><strong>Examples:</strong></p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// List all keys</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> all</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">list</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(all.keys) </span><span style=\"color:#6A737D\">// [{ name: \"user\" }, { name: \"config\" }]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// List with prefix</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'user:1'</span><span style=\"color:#E1E4E8\">, { name: </span><span style=\"color:#9ECBFF\">'alice'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'user:2'</span><span style=\"color:#E1E4E8\">, { name: </span><span style=\"color:#9ECBFF\">'bob'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'config'</span><span style=\"color:#E1E4E8\">, { theme: </span><span style=\"color:#9ECBFF\">'dark'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> users</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">list</span><span style=\"color:#E1E4E8\">({ prefix: </span><span style=\"color:#9ECBFF\">'user:'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(users.keys) </span><span style=\"color:#6A737D\">// [{ name: \"user:1\" }, { name: \"user:2\" }]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Limit results</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> first10</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">list</span><span style=\"color:#E1E4E8\">({ limit: </span><span style=\"color:#79B8FF\">10</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(first10.keys.</span><span style=\"color:#79B8FF\">length</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#6A737D\">// 10 or fewer</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Check if more results available</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">first10.list_complete) {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Use cursor for next page (future feature)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> next</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">list</span><span style=\"color:#E1E4E8\">({ cursor: first10.cursor })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><hr>\n<h2 id=\"type-definitions\">Type Definitions</h2>\n<h3 id=\"kvgetoptions\">KVGetOptions</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">interface</span><span style=\"color:#B392F0\"> KVGetOptions</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  type</span><span style=\"color:#F97583\">?:</span><span style=\"color:#9ECBFF\"> 'text'</span><span style=\"color:#F97583\"> |</span><span style=\"color:#9ECBFF\"> 'json'</span><span style=\"color:#F97583\"> |</span><span style=\"color:#9ECBFF\"> 'arrayBuffer'</span><span style=\"color:#F97583\"> |</span><span style=\"color:#9ECBFF\"> 'stream'</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Supported types:</strong></p>\n<ul>\n<li>✅ <code>&#39;text&#39;</code> - Return as string (default)</li>\n<li>✅ <code>&#39;json&#39;</code> - Parse and return as object</li>\n<li>❌ <code>&#39;arrayBuffer&#39;</code> - Future feature</li>\n<li>❌ <code>&#39;stream&#39;</code> - Future feature</li>\n</ul>\n<hr>\n<h3 id=\"kvputoptions\">KVPutOptions</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">interface</span><span style=\"color:#B392F0\"> KVPutOptions</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  metadata</span><span style=\"color:#F97583\">?:</span><span style=\"color:#B392F0\"> Record</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#79B8FF\">string</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">any</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  expirationTtl</span><span style=\"color:#F97583\">?:</span><span style=\"color:#79B8FF\"> number</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  expiration</span><span style=\"color:#F97583\">?:</span><span style=\"color:#79B8FF\"> number</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Reserved for future features:</strong></p>\n<ul>\n<li><code>metadata</code> - Custom metadata for the key</li>\n<li><code>expirationTtl</code> - TTL in seconds</li>\n<li><code>expiration</code> - Absolute expiration timestamp</li>\n</ul>\n<p>Currently these options are accepted but have no effect.</p>\n<hr>\n<h3 id=\"kvlistoptions\">KVListOptions</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">interface</span><span style=\"color:#B392F0\"> KVListOptions</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  prefix</span><span style=\"color:#F97583\">?:</span><span style=\"color:#79B8FF\"> string</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  limit</span><span style=\"color:#F97583\">?:</span><span style=\"color:#79B8FF\"> number</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  cursor</span><span style=\"color:#F97583\">?:</span><span style=\"color:#79B8FF\"> string</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Fields:</strong></p>\n<ul>\n<li><code>prefix</code> - Filter keys starting with prefix (default: none)</li>\n<li><code>limit</code> - Max keys to return (default: 1000, max: 1000)</li>\n<li><code>cursor</code> - Pagination cursor (future feature)</li>\n</ul>\n<hr>\n<h3 id=\"kvlistresult\">KVListResult</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">interface</span><span style=\"color:#B392F0\"> KVListResult</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  keys</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> KVListResultKey</span><span style=\"color:#E1E4E8\">[]</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  list_complete</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> boolean</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  cursor</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#F97583\"> |</span><span style=\"color:#79B8FF\"> null</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><hr>\n<h3 id=\"kvlistresultkey\">KVListResultKey</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">interface</span><span style=\"color:#B392F0\"> KVListResultKey</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  name</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  expiration</span><span style=\"color:#F97583\">?:</span><span style=\"color:#79B8FF\"> number</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  metadata</span><span style=\"color:#F97583\">?:</span><span style=\"color:#B392F0\"> Record</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#79B8FF\">string</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">any</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Fields:</strong></p>\n<ul>\n<li><code>name</code> - The key name</li>\n<li><code>expiration</code> - Future feature (always undefined)</li>\n<li><code>metadata</code> - Future feature (always undefined)</li>\n</ul>\n<hr>\n<h2 id=\"constraints--limits\">Constraints &amp; Limits</h2>\n<table>\n<thead>\n<tr>\n<th>Constraint</th>\n<th>Limit</th>\n<th>Error Message</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Key length</td>\n<td>512 bytes</td>\n<td>&quot;KV key too long: X bytes (max 512)&quot;</td>\n</tr>\n<tr>\n<td>Value size</td>\n<td>25 MB</td>\n<td>&quot;KV value too large: X bytes (max 25 MB)&quot;</td>\n</tr>\n<tr>\n<td>Keys per list()</td>\n<td>1000</td>\n<td>Silently limited to 1000</td>\n</tr>\n<tr>\n<td>Keys per contract</td>\n<td>Unlimited</td>\n<td>Subject to storage backend limits</td>\n</tr>\n</tbody></table>\n<hr>\n<h2 id=\"namespace-isolation\">Namespace Isolation</h2>\n<p>KV storage is automatically isolated per-contract:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Contract A</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'username'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'alice'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Contract B</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'username'</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#6A737D\">// Returns null, not \"alice\"</span></span></code></pre>\n</code></pre><p>Each contract has its own isolated namespace. Keys are internally prefixed with the contract name to prevent conflicts.</p>\n<hr>\n<h2 id=\"cloudflare-workers-compatibility\">Cloudflare Workers Compatibility</h2>\n<p>The API is designed to match Cloudflare Workers KV:</p>\n<p><strong>Matching Features:</strong></p>\n<ul>\n<li>✅ <code>get()</code> / <code>put()</code> / <code>delete()</code> / <code>list()</code> methods</li>\n<li>✅ Type options (&#39;text&#39;, &#39;json&#39;)</li>\n<li>✅ Prefix filtering</li>\n<li>✅ Limit parameter</li>\n<li>✅ Same return types</li>\n</ul>\n<p><strong>Differences:</strong></p>\n<ul>\n<li>❌ No <code>getWithMetadata()</code> yet</li>\n<li>❌ No TTL/expiration yet</li>\n<li>❌ No pagination cursors yet</li>\n<li>❌ No <code>&#39;arrayBuffer&#39;</code> / <code>&#39;stream&#39;</code> types yet</li>\n</ul>\n<p>This allows contracts written for Tana to be easily adapted for Cloudflare Workers and vice versa.</p>\n<hr>\n<h2 id=\"examples\">Examples</h2>\n<h3 id=\"counter\">Counter</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { kv } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/kv'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> contract</span><span style=\"color:#E1E4E8\">() {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> current</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'counter'</span><span style=\"color:#E1E4E8\">, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> count</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> (current?.count </span><span style=\"color:#F97583\">||</span><span style=\"color:#79B8FF\"> 0</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">+</span><span style=\"color:#79B8FF\"> 1</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'counter'</span><span style=\"color:#E1E4E8\">, { count, lastUpdated: Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">() })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> { count }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h3 id=\"session-management\">Session Management</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { kv } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/kv'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { context } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/context'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> contract</span><span style=\"color:#E1E4E8\">() {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> input</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> context.</span><span style=\"color:#B392F0\">input</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (input.action </span><span style=\"color:#F97583\">===</span><span style=\"color:#9ECBFF\"> 'create'</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> session</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      userId: input.userId,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      createdAt: Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`session:${</span><span style=\"color:#E1E4E8\">input</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">sessionId</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, session)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> { success: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (input.action </span><span style=\"color:#F97583\">===</span><span style=\"color:#9ECBFF\"> 'get'</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> session</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`session:${</span><span style=\"color:#E1E4E8\">input</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">sessionId</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> session </span><span style=\"color:#F97583\">||</span><span style=\"color:#E1E4E8\"> { error: </span><span style=\"color:#9ECBFF\">'Session not found'</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (input.action </span><span style=\"color:#F97583\">===</span><span style=\"color:#9ECBFF\"> 'delete'</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">delete</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`session:${</span><span style=\"color:#E1E4E8\">input</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">sessionId</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> { success: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h3 id=\"user-preferences\">User Preferences</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { kv } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/kv'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { context } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/context'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Request</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> caller</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> req.tana.caller</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">caller) </span><span style=\"color:#F97583\">return</span><span style=\"color:#E1E4E8\"> { error: </span><span style=\"color:#9ECBFF\">'Login required'</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> prefs</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`prefs:${</span><span style=\"color:#E1E4E8\">caller</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">id</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> prefs </span><span style=\"color:#F97583\">||</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    theme: </span><span style=\"color:#9ECBFF\">'dark'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    notifications: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    language: </span><span style=\"color:#9ECBFF\">'en'</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> post</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Request</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> caller</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> req.tana.caller</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">caller) </span><span style=\"color:#F97583\">return</span><span style=\"color:#E1E4E8\"> { error: </span><span style=\"color:#9ECBFF\">'Login required'</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> prefs</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> req.body</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`prefs:${</span><span style=\"color:#E1E4E8\">caller</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">id</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, prefs)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> { success: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h3 id=\"cache-with-prefix\">Cache with Prefix</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { kv } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/kv'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> contract</span><span style=\"color:#E1E4E8\">() {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Cache multiple items</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'cache:api:users'</span><span style=\"color:#E1E4E8\">, [{ id: </span><span style=\"color:#79B8FF\">1</span><span style=\"color:#E1E4E8\"> }, { id: </span><span style=\"color:#79B8FF\">2</span><span style=\"color:#E1E4E8\"> }])</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'cache:api:posts'</span><span style=\"color:#E1E4E8\">, [{ id: </span><span style=\"color:#79B8FF\">1</span><span style=\"color:#E1E4E8\"> }])</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'cache:db:config'</span><span style=\"color:#E1E4E8\">, { host: </span><span style=\"color:#9ECBFF\">'localhost'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // List only cache:api: items</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> apiCache</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">list</span><span style=\"color:#E1E4E8\">({ prefix: </span><span style=\"color:#9ECBFF\">'cache:api:'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(apiCache.keys)</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // [{ name: \"cache:api:posts\" }, { name: \"cache:api:users\" }]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Clear all api cache</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  for</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> key</span><span style=\"color:#F97583\"> of</span><span style=\"color:#E1E4E8\"> apiCache.keys) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">delete</span><span style=\"color:#E1E4E8\">(key.name)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> { cleared: apiCache.keys.</span><span style=\"color:#79B8FF\">length</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><hr>\n<h2 id=\"see-also\">See Also</h2>\n<ul>\n<li><a href=\"/guides/kv-storage\">KV Storage Guide</a> - Usage guide with patterns</li>\n<li><a href=\"/contributing/runtime/modules/kv\">KV Implementation</a> - Technical details</li>\n<li><a href=\"/guides/smart-contracts\">Smart Contracts</a> - Contract development guide</li>\n</ul>\n"
  },
  {
    "slug": [
      "contributing",
      "ledger",
      "intro"
    ],
    "metadata": {
      "title": "Ledger Service",
      "description": "Account and balance management service architecture",
      "sidebar": {
        "order": 1
      }
    },
    "content": "\nThe Tana Ledger is the core account and balance management service for the blockchain. It provides a REST API for user accounts, multi-currency balances, and transaction processing.\n\n## Features\n\n- **User Accounts** - Create and manage user accounts with Ed25519 keys\n- **Team Management** - Team creation, membership, and treasury accounts\n- **Multi-Currency Balances** - Track balances across multiple currencies (USD, EUR, BTC, etc.)\n- **Transaction Processing** - Validate and process transactions through block production\n- **REST API** - HTTP API for all account operations\n\n## Architecture\n\n```\nledger/\n├── src/\n│   ├── index.ts          # Main API server (Hono)\n│   ├── accounts/\n│   │   ├── users.ts      # User account management\n│   │   └── teams.ts      # Team account management\n│   ├── balances/\n│   │   ├── index.ts      # Balance operations\n│   │   └── currencies.ts # Currency management\n│   ├── transactions/\n│   │   ├── index.ts      # Transaction processing\n│   │   └── validator.ts  # Transaction validation\n│   ├── blocks/\n│   │   └── producer.ts   # Block production logic\n│   ├── api/\n│   │   ├── routes/       # API route handlers\n│   │   └── schemas.ts    # Zod validation schemas\n│   └── db/\n│       ├── schema.ts     # Drizzle ORM schema\n│       └── index.ts      # Database connection\n└── drizzle/              # Database migrations\n```\n\n## Development Setup\n\n### Prerequisites\n\n- Bun 1.1.38+\n- PostgreSQL 16\n- Docker (for local development)\n\n### Installation\n\n```bash\ncd ledger\n\n# Install dependencies\nbun install\n\n# Start PostgreSQL (via Docker)\ndocker-compose up -d postgres\n\n# Run database migrations\nbun run db:migrate\n\n# Start development server\nbun run dev\n```\n\nThe API will be available at `http://localhost:8080`.\n\n### Database Migrations\n\n```bash\n# Generate new migration\nbun run db:generate\n\n# Run migrations\nbun run db:migrate\n\n# Drop database (destructive!)\nbun run db:drop\n\n# Push schema changes (development only)\nbun run db:push\n\n# Open Drizzle Studio (GUI)\nbun run db:studio\n```\n\n## Block Production\n\nTransactions in Tana are processed into blocks. During development, you need to manually produce blocks to finalize pending transactions.\n\n### Manual Block Production\n\n```bash\n# From project root:\nnpm run pending    # Process pending transactions\nnpm run block      # Same as above (alias)\n\n# From ledger directory:\nnpm run pending    # Short command\nnpm run blockchain:produce  # Full command name\n```\n\n**When to run:**\n- After creating users (via mobile app or CLI)\n- After submitting transactions\n- When you want to finalize pending operations\n\n**What it does:**\n1. Finds all pending transactions in the database\n2. Executes them (user creation, transfers, contract calls, etc.)\n3. Creates a new block with those transactions\n4. Updates transaction status from \"pending\" → \"confirmed\"\n5. Updates all affected balances and state\n\n**Example output:**\n```\n🔨 Producing new block...\nLatest block: 6\nFound 3 pending transaction(s)\n\nProcessing transaction tx_abc123 (user_creation)...\n  ✓ Created user: @alice (550e8400-e29b-41d4-a716-446655440000)\n\nProcessing transaction tx_def456 (transfer)...\n  ✓ Transferred 100 USD from @alice to @bob\n\nProcessing transaction tx_ghi789 (contract_call)...\n  ✓ Executed contract cnt_myapp\n\n✅ Block produced successfully!\nBlock Details:\n  Height: 7\n  Transactions: 3\n  Gas Used: 63000 / 1000000\n  Block Hash: 0xabc123...\n```\n\n### Automatic Block Production (Future)\n\nIn production, blocks will be produced automatically at regular intervals (e.g., every 6 seconds) by a background worker or consensus mechanism. This is not yet implemented.\n\n## API Endpoints\n\n### Users\n\n```\nGET  /users               # List all users\nPOST /users               # Create new user\nGET  /users/:id           # Get user by ID\nGET  /users/username/:username  # Get user by username\nPATCH /users/:id          # Update user\nDELETE /users/:id         # Delete user\nGET  /users/:id/balances  # Get user balances\n```\n\n### Balances\n\n```\nGET  /balances            # List all balances\nPOST /balances            # Set balance (admin)\nGET  /balances/:id        # Get specific balance\n```\n\n### Transactions\n\n```\nGET  /transactions        # List all transactions\nPOST /transactions        # Create transaction\nGET  /transactions/:id    # Get transaction details\n```\n\n### Blocks\n\n```\nGET  /blocks              # List all blocks\nGET  /blocks/:height      # Get block by height\nGET  /blocks/latest       # Get latest block\n```\n\n### Contracts\n\n```\nGET  /contracts           # List all contracts\nPOST /contracts           # Deploy contract\nGET  /contracts/:id       # Get contract details\n```\n\n## Environment Variables\n\n```env\n# Server Configuration\nPORT=8080\nNODE_ENV=development\n\n# Database\nDATABASE_URL=postgres://tana:tana_dev_password@localhost:5432/tana\n\n# CORS (for playground integration)\nALLOWED_ORIGINS=http://localhost:3000,http://localhost:4321\n\n# Ledger URL (for consistency with other services)\nTANA_LEDGER_URL=http://localhost:8080\n```\n\nSee [Environment Variables](/contributing/env-vars/) for more details.\n\n## Database Schema\n\nThe ledger uses PostgreSQL with Drizzle ORM. Key tables:\n\n**users** - User accounts\n- `id` (UUID, primary key)\n- `username` (unique, must start with @)\n- `publicKey` (Ed25519 public key)\n- `displayName`, `bio`, `avatarData`\n\n**balances** - Account balances\n- `id` (UUID, primary key)\n- `ownerId` (references account)\n- `ownerType` (user, team, contract, system)\n- `amount` (numeric, precise to 8 decimals)\n- `currencyCode` (USD, EUR, BTC, etc.)\n\n**transactions** - All blockchain transactions\n- `id` (UUID, primary key)\n- `type` (user_creation, transfer, contract_call, etc.)\n- `from`, `to` (account references)\n- `amount`, `currencyCode`\n- `status` (pending, confirmed, failed)\n- `blockHeight` (null if pending)\n\n**blocks** - Blockchain blocks\n- `height` (bigint, primary key)\n- `hash` (unique block hash)\n- `timestamp`\n- `gasLimit`, `gasUsed`\n- `transactionCount`\n\n**contracts** - Deployed smart contracts\n- `id` (UUID, primary key)\n- `deployedBy` (user reference)\n- `codeHash` (contract code hash)\n- `storageRoot` (contract storage root)\n\n## Testing\n\n```bash\n# Run all tests\nbun test\n\n# Run specific test file\nbun test src/accounts/users.test.ts\n\n# Watch mode\nbun test --watch\n```\n\n## Building for Production\n\n```bash\n# Build TypeScript\nbun run build\n\n# Output in dist/\nls dist/\n\n# Run production build\nNODE_ENV=production bun dist/index.js\n```\n\n## Deployment\n\nSee the [Production Deployment](/guides/deployment/) guide for deploying the ledger service.\n\nKey points:\n- Use Docker for consistent environments\n- Set `DATABASE_URL` for PostgreSQL connection\n- Configure `ALLOWED_ORIGINS` for CORS\n- Set up Nginx reverse proxy with SSL\n- Enable automated backups\n- Monitor with health checks\n\n## Related Documentation\n\n- [Environment Variables](/contributing/env-vars/) - Configuration\n- [Block Production](/contributing/ledger/blocks/) - Block production details\n- [Transactions](/contributing/ledger/transactions/) - Transaction processing\n- [API Reference](/tana-api/intro/) - Complete API documentation\n- [Deployment Guide](/guides/deployment/) - Production deployment\n",
    "html": "<p>The Tana Ledger is the core account and balance management service for the blockchain. It provides a REST API for user accounts, multi-currency balances, and transaction processing.</p>\n<h2 id=\"features\">Features</h2>\n<ul>\n<li><strong>User Accounts</strong> - Create and manage user accounts with Ed25519 keys</li>\n<li><strong>Team Management</strong> - Team creation, membership, and treasury accounts</li>\n<li><strong>Multi-Currency Balances</strong> - Track balances across multiple currencies (USD, EUR, BTC, etc.)</li>\n<li><strong>Transaction Processing</strong> - Validate and process transactions through block production</li>\n<li><strong>REST API</strong> - HTTP API for all account operations</li>\n</ul>\n<h2 id=\"architecture\">Architecture</h2>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>ledger/</span></span>\n<span class=\"line\"><span>├── src/</span></span>\n<span class=\"line\"><span>│   ├── index.ts          # Main API server (Hono)</span></span>\n<span class=\"line\"><span>│   ├── accounts/</span></span>\n<span class=\"line\"><span>│   │   ├── users.ts      # User account management</span></span>\n<span class=\"line\"><span>│   │   └── teams.ts      # Team account management</span></span>\n<span class=\"line\"><span>│   ├── balances/</span></span>\n<span class=\"line\"><span>│   │   ├── index.ts      # Balance operations</span></span>\n<span class=\"line\"><span>│   │   └── currencies.ts # Currency management</span></span>\n<span class=\"line\"><span>│   ├── transactions/</span></span>\n<span class=\"line\"><span>│   │   ├── index.ts      # Transaction processing</span></span>\n<span class=\"line\"><span>│   │   └── validator.ts  # Transaction validation</span></span>\n<span class=\"line\"><span>│   ├── blocks/</span></span>\n<span class=\"line\"><span>│   │   └── producer.ts   # Block production logic</span></span>\n<span class=\"line\"><span>│   ├── api/</span></span>\n<span class=\"line\"><span>│   │   ├── routes/       # API route handlers</span></span>\n<span class=\"line\"><span>│   │   └── schemas.ts    # Zod validation schemas</span></span>\n<span class=\"line\"><span>│   └── db/</span></span>\n<span class=\"line\"><span>│       ├── schema.ts     # Drizzle ORM schema</span></span>\n<span class=\"line\"><span>│       └── index.ts      # Database connection</span></span>\n<span class=\"line\"><span>└── drizzle/              # Database migrations</span></span></code></pre>\n</code></pre><h2 id=\"development-setup\">Development Setup</h2>\n<h3 id=\"prerequisites\">Prerequisites</h3>\n<ul>\n<li>Bun 1.1.38+</li>\n<li>PostgreSQL 16</li>\n<li>Docker (for local development)</li>\n</ul>\n<h3 id=\"installation\">Installation</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#79B8FF\">cd</span><span style=\"color:#9ECBFF\"> ledger</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Install dependencies</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> install</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Start PostgreSQL (via Docker)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker-compose</span><span style=\"color:#9ECBFF\"> up</span><span style=\"color:#79B8FF\"> -d</span><span style=\"color:#9ECBFF\"> postgres</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Run database migrations</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> db:migrate</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Start development server</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> dev</span></span></code></pre>\n</code></pre><p>The API will be available at <code>http://localhost:8080</code>.</p>\n<h3 id=\"database-migrations\">Database Migrations</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Generate new migration</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> db:generate</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Run migrations</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> db:migrate</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Drop database (destructive!)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> db:drop</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Push schema changes (development only)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> db:push</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Open Drizzle Studio (GUI)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> db:studio</span></span></code></pre>\n</code></pre><h2 id=\"block-production\">Block Production</h2>\n<p>Transactions in Tana are processed into blocks. During development, you need to manually produce blocks to finalize pending transactions.</p>\n<h3 id=\"manual-block-production\">Manual Block Production</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># From project root:</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> pending</span><span style=\"color:#6A737D\">    # Process pending transactions</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> block</span><span style=\"color:#6A737D\">      # Same as above (alias)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># From ledger directory:</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> pending</span><span style=\"color:#6A737D\">    # Short command</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> blockchain:produce</span><span style=\"color:#6A737D\">  # Full command name</span></span></code></pre>\n</code></pre><p><strong>When to run:</strong></p>\n<ul>\n<li>After creating users (via mobile app or CLI)</li>\n<li>After submitting transactions</li>\n<li>When you want to finalize pending operations</li>\n</ul>\n<p><strong>What it does:</strong></p>\n<ol>\n<li>Finds all pending transactions in the database</li>\n<li>Executes them (user creation, transfers, contract calls, etc.)</li>\n<li>Creates a new block with those transactions</li>\n<li>Updates transaction status from &quot;pending&quot; → &quot;confirmed&quot;</li>\n<li>Updates all affected balances and state</li>\n</ol>\n<p><strong>Example output:</strong></p>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>🔨 Producing new block...</span></span>\n<span class=\"line\"><span>Latest block: 6</span></span>\n<span class=\"line\"><span>Found 3 pending transaction(s)</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>Processing transaction tx_abc123 (user_creation)...</span></span>\n<span class=\"line\"><span>  ✓ Created user: @alice (550e8400-e29b-41d4-a716-446655440000)</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>Processing transaction tx_def456 (transfer)...</span></span>\n<span class=\"line\"><span>  ✓ Transferred 100 USD from @alice to @bob</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>Processing transaction tx_ghi789 (contract_call)...</span></span>\n<span class=\"line\"><span>  ✓ Executed contract cnt_myapp</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>✅ Block produced successfully!</span></span>\n<span class=\"line\"><span>Block Details:</span></span>\n<span class=\"line\"><span>  Height: 7</span></span>\n<span class=\"line\"><span>  Transactions: 3</span></span>\n<span class=\"line\"><span>  Gas Used: 63000 / 1000000</span></span>\n<span class=\"line\"><span>  Block Hash: 0xabc123...</span></span></code></pre>\n</code></pre><h3 id=\"automatic-block-production-future\">Automatic Block Production (Future)</h3>\n<p>In production, blocks will be produced automatically at regular intervals (e.g., every 6 seconds) by a background worker or consensus mechanism. This is not yet implemented.</p>\n<h2 id=\"api-endpoints\">API Endpoints</h2>\n<h3 id=\"users\">Users</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>GET  /users               # List all users</span></span>\n<span class=\"line\"><span>POST /users               # Create new user</span></span>\n<span class=\"line\"><span>GET  /users/:id           # Get user by ID</span></span>\n<span class=\"line\"><span>GET  /users/username/:username  # Get user by username</span></span>\n<span class=\"line\"><span>PATCH /users/:id          # Update user</span></span>\n<span class=\"line\"><span>DELETE /users/:id         # Delete user</span></span>\n<span class=\"line\"><span>GET  /users/:id/balances  # Get user balances</span></span></code></pre>\n</code></pre><h3 id=\"balances\">Balances</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>GET  /balances            # List all balances</span></span>\n<span class=\"line\"><span>POST /balances            # Set balance (admin)</span></span>\n<span class=\"line\"><span>GET  /balances/:id        # Get specific balance</span></span></code></pre>\n</code></pre><h3 id=\"transactions\">Transactions</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>GET  /transactions        # List all transactions</span></span>\n<span class=\"line\"><span>POST /transactions        # Create transaction</span></span>\n<span class=\"line\"><span>GET  /transactions/:id    # Get transaction details</span></span></code></pre>\n</code></pre><h3 id=\"blocks\">Blocks</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>GET  /blocks              # List all blocks</span></span>\n<span class=\"line\"><span>GET  /blocks/:height      # Get block by height</span></span>\n<span class=\"line\"><span>GET  /blocks/latest       # Get latest block</span></span></code></pre>\n</code></pre><h3 id=\"contracts\">Contracts</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>GET  /contracts           # List all contracts</span></span>\n<span class=\"line\"><span>POST /contracts           # Deploy contract</span></span>\n<span class=\"line\"><span>GET  /contracts/:id       # Get contract details</span></span></code></pre>\n</code></pre><h2 id=\"environment-variables\">Environment Variables</h2>\n<pre><code class=\"language-env\"># Server Configuration\nPORT=8080\nNODE_ENV=development\n\n# Database\nDATABASE_URL=postgres://tana:tana_dev_password@localhost:5432/tana\n\n# CORS (for playground integration)\nALLOWED_ORIGINS=http://localhost:3000,http://localhost:4321\n\n# Ledger URL (for consistency with other services)\nTANA_LEDGER_URL=http://localhost:8080\n</code></pre><p>See <a href=\"/contributing/env-vars/\">Environment Variables</a> for more details.</p>\n<h2 id=\"database-schema\">Database Schema</h2>\n<p>The ledger uses PostgreSQL with Drizzle ORM. Key tables:</p>\n<p><strong>users</strong> - User accounts</p>\n<ul>\n<li><code>id</code> (UUID, primary key)</li>\n<li><code>username</code> (unique, must start with @)</li>\n<li><code>publicKey</code> (Ed25519 public key)</li>\n<li><code>displayName</code>, <code>bio</code>, <code>avatarData</code></li>\n</ul>\n<p><strong>balances</strong> - Account balances</p>\n<ul>\n<li><code>id</code> (UUID, primary key)</li>\n<li><code>ownerId</code> (references account)</li>\n<li><code>ownerType</code> (user, team, contract, system)</li>\n<li><code>amount</code> (numeric, precise to 8 decimals)</li>\n<li><code>currencyCode</code> (USD, EUR, BTC, etc.)</li>\n</ul>\n<p><strong>transactions</strong> - All blockchain transactions</p>\n<ul>\n<li><code>id</code> (UUID, primary key)</li>\n<li><code>type</code> (user_creation, transfer, contract_call, etc.)</li>\n<li><code>from</code>, <code>to</code> (account references)</li>\n<li><code>amount</code>, <code>currencyCode</code></li>\n<li><code>status</code> (pending, confirmed, failed)</li>\n<li><code>blockHeight</code> (null if pending)</li>\n</ul>\n<p><strong>blocks</strong> - Blockchain blocks</p>\n<ul>\n<li><code>height</code> (bigint, primary key)</li>\n<li><code>hash</code> (unique block hash)</li>\n<li><code>timestamp</code></li>\n<li><code>gasLimit</code>, <code>gasUsed</code></li>\n<li><code>transactionCount</code></li>\n</ul>\n<p><strong>contracts</strong> - Deployed smart contracts</p>\n<ul>\n<li><code>id</code> (UUID, primary key)</li>\n<li><code>deployedBy</code> (user reference)</li>\n<li><code>codeHash</code> (contract code hash)</li>\n<li><code>storageRoot</code> (contract storage root)</li>\n</ul>\n<h2 id=\"testing\">Testing</h2>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Run all tests</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> test</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Run specific test file</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> test</span><span style=\"color:#9ECBFF\"> src/accounts/users.test.ts</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Watch mode</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> test</span><span style=\"color:#79B8FF\"> --watch</span></span></code></pre>\n</code></pre><h2 id=\"building-for-production\">Building for Production</h2>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Build TypeScript</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> build</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Output in dist/</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">ls</span><span style=\"color:#9ECBFF\"> dist/</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Run production build</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">NODE_ENV</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">production</span><span style=\"color:#B392F0\"> bun</span><span style=\"color:#9ECBFF\"> dist/index.js</span></span></code></pre>\n</code></pre><h2 id=\"deployment\">Deployment</h2>\n<p>See the <a href=\"/guides/deployment/\">Production Deployment</a> guide for deploying the ledger service.</p>\n<p>Key points:</p>\n<ul>\n<li>Use Docker for consistent environments</li>\n<li>Set <code>DATABASE_URL</code> for PostgreSQL connection</li>\n<li>Configure <code>ALLOWED_ORIGINS</code> for CORS</li>\n<li>Set up Nginx reverse proxy with SSL</li>\n<li>Enable automated backups</li>\n<li>Monitor with health checks</li>\n</ul>\n<h2 id=\"related-documentation\">Related Documentation</h2>\n<ul>\n<li><a href=\"/contributing/env-vars/\">Environment Variables</a> - Configuration</li>\n<li><a href=\"/contributing/ledger/blocks/\">Block Production</a> - Block production details</li>\n<li><a href=\"/contributing/ledger/transactions/\">Transactions</a> - Transaction processing</li>\n<li><a href=\"/tana-api/intro/\">API Reference</a> - Complete API documentation</li>\n<li><a href=\"/guides/deployment/\">Deployment Guide</a> - Production deployment</li>\n</ul>\n"
  },
  {
    "slug": [
      "contributing",
      "architecture"
    ],
    "metadata": {
      "title": "System Architecture",
      "description": "Learn how Tana's components work together"
    },
    "content": "\n## Overview\n\nTana consists of **three compiled binaries** and integrated services working together to provide a complete blockchain platform.\n\n## Binary Structure\n\n### 1. `tana-cli` (CLI Binary)\n\n- **Built from:** `cli/` directory (TypeScript/Bun)\n- **Compiled with:** `bun build --compile`\n- **Purpose:** Main user interface and orchestrator\n\n**Contains:**\n- All commands (`new`, `deploy`, `start`, `stop`, `status`)\n- Configuration management (`~/.config/tana/`)\n- Service spawning and process management\n- Network communication\n- Most business logic\n\n### 2. `tana-runtime` (Execution Binary)\n\n- **Built from:** `runtime/` directory (Rust)\n- **Compiled with:** `cargo build --release`\n- **Purpose:** Sandboxed TypeScript contract execution for CLI\n- **Invoked by:** CLI when running contracts locally\n- **Not persistent:** One-shot execution per contract run\n\n### 3. `tana-edge` (Edge Server Binary)\n\n- **Built from:** `tana-edge/` directory (Rust)\n- **Compiled with:** `cargo build --release`\n- **Purpose:** High-performance HTTP server for off-chain contract execution\n- **Port:** 8180 (default)\n- **Persistent:** Runs as long-lived HTTP service\n- **Features:**\n  - GET/POST endpoints for smart contracts\n  - Fresh V8 isolate per request (Cloudflare Workers-style)\n  - Sub-100ms latency for blockchain queries\n  - Production-ready with subdomain routing\n  - Accesses ledger API for blockchain data\n\n## Integrated Services\n\n### Ledger Service\n\n- **Location:** `cli/services/ledger`\n- **Built into:** The `tana` CLI binary\n- **Started with:** `tana start` command\n- **Purpose:** Blockchain state management (users, balances, transactions, blocks)\n- **Port:** 8080\n- **Persistent:** Runs until Ctrl+C or `tana stop`\n\n**Stack:** TypeScript/Bun, Hono, Drizzle ORM, PostgreSQL\n\n**Responsibilities:**\n- User/Team account management\n- Multi-currency balance tracking\n- Transaction validation\n- Block storage and queries\n- REST API for all blockchain data\n\n### Queue Service\n\n- **Location:** `cli/services/queue`\n- **Package:** `@tana/queue` (independent workspace)\n- **Purpose:** High-performance transaction queue using Redis Streams\n- **Shared by:** All validators for distributed block production\n\n**Stack:** TypeScript/Bun, ioredis\n\n**Responsibilities:**\n- Transaction queueing with O(1) submission (100,000+ tx/sec)\n- Consumer groups for distributed validators\n- Exactly-once processing with XACK\n- Deterministic transaction ordering via Stream IDs\n- Pub/Sub notifications for instant updates\n\n### Identity Service\n\n- **Location:** `cli/services/identity`\n- **Package:** `@tana/identity` (independent workspace)\n- **Purpose:** User authentication and session management (NOT blockchain data)\n- **Port:** 8090\n- **Database:** Separate PostgreSQL tables (not replicated across validators)\n\n**Stack:** TypeScript/Bun, Hono, Drizzle ORM, PostgreSQL\n\n**Responsibilities:**\n- Mobile-first QR code authentication (like WhatsApp Web)\n- Session management with real-time updates (Server-Sent Events)\n- Device token management for push notifications\n- Transaction approval workflow for mobile apps\n- Secure authentication without exposing private keys to desktop/laptop\n\n**Security Model:**\n- Private keys ONLY exist on mobile devices (hardware security)\n- Desktop/laptop computers receive session tokens only (read-only interface)\n- No MetaMask-style browser extensions (protects against malware)\n- Ed25519 signature verification for all approvals\n\n## Data Flow\n\n### Contract Deployment Flow\n\n```\nUser runs: tana deploy contract\n          ↓\n    [tana CLI binary]\n          ↓\n    1. Read config from ~/.config/tana/\n    2. Determine deployment target (local/remote)\n    3. Sign transaction with Ed25519\n    4. Validate contract code\n          ↓\n    [Ledger API] ← HTTP POST /contracts\n          ↓\n    1. Verify signature\n    2. Create transaction\n    3. Queue to Redis Streams\n          ↓\n    [Redis Queue Service] ← XADD\n          ↓\n    [Block Producer] ← XREADGROUP (consumer)\n          ↓\n    1. Consume pending transactions\n    2. Sort by Stream ID (deterministic ordering)\n    3. Execute transactions\n    4. Create new block\n    5. XACK processed transactions\n          ↓\n    [tana-runtime binary] ← Execute contracts\n          ↓\n    Return state changes\n          ↓\n    [Ledger Service] ← Commit to PostgreSQL\n```\n\n### Authentication Flow (Mobile QR Login)\n\n```\nUser clicks \"Login\" on website\n          ↓\n    [Website] ← POST /auth/session/create\n          ↓\n    [Identity Service] creates session\n          ↓\n    Returns: sessionId + challenge + QR data\n          ↓\n    [Website] displays QR code\n    [Website] opens SSE connection (/auth/session/:id/events)\n          ↓\n    [User scans QR with mobile app]\n          ↓\n    [Mobile App] ← GET /auth/session/:id\n          ↓\n    [Identity Service] marks as \"scanned\"\n          ↓\n    [SSE] → \"scanned\" event to website\n          ↓\n    [User approves on mobile]\n          ↓\n    [Mobile App] signs challenge with Ed25519\n    [Mobile App] ← POST /auth/session/:id/approve\n          ↓\n    [Identity Service] verifies signature\n    [Identity Service] generates session token\n          ↓\n    [SSE] → \"approved\" event with token to website\n          ↓\n    [Website] receives session token\n    [Website] redirects to app with authentication\n```\n\n## Configuration Structure\n\n### Global Configuration\n\n```\n~/.config/tana/\n├── config.json              # Global settings (default chain, user)\n├── chains/\n│   ├── local.json          # Local chain config\n│   └── mainnet.json        # Remote chain configs\n├── nodes/\n│   └── node-xyz.json       # Node participation configs\n└── users/\n    └── alice.json          # User credentials (keys)\n```\n\n### Project Structure\n\n```\nmy-app/\n├── contract.ts             # Contract code\n└── contract.json           # Contract metadata\n```\n\n## Component Details\n\n### Ledger Service (Port 8080)\n\n**Endpoints:**\n- `GET /health` - Health check\n- `GET /users` - List users\n- `POST /users` - Create user\n- `GET /balances` - Query balances\n- `POST /balances` - Set balance\n- `GET /transactions` - List transactions\n- `POST /transactions` - Create transaction (queues to Redis)\n- `GET /blocks` - Query blocks\n- `POST /blocks` - Create block\n- `GET /contracts` - List contracts\n- `POST /contracts` - Deploy contract\n\n**Database Tables:**\n- `users` - User accounts\n- `balances` - Multi-currency balances\n- `transactions` - Transaction history (confirmed only)\n- `currencies` - Supported currencies\n- `blocks` - Blockchain blocks\n- `contracts` - Deployed smart contracts\n\n### Identity Service (Port 8090)\n\n**Endpoints:**\n- `GET /health` - Health check\n- `POST /auth/session/create` - Create QR code authentication session\n- `GET /auth/session/:id` - Get session details (mobile app scans QR)\n- `GET /auth/session/:id/events` - SSE stream for real-time session updates\n- `POST /auth/session/:id/approve` - Mobile app approves login with signature\n- `POST /auth/session/:id/reject` - Mobile app rejects login\n- `POST /auth/session/validate` - Validate session token\n\n**Database Tables (Separate from blockchain):**\n- `auth_sessions` - QR code login sessions with status tracking\n- `transaction_requests` - Pending transaction approvals from mobile\n- `device_tokens` - Push notification tokens for mobile devices\n\n**Authentication Flow:**\n1. Website creates session with `/auth/session/create` → receives session ID + challenge\n2. Website displays QR code with session data\n3. Website opens SSE connection to `/auth/session/:id/events` for real-time updates\n4. Mobile app scans QR → calls `/auth/session/:id` → marks as \"scanned\"\n5. User approves on mobile → signs challenge with Ed25519 private key\n6. Mobile calls `/auth/session/:id/approve` with signature\n7. SSE stream notifies website → session approved with token\n8. Website receives session token for subsequent authenticated requests\n\n### Rust Runtime\n\n**Purpose:** Sandboxed V8 TypeScript execution engine\n\n- Execute smart contracts in isolated environment\n- No network access, filesystem, or system calls\n- Deterministic execution\n- Gas metering\n\n**Modules Provided:**\n- `tana/core` - Console, version info\n- `tana/utils` - Whitelisted fetch API\n- `tana/block` - Block context (height, timestamp, executor, gas)\n- `tana/tx` - Transaction staging and execution\n\n## Monorepo Structure\n\n```\ntana/                        # Monorepo root\n├── runtime/                 # Rust - V8 TypeScript execution engine\n│   ├── src/                 # Rust source (deno_core)\n│   └── Cargo.toml\n│\n├── tana-edge/               # Rust - High-performance edge server\n│   ├── src/                 # Rust source (Actix Web + V8)\n│   └── Cargo.toml\n│\n├── cli/                     # TypeScript/Bun - Command-line tools\n│   ├── core/                # Core commands and logic\n│   ├── services/            # Integrated services\n│   │   ├── ledger/          # @tana/ledger - Blockchain state (port 8080)\n│   │   ├── queue/           # @tana/queue - Redis transaction queue\n│   │   └── identity/        # @tana/identity - Authentication (port 8090)\n│   └── package.json\n│\n├── websites/                # Web applications\n│   ├── playground/          # Interactive contract playground\n│   ├── landing/             # Landing page\n│   └── docs/                # Documentation site (you are here!)\n│\n├── types/                   # Shared TypeScript type definitions\n│   ├── tana-core.d.ts\n│   ├── tana-data.d.ts\n│   ├── tana-utils.d.ts\n│   ├── tana-block.d.ts\n│   └── tana-tx.d.ts\n│\n├── examples/                # Example smart contracts\n├── docs/                    # Technical documentation (markdown)\n├── mprocs.yaml              # Multi-process configuration\n└── package.json             # Workspace management\n```\n\n## Development Workflow\n\n### Database Setup\n\nPostgreSQL stores both blockchain data and authentication data in separate tables:\n\n#### Blockchain Tables (Ledger Service)\n\n```sql\n-- Users\nCREATE TABLE users (\n  id TEXT PRIMARY KEY,\n  username TEXT UNIQUE,\n  display_name TEXT,\n  public_key TEXT,\n  nonce INTEGER DEFAULT 0,\n  bio TEXT,\n  created_at TIMESTAMP\n);\n\n-- Balances\nCREATE TABLE balances (\n  owner_id TEXT,\n  owner_type TEXT,\n  currency_code TEXT,\n  amount TEXT,\n  updated_at TIMESTAMP\n);\n\n-- Transactions (confirmed only - pending in Redis queue)\nCREATE TABLE transactions (\n  id TEXT PRIMARY KEY,\n  from_id TEXT,\n  to_id TEXT,\n  amount TEXT,\n  currency_code TEXT,\n  type TEXT,\n  status TEXT,\n  metadata JSONB,\n  created_at TIMESTAMP,\n  confirmed_at TIMESTAMP\n);\n\n-- Blocks\nCREATE TABLE blocks (\n  height INTEGER PRIMARY KEY,\n  hash TEXT,\n  parent_hash TEXT,\n  state_root TEXT,\n  timestamp TIMESTAMP,\n  producer TEXT,\n  transactions JSONB\n);\n\n-- Contracts\nCREATE TABLE contracts (\n  id TEXT PRIMARY KEY,\n  code TEXT,\n  code_hash TEXT,\n  owner_id TEXT,\n  created_at TIMESTAMP\n);\n```\n\n#### Authentication Tables (Identity Service)\n\n**Note:** These tables are separate from blockchain data and NOT replicated across validators.\n\n```sql\n-- Auth Sessions (QR code login)\nCREATE TABLE auth_sessions (\n  id TEXT PRIMARY KEY,\n  challenge TEXT NOT NULL UNIQUE,\n  status auth_session_status NOT NULL DEFAULT 'waiting',\n  user_id TEXT,\n  username TEXT,\n  public_key TEXT,\n  session_token TEXT UNIQUE,\n  return_url TEXT NOT NULL,\n  app_name TEXT,\n  app_icon TEXT,\n  created_at TIMESTAMP NOT NULL DEFAULT NOW(),\n  expires_at TIMESTAMP NOT NULL,\n  approved_at TIMESTAMP,\n  scanned_at TIMESTAMP\n);\n\n-- Transaction Requests (mobile approval)\nCREATE TABLE transaction_requests (\n  id TEXT PRIMARY KEY,\n  session_id TEXT NOT NULL REFERENCES auth_sessions(id),\n  user_id TEXT NOT NULL,\n  transaction_type TEXT NOT NULL,\n  transaction_data TEXT NOT NULL,\n  status transaction_request_status NOT NULL DEFAULT 'pending',\n  transaction_id TEXT,\n  created_at TIMESTAMP NOT NULL DEFAULT NOW(),\n  expires_at TIMESTAMP NOT NULL,\n  responded_at TIMESTAMP\n);\n\n-- Device Tokens (push notifications)\nCREATE TABLE device_tokens (\n  id TEXT PRIMARY KEY,\n  user_id TEXT NOT NULL,\n  push_token TEXT NOT NULL UNIQUE,\n  device_name TEXT,\n  platform TEXT,\n  app_version TEXT,\n  is_active TEXT NOT NULL DEFAULT 'true',\n  created_at TIMESTAMP NOT NULL DEFAULT NOW(),\n  last_used_at TIMESTAMP NOT NULL DEFAULT NOW()\n);\n```\n\n### Environment Configuration\n\nAll sensitive configuration is stored in `.env` files:\n\n```bash\n# .env\n\n# Database URLs\nDATABASE_URL='postgres://tana:[PASSWORD]@localhost:5432/tana'\nIDENTITY_DB_URL='postgres://tana:[PASSWORD]@localhost:5432/tana'  # Can use same DB\nREDIS_URL='redis://localhost:6379'\n\n# Service Ports\nPORT=8080                    # Ledger service\nIDENTITY_PORT=8090           # Identity service\nEDGE_PORT=8180              # Edge server (tana-edge)\n\n# Environment\nNODE_ENV=development\n```\n\n**Environment Variable Reference:**\n\n- `DATABASE_URL` - PostgreSQL connection string for blockchain data (ledger service)\n- `IDENTITY_DB_URL` - PostgreSQL connection string for authentication data (identity service)\n  - Can use the same database as `DATABASE_URL` (tables are separate)\n  - Identity data is NOT replicated across validators\n- `REDIS_URL` - Redis connection string for transaction queue\n  - Shared by all validators\n  - Must support Redis Streams\n- `PORT` - HTTP port for ledger service API (default: 8080)\n- `IDENTITY_PORT` - HTTP port for identity service API (default: 8090)\n- `EDGE_PORT` - HTTP port for edge server (default: 8180)\n\n## Security Model\n\n### Sandbox Isolation\n\nThe Rust runtime provides complete isolation:\n\n- No filesystem access\n- No network access (except whitelisted fetch via `tana/utils`)\n- No process spawning\n- No system calls\n- Memory limits enforced\n- Gas metering for execution costs\n\n### API Security\n\n- CORS enabled for allowed origins\n- Rate limiting on all endpoints\n- Input validation with Zod schemas\n- SQL injection protection via Drizzle ORM\n- Environment-based configuration\n\n## Deployment Architecture\n\n### Development\n\n```\nmprocs → Multiple services in one terminal\n  ├── PostgreSQL (Docker) - Blockchain + Auth data\n  ├── Redis (Docker) - Transaction queue\n  ├── Ledger Service (Bun:8080) - Blockchain API\n  ├── Identity Service (Bun:8090) - Authentication API\n  ├── Edge Server (Rust:8180) - Contract execution\n  └── Docs/Playground (Astro/Node)\n```\n\n### Production - Single Node\n\n```\nSingle VPS:\n  ├── Nginx (Reverse proxy, SSL)\n  │   ├── /api → Ledger Service (8080)\n  │   ├── /auth → Identity Service (8090)\n  │   └── /edge → Edge Server (8180)\n  ├── Docker Compose\n  │   ├── Ledger Service (port 8080)\n  │   ├── Identity Service (port 8090)\n  │   ├── PostgreSQL (blockchain + auth)\n  │   └── Redis (transaction queue)\n  ├── tana-runtime (Binary)\n  └── tana-edge (Binary on 8180)\n```\n\n### Production - Multi-Validator Network\n\n```\nNetwork Topology:\n\n[Queue Service Node]\n  └── Redis (shared by all validators)\n\n[Validator Node 1]\n  ├── PostgreSQL (own copy)\n  ├── Ledger Service (8080)\n  └── Block Producer (consumes from shared Redis)\n\n[Validator Node 2]\n  ├── PostgreSQL (own copy)\n  ├── Ledger Service (8080)\n  └── Block Producer (consumes from shared Redis)\n\n[API Node] (public-facing, read-only)\n  ├── PostgreSQL (synced via consensus)\n  ├── Ledger Service (8080)\n  ├── Identity Service (8090)\n  └── Edge Server (8180)\n\n[Mobile App]\n  └── Connects to Identity Service for auth\n```\n\n**Key Points:**\n- Each validator runs its own PostgreSQL (database replication via blockchain consensus)\n- Redis queue is shared by all validators\n- Identity service typically runs on API nodes (not validators)\n- Mobile apps connect to identity service for authentication\n- Deterministic transaction ordering ensures consensus\n\n## Next Steps\n\n- [Quick Start Guide](/guides/quickstart/) - Set up your development environment\n- [CLI Reference](/tana-cli/intro/) - Learn the CLI commands\n- [API Reference](/tana-api/intro/) - Explore the REST API\n",
    "html": "<h2 id=\"overview\">Overview</h2>\n<p>Tana consists of <strong>three compiled binaries</strong> and integrated services working together to provide a complete blockchain platform.</p>\n<h2 id=\"binary-structure\">Binary Structure</h2>\n<h3 id=\"1-tana-cli-cli-binary\">1. <code>tana-cli</code> (CLI Binary)</h3>\n<ul>\n<li><strong>Built from:</strong> <code>cli/</code> directory (TypeScript/Bun)</li>\n<li><strong>Compiled with:</strong> <code>bun build --compile</code></li>\n<li><strong>Purpose:</strong> Main user interface and orchestrator</li>\n</ul>\n<p><strong>Contains:</strong></p>\n<ul>\n<li>All commands (<code>new</code>, <code>deploy</code>, <code>start</code>, <code>stop</code>, <code>status</code>)</li>\n<li>Configuration management (<code>~/.config/tana/</code>)</li>\n<li>Service spawning and process management</li>\n<li>Network communication</li>\n<li>Most business logic</li>\n</ul>\n<h3 id=\"2-tana-runtime-execution-binary\">2. <code>tana-runtime</code> (Execution Binary)</h3>\n<ul>\n<li><strong>Built from:</strong> <code>runtime/</code> directory (Rust)</li>\n<li><strong>Compiled with:</strong> <code>cargo build --release</code></li>\n<li><strong>Purpose:</strong> Sandboxed TypeScript contract execution for CLI</li>\n<li><strong>Invoked by:</strong> CLI when running contracts locally</li>\n<li><strong>Not persistent:</strong> One-shot execution per contract run</li>\n</ul>\n<h3 id=\"3-tana-edge-edge-server-binary\">3. <code>tana-edge</code> (Edge Server Binary)</h3>\n<ul>\n<li><strong>Built from:</strong> <code>tana-edge/</code> directory (Rust)</li>\n<li><strong>Compiled with:</strong> <code>cargo build --release</code></li>\n<li><strong>Purpose:</strong> High-performance HTTP server for off-chain contract execution</li>\n<li><strong>Port:</strong> 8180 (default)</li>\n<li><strong>Persistent:</strong> Runs as long-lived HTTP service</li>\n<li><strong>Features:</strong><ul>\n<li>GET/POST endpoints for smart contracts</li>\n<li>Fresh V8 isolate per request (Cloudflare Workers-style)</li>\n<li>Sub-100ms latency for blockchain queries</li>\n<li>Production-ready with subdomain routing</li>\n<li>Accesses ledger API for blockchain data</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"integrated-services\">Integrated Services</h2>\n<h3 id=\"ledger-service\">Ledger Service</h3>\n<ul>\n<li><strong>Location:</strong> <code>cli/services/ledger</code></li>\n<li><strong>Built into:</strong> The <code>tana</code> CLI binary</li>\n<li><strong>Started with:</strong> <code>tana start</code> command</li>\n<li><strong>Purpose:</strong> Blockchain state management (users, balances, transactions, blocks)</li>\n<li><strong>Port:</strong> 8080</li>\n<li><strong>Persistent:</strong> Runs until Ctrl+C or <code>tana stop</code></li>\n</ul>\n<p><strong>Stack:</strong> TypeScript/Bun, Hono, Drizzle ORM, PostgreSQL</p>\n<p><strong>Responsibilities:</strong></p>\n<ul>\n<li>User/Team account management</li>\n<li>Multi-currency balance tracking</li>\n<li>Transaction validation</li>\n<li>Block storage and queries</li>\n<li>REST API for all blockchain data</li>\n</ul>\n<h3 id=\"queue-service\">Queue Service</h3>\n<ul>\n<li><strong>Location:</strong> <code>cli/services/queue</code></li>\n<li><strong>Package:</strong> <code>@tana/queue</code> (independent workspace)</li>\n<li><strong>Purpose:</strong> High-performance transaction queue using Redis Streams</li>\n<li><strong>Shared by:</strong> All validators for distributed block production</li>\n</ul>\n<p><strong>Stack:</strong> TypeScript/Bun, ioredis</p>\n<p><strong>Responsibilities:</strong></p>\n<ul>\n<li>Transaction queueing with O(1) submission (100,000+ tx/sec)</li>\n<li>Consumer groups for distributed validators</li>\n<li>Exactly-once processing with XACK</li>\n<li>Deterministic transaction ordering via Stream IDs</li>\n<li>Pub/Sub notifications for instant updates</li>\n</ul>\n<h3 id=\"identity-service\">Identity Service</h3>\n<ul>\n<li><strong>Location:</strong> <code>cli/services/identity</code></li>\n<li><strong>Package:</strong> <code>@tana/identity</code> (independent workspace)</li>\n<li><strong>Purpose:</strong> User authentication and session management (NOT blockchain data)</li>\n<li><strong>Port:</strong> 8090</li>\n<li><strong>Database:</strong> Separate PostgreSQL tables (not replicated across validators)</li>\n</ul>\n<p><strong>Stack:</strong> TypeScript/Bun, Hono, Drizzle ORM, PostgreSQL</p>\n<p><strong>Responsibilities:</strong></p>\n<ul>\n<li>Mobile-first QR code authentication (like WhatsApp Web)</li>\n<li>Session management with real-time updates (Server-Sent Events)</li>\n<li>Device token management for push notifications</li>\n<li>Transaction approval workflow for mobile apps</li>\n<li>Secure authentication without exposing private keys to desktop/laptop</li>\n</ul>\n<p><strong>Security Model:</strong></p>\n<ul>\n<li>Private keys ONLY exist on mobile devices (hardware security)</li>\n<li>Desktop/laptop computers receive session tokens only (read-only interface)</li>\n<li>No MetaMask-style browser extensions (protects against malware)</li>\n<li>Ed25519 signature verification for all approvals</li>\n</ul>\n<h2 id=\"data-flow\">Data Flow</h2>\n<h3 id=\"contract-deployment-flow\">Contract Deployment Flow</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User runs: tana deploy contract</span></span>\n<span class=\"line\"><span>          ↓</span></span>\n<span class=\"line\"><span>    [tana CLI binary]</span></span>\n<span class=\"line\"><span>          ↓</span></span>\n<span class=\"line\"><span>    1. Read config from ~/.config/tana/</span></span>\n<span class=\"line\"><span>    2. Determine deployment target (local/remote)</span></span>\n<span class=\"line\"><span>    3. Sign transaction with Ed25519</span></span>\n<span class=\"line\"><span>    4. Validate contract code</span></span>\n<span class=\"line\"><span>          ↓</span></span>\n<span class=\"line\"><span>    [Ledger API] ← HTTP POST /contracts</span></span>\n<span class=\"line\"><span>          ↓</span></span>\n<span class=\"line\"><span>    1. Verify signature</span></span>\n<span class=\"line\"><span>    2. Create transaction</span></span>\n<span class=\"line\"><span>    3. Queue to Redis Streams</span></span>\n<span class=\"line\"><span>          ↓</span></span>\n<span class=\"line\"><span>    [Redis Queue Service] ← XADD</span></span>\n<span class=\"line\"><span>          ↓</span></span>\n<span class=\"line\"><span>    [Block Producer] ← XREADGROUP (consumer)</span></span>\n<span class=\"line\"><span>          ↓</span></span>\n<span class=\"line\"><span>    1. Consume pending transactions</span></span>\n<span class=\"line\"><span>    2. Sort by Stream ID (deterministic ordering)</span></span>\n<span class=\"line\"><span>    3. Execute transactions</span></span>\n<span class=\"line\"><span>    4. Create new block</span></span>\n<span class=\"line\"><span>    5. XACK processed transactions</span></span>\n<span class=\"line\"><span>          ↓</span></span>\n<span class=\"line\"><span>    [tana-runtime binary] ← Execute contracts</span></span>\n<span class=\"line\"><span>          ↓</span></span>\n<span class=\"line\"><span>    Return state changes</span></span>\n<span class=\"line\"><span>          ↓</span></span>\n<span class=\"line\"><span>    [Ledger Service] ← Commit to PostgreSQL</span></span></code></pre>\n</code></pre><h3 id=\"authentication-flow-mobile-qr-login\">Authentication Flow (Mobile QR Login)</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User clicks \"Login\" on website</span></span>\n<span class=\"line\"><span>          ↓</span></span>\n<span class=\"line\"><span>    [Website] ← POST /auth/session/create</span></span>\n<span class=\"line\"><span>          ↓</span></span>\n<span class=\"line\"><span>    [Identity Service] creates session</span></span>\n<span class=\"line\"><span>          ↓</span></span>\n<span class=\"line\"><span>    Returns: sessionId + challenge + QR data</span></span>\n<span class=\"line\"><span>          ↓</span></span>\n<span class=\"line\"><span>    [Website] displays QR code</span></span>\n<span class=\"line\"><span>    [Website] opens SSE connection (/auth/session/:id/events)</span></span>\n<span class=\"line\"><span>          ↓</span></span>\n<span class=\"line\"><span>    [User scans QR with mobile app]</span></span>\n<span class=\"line\"><span>          ↓</span></span>\n<span class=\"line\"><span>    [Mobile App] ← GET /auth/session/:id</span></span>\n<span class=\"line\"><span>          ↓</span></span>\n<span class=\"line\"><span>    [Identity Service] marks as \"scanned\"</span></span>\n<span class=\"line\"><span>          ↓</span></span>\n<span class=\"line\"><span>    [SSE] → \"scanned\" event to website</span></span>\n<span class=\"line\"><span>          ↓</span></span>\n<span class=\"line\"><span>    [User approves on mobile]</span></span>\n<span class=\"line\"><span>          ↓</span></span>\n<span class=\"line\"><span>    [Mobile App] signs challenge with Ed25519</span></span>\n<span class=\"line\"><span>    [Mobile App] ← POST /auth/session/:id/approve</span></span>\n<span class=\"line\"><span>          ↓</span></span>\n<span class=\"line\"><span>    [Identity Service] verifies signature</span></span>\n<span class=\"line\"><span>    [Identity Service] generates session token</span></span>\n<span class=\"line\"><span>          ↓</span></span>\n<span class=\"line\"><span>    [SSE] → \"approved\" event with token to website</span></span>\n<span class=\"line\"><span>          ↓</span></span>\n<span class=\"line\"><span>    [Website] receives session token</span></span>\n<span class=\"line\"><span>    [Website] redirects to app with authentication</span></span></code></pre>\n</code></pre><h2 id=\"configuration-structure\">Configuration Structure</h2>\n<h3 id=\"global-configuration\">Global Configuration</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>~/.config/tana/</span></span>\n<span class=\"line\"><span>├── config.json              # Global settings (default chain, user)</span></span>\n<span class=\"line\"><span>├── chains/</span></span>\n<span class=\"line\"><span>│   ├── local.json          # Local chain config</span></span>\n<span class=\"line\"><span>│   └── mainnet.json        # Remote chain configs</span></span>\n<span class=\"line\"><span>├── nodes/</span></span>\n<span class=\"line\"><span>│   └── node-xyz.json       # Node participation configs</span></span>\n<span class=\"line\"><span>└── users/</span></span>\n<span class=\"line\"><span>    └── alice.json          # User credentials (keys)</span></span></code></pre>\n</code></pre><h3 id=\"project-structure\">Project Structure</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>my-app/</span></span>\n<span class=\"line\"><span>├── contract.ts             # Contract code</span></span>\n<span class=\"line\"><span>└── contract.json           # Contract metadata</span></span></code></pre>\n</code></pre><h2 id=\"component-details\">Component Details</h2>\n<h3 id=\"ledger-service-port-8080\">Ledger Service (Port 8080)</h3>\n<p><strong>Endpoints:</strong></p>\n<ul>\n<li><code>GET /health</code> - Health check</li>\n<li><code>GET /users</code> - List users</li>\n<li><code>POST /users</code> - Create user</li>\n<li><code>GET /balances</code> - Query balances</li>\n<li><code>POST /balances</code> - Set balance</li>\n<li><code>GET /transactions</code> - List transactions</li>\n<li><code>POST /transactions</code> - Create transaction (queues to Redis)</li>\n<li><code>GET /blocks</code> - Query blocks</li>\n<li><code>POST /blocks</code> - Create block</li>\n<li><code>GET /contracts</code> - List contracts</li>\n<li><code>POST /contracts</code> - Deploy contract</li>\n</ul>\n<p><strong>Database Tables:</strong></p>\n<ul>\n<li><code>users</code> - User accounts</li>\n<li><code>balances</code> - Multi-currency balances</li>\n<li><code>transactions</code> - Transaction history (confirmed only)</li>\n<li><code>currencies</code> - Supported currencies</li>\n<li><code>blocks</code> - Blockchain blocks</li>\n<li><code>contracts</code> - Deployed smart contracts</li>\n</ul>\n<h3 id=\"identity-service-port-8090\">Identity Service (Port 8090)</h3>\n<p><strong>Endpoints:</strong></p>\n<ul>\n<li><code>GET /health</code> - Health check</li>\n<li><code>POST /auth/session/create</code> - Create QR code authentication session</li>\n<li><code>GET /auth/session/:id</code> - Get session details (mobile app scans QR)</li>\n<li><code>GET /auth/session/:id/events</code> - SSE stream for real-time session updates</li>\n<li><code>POST /auth/session/:id/approve</code> - Mobile app approves login with signature</li>\n<li><code>POST /auth/session/:id/reject</code> - Mobile app rejects login</li>\n<li><code>POST /auth/session/validate</code> - Validate session token</li>\n</ul>\n<p><strong>Database Tables (Separate from blockchain):</strong></p>\n<ul>\n<li><code>auth_sessions</code> - QR code login sessions with status tracking</li>\n<li><code>transaction_requests</code> - Pending transaction approvals from mobile</li>\n<li><code>device_tokens</code> - Push notification tokens for mobile devices</li>\n</ul>\n<p><strong>Authentication Flow:</strong></p>\n<ol>\n<li>Website creates session with <code>/auth/session/create</code> → receives session ID + challenge</li>\n<li>Website displays QR code with session data</li>\n<li>Website opens SSE connection to <code>/auth/session/:id/events</code> for real-time updates</li>\n<li>Mobile app scans QR → calls <code>/auth/session/:id</code> → marks as &quot;scanned&quot;</li>\n<li>User approves on mobile → signs challenge with Ed25519 private key</li>\n<li>Mobile calls <code>/auth/session/:id/approve</code> with signature</li>\n<li>SSE stream notifies website → session approved with token</li>\n<li>Website receives session token for subsequent authenticated requests</li>\n</ol>\n<h3 id=\"rust-runtime\">Rust Runtime</h3>\n<p><strong>Purpose:</strong> Sandboxed V8 TypeScript execution engine</p>\n<ul>\n<li>Execute smart contracts in isolated environment</li>\n<li>No network access, filesystem, or system calls</li>\n<li>Deterministic execution</li>\n<li>Gas metering</li>\n</ul>\n<p><strong>Modules Provided:</strong></p>\n<ul>\n<li><code>tana/core</code> - Console, version info</li>\n<li><code>tana/utils</code> - Whitelisted fetch API</li>\n<li><code>tana/block</code> - Block context (height, timestamp, executor, gas)</li>\n<li><code>tana/tx</code> - Transaction staging and execution</li>\n</ul>\n<h2 id=\"monorepo-structure\">Monorepo Structure</h2>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>tana/                        # Monorepo root</span></span>\n<span class=\"line\"><span>├── runtime/                 # Rust - V8 TypeScript execution engine</span></span>\n<span class=\"line\"><span>│   ├── src/                 # Rust source (deno_core)</span></span>\n<span class=\"line\"><span>│   └── Cargo.toml</span></span>\n<span class=\"line\"><span>│</span></span>\n<span class=\"line\"><span>├── tana-edge/               # Rust - High-performance edge server</span></span>\n<span class=\"line\"><span>│   ├── src/                 # Rust source (Actix Web + V8)</span></span>\n<span class=\"line\"><span>│   └── Cargo.toml</span></span>\n<span class=\"line\"><span>│</span></span>\n<span class=\"line\"><span>├── cli/                     # TypeScript/Bun - Command-line tools</span></span>\n<span class=\"line\"><span>│   ├── core/                # Core commands and logic</span></span>\n<span class=\"line\"><span>│   ├── services/            # Integrated services</span></span>\n<span class=\"line\"><span>│   │   ├── ledger/          # @tana/ledger - Blockchain state (port 8080)</span></span>\n<span class=\"line\"><span>│   │   ├── queue/           # @tana/queue - Redis transaction queue</span></span>\n<span class=\"line\"><span>│   │   └── identity/        # @tana/identity - Authentication (port 8090)</span></span>\n<span class=\"line\"><span>│   └── package.json</span></span>\n<span class=\"line\"><span>│</span></span>\n<span class=\"line\"><span>├── websites/                # Web applications</span></span>\n<span class=\"line\"><span>│   ├── playground/          # Interactive contract playground</span></span>\n<span class=\"line\"><span>│   ├── landing/             # Landing page</span></span>\n<span class=\"line\"><span>│   └── docs/                # Documentation site (you are here!)</span></span>\n<span class=\"line\"><span>│</span></span>\n<span class=\"line\"><span>├── types/                   # Shared TypeScript type definitions</span></span>\n<span class=\"line\"><span>│   ├── tana-core.d.ts</span></span>\n<span class=\"line\"><span>│   ├── tana-data.d.ts</span></span>\n<span class=\"line\"><span>│   ├── tana-utils.d.ts</span></span>\n<span class=\"line\"><span>│   ├── tana-block.d.ts</span></span>\n<span class=\"line\"><span>│   └── tana-tx.d.ts</span></span>\n<span class=\"line\"><span>│</span></span>\n<span class=\"line\"><span>├── examples/                # Example smart contracts</span></span>\n<span class=\"line\"><span>├── docs/                    # Technical documentation (markdown)</span></span>\n<span class=\"line\"><span>├── mprocs.yaml              # Multi-process configuration</span></span>\n<span class=\"line\"><span>└── package.json             # Workspace management</span></span></code></pre>\n</code></pre><h2 id=\"development-workflow\">Development Workflow</h2>\n<h3 id=\"database-setup\">Database Setup</h3>\n<p>PostgreSQL stores both blockchain data and authentication data in separate tables:</p>\n<h4 id=\"blockchain-tables-ledger-service\">Blockchain Tables (Ledger Service)</h4>\n<pre><code class=\"language-sql\">-- Users\nCREATE TABLE users (\n  id TEXT PRIMARY KEY,\n  username TEXT UNIQUE,\n  display_name TEXT,\n  public_key TEXT,\n  nonce INTEGER DEFAULT 0,\n  bio TEXT,\n  created_at TIMESTAMP\n);\n\n-- Balances\nCREATE TABLE balances (\n  owner_id TEXT,\n  owner_type TEXT,\n  currency_code TEXT,\n  amount TEXT,\n  updated_at TIMESTAMP\n);\n\n-- Transactions (confirmed only - pending in Redis queue)\nCREATE TABLE transactions (\n  id TEXT PRIMARY KEY,\n  from_id TEXT,\n  to_id TEXT,\n  amount TEXT,\n  currency_code TEXT,\n  type TEXT,\n  status TEXT,\n  metadata JSONB,\n  created_at TIMESTAMP,\n  confirmed_at TIMESTAMP\n);\n\n-- Blocks\nCREATE TABLE blocks (\n  height INTEGER PRIMARY KEY,\n  hash TEXT,\n  parent_hash TEXT,\n  state_root TEXT,\n  timestamp TIMESTAMP,\n  producer TEXT,\n  transactions JSONB\n);\n\n-- Contracts\nCREATE TABLE contracts (\n  id TEXT PRIMARY KEY,\n  code TEXT,\n  code_hash TEXT,\n  owner_id TEXT,\n  created_at TIMESTAMP\n);\n</code></pre><h4 id=\"authentication-tables-identity-service\">Authentication Tables (Identity Service)</h4>\n<p><strong>Note:</strong> These tables are separate from blockchain data and NOT replicated across validators.</p>\n<pre><code class=\"language-sql\">-- Auth Sessions (QR code login)\nCREATE TABLE auth_sessions (\n  id TEXT PRIMARY KEY,\n  challenge TEXT NOT NULL UNIQUE,\n  status auth_session_status NOT NULL DEFAULT &#39;waiting&#39;,\n  user_id TEXT,\n  username TEXT,\n  public_key TEXT,\n  session_token TEXT UNIQUE,\n  return_url TEXT NOT NULL,\n  app_name TEXT,\n  app_icon TEXT,\n  created_at TIMESTAMP NOT NULL DEFAULT NOW(),\n  expires_at TIMESTAMP NOT NULL,\n  approved_at TIMESTAMP,\n  scanned_at TIMESTAMP\n);\n\n-- Transaction Requests (mobile approval)\nCREATE TABLE transaction_requests (\n  id TEXT PRIMARY KEY,\n  session_id TEXT NOT NULL REFERENCES auth_sessions(id),\n  user_id TEXT NOT NULL,\n  transaction_type TEXT NOT NULL,\n  transaction_data TEXT NOT NULL,\n  status transaction_request_status NOT NULL DEFAULT &#39;pending&#39;,\n  transaction_id TEXT,\n  created_at TIMESTAMP NOT NULL DEFAULT NOW(),\n  expires_at TIMESTAMP NOT NULL,\n  responded_at TIMESTAMP\n);\n\n-- Device Tokens (push notifications)\nCREATE TABLE device_tokens (\n  id TEXT PRIMARY KEY,\n  user_id TEXT NOT NULL,\n  push_token TEXT NOT NULL UNIQUE,\n  device_name TEXT,\n  platform TEXT,\n  app_version TEXT,\n  is_active TEXT NOT NULL DEFAULT &#39;true&#39;,\n  created_at TIMESTAMP NOT NULL DEFAULT NOW(),\n  last_used_at TIMESTAMP NOT NULL DEFAULT NOW()\n);\n</code></pre><h3 id=\"environment-configuration\">Environment Configuration</h3>\n<p>All sensitive configuration is stored in <code>.env</code> files:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># .env</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Database URLs</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">DATABASE_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">'postgres://tana:[PASSWORD]@localhost:5432/tana'</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">IDENTITY_DB_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">'postgres://tana:[PASSWORD]@localhost:5432/tana'</span><span style=\"color:#6A737D\">  # Can use same DB</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">REDIS_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">'redis://localhost:6379'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Service Ports</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">PORT</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">8080</span><span style=\"color:#6A737D\">                    # Ledger service</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">IDENTITY_PORT</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">8090</span><span style=\"color:#6A737D\">           # Identity service</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">EDGE_PORT</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">8180</span><span style=\"color:#6A737D\">              # Edge server (tana-edge)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Environment</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">NODE_ENV</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">development</span></span></code></pre>\n</code></pre><p><strong>Environment Variable Reference:</strong></p>\n<ul>\n<li><code>DATABASE_URL</code> - PostgreSQL connection string for blockchain data (ledger service)</li>\n<li><code>IDENTITY_DB_URL</code> - PostgreSQL connection string for authentication data (identity service)<ul>\n<li>Can use the same database as <code>DATABASE_URL</code> (tables are separate)</li>\n<li>Identity data is NOT replicated across validators</li>\n</ul>\n</li>\n<li><code>REDIS_URL</code> - Redis connection string for transaction queue<ul>\n<li>Shared by all validators</li>\n<li>Must support Redis Streams</li>\n</ul>\n</li>\n<li><code>PORT</code> - HTTP port for ledger service API (default: 8080)</li>\n<li><code>IDENTITY_PORT</code> - HTTP port for identity service API (default: 8090)</li>\n<li><code>EDGE_PORT</code> - HTTP port for edge server (default: 8180)</li>\n</ul>\n<h2 id=\"security-model\">Security Model</h2>\n<h3 id=\"sandbox-isolation\">Sandbox Isolation</h3>\n<p>The Rust runtime provides complete isolation:</p>\n<ul>\n<li>No filesystem access</li>\n<li>No network access (except whitelisted fetch via <code>tana/utils</code>)</li>\n<li>No process spawning</li>\n<li>No system calls</li>\n<li>Memory limits enforced</li>\n<li>Gas metering for execution costs</li>\n</ul>\n<h3 id=\"api-security\">API Security</h3>\n<ul>\n<li>CORS enabled for allowed origins</li>\n<li>Rate limiting on all endpoints</li>\n<li>Input validation with Zod schemas</li>\n<li>SQL injection protection via Drizzle ORM</li>\n<li>Environment-based configuration</li>\n</ul>\n<h2 id=\"deployment-architecture\">Deployment Architecture</h2>\n<h3 id=\"development\">Development</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>mprocs → Multiple services in one terminal</span></span>\n<span class=\"line\"><span>  ├── PostgreSQL (Docker) - Blockchain + Auth data</span></span>\n<span class=\"line\"><span>  ├── Redis (Docker) - Transaction queue</span></span>\n<span class=\"line\"><span>  ├── Ledger Service (Bun:8080) - Blockchain API</span></span>\n<span class=\"line\"><span>  ├── Identity Service (Bun:8090) - Authentication API</span></span>\n<span class=\"line\"><span>  ├── Edge Server (Rust:8180) - Contract execution</span></span>\n<span class=\"line\"><span>  └── Docs/Playground (Astro/Node)</span></span></code></pre>\n</code></pre><h3 id=\"production---single-node\">Production - Single Node</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Single VPS:</span></span>\n<span class=\"line\"><span>  ├── Nginx (Reverse proxy, SSL)</span></span>\n<span class=\"line\"><span>  │   ├── /api → Ledger Service (8080)</span></span>\n<span class=\"line\"><span>  │   ├── /auth → Identity Service (8090)</span></span>\n<span class=\"line\"><span>  │   └── /edge → Edge Server (8180)</span></span>\n<span class=\"line\"><span>  ├── Docker Compose</span></span>\n<span class=\"line\"><span>  │   ├── Ledger Service (port 8080)</span></span>\n<span class=\"line\"><span>  │   ├── Identity Service (port 8090)</span></span>\n<span class=\"line\"><span>  │   ├── PostgreSQL (blockchain + auth)</span></span>\n<span class=\"line\"><span>  │   └── Redis (transaction queue)</span></span>\n<span class=\"line\"><span>  ├── tana-runtime (Binary)</span></span>\n<span class=\"line\"><span>  └── tana-edge (Binary on 8180)</span></span></code></pre>\n</code></pre><h3 id=\"production---multi-validator-network\">Production - Multi-Validator Network</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Network Topology:</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>[Queue Service Node]</span></span>\n<span class=\"line\"><span>  └── Redis (shared by all validators)</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>[Validator Node 1]</span></span>\n<span class=\"line\"><span>  ├── PostgreSQL (own copy)</span></span>\n<span class=\"line\"><span>  ├── Ledger Service (8080)</span></span>\n<span class=\"line\"><span>  └── Block Producer (consumes from shared Redis)</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>[Validator Node 2]</span></span>\n<span class=\"line\"><span>  ├── PostgreSQL (own copy)</span></span>\n<span class=\"line\"><span>  ├── Ledger Service (8080)</span></span>\n<span class=\"line\"><span>  └── Block Producer (consumes from shared Redis)</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>[API Node] (public-facing, read-only)</span></span>\n<span class=\"line\"><span>  ├── PostgreSQL (synced via consensus)</span></span>\n<span class=\"line\"><span>  ├── Ledger Service (8080)</span></span>\n<span class=\"line\"><span>  ├── Identity Service (8090)</span></span>\n<span class=\"line\"><span>  └── Edge Server (8180)</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>[Mobile App]</span></span>\n<span class=\"line\"><span>  └── Connects to Identity Service for auth</span></span></code></pre>\n</code></pre><p><strong>Key Points:</strong></p>\n<ul>\n<li>Each validator runs its own PostgreSQL (database replication via blockchain consensus)</li>\n<li>Redis queue is shared by all validators</li>\n<li>Identity service typically runs on API nodes (not validators)</li>\n<li>Mobile apps connect to identity service for authentication</li>\n<li>Deterministic transaction ordering ensures consensus</li>\n</ul>\n<h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li><a href=\"/guides/quickstart/\">Quick Start Guide</a> - Set up your development environment</li>\n<li><a href=\"/tana-cli/intro/\">CLI Reference</a> - Learn the CLI commands</li>\n<li><a href=\"/tana-api/intro/\">API Reference</a> - Explore the REST API</li>\n</ul>\n"
  },
  {
    "slug": [
      "contributing",
      "core",
      "blocks"
    ],
    "metadata": {
      "title": "Blocks & Blockchain",
      "description": "Understanding Tana's block structure and production"
    },
    "content": "\nBlocks are the fundamental unit of Tana's blockchain, packaging transactions and establishing a tamper-proof history of all state changes.\n\n## Block Structure\n\n### Database Schema\n\n```sql\nCREATE TABLE blocks (\n  -- Block identification\n  height        BIGINT PRIMARY KEY,           -- 0 for genesis, then 1, 2, 3...\n  hash          VARCHAR(64) NOT NULL UNIQUE,  -- SHA256 of block contents\n  parent_hash   VARCHAR(64) NOT NULL,         -- Hash of previous block\n\n  -- Block metadata\n  timestamp     TIMESTAMP NOT NULL,           -- Block creation time\n  producer      UUID NOT NULL,                -- Node/user that produced this block\n\n  -- Block contents\n  transactions  JSONB NOT NULL,               -- Array of transaction IDs\n  state_root    VARCHAR(64) NOT NULL,         -- Merkle root of state\n\n  -- Execution\n  gas_used      BIGINT NOT NULL DEFAULT 0,    -- Total gas consumed\n  gas_limit     BIGINT NOT NULL,              -- Maximum gas allowed\n\n  -- Timestamps\n  created_at    TIMESTAMP NOT NULL DEFAULT NOW()\n);\n```\n\n### TypeScript Interface\n\n```typescript\ninterface Block {\n  // Identity\n  height: number          // Block number (0 = genesis)\n  hash: string           // Block hash\n  previousHash: string   // Previous block hash\n\n  // Metadata\n  timestamp: number      // Unix timestamp (ms)\n  producer: string       // Producer ID\n\n  // Contents\n  transactions: string[] // Array of transaction IDs\n  stateRoot: string      // State merkle root\n\n  // Execution\n  gasUsed: number        // Gas consumed\n  gasLimit: number       // Gas limit\n\n  // Timestamps\n  createdAt: Date\n}\n```\n\n## Genesis Block (Block 0)\n\nThe **genesis block** is block #0 - the first block in the blockchain. It establishes the initial state and network parameters.\n\n### Genesis Block Example\n\n```typescript\n{\n  // Identity\n  height: 0,\n  hash: \"0xa1b2c3d4e5f6...\",\n  previousHash: \"0x0000000000000000000000000000000000000000000000000000000000000000\",\n\n  // Metadata\n  timestamp: 1730678400000,  // Launch date\n  producer: \"tana:genesis\",\n\n  // Contents\n  transactions: [],\n  stateRoot: \"0x...\",\n\n  // Execution\n  gasUsed: 0,\n  gasLimit: 1000000,\n\n  // Genesis metadata\n  metadata: {\n    version: \"0.1.0\",\n    networkName: \"tana\",\n    chainId: 1,\n    genesisMessage: \"Tana blockchain - TypeScript smart contracts\",\n    blockTime: 6000,  // 6 second blocks\n  }\n}\n```\n\n## Block Production Flow\n\n### Current State (Development)\n\n```\nTransaction submitted\n    ↓\nDirectly applied to database\n    ↓\nBlock created with transaction\n    ↓\nState root calculated\n    ↓\nBlock finalized\n```\n\n### Future State (Production)\n\n```\n1. Transactions submitted to mempool\n    ↓\n2. Block producer selects transactions\n    ↓\n3. Execute transactions in order\n    ↓\n4. Calculate state root\n    ↓\n5. Create block with:\n   - Transactions included\n   - State root\n   - Gas used\n    ↓\n6. Sign block\n    ↓\n7. Insert block into database\n    ↓\n8. Propagate to network\n```\n\n## Block Hash Calculation\n\nBlocks are identified by the hash of their contents:\n\n```typescript\nfunction calculateBlockHash(block: Block): string {\n  const data = JSON.stringify({\n    height: block.height,\n    previousHash: block.previousHash,\n    timestamp: block.timestamp,\n    stateRoot: block.stateRoot,\n    transactions: block.transactions,\n    gasUsed: block.gasUsed,\n  })\n\n  return crypto.createHash('sha256')\n    .update(data)\n    .digest('hex')\n}\n```\n\n## State Root\n\nThe state root is a Merkle root of all account states after executing the block's transactions. This allows:\n\n- **Efficient verification** - Prove account state without full blockchain\n- **Light clients** - Verify transactions without downloading everything\n- **State snapshots** - Quick sync for new nodes\n- **Fraud proofs** - Prove invalid state transitions\n\n### State Root Calculation\n\n```typescript\nfunction calculateStateRoot(accounts: Account[]): string {\n  // Sort accounts by ID for deterministic hashing\n  const sorted = accounts.sort((a, b) => a.id.localeCompare(b.id))\n\n  // Hash each account state\n  const accountHashes = sorted.map(account => {\n    const state = {\n      id: account.id,\n      balances: account.balances,\n      nonce: account.nonce,\n    }\n    return hash(JSON.stringify(state))\n  })\n\n  // Build Merkle tree and return root\n  return buildMerkleRoot(accountHashes)\n}\n```\n\n## Block Queries\n\n### Get Latest Block\n\n```typescript\n// Via API\nGET /blocks/latest\n\n// Response\n{\n  \"height\": 12345,\n  \"hash\": \"0xa1b2c3d4...\",\n  \"timestamp\": 1699999999000,\n  \"transactions\": [\"tx1\", \"tx2\", \"tx3\"],\n  \"stateRoot\": \"0x...\",\n  \"gasUsed\": 150000,\n  \"gasLimit\": 1000000\n}\n```\n\n### Get Specific Block\n\n```typescript\n// Via API\nGET /blocks/12345\n\n// Or by hash\nGET /blocks/0xa1b2c3d4...\n```\n\n### Get Block Range\n\n```typescript\n// Via API\nGET /blocks?from=100&to=200\n\n// Returns array of blocks\n```\n\n## Block Context in Contracts\n\nSmart contracts can access block information:\n\n```typescript\nimport { console } from 'tana/core'\nimport { block } from 'tana/block'\n\n// Current block context\nconsole.log('Block height:', block.height)\nconsole.log('Block hash:', block.hash)\nconsole.log('Block timestamp:', block.timestamp)\nconsole.log('Block producer:', block.producer)\nconsole.log('Gas limit:', block.gasLimit)\n\n// Query historical blocks (future)\nconst genesis = await block.getBlock(0)\nconsole.log('Genesis message:', genesis.metadata.genesisMessage)\n```\n\n## Block Explorer\n\nQuery blocks via the API or CLI:\n\n```bash\n# Get latest block\ncurl http://localhost:8080/blocks/latest\n\n# Get specific block\ncurl http://localhost:8080/blocks/12345\n\n# Get block transactions\ncurl http://localhost:8080/blocks/12345/transactions\n```\n\n## Development Roadmap\n\n### Phase 1: Basic Blocks (Current)\n- ✅ Blocks table\n- ✅ Genesis block\n- ✅ Block creation on transaction\n- ✅ Block queries via API\n\n### Phase 2: Block Production\n- ⏳ Mempool for pending transactions\n- ⏳ Block producer service\n- ⏳ Transaction selection\n- ⏳ Automated block creation\n\n### Phase 3: Consensus\n- ⏳ Multiple validators\n- ⏳ Consensus mechanism\n- ⏳ Fork resolution\n- ⏳ Finality rules\n\n## Next Steps\n\n- [Data Model](/guides/core/data-model/) - Learn about Tana's data structures\n- [Contract Execution](/guides/core/contract-execution/) - How contracts interact with blocks\n- [API Reference](/tana-api/intro/) - Query blocks via the REST API\n",
    "html": "<p>Blocks are the fundamental unit of Tana&#39;s blockchain, packaging transactions and establishing a tamper-proof history of all state changes.</p>\n<h2 id=\"block-structure\">Block Structure</h2>\n<h3 id=\"database-schema\">Database Schema</h3>\n<pre><code class=\"language-sql\">CREATE TABLE blocks (\n  -- Block identification\n  height        BIGINT PRIMARY KEY,           -- 0 for genesis, then 1, 2, 3...\n  hash          VARCHAR(64) NOT NULL UNIQUE,  -- SHA256 of block contents\n  parent_hash   VARCHAR(64) NOT NULL,         -- Hash of previous block\n\n  -- Block metadata\n  timestamp     TIMESTAMP NOT NULL,           -- Block creation time\n  producer      UUID NOT NULL,                -- Node/user that produced this block\n\n  -- Block contents\n  transactions  JSONB NOT NULL,               -- Array of transaction IDs\n  state_root    VARCHAR(64) NOT NULL,         -- Merkle root of state\n\n  -- Execution\n  gas_used      BIGINT NOT NULL DEFAULT 0,    -- Total gas consumed\n  gas_limit     BIGINT NOT NULL,              -- Maximum gas allowed\n\n  -- Timestamps\n  created_at    TIMESTAMP NOT NULL DEFAULT NOW()\n);\n</code></pre><h3 id=\"typescript-interface\">TypeScript Interface</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">interface</span><span style=\"color:#B392F0\"> Block</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Identity</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  height</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#6A737D\">          // Block number (0 = genesis)</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  hash</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">           // Block hash</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  previousHash</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">   // Previous block hash</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Metadata</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  timestamp</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#6A737D\">      // Unix timestamp (ms)</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  producer</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">       // Producer ID</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Contents</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  transactions</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">[] </span><span style=\"color:#6A737D\">// Array of transaction IDs</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  stateRoot</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">      // State merkle root</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Execution</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  gasUsed</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#6A737D\">        // Gas consumed</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  gasLimit</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#6A737D\">       // Gas limit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Timestamps</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  createdAt</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Date</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h2 id=\"genesis-block-block-0\">Genesis Block (Block 0)</h2>\n<p>The <strong>genesis block</strong> is block #0 - the first block in the blockchain. It establishes the initial state and network parameters.</p>\n<h3 id=\"genesis-block-example\">Genesis Block Example</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Identity</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  height</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">0</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  hash</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"0xa1b2c3d4e5f6...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  previousHash</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"0x0000000000000000000000000000000000000000000000000000000000000000\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Metadata</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  timestamp</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">1730678400000</span><span style=\"color:#E1E4E8\">,  </span><span style=\"color:#6A737D\">// Launch date</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  producer</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"tana:genesis\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Contents</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  transactions</span><span style=\"color:#E1E4E8\">: [],</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  stateRoot</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"0x...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Execution</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  gasUsed</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">0</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  gasLimit</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">1000000</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Genesis metadata</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  metadata</span><span style=\"color:#E1E4E8\">: {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">    version</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"0.1.0\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">    networkName</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"tana\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">    chainId</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">1</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">    genesisMessage</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Tana blockchain - TypeScript smart contracts\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">    blockTime</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">6000</span><span style=\"color:#E1E4E8\">,  </span><span style=\"color:#6A737D\">// 6 second blocks</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h2 id=\"block-production-flow\">Block Production Flow</h2>\n<h3 id=\"current-state-development\">Current State (Development)</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Transaction submitted</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Directly applied to database</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Block created with transaction</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>State root calculated</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Block finalized</span></span></code></pre>\n</code></pre><h3 id=\"future-state-production\">Future State (Production)</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>1. Transactions submitted to mempool</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>2. Block producer selects transactions</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>3. Execute transactions in order</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>4. Calculate state root</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>5. Create block with:</span></span>\n<span class=\"line\"><span>   - Transactions included</span></span>\n<span class=\"line\"><span>   - State root</span></span>\n<span class=\"line\"><span>   - Gas used</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>6. Sign block</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>7. Insert block into database</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>8. Propagate to network</span></span></code></pre>\n</code></pre><h2 id=\"block-hash-calculation\">Block Hash Calculation</h2>\n<p>Blocks are identified by the hash of their contents:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">function</span><span style=\"color:#B392F0\"> calculateBlockHash</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">block</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Block</span><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> data</span><span style=\"color:#F97583\"> =</span><span style=\"color:#79B8FF\"> JSON</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">stringify</span><span style=\"color:#E1E4E8\">({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    height: block.height,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    previousHash: block.previousHash,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    timestamp: block.timestamp,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    stateRoot: block.stateRoot,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    transactions: block.transactions,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    gasUsed: block.gasUsed,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> crypto.</span><span style=\"color:#B392F0\">createHash</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'sha256'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    .</span><span style=\"color:#B392F0\">update</span><span style=\"color:#E1E4E8\">(data)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    .</span><span style=\"color:#B392F0\">digest</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'hex'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h2 id=\"state-root\">State Root</h2>\n<p>The state root is a Merkle root of all account states after executing the block&#39;s transactions. This allows:</p>\n<ul>\n<li><strong>Efficient verification</strong> - Prove account state without full blockchain</li>\n<li><strong>Light clients</strong> - Verify transactions without downloading everything</li>\n<li><strong>State snapshots</strong> - Quick sync for new nodes</li>\n<li><strong>Fraud proofs</strong> - Prove invalid state transitions</li>\n</ul>\n<h3 id=\"state-root-calculation\">State Root Calculation</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">function</span><span style=\"color:#B392F0\"> calculateStateRoot</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">accounts</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Account</span><span style=\"color:#E1E4E8\">[])</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Sort accounts by ID for deterministic hashing</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> sorted</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> accounts.</span><span style=\"color:#B392F0\">sort</span><span style=\"color:#E1E4E8\">((</span><span style=\"color:#FFAB70\">a</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">b</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> a.id.</span><span style=\"color:#B392F0\">localeCompare</span><span style=\"color:#E1E4E8\">(b.id))</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Hash each account state</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> accountHashes</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> sorted.</span><span style=\"color:#B392F0\">map</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">account</span><span style=\"color:#F97583\"> =></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> state</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      id: account.id,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      balances: account.balances,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      nonce: account.nonce,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#B392F0\"> hash</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">JSON</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">stringify</span><span style=\"color:#E1E4E8\">(state))</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Build Merkle tree and return root</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#B392F0\"> buildMerkleRoot</span><span style=\"color:#E1E4E8\">(accountHashes)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h2 id=\"block-queries\">Block Queries</h2>\n<h3 id=\"get-latest-block\">Get Latest Block</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Via API</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">GET</span><span style=\"color:#F97583\"> /</span><span style=\"color:#E1E4E8\">blocks</span><span style=\"color:#F97583\">/</span><span style=\"color:#E1E4E8\">latest</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Response</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  \"height\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">12345</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  \"hash\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"0xa1b2c3d4...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  \"timestamp\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">1699999999000</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  \"transactions\"</span><span style=\"color:#E1E4E8\">: [</span><span style=\"color:#9ECBFF\">\"tx1\"</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">\"tx2\"</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">\"tx3\"</span><span style=\"color:#E1E4E8\">],</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  \"stateRoot\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"0x...\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  \"gasUsed\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">150000</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  \"gasLimit\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">1000000</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h3 id=\"get-specific-block\">Get Specific Block</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Via API</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">GET</span><span style=\"color:#F97583\"> /</span><span style=\"color:#E1E4E8\">blocks</span><span style=\"color:#F97583\">/</span><span style=\"color:#79B8FF\">12345</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Or by hash</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">GET</span><span style=\"color:#F97583\"> /</span><span style=\"color:#E1E4E8\">blocks</span><span style=\"color:#F97583\">/</span><span style=\"color:#79B8FF\">0xa1b2c3d4</span><span style=\"color:#F97583\">...</span></span></code></pre>\n</code></pre><h3 id=\"get-block-range\">Get Block Range</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Via API</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">GET</span><span style=\"color:#F97583\"> /</span><span style=\"color:#E1E4E8\">blocks</span><span style=\"color:#F97583\">?</span><span style=\"color:#E1E4E8\">from</span><span style=\"color:#F97583\">=</span><span style=\"color:#79B8FF\">100</span><span style=\"color:#F97583\">&#x26;</span><span style=\"color:#E1E4E8\">to</span><span style=\"color:#F97583\">=</span><span style=\"color:#79B8FF\">200</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Returns array of blocks</span></span></code></pre>\n</code></pre><h2 id=\"block-context-in-contracts\">Block Context in Contracts</h2>\n<p>Smart contracts can access block information:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { console } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/core'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { block } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/block'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Current block context</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Block height:'</span><span style=\"color:#E1E4E8\">, block.height)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Block hash:'</span><span style=\"color:#E1E4E8\">, block.hash)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Block timestamp:'</span><span style=\"color:#E1E4E8\">, block.timestamp)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Block producer:'</span><span style=\"color:#E1E4E8\">, block.producer)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Gas limit:'</span><span style=\"color:#E1E4E8\">, block.gasLimit)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Query historical blocks (future)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> genesis</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> block.</span><span style=\"color:#B392F0\">getBlock</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">0</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Genesis message:'</span><span style=\"color:#E1E4E8\">, genesis.metadata.genesisMessage)</span></span></code></pre>\n</code></pre><h2 id=\"block-explorer\">Block Explorer</h2>\n<p>Query blocks via the API or CLI:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Get latest block</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8080/blocks/latest</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Get specific block</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8080/blocks/12345</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Get block transactions</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8080/blocks/12345/transactions</span></span></code></pre>\n</code></pre><h2 id=\"development-roadmap\">Development Roadmap</h2>\n<h3 id=\"phase-1-basic-blocks-current\">Phase 1: Basic Blocks (Current)</h3>\n<ul>\n<li>✅ Blocks table</li>\n<li>✅ Genesis block</li>\n<li>✅ Block creation on transaction</li>\n<li>✅ Block queries via API</li>\n</ul>\n<h3 id=\"phase-2-block-production\">Phase 2: Block Production</h3>\n<ul>\n<li>⏳ Mempool for pending transactions</li>\n<li>⏳ Block producer service</li>\n<li>⏳ Transaction selection</li>\n<li>⏳ Automated block creation</li>\n</ul>\n<h3 id=\"phase-3-consensus\">Phase 3: Consensus</h3>\n<ul>\n<li>⏳ Multiple validators</li>\n<li>⏳ Consensus mechanism</li>\n<li>⏳ Fork resolution</li>\n<li>⏳ Finality rules</li>\n</ul>\n<h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li><a href=\"/guides/core/data-model/\">Data Model</a> - Learn about Tana&#39;s data structures</li>\n<li><a href=\"/guides/core/contract-execution/\">Contract Execution</a> - How contracts interact with blocks</li>\n<li><a href=\"/tana-api/intro/\">API Reference</a> - Query blocks via the REST API</li>\n</ul>\n"
  },
  {
    "slug": [
      "contributing",
      "core",
      "system-flows"
    ],
    "metadata": {
      "title": "System Flows",
      "description": "How data flows through Tana's services"
    },
    "content": "\nThis guide maps out the key user actions and how they flow through Tana's services.\n\n## Core User Actions\n\n### 1. User Creates Account\n\n```\nUser submits:\n  - username\n  - display_name\n  - public_key\n    ↓\nPOST /users\n    ↓\nLedger Service validates:\n  - username unique?\n  - valid format?\n    ↓\nPostgreSQL INSERT\n    ↓\nReturns: user object with ID\n```\n\n**Services Required:**\n- ✅ Ledger API\n- ✅ PostgreSQL\n\n**Status:** ✅ **READY**\n\n### 2. User Checks Balance\n\n```\nUser queries: GET /balances?ownerId=alice&currencyCode=USD\n    ↓\nLedger Service queries DB\n    ↓\nPostgreSQL SELECT\n    ↓\nReturns: { amount: \"1000.00\", currencyCode: \"USD\" }\n```\n\n**Services Required:**\n- ✅ Ledger API\n- ✅ PostgreSQL\n\n**Status:** ✅ **READY**\n\n### 3. User Sends Funds\n\n```\nUser submits: POST /transactions\n  {\n    from: \"alice\",\n    to: \"bob\",\n    amount: \"100.00\",\n    currency: \"USD\"\n  }\n    ↓\nLedger Service validates:\n  - Alice has balance >= 100?\n  - Bob exists?\n    ↓\nBEGIN TRANSACTION\n  UPDATE balances SET amount = amount - 100 WHERE owner_id = 'alice'\n  UPDATE balances SET amount = amount + 100 WHERE owner_id = 'bob'\n  INSERT INTO transactions (...)\nCOMMIT\n    ↓\nReturns: transaction ID\n```\n\n**Services Required:**\n- ✅ Ledger API\n- ✅ PostgreSQL\n\n**Status:** ✅ **READY**\n\n### 4. User Tests Contract in Playground\n\n```\nUser writes TypeScript in browser\n    ↓\nClicks \"Run\"\n    ↓\nBrowser sandbox executes:\n  - Transpiles TS → JS\n  - Runs in isolated context\n  - tana/* modules available\n    ↓\nContract reads data:\n  GET /balances (read-only)\n    ↓\nContract simulates writes:\n  tx.transfer() - staged locally\n  tx.execute() - returns mock result\n    ↓\nBrowser displays output\n```\n\n**Services Required:**\n- ✅ Playground Website\n- ✅ Ledger API (read-only)\n- ✅ Browser Sandbox\n\n**Status:** ✅ **READY**\n\n### 5. User Deploys Contract (via CLI)\n\n```\nUser runs: tana deploy contract ./my-contract.ts\n    ↓\nCLI validates contract code\n    ↓\nPOST /contracts\n  {\n    code: \"...\",\n    owner: \"alice\"\n  }\n    ↓\nLedger Service:\n  - Stores contract code\n  - Generates contract ID\n    ↓\nPostgreSQL INSERT\n    ↓\nReturns: contract_id\n```\n\n**Services Required:**\n- ✅ CLI\n- ✅ Ledger API\n- ✅ PostgreSQL\n\n**Status:** ⏳ **IN PROGRESS**\n\n### 6. User Executes Contract (Future)\n\n```\nUser calls: POST /contracts/:id/execute { args: {...} }\n    ↓\nContracts Service:\n  - Loads contract code from DB\n  - Spawns Rust runtime process\n    ↓\nRuntime executes:\n  - Reads state via tana/block\n  - Stages changes via tana/tx\n  - Returns execution result\n    ↓\nContracts Service validates:\n  - Gas limit not exceeded?\n  - Valid state transitions?\n    ↓\nIf valid:\n  POST /transactions (apply changes)\n    ↓\nReturns: execution result\n```\n\n**Services Required:**\n- ⏳ Contracts Service\n- ✅ Rust Runtime\n- ✅ Ledger API\n\n**Status:** ⏳ **PLANNED**\n\n## Data Flow Patterns\n\n### Pattern 1: Read-Only Query\n\n```\nUser → API → PostgreSQL → Response\n```\n\n**Example:** Get balance, list users, query transactions\n\n**Status:** ✅ Working\n\n### Pattern 2: Direct State Change\n\n```\nUser → API → Validate → PostgreSQL Transaction → Response\n```\n\n**Example:** Create user, transfer funds\n\n**Status:** ✅ Working\n\n### Pattern 3: Contract Execution (Future)\n\n```\nUser → API → Runtime → Validate → PostgreSQL → Response\n         ↓        ↓\n    Load Code  Execute\n```\n\n**Example:** Deploy contract, execute contract\n\n**Status:** ⏳ Planned\n\n## Service Dependencies\n\n### Current Architecture\n\n```\nCLI/Playground\n    ↓ HTTP\nLedger Service\n    ↓ TCP\nPostgreSQL\n```\n\n**Status:** ✅ Fully operational\n\n### Future Architecture\n\n```\nCLI/Playground\n    ↓ HTTP\nLedger Service\n    ↓ Subprocess\nRuntime (Rust)\n    ↓ HTTP\nLedger Service\n    ↓ TCP\nPostgreSQL + Redis\n```\n\n**Status:** ⏳ Partially implemented\n\n## Transaction Lifecycle\n\n### 1. Submission\n\n```\nUser creates transaction\n    ↓\nValidate locally (signature, format)\n    ↓\nSubmit to ledger API\n```\n\n### 2. Validation\n\n```\nLedger receives transaction\n    ↓\nValidate:\n  - Valid signature?\n  - Sufficient balance?\n  - Valid recipient?\n    ↓\nIf invalid: Reject\nIf valid: Continue\n```\n\n### 3. Execution\n\n```\nBegin database transaction\n    ↓\nUpdate balances\n    ↓\nInsert transaction record\n    ↓\nCommit\n```\n\n### 4. Confirmation\n\n```\nTransaction included in block\n    ↓\nState root updated\n    ↓\nTransaction confirmed\n```\n\n## Next Steps\n\n- [Data Model](/guides/core/data-model/) - Understand the data structures\n- [Blocks & Blockchain](/guides/core/blocks/) - Learn about block production\n- [CLI Reference](/tana-cli/intro/) - Use the command-line interface\n",
    "html": "<p>This guide maps out the key user actions and how they flow through Tana&#39;s services.</p>\n<h2 id=\"core-user-actions\">Core User Actions</h2>\n<h3 id=\"1-user-creates-account\">1. User Creates Account</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User submits:</span></span>\n<span class=\"line\"><span>  - username</span></span>\n<span class=\"line\"><span>  - display_name</span></span>\n<span class=\"line\"><span>  - public_key</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>POST /users</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Ledger Service validates:</span></span>\n<span class=\"line\"><span>  - username unique?</span></span>\n<span class=\"line\"><span>  - valid format?</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>PostgreSQL INSERT</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Returns: user object with ID</span></span></code></pre>\n</code></pre><p><strong>Services Required:</strong></p>\n<ul>\n<li>✅ Ledger API</li>\n<li>✅ PostgreSQL</li>\n</ul>\n<p><strong>Status:</strong> ✅ <strong>READY</strong></p>\n<h3 id=\"2-user-checks-balance\">2. User Checks Balance</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User queries: GET /balances?ownerId=alice&#x26;currencyCode=USD</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Ledger Service queries DB</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>PostgreSQL SELECT</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Returns: { amount: \"1000.00\", currencyCode: \"USD\" }</span></span></code></pre>\n</code></pre><p><strong>Services Required:</strong></p>\n<ul>\n<li>✅ Ledger API</li>\n<li>✅ PostgreSQL</li>\n</ul>\n<p><strong>Status:</strong> ✅ <strong>READY</strong></p>\n<h3 id=\"3-user-sends-funds\">3. User Sends Funds</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User submits: POST /transactions</span></span>\n<span class=\"line\"><span>  {</span></span>\n<span class=\"line\"><span>    from: \"alice\",</span></span>\n<span class=\"line\"><span>    to: \"bob\",</span></span>\n<span class=\"line\"><span>    amount: \"100.00\",</span></span>\n<span class=\"line\"><span>    currency: \"USD\"</span></span>\n<span class=\"line\"><span>  }</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Ledger Service validates:</span></span>\n<span class=\"line\"><span>  - Alice has balance >= 100?</span></span>\n<span class=\"line\"><span>  - Bob exists?</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>BEGIN TRANSACTION</span></span>\n<span class=\"line\"><span>  UPDATE balances SET amount = amount - 100 WHERE owner_id = 'alice'</span></span>\n<span class=\"line\"><span>  UPDATE balances SET amount = amount + 100 WHERE owner_id = 'bob'</span></span>\n<span class=\"line\"><span>  INSERT INTO transactions (...)</span></span>\n<span class=\"line\"><span>COMMIT</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Returns: transaction ID</span></span></code></pre>\n</code></pre><p><strong>Services Required:</strong></p>\n<ul>\n<li>✅ Ledger API</li>\n<li>✅ PostgreSQL</li>\n</ul>\n<p><strong>Status:</strong> ✅ <strong>READY</strong></p>\n<h3 id=\"4-user-tests-contract-in-playground\">4. User Tests Contract in Playground</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User writes TypeScript in browser</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Clicks \"Run\"</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Browser sandbox executes:</span></span>\n<span class=\"line\"><span>  - Transpiles TS → JS</span></span>\n<span class=\"line\"><span>  - Runs in isolated context</span></span>\n<span class=\"line\"><span>  - tana/* modules available</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Contract reads data:</span></span>\n<span class=\"line\"><span>  GET /balances (read-only)</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Contract simulates writes:</span></span>\n<span class=\"line\"><span>  tx.transfer() - staged locally</span></span>\n<span class=\"line\"><span>  tx.execute() - returns mock result</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Browser displays output</span></span></code></pre>\n</code></pre><p><strong>Services Required:</strong></p>\n<ul>\n<li>✅ Playground Website</li>\n<li>✅ Ledger API (read-only)</li>\n<li>✅ Browser Sandbox</li>\n</ul>\n<p><strong>Status:</strong> ✅ <strong>READY</strong></p>\n<h3 id=\"5-user-deploys-contract-via-cli\">5. User Deploys Contract (via CLI)</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User runs: tana deploy contract ./my-contract.ts</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>CLI validates contract code</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>POST /contracts</span></span>\n<span class=\"line\"><span>  {</span></span>\n<span class=\"line\"><span>    code: \"...\",</span></span>\n<span class=\"line\"><span>    owner: \"alice\"</span></span>\n<span class=\"line\"><span>  }</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Ledger Service:</span></span>\n<span class=\"line\"><span>  - Stores contract code</span></span>\n<span class=\"line\"><span>  - Generates contract ID</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>PostgreSQL INSERT</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Returns: contract_id</span></span></code></pre>\n</code></pre><p><strong>Services Required:</strong></p>\n<ul>\n<li>✅ CLI</li>\n<li>✅ Ledger API</li>\n<li>✅ PostgreSQL</li>\n</ul>\n<p><strong>Status:</strong> ⏳ <strong>IN PROGRESS</strong></p>\n<h3 id=\"6-user-executes-contract-future\">6. User Executes Contract (Future)</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User calls: POST /contracts/:id/execute { args: {...} }</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Contracts Service:</span></span>\n<span class=\"line\"><span>  - Loads contract code from DB</span></span>\n<span class=\"line\"><span>  - Spawns Rust runtime process</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Runtime executes:</span></span>\n<span class=\"line\"><span>  - Reads state via tana/block</span></span>\n<span class=\"line\"><span>  - Stages changes via tana/tx</span></span>\n<span class=\"line\"><span>  - Returns execution result</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Contracts Service validates:</span></span>\n<span class=\"line\"><span>  - Gas limit not exceeded?</span></span>\n<span class=\"line\"><span>  - Valid state transitions?</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>If valid:</span></span>\n<span class=\"line\"><span>  POST /transactions (apply changes)</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Returns: execution result</span></span></code></pre>\n</code></pre><p><strong>Services Required:</strong></p>\n<ul>\n<li>⏳ Contracts Service</li>\n<li>✅ Rust Runtime</li>\n<li>✅ Ledger API</li>\n</ul>\n<p><strong>Status:</strong> ⏳ <strong>PLANNED</strong></p>\n<h2 id=\"data-flow-patterns\">Data Flow Patterns</h2>\n<h3 id=\"pattern-1-read-only-query\">Pattern 1: Read-Only Query</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User → API → PostgreSQL → Response</span></span></code></pre>\n</code></pre><p><strong>Example:</strong> Get balance, list users, query transactions</p>\n<p><strong>Status:</strong> ✅ Working</p>\n<h3 id=\"pattern-2-direct-state-change\">Pattern 2: Direct State Change</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User → API → Validate → PostgreSQL Transaction → Response</span></span></code></pre>\n</code></pre><p><strong>Example:</strong> Create user, transfer funds</p>\n<p><strong>Status:</strong> ✅ Working</p>\n<h3 id=\"pattern-3-contract-execution-future\">Pattern 3: Contract Execution (Future)</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User → API → Runtime → Validate → PostgreSQL → Response</span></span>\n<span class=\"line\"><span>         ↓        ↓</span></span>\n<span class=\"line\"><span>    Load Code  Execute</span></span></code></pre>\n</code></pre><p><strong>Example:</strong> Deploy contract, execute contract</p>\n<p><strong>Status:</strong> ⏳ Planned</p>\n<h2 id=\"service-dependencies\">Service Dependencies</h2>\n<h3 id=\"current-architecture\">Current Architecture</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>CLI/Playground</span></span>\n<span class=\"line\"><span>    ↓ HTTP</span></span>\n<span class=\"line\"><span>Ledger Service</span></span>\n<span class=\"line\"><span>    ↓ TCP</span></span>\n<span class=\"line\"><span>PostgreSQL</span></span></code></pre>\n</code></pre><p><strong>Status:</strong> ✅ Fully operational</p>\n<h3 id=\"future-architecture\">Future Architecture</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>CLI/Playground</span></span>\n<span class=\"line\"><span>    ↓ HTTP</span></span>\n<span class=\"line\"><span>Ledger Service</span></span>\n<span class=\"line\"><span>    ↓ Subprocess</span></span>\n<span class=\"line\"><span>Runtime (Rust)</span></span>\n<span class=\"line\"><span>    ↓ HTTP</span></span>\n<span class=\"line\"><span>Ledger Service</span></span>\n<span class=\"line\"><span>    ↓ TCP</span></span>\n<span class=\"line\"><span>PostgreSQL + Redis</span></span></code></pre>\n</code></pre><p><strong>Status:</strong> ⏳ Partially implemented</p>\n<h2 id=\"transaction-lifecycle\">Transaction Lifecycle</h2>\n<h3 id=\"1-submission\">1. Submission</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User creates transaction</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Validate locally (signature, format)</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Submit to ledger API</span></span></code></pre>\n</code></pre><h3 id=\"2-validation\">2. Validation</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Ledger receives transaction</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Validate:</span></span>\n<span class=\"line\"><span>  - Valid signature?</span></span>\n<span class=\"line\"><span>  - Sufficient balance?</span></span>\n<span class=\"line\"><span>  - Valid recipient?</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>If invalid: Reject</span></span>\n<span class=\"line\"><span>If valid: Continue</span></span></code></pre>\n</code></pre><h3 id=\"3-execution\">3. Execution</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Begin database transaction</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Update balances</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Insert transaction record</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Commit</span></span></code></pre>\n</code></pre><h3 id=\"4-confirmation\">4. Confirmation</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Transaction included in block</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>State root updated</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Transaction confirmed</span></span></code></pre>\n</code></pre><h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li><a href=\"/guides/core/data-model/\">Data Model</a> - Understand the data structures</li>\n<li><a href=\"/guides/core/blocks/\">Blocks &amp; Blockchain</a> - Learn about block production</li>\n<li><a href=\"/tana-cli/intro/\">CLI Reference</a> - Use the command-line interface</li>\n</ul>\n"
  },
  {
    "slug": [
      "contributing",
      "core",
      "data-model"
    ],
    "metadata": {
      "title": "Data Model",
      "description": "Core data structures in Tana blockchain"
    },
    "content": "\nTana's blockchain stores users, balances, transactions, contracts, and blocks. This page describes the core data model.\n\n## Primary Objects\n\n### User\n\nUser accounts are the foundation of Tana. Each user has a unique ID, public key for signatures, and multi-currency balances.\n\n```typescript\ninterface User {\n  id: string                    // Unique ID (address)\n  publicKey: string             // Ed25519 public key\n  username: string              // @alice\n  displayName: string           // \"Alice Johnson\"\n  metadata: {\n    bio?: string\n    avatarData?: string         // Small image stored on-chain (<100KB base64)\n    avatarHash?: string         // Or content hash if stored off-chain\n  }\n  balances: Map<Currency, Decimal>  // Multi-currency\n  createdAt: timestamp\n  stateHash: string             // Merkle root of account state\n}\n```\n\n### Transaction\n\nAll blockchain state changes are recorded as transactions.\n\n```typescript\ninterface Transaction {\n  id: string                    // Tx hash\n  from: string                  // User/Team ID\n  to: string                    // User/Team ID\n  amount: Decimal\n  currency: Currency            // USD, BTC, ETH, etc.\n  type: 'transfer' | 'deposit' | 'withdraw' | 'contract_call' | 'user_creation'\n  contractId?: string           // If contract execution\n  contractInput?: any           // Arguments\n  signature: string             // Ed25519\n  timestamp: timestamp\n  blockHeight: number           // Block inclusion\n  status: 'pending' | 'confirmed' | 'failed'\n}\n```\n\n### Currency\n\nTana supports multi-currency balances without requiring a native token.\n\n```typescript\ninterface Currency {\n  code: string                  // \"USD\", \"BTC\", \"ETH\"\n  name: string                  // \"US Dollar\", \"Bitcoin\"\n  symbol: string                // \"$\", \"₿\"\n  decimals: number              // Precision (e.g., 2 for USD, 8 for BTC)\n  type: 'fiat' | 'crypto'\n  verified: boolean             // Is this a recognized currency?\n}\n```\n\n### Smart Contract\n\nContracts are TypeScript code deployed on-chain with isolated key-value storage.\n\n```typescript\ninterface SmartContract {\n  id: string                    // Contract address\n  codeHash: string              // SHA-256 of code\n  code: string                  // TypeScript source\n  author: string                // User ID\n  deployedAt: timestamp\n  storage: Map<string, string>  // Key-value state (tana/data)\n  metadata: {\n    name?: string\n    description?: string\n    version?: string\n  }\n}\n```\n\n### Block\n\nBlocks package transactions and establish blockchain state.\n\n```typescript\ninterface Block {\n  id: string                    // Block hash\n  height: number                // Block number (0 = genesis)\n  timestamp: timestamp\n  previousHash: string          // Previous block\n  transactions: string[]        // Tx hashes\n  stateRoot: string             // Merkle root of all account states\n  validatorSignature: string    // Block producer signature\n  gasUsed: number              // Gas consumed\n  gasLimit: number             // Gas limit\n}\n```\n\n## Database Schema\n\n### Users Table\n\n```sql\nCREATE TABLE users (\n  id TEXT PRIMARY KEY,\n  username TEXT UNIQUE NOT NULL,\n  display_name TEXT,\n  public_key TEXT NOT NULL,\n  bio TEXT,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n### Balances Table\n\n```sql\nCREATE TABLE balances (\n  owner_id TEXT NOT NULL,\n  owner_type TEXT NOT NULL,\n  currency_code TEXT NOT NULL,\n  amount TEXT NOT NULL,  -- Stored as string for precision\n  updated_at TIMESTAMP DEFAULT NOW(),\n  PRIMARY KEY (owner_id, currency_code)\n);\n```\n\n### Transactions Table\n\n```sql\nCREATE TABLE transactions (\n  id TEXT PRIMARY KEY,\n  from_id TEXT,\n  to_id TEXT,\n  amount TEXT,\n  currency_code TEXT NOT NULL,\n  type TEXT NOT NULL,\n  status TEXT NOT NULL DEFAULT 'pending',\n  block_height INTEGER,\n  metadata JSONB,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n### Currencies Table\n\n```sql\nCREATE TABLE currencies (\n  code TEXT PRIMARY KEY,\n  name TEXT NOT NULL,\n  symbol TEXT NOT NULL,\n  decimals INTEGER NOT NULL,\n  is_active BOOLEAN DEFAULT true,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n### Blocks Table\n\n```sql\nCREATE TABLE blocks (\n  height INTEGER PRIMARY KEY,\n  hash TEXT UNIQUE NOT NULL,\n  parent_hash TEXT NOT NULL,\n  state_root TEXT NOT NULL,\n  timestamp TIMESTAMP NOT NULL,\n  producer TEXT NOT NULL,\n  transactions JSONB NOT NULL,\n  gas_used BIGINT DEFAULT 0,\n  gas_limit BIGINT NOT NULL,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n### Contracts Table\n\n```sql\nCREATE TABLE contracts (\n  id TEXT PRIMARY KEY,\n  code TEXT NOT NULL,\n  owner_id TEXT NOT NULL,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n### KV Storage Table\n\nPer-contract key-value storage for `tana/kv` module.\n\n```sql\nCREATE TABLE kv_storage (\n  contract_name TEXT NOT NULL,\n  key TEXT NOT NULL,\n  value TEXT NOT NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (contract_name, key)\n);\n\nCREATE INDEX idx_kv_contract ON kv_storage(contract_name);\n```\n\n**Notes:**\n- Each contract has isolated namespace via `contract_name`\n- Keys automatically prefixed: `\"{contract_name}:{key}\"`\n- Max key length: 512 bytes\n- Max value size: 25 MB\n- Used by `tana/kv` module (Cloudflare Workers-compatible API)\n\n## State Management\n\n### Account State\n\nEach user and team has a state hash that represents their complete state:\n\n- All balances across all currencies\n- Account metadata\n- Contract storage (if applicable)\n\n### State Root\n\nEach block has a state root - a Merkle root of all account state hashes. This allows:\n\n- Efficient state verification\n- Light client support\n- State snapshots\n- Fraud proofs\n\n### Transaction Flow\n\n```\nUser submits transaction\n    ↓\nValidate (signature, balance, etc.)\n    ↓\nAdd to pending transactions\n    ↓\nBlock producer includes in block\n    ↓\nExecute transaction\n    ↓\nUpdate account states\n    ↓\nCalculate new state root\n    ↓\nFinalize block\n```\n\n## Next Steps\n\n- [Blocks & Blockchain](/guides/core/blocks/) - Learn about block structure\n- [Contract Execution](/guides/core/contract-execution/) - How contracts interact with state\n- [API Reference](/tana-api/intro/) - Interact with the data model via API\n",
    "html": "<p>Tana&#39;s blockchain stores users, balances, transactions, contracts, and blocks. This page describes the core data model.</p>\n<h2 id=\"primary-objects\">Primary Objects</h2>\n<h3 id=\"user\">User</h3>\n<p>User accounts are the foundation of Tana. Each user has a unique ID, public key for signatures, and multi-currency balances.</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">interface</span><span style=\"color:#B392F0\"> User</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  id</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">                    // Unique ID (address)</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  publicKey</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">             // Ed25519 public key</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  username</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">              // @alice</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  displayName</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">           // \"Alice Johnson\"</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  metadata</span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">    bio</span><span style=\"color:#F97583\">?:</span><span style=\"color:#79B8FF\"> string</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">    avatarData</span><span style=\"color:#F97583\">?:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">         // Small image stored on-chain (&#x3C;100KB base64)</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">    avatarHash</span><span style=\"color:#F97583\">?:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">         // Or content hash if stored off-chain</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  balances</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Map</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Currency</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">Decimal</span><span style=\"color:#E1E4E8\">>  </span><span style=\"color:#6A737D\">// Multi-currency</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  createdAt</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> timestamp</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  stateHash</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">             // Merkle root of account state</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h3 id=\"transaction\">Transaction</h3>\n<p>All blockchain state changes are recorded as transactions.</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">interface</span><span style=\"color:#B392F0\"> Transaction</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  id</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">                    // Tx hash</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  from</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">                  // User/Team ID</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  to</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">                    // User/Team ID</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  amount</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Decimal</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  currency</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Currency</span><span style=\"color:#6A737D\">            // USD, BTC, ETH, etc.</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  type</span><span style=\"color:#F97583\">:</span><span style=\"color:#9ECBFF\"> 'transfer'</span><span style=\"color:#F97583\"> |</span><span style=\"color:#9ECBFF\"> 'deposit'</span><span style=\"color:#F97583\"> |</span><span style=\"color:#9ECBFF\"> 'withdraw'</span><span style=\"color:#F97583\"> |</span><span style=\"color:#9ECBFF\"> 'contract_call'</span><span style=\"color:#F97583\"> |</span><span style=\"color:#9ECBFF\"> 'user_creation'</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  contractId</span><span style=\"color:#F97583\">?:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">           // If contract execution</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  contractInput</span><span style=\"color:#F97583\">?:</span><span style=\"color:#79B8FF\"> any</span><span style=\"color:#6A737D\">           // Arguments</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  signature</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">             // Ed25519</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  timestamp</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> timestamp</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  blockHeight</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#6A737D\">           // Block inclusion</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  status</span><span style=\"color:#F97583\">:</span><span style=\"color:#9ECBFF\"> 'pending'</span><span style=\"color:#F97583\"> |</span><span style=\"color:#9ECBFF\"> 'confirmed'</span><span style=\"color:#F97583\"> |</span><span style=\"color:#9ECBFF\"> 'failed'</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h3 id=\"currency\">Currency</h3>\n<p>Tana supports multi-currency balances without requiring a native token.</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">interface</span><span style=\"color:#B392F0\"> Currency</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  code</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">                  // \"USD\", \"BTC\", \"ETH\"</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  name</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">                  // \"US Dollar\", \"Bitcoin\"</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  symbol</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">                // \"$\", \"₿\"</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  decimals</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#6A737D\">              // Precision (e.g., 2 for USD, 8 for BTC)</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  type</span><span style=\"color:#F97583\">:</span><span style=\"color:#9ECBFF\"> 'fiat'</span><span style=\"color:#F97583\"> |</span><span style=\"color:#9ECBFF\"> 'crypto'</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  verified</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> boolean</span><span style=\"color:#6A737D\">             // Is this a recognized currency?</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h3 id=\"smart-contract\">Smart Contract</h3>\n<p>Contracts are TypeScript code deployed on-chain with isolated key-value storage.</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">interface</span><span style=\"color:#B392F0\"> SmartContract</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  id</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">                    // Contract address</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  codeHash</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">              // SHA-256 of code</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  code</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">                  // TypeScript source</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  author</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">                // User ID</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  deployedAt</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> timestamp</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  storage</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Map</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#79B8FF\">string</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">string</span><span style=\"color:#E1E4E8\">>  </span><span style=\"color:#6A737D\">// Key-value state (tana/data)</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  metadata</span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">    name</span><span style=\"color:#F97583\">?:</span><span style=\"color:#79B8FF\"> string</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">    description</span><span style=\"color:#F97583\">?:</span><span style=\"color:#79B8FF\"> string</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">    version</span><span style=\"color:#F97583\">?:</span><span style=\"color:#79B8FF\"> string</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h3 id=\"block\">Block</h3>\n<p>Blocks package transactions and establish blockchain state.</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">interface</span><span style=\"color:#B392F0\"> Block</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  id</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">                    // Block hash</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  height</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#6A737D\">                // Block number (0 = genesis)</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  timestamp</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> timestamp</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  previousHash</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">          // Previous block</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  transactions</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">[]        </span><span style=\"color:#6A737D\">// Tx hashes</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  stateRoot</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">             // Merkle root of all account states</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  validatorSignature</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#6A737D\">    // Block producer signature</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  gasUsed</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#6A737D\">              // Gas consumed</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  gasLimit</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#6A737D\">             // Gas limit</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h2 id=\"database-schema\">Database Schema</h2>\n<h3 id=\"users-table\">Users Table</h3>\n<pre><code class=\"language-sql\">CREATE TABLE users (\n  id TEXT PRIMARY KEY,\n  username TEXT UNIQUE NOT NULL,\n  display_name TEXT,\n  public_key TEXT NOT NULL,\n  bio TEXT,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n</code></pre><h3 id=\"balances-table\">Balances Table</h3>\n<pre><code class=\"language-sql\">CREATE TABLE balances (\n  owner_id TEXT NOT NULL,\n  owner_type TEXT NOT NULL,\n  currency_code TEXT NOT NULL,\n  amount TEXT NOT NULL,  -- Stored as string for precision\n  updated_at TIMESTAMP DEFAULT NOW(),\n  PRIMARY KEY (owner_id, currency_code)\n);\n</code></pre><h3 id=\"transactions-table\">Transactions Table</h3>\n<pre><code class=\"language-sql\">CREATE TABLE transactions (\n  id TEXT PRIMARY KEY,\n  from_id TEXT,\n  to_id TEXT,\n  amount TEXT,\n  currency_code TEXT NOT NULL,\n  type TEXT NOT NULL,\n  status TEXT NOT NULL DEFAULT &#39;pending&#39;,\n  block_height INTEGER,\n  metadata JSONB,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n</code></pre><h3 id=\"currencies-table\">Currencies Table</h3>\n<pre><code class=\"language-sql\">CREATE TABLE currencies (\n  code TEXT PRIMARY KEY,\n  name TEXT NOT NULL,\n  symbol TEXT NOT NULL,\n  decimals INTEGER NOT NULL,\n  is_active BOOLEAN DEFAULT true,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n</code></pre><h3 id=\"blocks-table\">Blocks Table</h3>\n<pre><code class=\"language-sql\">CREATE TABLE blocks (\n  height INTEGER PRIMARY KEY,\n  hash TEXT UNIQUE NOT NULL,\n  parent_hash TEXT NOT NULL,\n  state_root TEXT NOT NULL,\n  timestamp TIMESTAMP NOT NULL,\n  producer TEXT NOT NULL,\n  transactions JSONB NOT NULL,\n  gas_used BIGINT DEFAULT 0,\n  gas_limit BIGINT NOT NULL,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n</code></pre><h3 id=\"contracts-table\">Contracts Table</h3>\n<pre><code class=\"language-sql\">CREATE TABLE contracts (\n  id TEXT PRIMARY KEY,\n  code TEXT NOT NULL,\n  owner_id TEXT NOT NULL,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n</code></pre><h3 id=\"kv-storage-table\">KV Storage Table</h3>\n<p>Per-contract key-value storage for <code>tana/kv</code> module.</p>\n<pre><code class=\"language-sql\">CREATE TABLE kv_storage (\n  contract_name TEXT NOT NULL,\n  key TEXT NOT NULL,\n  value TEXT NOT NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (contract_name, key)\n);\n\nCREATE INDEX idx_kv_contract ON kv_storage(contract_name);\n</code></pre><p><strong>Notes:</strong></p>\n<ul>\n<li>Each contract has isolated namespace via <code>contract_name</code></li>\n<li>Keys automatically prefixed: <code>&quot;{contract_name}:{key}&quot;</code></li>\n<li>Max key length: 512 bytes</li>\n<li>Max value size: 25 MB</li>\n<li>Used by <code>tana/kv</code> module (Cloudflare Workers-compatible API)</li>\n</ul>\n<h2 id=\"state-management\">State Management</h2>\n<h3 id=\"account-state\">Account State</h3>\n<p>Each user and team has a state hash that represents their complete state:</p>\n<ul>\n<li>All balances across all currencies</li>\n<li>Account metadata</li>\n<li>Contract storage (if applicable)</li>\n</ul>\n<h3 id=\"state-root\">State Root</h3>\n<p>Each block has a state root - a Merkle root of all account state hashes. This allows:</p>\n<ul>\n<li>Efficient state verification</li>\n<li>Light client support</li>\n<li>State snapshots</li>\n<li>Fraud proofs</li>\n</ul>\n<h3 id=\"transaction-flow\">Transaction Flow</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User submits transaction</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Validate (signature, balance, etc.)</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Add to pending transactions</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Block producer includes in block</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Execute transaction</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Update account states</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Calculate new state root</span></span>\n<span class=\"line\"><span>    ↓</span></span>\n<span class=\"line\"><span>Finalize block</span></span></code></pre>\n</code></pre><h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li><a href=\"/guides/core/blocks/\">Blocks &amp; Blockchain</a> - Learn about block structure</li>\n<li><a href=\"/guides/core/contract-execution/\">Contract Execution</a> - How contracts interact with state</li>\n<li><a href=\"/tana-api/intro/\">API Reference</a> - Interact with the data model via API</li>\n</ul>\n"
  },
  {
    "slug": [
      "contributing",
      "setup"
    ],
    "metadata": {
      "title": "Development Setup",
      "description": "Build Tana from source for development",
      "sidebar": {
        "order": 2
      }
    },
    "content": "\nThis guide is for **contributors** who want to build Tana from source. If you just want to use Tana, see the [Quick Start](/guides/quickstart/) instead.\n\n## Prerequisites\n\n- [Bun](https://bun.sh) >= 1.0 (TypeScript runtime)\n- [Rust](https://rustup.rs) >= 1.70 (for runtime binary)\n- [Docker](https://docker.com) (for PostgreSQL and Redis)\n- [mprocs](https://github.com/pvolok/mprocs) (optional, for multi-process management)\n\n## Clone Repository\n\n```bash\ngit clone https://github.com/conoda/tana.git\ncd tana\n```\n\n## Install Dependencies\n\n```bash\n# Install all workspace dependencies\nbun install\n```\n\n## Build Rust Runtime\n\n```bash\ncd runtime\ncargo build --release\ncd ..\n```\n\nThis creates the `tana-runtime` binary at `runtime/target/release/tana-runtime`.\n\n## Build CLI (Optional)\n\n```bash\ncd cli\nbun run make\ncd ..\n```\n\nThis creates a standalone `tana` binary at `cli/dist/tana`.\n\n## Start Development Environment\n\n### Option 1: All Services with mprocs (Recommended)\n\n```bash\nnpm run dev\n# or\n./dev.sh\n```\n\nThis starts:\n- ✅ PostgreSQL (auto)\n- ✅ Redis (auto)\n- ✅ Ledger Service (auto) - http://localhost:8080\n- ✅ Playground (auto) - http://localhost:4321\n- ⏸️ Contracts Service (manual)\n- ⏸️ Node Service (manual)\n\n**mprocs shortcuts:**\n- `Tab` - Switch between processes\n- `Space` - Start/stop a process\n- `Ctrl+A` then `Q` - Quit all processes\n- `Ctrl+A` then `K` - Kill a process\n- `Arrow keys` - Navigate\n\n### Option 2: Individual Services\n\n```bash\n# Start database infrastructure\nnpm run db:up\n\n# Start individual services\nbun cli/main.ts start      # Ledger service (port 8080)\nnpm run dev:contracts       # Contracts (port 8081)\nnpm run dev:node            # Blockchain node (port 9933)\nnpm run dev:playground      # Playground (port 4321)\n```\n\n## Environment Configuration\n\nCreate a `.env` file in the project root:\n\n```bash\ncp .env.example .env\n```\n\nEdit `.env` to configure:\n\n```bash\n# Database\nDATABASE_URL='postgres://tana:[PASSWORD]@localhost:5432/tana'\n\n# Redis\nREDIS_URL='redis://localhost:6379'\n\n# Service Ports\nLEDGER_PORT=8080\nCONTRACTS_PORT=8081\nNODE_PORT=9933\n\n# Environment\nNODE_ENV=development\n```\n\n## Testing\n\n```bash\n# Run all tests\nbun test\n\n# Test specific service\nbun run --filter @tana/ledger test\n\n# Test Rust runtime\ncd runtime && cargo test\n```\n\n## Common Development Tasks\n\n### Database Management\n\n```bash\n# Start databases\nnpm run db:up\n\n# Stop databases\nnpm run db:down\n\n# View logs\nnpm run db:logs\n\n# Reset databases (warning: deletes all data)\ndocker compose down -v && npm run db:up\n```\n\n### Building\n\n```bash\n# Build all services\nnpm run build\n\n# Build Rust runtime\nnpm run build:runtime\n\n# Build CLI binary\ncd cli && bun run make\n```\n\n### Running Examples\n\n```bash\n# Test the runtime\nbun run chaintest\n\n# Run a contract\ncd runtime\ncargo run -- ../examples/default.ts\n```\n\n## Troubleshooting\n\n### Port Already in Use\n\n```bash\n# Kill process on port 8080\nlsof -ti:8080 | xargs kill -9\n\n# Check what's using a port\nlsof -i :8080\n```\n\n### Database Connection Errors\n\n```bash\n# Restart PostgreSQL\ndocker compose restart postgres\n\n# Check logs\ndocker compose logs postgres\n\n# Verify DATABASE_URL in .env\ncat .env | grep DATABASE_URL\n```\n\n### Build Errors\n\n```bash\n# Clean and rebuild\nrm -rf node_modules\nbun install\n\n# Rust\ncd runtime\ncargo clean\ncargo build --release\n```\n\n## Project Structure\n\n```\ntana/\n├── cli/             # CLI binary (TypeScript/Bun)\n├── runtime/         # Contract execution (Rust)\n├── ledger/          # Ledger service (TypeScript/Bun)\n├── contracts/       # Contract executor (TypeScript/Bun)\n├── node/            # Blockchain node (TypeScript/Bun)\n├── websites/\n│   ├── docs/        # Documentation (Astro/Starlight)\n│   ├── playground/  # Contract playground (Astro/Svelte)\n│   └── landing/     # Landing page (Next.js)\n├── types/           # Shared TypeScript types\n├── examples/        # Example contracts\n└── docs/            # Technical documentation\n```\n\n## Next Steps\n\n- Read [System Architecture](/contributing/architecture/) to understand how Tana works\n- Explore [Core Concepts](/contributing/core/data-model/) for technical details\n- Check out [Testing Guide](/contributing/testing/) for writing tests\n",
    "html": "<p>This guide is for <strong>contributors</strong> who want to build Tana from source. If you just want to use Tana, see the <a href=\"/guides/quickstart/\">Quick Start</a> instead.</p>\n<h2 id=\"prerequisites\">Prerequisites</h2>\n<ul>\n<li><a href=\"https://bun.sh\">Bun</a> &gt;= 1.0 (TypeScript runtime)</li>\n<li><a href=\"https://rustup.rs\">Rust</a> &gt;= 1.70 (for runtime binary)</li>\n<li><a href=\"https://docker.com\">Docker</a> (for PostgreSQL and Redis)</li>\n<li><a href=\"https://github.com/pvolok/mprocs\">mprocs</a> (optional, for multi-process management)</li>\n</ul>\n<h2 id=\"clone-repository\">Clone Repository</h2>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">git</span><span style=\"color:#9ECBFF\"> clone</span><span style=\"color:#9ECBFF\"> https://github.com/conoda/tana.git</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">cd</span><span style=\"color:#9ECBFF\"> tana</span></span></code></pre>\n</code></pre><h2 id=\"install-dependencies\">Install Dependencies</h2>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Install all workspace dependencies</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> install</span></span></code></pre>\n</code></pre><h2 id=\"build-rust-runtime\">Build Rust Runtime</h2>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#79B8FF\">cd</span><span style=\"color:#9ECBFF\"> runtime</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">cargo</span><span style=\"color:#9ECBFF\"> build</span><span style=\"color:#79B8FF\"> --release</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">cd</span><span style=\"color:#9ECBFF\"> ..</span></span></code></pre>\n</code></pre><p>This creates the <code>tana-runtime</code> binary at <code>runtime/target/release/tana-runtime</code>.</p>\n<h2 id=\"build-cli-optional\">Build CLI (Optional)</h2>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#79B8FF\">cd</span><span style=\"color:#9ECBFF\"> cli</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> make</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">cd</span><span style=\"color:#9ECBFF\"> ..</span></span></code></pre>\n</code></pre><p>This creates a standalone <code>tana</code> binary at <code>cli/dist/tana</code>.</p>\n<h2 id=\"start-development-environment\">Start Development Environment</h2>\n<h3 id=\"option-1-all-services-with-mprocs-recommended\">Option 1: All Services with mprocs (Recommended)</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> dev</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># or</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">./dev.sh</span></span></code></pre>\n</code></pre><p>This starts:</p>\n<ul>\n<li>✅ PostgreSQL (auto)</li>\n<li>✅ Redis (auto)</li>\n<li>✅ Ledger Service (auto) - <a href=\"http://localhost:8080\">http://localhost:8080</a></li>\n<li>✅ Playground (auto) - <a href=\"http://localhost:4321\">http://localhost:4321</a></li>\n<li>⏸️ Contracts Service (manual)</li>\n<li>⏸️ Node Service (manual)</li>\n</ul>\n<p><strong>mprocs shortcuts:</strong></p>\n<ul>\n<li><code>Tab</code> - Switch between processes</li>\n<li><code>Space</code> - Start/stop a process</li>\n<li><code>Ctrl+A</code> then <code>Q</code> - Quit all processes</li>\n<li><code>Ctrl+A</code> then <code>K</code> - Kill a process</li>\n<li><code>Arrow keys</code> - Navigate</li>\n</ul>\n<h3 id=\"option-2-individual-services\">Option 2: Individual Services</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Start database infrastructure</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> db:up</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Start individual services</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> cli/main.ts</span><span style=\"color:#9ECBFF\"> start</span><span style=\"color:#6A737D\">      # Ledger service (port 8080)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> dev:contracts</span><span style=\"color:#6A737D\">       # Contracts (port 8081)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> dev:node</span><span style=\"color:#6A737D\">            # Blockchain node (port 9933)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> dev:playground</span><span style=\"color:#6A737D\">      # Playground (port 4321)</span></span></code></pre>\n</code></pre><h2 id=\"environment-configuration\">Environment Configuration</h2>\n<p>Create a <code>.env</code> file in the project root:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">cp</span><span style=\"color:#9ECBFF\"> .env.example</span><span style=\"color:#9ECBFF\"> .env</span></span></code></pre>\n</code></pre><p>Edit <code>.env</code> to configure:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Database</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">DATABASE_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">'postgres://tana:[PASSWORD]@localhost:5432/tana'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Redis</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">REDIS_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">'redis://localhost:6379'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Service Ports</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">LEDGER_PORT</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">8080</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">CONTRACTS_PORT</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">8081</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">NODE_PORT</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">9933</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Environment</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">NODE_ENV</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">development</span></span></code></pre>\n</code></pre><h2 id=\"testing\">Testing</h2>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Run all tests</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> test</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Test specific service</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#79B8FF\"> --filter</span><span style=\"color:#9ECBFF\"> @tana/ledger</span><span style=\"color:#9ECBFF\"> test</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Test Rust runtime</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">cd</span><span style=\"color:#9ECBFF\"> runtime</span><span style=\"color:#E1E4E8\"> &#x26;&#x26; </span><span style=\"color:#B392F0\">cargo</span><span style=\"color:#9ECBFF\"> test</span></span></code></pre>\n</code></pre><h2 id=\"common-development-tasks\">Common Development Tasks</h2>\n<h3 id=\"database-management\">Database Management</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Start databases</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> db:up</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Stop databases</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> db:down</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># View logs</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> db:logs</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Reset databases (warning: deletes all data)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker</span><span style=\"color:#9ECBFF\"> compose</span><span style=\"color:#9ECBFF\"> down</span><span style=\"color:#79B8FF\"> -v</span><span style=\"color:#E1E4E8\"> &#x26;&#x26; </span><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> db:up</span></span></code></pre>\n</code></pre><h3 id=\"building\">Building</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Build all services</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> build</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Build Rust runtime</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> build:runtime</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Build CLI binary</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">cd</span><span style=\"color:#9ECBFF\"> cli</span><span style=\"color:#E1E4E8\"> &#x26;&#x26; </span><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> make</span></span></code></pre>\n</code></pre><h3 id=\"running-examples\">Running Examples</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Test the runtime</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> chaintest</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Run a contract</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">cd</span><span style=\"color:#9ECBFF\"> runtime</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">cargo</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#79B8FF\"> --</span><span style=\"color:#9ECBFF\"> ../examples/default.ts</span></span></code></pre>\n</code></pre><h2 id=\"troubleshooting\">Troubleshooting</h2>\n<h3 id=\"port-already-in-use\">Port Already in Use</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Kill process on port 8080</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">lsof</span><span style=\"color:#79B8FF\"> -ti:8080</span><span style=\"color:#F97583\"> |</span><span style=\"color:#B392F0\"> xargs</span><span style=\"color:#9ECBFF\"> kill</span><span style=\"color:#79B8FF\"> -9</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Check what's using a port</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">lsof</span><span style=\"color:#79B8FF\"> -i</span><span style=\"color:#9ECBFF\"> :8080</span></span></code></pre>\n</code></pre><h3 id=\"database-connection-errors\">Database Connection Errors</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Restart PostgreSQL</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker</span><span style=\"color:#9ECBFF\"> compose</span><span style=\"color:#9ECBFF\"> restart</span><span style=\"color:#9ECBFF\"> postgres</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Check logs</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker</span><span style=\"color:#9ECBFF\"> compose</span><span style=\"color:#9ECBFF\"> logs</span><span style=\"color:#9ECBFF\"> postgres</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Verify DATABASE_URL in .env</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">cat</span><span style=\"color:#9ECBFF\"> .env</span><span style=\"color:#F97583\"> |</span><span style=\"color:#B392F0\"> grep</span><span style=\"color:#9ECBFF\"> DATABASE_URL</span></span></code></pre>\n</code></pre><h3 id=\"build-errors\">Build Errors</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Clean and rebuild</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">rm</span><span style=\"color:#79B8FF\"> -rf</span><span style=\"color:#9ECBFF\"> node_modules</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> install</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Rust</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">cd</span><span style=\"color:#9ECBFF\"> runtime</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">cargo</span><span style=\"color:#9ECBFF\"> clean</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">cargo</span><span style=\"color:#9ECBFF\"> build</span><span style=\"color:#79B8FF\"> --release</span></span></code></pre>\n</code></pre><h2 id=\"project-structure\">Project Structure</h2>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>tana/</span></span>\n<span class=\"line\"><span>├── cli/             # CLI binary (TypeScript/Bun)</span></span>\n<span class=\"line\"><span>├── runtime/         # Contract execution (Rust)</span></span>\n<span class=\"line\"><span>├── ledger/          # Ledger service (TypeScript/Bun)</span></span>\n<span class=\"line\"><span>├── contracts/       # Contract executor (TypeScript/Bun)</span></span>\n<span class=\"line\"><span>├── node/            # Blockchain node (TypeScript/Bun)</span></span>\n<span class=\"line\"><span>├── websites/</span></span>\n<span class=\"line\"><span>│   ├── docs/        # Documentation (Astro/Starlight)</span></span>\n<span class=\"line\"><span>│   ├── playground/  # Contract playground (Astro/Svelte)</span></span>\n<span class=\"line\"><span>│   └── landing/     # Landing page (Next.js)</span></span>\n<span class=\"line\"><span>├── types/           # Shared TypeScript types</span></span>\n<span class=\"line\"><span>├── examples/        # Example contracts</span></span>\n<span class=\"line\"><span>└── docs/            # Technical documentation</span></span></code></pre>\n</code></pre><h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li>Read <a href=\"/contributing/architecture/\">System Architecture</a> to understand how Tana works</li>\n<li>Explore <a href=\"/contributing/core/data-model/\">Core Concepts</a> for technical details</li>\n<li>Check out <a href=\"/contributing/testing/\">Testing Guide</a> for writing tests</li>\n</ul>\n"
  },
  {
    "slug": [
      "contributing",
      "intro"
    ],
    "metadata": {
      "title": "Contributing",
      "description": "Guide for contributing to Tana development",
      "sidebar": {
        "order": 1
      }
    },
    "content": "\nThank you for your interest in contributing to Tana! This section contains documentation for developers who want to contribute to the project.\n\n## For Users vs Contributors\n\n**If you're a user** looking to use Tana:\n- See [Quick Start](/guides/quickstart/) for installation\n- See [CLI Reference](/tana-cli/intro/) for commands\n- See [API Reference](/tana-api/intro/) for API endpoints\n\n**If you're a contributor** looking to develop Tana:\n- Continue reading this section\n- See [Development Setup](/contributing/setup/) to build from source\n- See [System Architecture](/contributing/architecture/) to understand the codebase\n\n## What's in This Section\n\n### Development\n- [Development Setup](/contributing/setup/) - Build Tana from source\n- [System Architecture](/contributing/architecture/) - How Tana works internally\n- [Testing](/contributing/testing/) - Running tests\n\n### Technical Details\n- [Data Model](/contributing/core/data-model/) - Database schemas and structures\n- [Blocks & Blockchain](/contributing/core/blocks/) - Block production and validation\n- [System Flows](/contributing/core/system-flows/) - Internal data flows\n\n## Ways to Contribute\n\n### Code Contributions\n- Fix bugs\n- Add features\n- Improve performance\n- Write tests\n\n### Documentation\n- Improve existing docs\n- Add examples\n- Fix typos\n- Translate documentation\n\n### Community\n- Help others in discussions\n- Report bugs\n- Suggest features\n- Write blog posts or tutorials\n\n## Getting Help\n\n- **GitHub Issues**: Report bugs or request features\n- **GitHub Discussions**: Ask questions and share ideas\n- **Discord**: Join the community (coming soon)\n\n## Code of Conduct\n\nBe respectful, inclusive, and professional. We're all here to learn and build together.\n",
    "html": "<p>Thank you for your interest in contributing to Tana! This section contains documentation for developers who want to contribute to the project.</p>\n<h2 id=\"for-users-vs-contributors\">For Users vs Contributors</h2>\n<p><strong>If you&#39;re a user</strong> looking to use Tana:</p>\n<ul>\n<li>See <a href=\"/guides/quickstart/\">Quick Start</a> for installation</li>\n<li>See <a href=\"/tana-cli/intro/\">CLI Reference</a> for commands</li>\n<li>See <a href=\"/tana-api/intro/\">API Reference</a> for API endpoints</li>\n</ul>\n<p><strong>If you&#39;re a contributor</strong> looking to develop Tana:</p>\n<ul>\n<li>Continue reading this section</li>\n<li>See <a href=\"/contributing/setup/\">Development Setup</a> to build from source</li>\n<li>See <a href=\"/contributing/architecture/\">System Architecture</a> to understand the codebase</li>\n</ul>\n<h2 id=\"whats-in-this-section\">What&#39;s in This Section</h2>\n<h3 id=\"development\">Development</h3>\n<ul>\n<li><a href=\"/contributing/setup/\">Development Setup</a> - Build Tana from source</li>\n<li><a href=\"/contributing/architecture/\">System Architecture</a> - How Tana works internally</li>\n<li><a href=\"/contributing/testing/\">Testing</a> - Running tests</li>\n</ul>\n<h3 id=\"technical-details\">Technical Details</h3>\n<ul>\n<li><a href=\"/contributing/core/data-model/\">Data Model</a> - Database schemas and structures</li>\n<li><a href=\"/contributing/core/blocks/\">Blocks &amp; Blockchain</a> - Block production and validation</li>\n<li><a href=\"/contributing/core/system-flows/\">System Flows</a> - Internal data flows</li>\n</ul>\n<h2 id=\"ways-to-contribute\">Ways to Contribute</h2>\n<h3 id=\"code-contributions\">Code Contributions</h3>\n<ul>\n<li>Fix bugs</li>\n<li>Add features</li>\n<li>Improve performance</li>\n<li>Write tests</li>\n</ul>\n<h3 id=\"documentation\">Documentation</h3>\n<ul>\n<li>Improve existing docs</li>\n<li>Add examples</li>\n<li>Fix typos</li>\n<li>Translate documentation</li>\n</ul>\n<h3 id=\"community\">Community</h3>\n<ul>\n<li>Help others in discussions</li>\n<li>Report bugs</li>\n<li>Suggest features</li>\n<li>Write blog posts or tutorials</li>\n</ul>\n<h2 id=\"getting-help\">Getting Help</h2>\n<ul>\n<li><strong>GitHub Issues</strong>: Report bugs or request features</li>\n<li><strong>GitHub Discussions</strong>: Ask questions and share ideas</li>\n<li><strong>Discord</strong>: Join the community (coming soon)</li>\n</ul>\n<h2 id=\"code-of-conduct\">Code of Conduct</h2>\n<p>Be respectful, inclusive, and professional. We&#39;re all here to learn and build together.</p>\n"
  },
  {
    "slug": [
      "contributing",
      "runtime",
      "intro"
    ],
    "metadata": {
      "title": "Runtime Architecture",
      "description": "V8-based TypeScript runtime for smart contracts",
      "sidebar": {
        "order": 1
      }
    },
    "content": "\nTana Runtime is a lightweight JavaScript/TypeScript runtime built on **deno_core** (Deno's V8 engine). It provides a sandboxed execution environment for TypeScript smart contracts, similar to Cloudflare Workers.\n\n## Overview\n\nThe runtime creates a secure sandbox for executing TypeScript with:\n\n1. **V8 JavaScript Engine** - Via deno_core for native performance\n2. **TypeScript Compiler** - Dynamically transpiles TypeScript to JavaScript\n3. **Custom Module System** - Virtual modules like `tana:core`, `tana:data`, `tana:utils`\n4. **Sandbox Isolation** - Hides Deno API, exposes only whitelisted functionality\n5. **Dual Environment Support** - Same code runs in CLI runtime and browser playground\n\n## Quick Start\n\n```bash\n# Run the Rust CLI runtime\ncd runtime\ncargo run\n\n# Or run a specific script\ncargo run example.ts\n```\n\n## Architecture\n\n### Runtime Stack\n\n```\n┌─────────────────────────────────────┐\n│   TypeScript Smart Contracts        │\n├─────────────────────────────────────┤\n│   Virtual Modules (tana:core, etc)  │\n├─────────────────────────────────────┤\n│   TypeScript Compiler (typescript.js)│\n├─────────────────────────────────────┤\n│   Sandboxed V8 Runtime (deno_core)  │\n├─────────────────────────────────────┤\n│   Rust Runtime / Browser Playground │\n└─────────────────────────────────────┘\n```\n\n### Core Components\n\n**src/main.rs** - Main runtime entry point\n- Initializes `JsRuntime` with deno_core\n- Loads internal modules\n- Defines ops (Rust↔JavaScript bridge)\n- Bootstraps V8 with tana-globals.ts\n\n**src/lib.rs** - Library exports for WASM builds\n\n**build.rs** - Build script\n- Extracts version info (Tana, Deno Core, V8)\n- Embeds metadata at compile time\n\n**tana-globals.ts** - Bootstrap code\n- Defines `globalThis.tana`\n- Hides `Deno` API for isolation\n- Sets up module loader\n\n**typescript.js** - Embedded TypeScript compiler\n- Bundled compiler for `.ts` → `.js` transpilation\n- Loaded into V8 at runtime\n\n### Execution Flow\n\n1. `main.rs` bootstraps V8 + deno_core runtime\n2. Loads `typescript.js` compiler into V8\n3. Injects `tana-globals.ts` and hides `Deno` API\n4. Registers virtual modules (`tana:core`, `tana:data`, etc.)\n5. Reads user script (e.g., `example.ts`)\n6. Transpiles TypeScript → JavaScript\n7. Executes in sandbox with isolated state\n\n## Implemented Features\n\n### Storage API (`tana:data`)\n\n**Status:** ✅ Feature parity achieved (works identically in both environments)\n\n```typescript\nimport { data } from 'tana:data'\n\n// Set values (staged, not committed yet)\nawait data.set('counter', 42)\nawait data.set('user', { name: 'Alice', balance: 1000 })\n\n// Read values\nconst count = await data.get('counter')  // 42\nconst user = await data.get('user')      // { name: 'Alice', balance: 1000 }\n\n// Pattern matching\nawait data.set('user:1:name', 'Bob')\nawait data.set('user:2:name', 'Charlie')\nconst userKeys = await data.keys('user:*')  // ['user:1:name', 'user:2:name']\n\n// Atomic commit (all or nothing)\nawait data.commit()\n```\n\n**Implementation:**\n- **Playground:** localStorage backend with full persistence\n- **Rust Runtime:** In-memory HashMap (resets each run)\n- **Planned:** Redis backend for production persistence\n\n**Storage Limits:**\n- Max key size: 256 bytes\n- Max value size: 10 KB\n- Max total size: 100 KB per contract\n- Max keys: 1000\n\n**Key Features:**\n- Staging buffer with atomic commits\n- Size validation before persistence\n- JSON auto-serialization\n- Glob pattern matching support\n\n### Fetch API (`tana:utils`)\n\n**Status:** ✅ Working in both environments\n\n```typescript\nimport { fetch } from 'tana:utils'\n\n// Whitelisted domains only\nconst data = await fetch('https://pokeapi.co/api/v2/pokemon/ditto')\nconsole.log(data)\n```\n\n**Security:**\n- Domain whitelist: `pokeapi.co`, `tana.dev`, `localhost`, etc.\n- Rust: reqwest + tokio async runtime\n- Playground: browser fetch with same whitelist\n\n### Console API (`tana:core`)\n\n**Status:** ✅ Working in both environments\n\n```typescript\nimport { console } from 'tana:core'\n\nconsole.log('Hello from Tana!')\nconsole.error('Error message')\n\n// Runtime version info\nimport { version } from 'tana:core'\nconsole.log(version.tana)       // \"0.1.0\"\nconsole.log(version.deno_core)  // \"0.338\"\nconsole.log(version.v8)         // \"13.2.281.5\"\n```\n\n## Feature Parity Strategy\n\n**Dual Environment Support:**\n\n1. **Rust CLI Runtime** (`cargo run`) - Production-ready V8 sandbox\n2. **Browser Playground** (Astro/Svelte web app) - Development/testing UI\n\n**Synchronization Points:**\n- `src/main.rs` - Rust ops definitions\n- `playground/src/pages/sandbox.astro` - JavaScript module implementations\n- `types/*.d.ts` - Shared TypeScript definitions\n- `playground/src/components/Editor.svelte` - Monaco type definitions\n\n**Rule:** If it's in the type definitions, it MUST work in BOTH environments.\n\n## File Structure\n\n### Core Runtime Files\n\n| File | Description |\n|------|-------------|\n| **src/main.rs** | Main entry point, initializes JsRuntime, defines ops |\n| **src/lib.rs** | Library exports for WASM builds |\n| **build.rs** | Build script extracting version info |\n| **Cargo.toml** | Rust dependencies and package configuration |\n| **typescript.js** | Embedded TypeScript compiler |\n| **tana-globals.ts** | Bootstrap defining `globalThis.tana` |\n\n### TypeScript & Type Definitions\n\n| File | Description |\n|------|-------------|\n| **types/tana.d.ts** | Type declarations for `tana` and `tana:core` |\n| **types/tana-data.d.ts** | Type declarations for `tana:data` storage |\n| **types/tana-utils.d.ts** | Type declarations for `tana:utils` |\n| **tsconfig.json** | TypeScript config mapping `\"tana:*\"` paths |\n\n### Example & Test Files\n\n| File | Description |\n|------|-------------|\n| **example.ts** | Example TypeScript program |\n| **counter-test.ts** | Simple counter demonstrating storage API |\n| **test-storage.ts** | Comprehensive storage API tests |\n| **test-fetch.ts** | Fetch API tests |\n\n## Technical Stack\n\n### Rust Dependencies\n\n```toml\ndeno_core = \"0.338\"          # V8 runtime\ndeno_error = \"0.5.7\"         # Error handling\nreqwest = \"0.12\"             # HTTP client\ntokio = \"1\"                  # Async runtime\nredis = \"0.27\"               # Database client (planned)\nserde_json = \"1.0\"           # JSON handling\nwasm-bindgen = \"0.2\"         # WASM support\n```\n\n## Example Smart Contract\n\n```typescript\nimport { console } from 'tana:core'\nimport { data } from 'tana:data'\n\n// Simple token transfer contract\nasync function transfer(from: string, to: string, amount: number) {\n  // Read current balances\n  const fromBalance = parseInt((await data.get(`balance:${from}`)) as string)\n  const toBalance = parseInt((await data.get(`balance:${to}`)) as string)\n\n  // Validate\n  if (fromBalance < amount) {\n    throw new Error('Insufficient balance')\n  }\n\n  // Update balances\n  await data.set(`balance:${from}`, String(fromBalance - amount))\n  await data.set(`balance:${to}`, String(toBalance + amount))\n\n  // Commit atomically (both balances updated or neither)\n  await data.commit()\n\n  console.log(`Transferred ${amount} from ${from} to ${to}`)\n}\n\n// Initialize balances\nawait data.set('balance:alice', '1000')\nawait data.set('balance:bob', '500')\nawait data.commit()\n\n// Execute transfer\nawait transfer('alice', 'bob', 200)\n\n// Check new balances\nconsole.log('Alice:', await data.get('balance:alice'))  // '800'\nconsole.log('Bob:', await data.get('balance:bob'))      // '700'\n```\n\n## Testing\n\n### CLI Runtime\n\n```bash\n# Run example script\ncargo run\n\n# Run specific test\ncargo run counter-test.ts\ncargo run test-storage.ts\ncargo run test-fetch.ts\n```\n\n### Browser Playground\n\n```bash\ncd playground\nnpm install\nnpm run dev\n```\n\nOpen http://localhost:4322/ and use the Monaco editor to write and run TypeScript contracts.\n\n**Inspect Storage:**\n1. Open Browser DevTools (F12)\n2. Go to **Application > Local Storage**\n3. Look for keys starting with `tana:data:`\n\n## Development Status\n\n### Working ✅\n\n- V8 runtime bootstrapping\n- TypeScript transpilation\n- Module system (`tana:core`, `tana:data`, `tana:utils`)\n- Storage API with staging + atomic commits\n- Fetch API with domain whitelist\n- Browser playground with Monaco editor\n- Feature parity between CLI and playground\n- JSON auto-serialization for storage\n- Glob pattern matching for keys\n\n### In Progress 🚧\n\n- Redis backend for persistent storage (Rust runtime)\n- Docker setup for database services\n- Blockchain integration (`tana:blockchain` module)\n- Data View tab in playground UI\n- Gas costs and storage rent model\n\n### Planned 📋\n\n- PostgreSQL integration for ledger state\n- Ed25519 signature verification\n- Block batching and Merkle proofs\n- Multi-currency account system\n- Contract deployment and versioning\n- API endpoints for network access\n\n## Next Steps\n\n1. **Redis Integration** - Add persistent storage backend to Rust runtime\n2. **Docker Compose** - Setup Redis + PostgreSQL services\n3. **Data View Tab** - Add UI to visualize storage in playground\n4. **Blockchain Module** - Implement `tana:blockchain` API\n5. **Gas Costs** - Add metering for storage operations\n6. **Contract Deployment** - Support uploading and versioning contracts\n\n## Important Notes\n\n- `globalThis.Deno` is deleted to ensure true sandbox isolation\n- The current module system will be replaced by a Rust `ModuleLoader`\n- Storage limits prevent abuse (similar to Ethereum gas model)\n- Same TypeScript code runs in CLI and browser playground\n- Contracts are deterministic state machines identified by code hash\n\n## Related Documentation\n\n- [Smart Contract Examples](/guides/smart-contracts/) - Writing contracts\n- [Edge Server](/contributing/edge/intro/) - Production contract execution\n- [Environment Variables](/contributing/env-vars/) - Configuration\n",
    "html": "<p>Tana Runtime is a lightweight JavaScript/TypeScript runtime built on <strong>deno_core</strong> (Deno&#39;s V8 engine). It provides a sandboxed execution environment for TypeScript smart contracts, similar to Cloudflare Workers.</p>\n<h2 id=\"overview\">Overview</h2>\n<p>The runtime creates a secure sandbox for executing TypeScript with:</p>\n<ol>\n<li><strong>V8 JavaScript Engine</strong> - Via deno_core for native performance</li>\n<li><strong>TypeScript Compiler</strong> - Dynamically transpiles TypeScript to JavaScript</li>\n<li><strong>Custom Module System</strong> - Virtual modules like <code>tana:core</code>, <code>tana:data</code>, <code>tana:utils</code></li>\n<li><strong>Sandbox Isolation</strong> - Hides Deno API, exposes only whitelisted functionality</li>\n<li><strong>Dual Environment Support</strong> - Same code runs in CLI runtime and browser playground</li>\n</ol>\n<h2 id=\"quick-start\">Quick Start</h2>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Run the Rust CLI runtime</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">cd</span><span style=\"color:#9ECBFF\"> runtime</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">cargo</span><span style=\"color:#9ECBFF\"> run</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Or run a specific script</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">cargo</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> example.ts</span></span></code></pre>\n</code></pre><h2 id=\"architecture\">Architecture</h2>\n<h3 id=\"runtime-stack\">Runtime Stack</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>┌─────────────────────────────────────┐</span></span>\n<span class=\"line\"><span>│   TypeScript Smart Contracts        │</span></span>\n<span class=\"line\"><span>├─────────────────────────────────────┤</span></span>\n<span class=\"line\"><span>│   Virtual Modules (tana:core, etc)  │</span></span>\n<span class=\"line\"><span>├─────────────────────────────────────┤</span></span>\n<span class=\"line\"><span>│   TypeScript Compiler (typescript.js)│</span></span>\n<span class=\"line\"><span>├─────────────────────────────────────┤</span></span>\n<span class=\"line\"><span>│   Sandboxed V8 Runtime (deno_core)  │</span></span>\n<span class=\"line\"><span>├─────────────────────────────────────┤</span></span>\n<span class=\"line\"><span>│   Rust Runtime / Browser Playground │</span></span>\n<span class=\"line\"><span>└─────────────────────────────────────┘</span></span></code></pre>\n</code></pre><h3 id=\"core-components\">Core Components</h3>\n<p><strong>src/main.rs</strong> - Main runtime entry point</p>\n<ul>\n<li>Initializes <code>JsRuntime</code> with deno_core</li>\n<li>Loads internal modules</li>\n<li>Defines ops (Rust↔JavaScript bridge)</li>\n<li>Bootstraps V8 with tana-globals.ts</li>\n</ul>\n<p><strong>src/lib.rs</strong> - Library exports for WASM builds</p>\n<p><strong>build.rs</strong> - Build script</p>\n<ul>\n<li>Extracts version info (Tana, Deno Core, V8)</li>\n<li>Embeds metadata at compile time</li>\n</ul>\n<p><strong>tana-globals.ts</strong> - Bootstrap code</p>\n<ul>\n<li>Defines <code>globalThis.tana</code></li>\n<li>Hides <code>Deno</code> API for isolation</li>\n<li>Sets up module loader</li>\n</ul>\n<p><strong>typescript.js</strong> - Embedded TypeScript compiler</p>\n<ul>\n<li>Bundled compiler for <code>.ts</code> → <code>.js</code> transpilation</li>\n<li>Loaded into V8 at runtime</li>\n</ul>\n<h3 id=\"execution-flow\">Execution Flow</h3>\n<ol>\n<li><code>main.rs</code> bootstraps V8 + deno_core runtime</li>\n<li>Loads <code>typescript.js</code> compiler into V8</li>\n<li>Injects <code>tana-globals.ts</code> and hides <code>Deno</code> API</li>\n<li>Registers virtual modules (<code>tana:core</code>, <code>tana:data</code>, etc.)</li>\n<li>Reads user script (e.g., <code>example.ts</code>)</li>\n<li>Transpiles TypeScript → JavaScript</li>\n<li>Executes in sandbox with isolated state</li>\n</ol>\n<h2 id=\"implemented-features\">Implemented Features</h2>\n<h3 id=\"storage-api-tanadata\">Storage API (<code>tana:data</code>)</h3>\n<p><strong>Status:</strong> ✅ Feature parity achieved (works identically in both environments)</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { data } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana:data'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Set values (staged, not committed yet)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">set</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'counter'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">42</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">set</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'user'</span><span style=\"color:#E1E4E8\">, { name: </span><span style=\"color:#9ECBFF\">'Alice'</span><span style=\"color:#E1E4E8\">, balance: </span><span style=\"color:#79B8FF\">1000</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Read values</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> count</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'counter'</span><span style=\"color:#E1E4E8\">)  </span><span style=\"color:#6A737D\">// 42</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> user</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'user'</span><span style=\"color:#E1E4E8\">)      </span><span style=\"color:#6A737D\">// { name: 'Alice', balance: 1000 }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Pattern matching</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">set</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'user:1:name'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'Bob'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">set</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'user:2:name'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'Charlie'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> userKeys</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">keys</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'user:*'</span><span style=\"color:#E1E4E8\">)  </span><span style=\"color:#6A737D\">// ['user:1:name', 'user:2:name']</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Atomic commit (all or nothing)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">commit</span><span style=\"color:#E1E4E8\">()</span></span></code></pre>\n</code></pre><p><strong>Implementation:</strong></p>\n<ul>\n<li><strong>Playground:</strong> localStorage backend with full persistence</li>\n<li><strong>Rust Runtime:</strong> In-memory HashMap (resets each run)</li>\n<li><strong>Planned:</strong> Redis backend for production persistence</li>\n</ul>\n<p><strong>Storage Limits:</strong></p>\n<ul>\n<li>Max key size: 256 bytes</li>\n<li>Max value size: 10 KB</li>\n<li>Max total size: 100 KB per contract</li>\n<li>Max keys: 1000</li>\n</ul>\n<p><strong>Key Features:</strong></p>\n<ul>\n<li>Staging buffer with atomic commits</li>\n<li>Size validation before persistence</li>\n<li>JSON auto-serialization</li>\n<li>Glob pattern matching support</li>\n</ul>\n<h3 id=\"fetch-api-tanautils\">Fetch API (<code>tana:utils</code>)</h3>\n<p><strong>Status:</strong> ✅ Working in both environments</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { fetch } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana:utils'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Whitelisted domains only</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> data</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> fetch</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'https://pokeapi.co/api/v2/pokemon/ditto'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(data)</span></span></code></pre>\n</code></pre><p><strong>Security:</strong></p>\n<ul>\n<li>Domain whitelist: <code>pokeapi.co</code>, <code>tana.dev</code>, <code>localhost</code>, etc.</li>\n<li>Rust: reqwest + tokio async runtime</li>\n<li>Playground: browser fetch with same whitelist</li>\n</ul>\n<h3 id=\"console-api-tanacore\">Console API (<code>tana:core</code>)</h3>\n<p><strong>Status:</strong> ✅ Working in both environments</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { console } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana:core'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Hello from Tana!'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Error message'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Runtime version info</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { version } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana:core'</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(version.tana)       </span><span style=\"color:#6A737D\">// \"0.1.0\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(version.deno_core)  </span><span style=\"color:#6A737D\">// \"0.338\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(version.v8)         </span><span style=\"color:#6A737D\">// \"13.2.281.5\"</span></span></code></pre>\n</code></pre><h2 id=\"feature-parity-strategy\">Feature Parity Strategy</h2>\n<p><strong>Dual Environment Support:</strong></p>\n<ol>\n<li><strong>Rust CLI Runtime</strong> (<code>cargo run</code>) - Production-ready V8 sandbox</li>\n<li><strong>Browser Playground</strong> (Astro/Svelte web app) - Development/testing UI</li>\n</ol>\n<p><strong>Synchronization Points:</strong></p>\n<ul>\n<li><code>src/main.rs</code> - Rust ops definitions</li>\n<li><code>playground/src/pages/sandbox.astro</code> - JavaScript module implementations</li>\n<li><code>types/*.d.ts</code> - Shared TypeScript definitions</li>\n<li><code>playground/src/components/Editor.svelte</code> - Monaco type definitions</li>\n</ul>\n<p><strong>Rule:</strong> If it&#39;s in the type definitions, it MUST work in BOTH environments.</p>\n<h2 id=\"file-structure\">File Structure</h2>\n<h3 id=\"core-runtime-files\">Core Runtime Files</h3>\n<table>\n<thead>\n<tr>\n<th>File</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>src/main.rs</strong></td>\n<td>Main entry point, initializes JsRuntime, defines ops</td>\n</tr>\n<tr>\n<td><strong>src/lib.rs</strong></td>\n<td>Library exports for WASM builds</td>\n</tr>\n<tr>\n<td><strong>build.rs</strong></td>\n<td>Build script extracting version info</td>\n</tr>\n<tr>\n<td><strong>Cargo.toml</strong></td>\n<td>Rust dependencies and package configuration</td>\n</tr>\n<tr>\n<td><strong>typescript.js</strong></td>\n<td>Embedded TypeScript compiler</td>\n</tr>\n<tr>\n<td><strong>tana-globals.ts</strong></td>\n<td>Bootstrap defining <code>globalThis.tana</code></td>\n</tr>\n</tbody></table>\n<h3 id=\"typescript--type-definitions\">TypeScript &amp; Type Definitions</h3>\n<table>\n<thead>\n<tr>\n<th>File</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>types/tana.d.ts</strong></td>\n<td>Type declarations for <code>tana</code> and <code>tana:core</code></td>\n</tr>\n<tr>\n<td><strong>types/tana-data.d.ts</strong></td>\n<td>Type declarations for <code>tana:data</code> storage</td>\n</tr>\n<tr>\n<td><strong>types/tana-utils.d.ts</strong></td>\n<td>Type declarations for <code>tana:utils</code></td>\n</tr>\n<tr>\n<td><strong>tsconfig.json</strong></td>\n<td>TypeScript config mapping <code>&quot;tana:*&quot;</code> paths</td>\n</tr>\n</tbody></table>\n<h3 id=\"example--test-files\">Example &amp; Test Files</h3>\n<table>\n<thead>\n<tr>\n<th>File</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>example.ts</strong></td>\n<td>Example TypeScript program</td>\n</tr>\n<tr>\n<td><strong>counter-test.ts</strong></td>\n<td>Simple counter demonstrating storage API</td>\n</tr>\n<tr>\n<td><strong>test-storage.ts</strong></td>\n<td>Comprehensive storage API tests</td>\n</tr>\n<tr>\n<td><strong>test-fetch.ts</strong></td>\n<td>Fetch API tests</td>\n</tr>\n</tbody></table>\n<h2 id=\"technical-stack\">Technical Stack</h2>\n<h3 id=\"rust-dependencies\">Rust Dependencies</h3>\n<pre><code class=\"language-toml\">deno_core = &quot;0.338&quot;          # V8 runtime\ndeno_error = &quot;0.5.7&quot;         # Error handling\nreqwest = &quot;0.12&quot;             # HTTP client\ntokio = &quot;1&quot;                  # Async runtime\nredis = &quot;0.27&quot;               # Database client (planned)\nserde_json = &quot;1.0&quot;           # JSON handling\nwasm-bindgen = &quot;0.2&quot;         # WASM support\n</code></pre><h2 id=\"example-smart-contract\">Example Smart Contract</h2>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { console } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana:core'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { data } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana:data'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Simple token transfer contract</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> transfer</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">from</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">to</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">amount</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Read current balances</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> fromBalance</span><span style=\"color:#F97583\"> =</span><span style=\"color:#B392F0\"> parseInt</span><span style=\"color:#E1E4E8\">((</span><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`balance:${</span><span style=\"color:#E1E4E8\">from</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">)) </span><span style=\"color:#F97583\">as</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> toBalance</span><span style=\"color:#F97583\"> =</span><span style=\"color:#B392F0\"> parseInt</span><span style=\"color:#E1E4E8\">((</span><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`balance:${</span><span style=\"color:#E1E4E8\">to</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">)) </span><span style=\"color:#F97583\">as</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Validate</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (fromBalance </span><span style=\"color:#F97583\">&#x3C;</span><span style=\"color:#E1E4E8\"> amount) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    throw</span><span style=\"color:#F97583\"> new</span><span style=\"color:#B392F0\"> Error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Insufficient balance'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Update balances</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">set</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`balance:${</span><span style=\"color:#E1E4E8\">from</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">String</span><span style=\"color:#E1E4E8\">(fromBalance </span><span style=\"color:#F97583\">-</span><span style=\"color:#E1E4E8\"> amount))</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">set</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`balance:${</span><span style=\"color:#E1E4E8\">to</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">String</span><span style=\"color:#E1E4E8\">(toBalance </span><span style=\"color:#F97583\">+</span><span style=\"color:#E1E4E8\"> amount))</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Commit atomically (both balances updated or neither)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">commit</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`Transferred ${</span><span style=\"color:#E1E4E8\">amount</span><span style=\"color:#9ECBFF\">} from ${</span><span style=\"color:#E1E4E8\">from</span><span style=\"color:#9ECBFF\">} to ${</span><span style=\"color:#E1E4E8\">to</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Initialize balances</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">set</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'balance:alice'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'1000'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">set</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'balance:bob'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'500'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">commit</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Execute transfer</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#B392F0\"> transfer</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'alice'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'bob'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">200</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Check new balances</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Alice:'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'balance:alice'</span><span style=\"color:#E1E4E8\">))  </span><span style=\"color:#6A737D\">// '800'</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Bob:'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'balance:bob'</span><span style=\"color:#E1E4E8\">))      </span><span style=\"color:#6A737D\">// '700'</span></span></code></pre>\n</code></pre><h2 id=\"testing\">Testing</h2>\n<h3 id=\"cli-runtime\">CLI Runtime</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Run example script</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">cargo</span><span style=\"color:#9ECBFF\"> run</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Run specific test</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">cargo</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> counter-test.ts</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">cargo</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> test-storage.ts</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">cargo</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> test-fetch.ts</span></span></code></pre>\n</code></pre><h3 id=\"browser-playground\">Browser Playground</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#79B8FF\">cd</span><span style=\"color:#9ECBFF\"> playground</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> install</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> dev</span></span></code></pre>\n</code></pre><p>Open <a href=\"http://localhost:4322/\">http://localhost:4322/</a> and use the Monaco editor to write and run TypeScript contracts.</p>\n<p><strong>Inspect Storage:</strong></p>\n<ol>\n<li>Open Browser DevTools (F12)</li>\n<li>Go to <strong>Application &gt; Local Storage</strong></li>\n<li>Look for keys starting with <code>tana:data:</code></li>\n</ol>\n<h2 id=\"development-status\">Development Status</h2>\n<h3 id=\"working-\">Working ✅</h3>\n<ul>\n<li>V8 runtime bootstrapping</li>\n<li>TypeScript transpilation</li>\n<li>Module system (<code>tana:core</code>, <code>tana:data</code>, <code>tana:utils</code>)</li>\n<li>Storage API with staging + atomic commits</li>\n<li>Fetch API with domain whitelist</li>\n<li>Browser playground with Monaco editor</li>\n<li>Feature parity between CLI and playground</li>\n<li>JSON auto-serialization for storage</li>\n<li>Glob pattern matching for keys</li>\n</ul>\n<h3 id=\"in-progress-\">In Progress 🚧</h3>\n<ul>\n<li>Redis backend for persistent storage (Rust runtime)</li>\n<li>Docker setup for database services</li>\n<li>Blockchain integration (<code>tana:blockchain</code> module)</li>\n<li>Data View tab in playground UI</li>\n<li>Gas costs and storage rent model</li>\n</ul>\n<h3 id=\"planned-\">Planned 📋</h3>\n<ul>\n<li>PostgreSQL integration for ledger state</li>\n<li>Ed25519 signature verification</li>\n<li>Block batching and Merkle proofs</li>\n<li>Multi-currency account system</li>\n<li>Contract deployment and versioning</li>\n<li>API endpoints for network access</li>\n</ul>\n<h2 id=\"next-steps\">Next Steps</h2>\n<ol>\n<li><strong>Redis Integration</strong> - Add persistent storage backend to Rust runtime</li>\n<li><strong>Docker Compose</strong> - Setup Redis + PostgreSQL services</li>\n<li><strong>Data View Tab</strong> - Add UI to visualize storage in playground</li>\n<li><strong>Blockchain Module</strong> - Implement <code>tana:blockchain</code> API</li>\n<li><strong>Gas Costs</strong> - Add metering for storage operations</li>\n<li><strong>Contract Deployment</strong> - Support uploading and versioning contracts</li>\n</ol>\n<h2 id=\"important-notes\">Important Notes</h2>\n<ul>\n<li><code>globalThis.Deno</code> is deleted to ensure true sandbox isolation</li>\n<li>The current module system will be replaced by a Rust <code>ModuleLoader</code></li>\n<li>Storage limits prevent abuse (similar to Ethereum gas model)</li>\n<li>Same TypeScript code runs in CLI and browser playground</li>\n<li>Contracts are deterministic state machines identified by code hash</li>\n</ul>\n<h2 id=\"related-documentation\">Related Documentation</h2>\n<ul>\n<li><a href=\"/guides/smart-contracts/\">Smart Contract Examples</a> - Writing contracts</li>\n<li><a href=\"/contributing/edge/intro/\">Edge Server</a> - Production contract execution</li>\n<li><a href=\"/contributing/env-vars/\">Environment Variables</a> - Configuration</li>\n</ul>\n"
  },
  {
    "slug": [
      "contributing",
      "runtime",
      "modules",
      "kv"
    ],
    "metadata": {
      "title": "KV Storage Implementation",
      "description": "Technical details of tana/kv module across all runtimes"
    },
    "content": "\nTechnical reference for the `tana/kv` module implementation across tana-runtime, tana-edge, and playground environments.\n\n## Architecture Overview\n\nKV storage provides Cloudflare Workers-compatible key-value storage with automatic per-contract namespace isolation.\n\n### Namespace Isolation\n\nAll keys are internally prefixed with the contract name:\n```\nStored Key Format: \"{contract_name}:{user_key}\"\nExample: \"my_contract:username\" → \"alice\"\n```\n\nThis ensures contracts cannot access each other's data.\n\n## Runtime Implementations\n\n### tana-runtime (Rust CLI)\n\n**Location:** `runtime/src/tana_kv.rs`, `runtime/src/main.rs`\n\n**Storage Backend:** PostgreSQL (migration `0011_kv_storage.sql`)\n\n**Schema:**\n```sql\nCREATE TABLE kv_storage (\n  contract_name TEXT NOT NULL,\n  key TEXT NOT NULL,\n  value TEXT NOT NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (contract_name, key)\n);\n```\n\n**Rust Ops:**\n```rust\n#[op2]\n#[string]\nfn op_kv_get_raw(\n    state: &OpState,\n    #[string] key: String,\n) -> Result<Option<String>, JsErrorBox>\n\n#[op2(fast)]\nfn op_kv_put_raw(\n    state: &OpState,\n    #[string] key: String,\n    #[string] value: String,\n) -> Result<(), JsErrorBox>\n\n#[op2(fast)]\nfn op_kv_delete_raw(\n    state: &OpState,\n    #[string] key: String,\n) -> Result<(), JsErrorBox>\n\n#[op2]\n#[serde]\nfn op_kv_list_keys(\n    state: &OpState,\n    #[string] prefix: Option<String>,\n    #[serde] limit: Option<usize>,\n) -> Result<Vec<String>, JsErrorBox>\n```\n\n**JavaScript Bridge:**\n```typescript\n// Uses context.contract_name() from OpState\nconst contractName = globalThis.__tanaCore.ops.op_context_contract_name()\nglobalThis.__tanaCore.ops.op_kv_get_raw(key) // Automatically namespaced\n```\n\n**Characteristics:**\n- ✅ Persistent across restarts\n- ✅ ACID transactions via PostgreSQL\n- ✅ Production-ready\n- 📊 Performance: ~1-5ms per operation\n\n---\n\n### tana-edge (Rust HTTP Server)\n\n**Location:** `tana-edge/src/main.rs` (lines 41-49, 335-460, 1163-1196)\n\n**Storage Backend:** In-memory HashMap (Redis-ready)\n\n**Data Structure:**\n```rust\nstatic KV_STORAGE: Mutex<Option<HashMap<String, String>>> = Mutex::new(None);\n```\n\n**Rust Ops:**\n```rust\n// Same signatures as tana-runtime, but contract_name passed as parameter\n#[op2]\n#[string]\nfn op_kv_get_raw(\n    #[string] contract_name: String,\n    #[string] key: String,\n) -> Result<Option<String>, JsErrorBox>\n\n// ... put, delete, list ops similar\n```\n\n**JavaScript Bridge:**\n```typescript\n// Hardcoded contract name for development\nconst contractName = \"edge_contract\"\nconst rawValue = globalThis.__tanaCore.ops.op_kv_get_raw(contractName, key)\n```\n\n**Characteristics:**\n- ⚡ Very fast (in-memory)\n- ❌ Not persistent (resets on restart)\n- 🔧 Development/testing use\n- 🚀 Production: Replace with Redis backend\n- 📊 Performance: <0.1ms per operation\n\n---\n\n### playground (Browser/TypeScript)\n\n**Location:**\n- `websites/playground/src/pages/sandbox.astro` (lines 691-811)\n- `websites/playground/src/components/Editor.svelte` (lines 277-318)\n\n**Storage Backend:** Browser localStorage\n\n**Key Format:**\n```\nlocalStorage Key: \"tana_kv_playground:playground_contract:{user_key}\"\nExample: \"tana_kv_playground:playground_contract:username\"\n```\n\n**Implementation:**\n```typescript\nconst kv = {\n  async get(key: string, options?: KVGetOptions) {\n    const storageKey = `tana_kv_playground:playground_contract:${key}`\n    const value = localStorage.getItem(storageKey)\n    if (!value) return null\n\n    const type = options?.type || 'text'\n    return type === 'json' ? JSON.parse(value) : value\n  },\n\n  async put(key: string, value: string | object) {\n    const storageKey = `tana_kv_playground:playground_contract:${key}`\n    const serialized = typeof value === 'string' ? value : JSON.stringify(value)\n    localStorage.setItem(storageKey, serialized)\n  },\n\n  async delete(key: string) {\n    const storageKey = `tana_kv_playground:playground_contract:${key}`\n    localStorage.removeItem(storageKey)\n  },\n\n  async list(options?: KVListOptions): Promise<KVListResult> {\n    const prefix = `tana_kv_playground:playground_contract:${options?.prefix || ''}`\n    const limit = options?.limit || 1000\n    const keys: string[] = []\n\n    for (let i = 0; i < localStorage.length; i++) {\n      const fullKey = localStorage.key(i)\n      if (fullKey?.startsWith(prefix)) {\n        const userKey = fullKey.replace('tana_kv_playground:playground_contract:', '')\n        keys.push(userKey)\n        if (keys.length >= limit) break\n      }\n    }\n\n    keys.sort()\n    return {\n      keys: keys.map(name => ({ name })),\n      list_complete: true,\n      cursor: null\n    }\n  }\n}\n```\n\n**Characteristics:**\n- 💾 Persistent per-browser\n- 🚀 Instant execution\n- 📏 Limited to ~5-10MB total\n- 🧪 Great for experimentation\n- 📊 Performance: <0.1ms per operation\n\n## API Consistency\n\nAll three runtimes implement identical JavaScript API:\n\n```typescript\ninterface KV {\n  get(key: string, options?: { type?: 'text' | 'json' }): Promise<string | object | null>\n  put(key: string, value: string | object, options?: KVPutOptions): Promise<void>\n  delete(key: string): Promise<void>\n  list(options?: { prefix?: string, limit?: number }): Promise<KVListResult>\n}\n```\n\nThis ensures contracts are **portable** - code written in playground works identically in tana-runtime and tana-edge.\n\n## Validation & Limits\n\nAll runtimes enforce:\n\n| Constraint | Value | Error |\n|------------|-------|-------|\n| Max key length | 512 bytes | \"KV key too long\" |\n| Max value size | 25 MB | \"KV value too large\" |\n| Max list() keys | 1000 | Silently limited |\n\nValidation happens in Rust ops before storage:\n\n```rust\nif key.len() > MAX_KV_KEY_LENGTH {\n    return Err(JsErrorBox::new(\"Error\",\n        format!(\"KV key too long: {} bytes (max {})\", key.len(), MAX_KV_KEY_LENGTH)\n    ));\n}\n\nif value.len() > MAX_KV_VALUE_SIZE {\n    return Err(JsErrorBox::new(\"Error\",\n        format!(\"KV value too large: {} bytes (max {})\", value.len(), MAX_KV_VALUE_SIZE)\n    ));\n}\n```\n\n## Type Definitions\n\n**Location:** `types/tana-kv.d.ts`\n\nProvides full TypeScript definitions with:\n- Method overloads for type inference\n- JSDoc documentation\n- Cloudflare Workers compatibility notes\n\nExample type inference:\n```typescript\n// TypeScript knows this returns string | null\nconst text = await kv.get('key')\n\n// TypeScript knows this returns any | null\nconst json = await kv.get('key', { type: 'json' })\n```\n\n## Performance Characteristics\n\n| Operation | Runtime | Edge | Playground |\n|-----------|---------|------|------------|\n| get() | 1-5ms | <0.1ms | <0.1ms |\n| put() | 2-10ms | <0.1ms | <0.1ms |\n| delete() | 1-5ms | <0.1ms | <0.1ms |\n| list(100) | 5-20ms | <1ms | <1ms |\n| list(1000) | 20-100ms | 1-5ms | 5-10ms |\n\n**Notes:**\n- Runtime: PostgreSQL network + query time\n- Edge: Pure in-memory HashMap lookups\n- Playground: localStorage DOM API overhead\n\n## Future Enhancements\n\n### Planned Features\n- ⏰ **TTL Support** - Automatic expiration\n- 📊 **Metadata** - Custom key metadata\n- 📄 **Pagination** - Cursor-based list()\n- 🔄 **Bulk Operations** - Batch get/put/delete\n- 🔍 **Range Queries** - Key range scans\n\n### Implementation Notes\n\n**TTL (expirationTtl/expiration):**\n```sql\n-- PostgreSQL schema addition\nALTER TABLE kv_storage ADD COLUMN expires_at TIMESTAMP;\nCREATE INDEX idx_kv_expires ON kv_storage(expires_at) WHERE expires_at IS NOT NULL;\n```\n\n**Metadata:**\n```sql\nALTER TABLE kv_storage ADD COLUMN metadata JSONB;\n```\n\n**Pagination:**\n```typescript\n// Return cursor in list() results\nreturn {\n  keys: [...],\n  list_complete: false,\n  cursor: \"offset:1000\" // For next page\n}\n```\n\n## Testing\n\nRun KV storage tests:\n\n```bash\n# tana-runtime\n./target/release/tana-runtime examples/kv-test.ts\n\n# tana-edge\n./target/release/tana-edge\ncurl -X POST http://localhost:8082/test \\\n  -H \"Content-Type: text/plain\" \\\n  -d \"$(cat examples/kv-test.ts)\"\n\n# playground\n# Open browser, paste code from examples/kv-test.ts\n```\n\n## Common Issues\n\n**\"KV key too long\"**\n- Key exceeds 512 bytes\n- Solution: Use shorter keys or hash long identifiers\n\n**\"KV value too large\"**\n- Value exceeds 25 MB\n- Solution: Split large data across multiple keys\n\n**Namespace collision**\n- Different contracts trying to access same data\n- This is prevented by automatic namespacing\n\n**list() returns empty**\n- No keys match prefix\n- Check prefix syntax (no wildcards, exact string match)\n\n## Migration Guide\n\n### From tana/data to tana/kv\n\n```typescript\n// OLD: tana/data (synchronous)\nimport { data } from 'tana/data'\ndata.set('key', 'value')\nconst value = data.get('key')\n\n// NEW: tana/kv (async)\nimport { kv } from 'tana/kv'\nawait kv.put('key', 'value')\nconst value = await kv.get('key')\n```\n\n**Key differences:**\n- `kv.*` is async (returns Promises)\n- `kv.put()` auto-serializes objects\n- `kv.list()` provides structured results\n- `kv.get()` supports type hints\n\nBoth modules remain available. Use `tana/data` for simple synchronous storage, `tana/kv` for Cloudflare-compatible async patterns.\n",
    "html": "<p>Technical reference for the <code>tana/kv</code> module implementation across tana-runtime, tana-edge, and playground environments.</p>\n<h2 id=\"architecture-overview\">Architecture Overview</h2>\n<p>KV storage provides Cloudflare Workers-compatible key-value storage with automatic per-contract namespace isolation.</p>\n<h3 id=\"namespace-isolation\">Namespace Isolation</h3>\n<p>All keys are internally prefixed with the contract name:</p>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Stored Key Format: \"{contract_name}:{user_key}\"</span></span>\n<span class=\"line\"><span>Example: \"my_contract:username\" → \"alice\"</span></span></code></pre>\n</code></pre><p>This ensures contracts cannot access each other&#39;s data.</p>\n<h2 id=\"runtime-implementations\">Runtime Implementations</h2>\n<h3 id=\"tana-runtime-rust-cli\">tana-runtime (Rust CLI)</h3>\n<p><strong>Location:</strong> <code>runtime/src/tana_kv.rs</code>, <code>runtime/src/main.rs</code></p>\n<p><strong>Storage Backend:</strong> PostgreSQL (migration <code>0011_kv_storage.sql</code>)</p>\n<p><strong>Schema:</strong></p>\n<pre><code class=\"language-sql\">CREATE TABLE kv_storage (\n  contract_name TEXT NOT NULL,\n  key TEXT NOT NULL,\n  value TEXT NOT NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (contract_name, key)\n);\n</code></pre><p><strong>Rust Ops:</strong></p>\n<pre><code class=\"language-rust\">#[op2]\n#[string]\nfn op_kv_get_raw(\n    state: &amp;OpState,\n    #[string] key: String,\n) -&gt; Result&lt;Option&lt;String&gt;, JsErrorBox&gt;\n\n#[op2(fast)]\nfn op_kv_put_raw(\n    state: &amp;OpState,\n    #[string] key: String,\n    #[string] value: String,\n) -&gt; Result&lt;(), JsErrorBox&gt;\n\n#[op2(fast)]\nfn op_kv_delete_raw(\n    state: &amp;OpState,\n    #[string] key: String,\n) -&gt; Result&lt;(), JsErrorBox&gt;\n\n#[op2]\n#[serde]\nfn op_kv_list_keys(\n    state: &amp;OpState,\n    #[string] prefix: Option&lt;String&gt;,\n    #[serde] limit: Option&lt;usize&gt;,\n) -&gt; Result&lt;Vec&lt;String&gt;, JsErrorBox&gt;\n</code></pre><p><strong>JavaScript Bridge:</strong></p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Uses context.contract_name() from OpState</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> contractName</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> globalThis.__tanaCore.ops.</span><span style=\"color:#B392F0\">op_context_contract_name</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">globalThis.__tanaCore.ops.</span><span style=\"color:#B392F0\">op_kv_get_raw</span><span style=\"color:#E1E4E8\">(key) </span><span style=\"color:#6A737D\">// Automatically namespaced</span></span></code></pre>\n</code></pre><p><strong>Characteristics:</strong></p>\n<ul>\n<li>✅ Persistent across restarts</li>\n<li>✅ ACID transactions via PostgreSQL</li>\n<li>✅ Production-ready</li>\n<li>📊 Performance: ~1-5ms per operation</li>\n</ul>\n<hr>\n<h3 id=\"tana-edge-rust-http-server\">tana-edge (Rust HTTP Server)</h3>\n<p><strong>Location:</strong> <code>tana-edge/src/main.rs</code> (lines 41-49, 335-460, 1163-1196)</p>\n<p><strong>Storage Backend:</strong> In-memory HashMap (Redis-ready)</p>\n<p><strong>Data Structure:</strong></p>\n<pre><code class=\"language-rust\">static KV_STORAGE: Mutex&lt;Option&lt;HashMap&lt;String, String&gt;&gt;&gt; = Mutex::new(None);\n</code></pre><p><strong>Rust Ops:</strong></p>\n<pre><code class=\"language-rust\">// Same signatures as tana-runtime, but contract_name passed as parameter\n#[op2]\n#[string]\nfn op_kv_get_raw(\n    #[string] contract_name: String,\n    #[string] key: String,\n) -&gt; Result&lt;Option&lt;String&gt;, JsErrorBox&gt;\n\n// ... put, delete, list ops similar\n</code></pre><p><strong>JavaScript Bridge:</strong></p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Hardcoded contract name for development</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> contractName</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"edge_contract\"</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> rawValue</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> globalThis.__tanaCore.ops.</span><span style=\"color:#B392F0\">op_kv_get_raw</span><span style=\"color:#E1E4E8\">(contractName, key)</span></span></code></pre>\n</code></pre><p><strong>Characteristics:</strong></p>\n<ul>\n<li>⚡ Very fast (in-memory)</li>\n<li>❌ Not persistent (resets on restart)</li>\n<li>🔧 Development/testing use</li>\n<li>🚀 Production: Replace with Redis backend</li>\n<li>📊 Performance: &lt;0.1ms per operation</li>\n</ul>\n<hr>\n<h3 id=\"playground-browsertypescript\">playground (Browser/TypeScript)</h3>\n<p><strong>Location:</strong></p>\n<ul>\n<li><code>websites/playground/src/pages/sandbox.astro</code> (lines 691-811)</li>\n<li><code>websites/playground/src/components/Editor.svelte</code> (lines 277-318)</li>\n</ul>\n<p><strong>Storage Backend:</strong> Browser localStorage</p>\n<p><strong>Key Format:</strong></p>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>localStorage Key: \"tana_kv_playground:playground_contract:{user_key}\"</span></span>\n<span class=\"line\"><span>Example: \"tana_kv_playground:playground_contract:username\"</span></span></code></pre>\n</code></pre><p><strong>Implementation:</strong></p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> kv</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  async</span><span style=\"color:#B392F0\"> get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">key</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">options</span><span style=\"color:#F97583\">?:</span><span style=\"color:#B392F0\"> KVGetOptions</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> storageKey</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> `tana_kv_playground:playground_contract:${</span><span style=\"color:#E1E4E8\">key</span><span style=\"color:#9ECBFF\">}`</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> value</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> localStorage.</span><span style=\"color:#B392F0\">getItem</span><span style=\"color:#E1E4E8\">(storageKey)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">value) </span><span style=\"color:#F97583\">return</span><span style=\"color:#79B8FF\"> null</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> type</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> options?.type </span><span style=\"color:#F97583\">||</span><span style=\"color:#9ECBFF\"> 'text'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> type </span><span style=\"color:#F97583\">===</span><span style=\"color:#9ECBFF\"> 'json'</span><span style=\"color:#F97583\"> ?</span><span style=\"color:#79B8FF\"> JSON</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">parse</span><span style=\"color:#E1E4E8\">(value) </span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> value</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  async</span><span style=\"color:#B392F0\"> put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">key</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">value</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#F97583\"> |</span><span style=\"color:#79B8FF\"> object</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> storageKey</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> `tana_kv_playground:playground_contract:${</span><span style=\"color:#E1E4E8\">key</span><span style=\"color:#9ECBFF\">}`</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> serialized</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> typeof</span><span style=\"color:#E1E4E8\"> value </span><span style=\"color:#F97583\">===</span><span style=\"color:#9ECBFF\"> 'string'</span><span style=\"color:#F97583\"> ?</span><span style=\"color:#E1E4E8\"> value </span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> JSON</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">stringify</span><span style=\"color:#E1E4E8\">(value)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    localStorage.</span><span style=\"color:#B392F0\">setItem</span><span style=\"color:#E1E4E8\">(storageKey, serialized)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  async</span><span style=\"color:#B392F0\"> delete</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">key</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> storageKey</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> `tana_kv_playground:playground_contract:${</span><span style=\"color:#E1E4E8\">key</span><span style=\"color:#9ECBFF\">}`</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    localStorage.</span><span style=\"color:#B392F0\">removeItem</span><span style=\"color:#E1E4E8\">(storageKey)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  async</span><span style=\"color:#B392F0\"> list</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">options</span><span style=\"color:#F97583\">?:</span><span style=\"color:#B392F0\"> KVListOptions</span><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Promise</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">KVListResult</span><span style=\"color:#E1E4E8\">> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> prefix</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> `tana_kv_playground:playground_contract:${</span><span style=\"color:#E1E4E8\">options</span><span style=\"color:#9ECBFF\">?.</span><span style=\"color:#E1E4E8\">prefix</span><span style=\"color:#F97583\"> ||</span><span style=\"color:#9ECBFF\"> ''}`</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> limit</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> options?.limit </span><span style=\"color:#F97583\">||</span><span style=\"color:#79B8FF\"> 1000</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> keys</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">[] </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> []</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">    for</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">let</span><span style=\"color:#E1E4E8\"> i </span><span style=\"color:#F97583\">=</span><span style=\"color:#79B8FF\"> 0</span><span style=\"color:#E1E4E8\">; i </span><span style=\"color:#F97583\">&#x3C;</span><span style=\"color:#E1E4E8\"> localStorage.</span><span style=\"color:#79B8FF\">length</span><span style=\"color:#E1E4E8\">; i</span><span style=\"color:#F97583\">++</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      const</span><span style=\"color:#79B8FF\"> fullKey</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> localStorage.</span><span style=\"color:#B392F0\">key</span><span style=\"color:#E1E4E8\">(i)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      if</span><span style=\"color:#E1E4E8\"> (fullKey?.</span><span style=\"color:#B392F0\">startsWith</span><span style=\"color:#E1E4E8\">(prefix)) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        const</span><span style=\"color:#79B8FF\"> userKey</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> fullKey.</span><span style=\"color:#B392F0\">replace</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'tana_kv_playground:playground_contract:'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">''</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        keys.</span><span style=\"color:#B392F0\">push</span><span style=\"color:#E1E4E8\">(userKey)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        if</span><span style=\"color:#E1E4E8\"> (keys.</span><span style=\"color:#79B8FF\">length</span><span style=\"color:#F97583\"> >=</span><span style=\"color:#E1E4E8\"> limit) </span><span style=\"color:#F97583\">break</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    keys.</span><span style=\"color:#B392F0\">sort</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      keys: keys.</span><span style=\"color:#B392F0\">map</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">name</span><span style=\"color:#F97583\"> =></span><span style=\"color:#E1E4E8\"> ({ name })),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      list_complete: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      cursor: </span><span style=\"color:#79B8FF\">null</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Characteristics:</strong></p>\n<ul>\n<li>💾 Persistent per-browser</li>\n<li>🚀 Instant execution</li>\n<li>📏 Limited to ~5-10MB total</li>\n<li>🧪 Great for experimentation</li>\n<li>📊 Performance: &lt;0.1ms per operation</li>\n</ul>\n<h2 id=\"api-consistency\">API Consistency</h2>\n<p>All three runtimes implement identical JavaScript API:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">interface</span><span style=\"color:#B392F0\"> KV</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">key</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">options</span><span style=\"color:#F97583\">?:</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#FFAB70\">type</span><span style=\"color:#F97583\">?:</span><span style=\"color:#9ECBFF\"> 'text'</span><span style=\"color:#F97583\"> |</span><span style=\"color:#9ECBFF\"> 'json'</span><span style=\"color:#E1E4E8\"> })</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Promise</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#79B8FF\">string</span><span style=\"color:#F97583\"> |</span><span style=\"color:#79B8FF\"> object</span><span style=\"color:#F97583\"> |</span><span style=\"color:#79B8FF\"> null</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">key</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">value</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#F97583\"> |</span><span style=\"color:#79B8FF\"> object</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">options</span><span style=\"color:#F97583\">?:</span><span style=\"color:#B392F0\"> KVPutOptions</span><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Promise</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#79B8FF\">void</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  delete</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">key</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Promise</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#79B8FF\">void</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  list</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">options</span><span style=\"color:#F97583\">?:</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#FFAB70\">prefix</span><span style=\"color:#F97583\">?:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">limit</span><span style=\"color:#F97583\">?:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\"> })</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Promise</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">KVListResult</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p>This ensures contracts are <strong>portable</strong> - code written in playground works identically in tana-runtime and tana-edge.</p>\n<h2 id=\"validation--limits\">Validation &amp; Limits</h2>\n<p>All runtimes enforce:</p>\n<table>\n<thead>\n<tr>\n<th>Constraint</th>\n<th>Value</th>\n<th>Error</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Max key length</td>\n<td>512 bytes</td>\n<td>&quot;KV key too long&quot;</td>\n</tr>\n<tr>\n<td>Max value size</td>\n<td>25 MB</td>\n<td>&quot;KV value too large&quot;</td>\n</tr>\n<tr>\n<td>Max list() keys</td>\n<td>1000</td>\n<td>Silently limited</td>\n</tr>\n</tbody></table>\n<p>Validation happens in Rust ops before storage:</p>\n<pre><code class=\"language-rust\">if key.len() &gt; MAX_KV_KEY_LENGTH {\n    return Err(JsErrorBox::new(&quot;Error&quot;,\n        format!(&quot;KV key too long: {} bytes (max {})&quot;, key.len(), MAX_KV_KEY_LENGTH)\n    ));\n}\n\nif value.len() &gt; MAX_KV_VALUE_SIZE {\n    return Err(JsErrorBox::new(&quot;Error&quot;,\n        format!(&quot;KV value too large: {} bytes (max {})&quot;, value.len(), MAX_KV_VALUE_SIZE)\n    ));\n}\n</code></pre><h2 id=\"type-definitions\">Type Definitions</h2>\n<p><strong>Location:</strong> <code>types/tana-kv.d.ts</code></p>\n<p>Provides full TypeScript definitions with:</p>\n<ul>\n<li>Method overloads for type inference</li>\n<li>JSDoc documentation</li>\n<li>Cloudflare Workers compatibility notes</li>\n</ul>\n<p>Example type inference:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// TypeScript knows this returns string | null</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> text</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'key'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// TypeScript knows this returns any | null</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> json</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'key'</span><span style=\"color:#E1E4E8\">, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span></code></pre>\n</code></pre><h2 id=\"performance-characteristics\">Performance Characteristics</h2>\n<table>\n<thead>\n<tr>\n<th>Operation</th>\n<th>Runtime</th>\n<th>Edge</th>\n<th>Playground</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>get()</td>\n<td>1-5ms</td>\n<td>&lt;0.1ms</td>\n<td>&lt;0.1ms</td>\n</tr>\n<tr>\n<td>put()</td>\n<td>2-10ms</td>\n<td>&lt;0.1ms</td>\n<td>&lt;0.1ms</td>\n</tr>\n<tr>\n<td>delete()</td>\n<td>1-5ms</td>\n<td>&lt;0.1ms</td>\n<td>&lt;0.1ms</td>\n</tr>\n<tr>\n<td>list(100)</td>\n<td>5-20ms</td>\n<td>&lt;1ms</td>\n<td>&lt;1ms</td>\n</tr>\n<tr>\n<td>list(1000)</td>\n<td>20-100ms</td>\n<td>1-5ms</td>\n<td>5-10ms</td>\n</tr>\n</tbody></table>\n<p><strong>Notes:</strong></p>\n<ul>\n<li>Runtime: PostgreSQL network + query time</li>\n<li>Edge: Pure in-memory HashMap lookups</li>\n<li>Playground: localStorage DOM API overhead</li>\n</ul>\n<h2 id=\"future-enhancements\">Future Enhancements</h2>\n<h3 id=\"planned-features\">Planned Features</h3>\n<ul>\n<li>⏰ <strong>TTL Support</strong> - Automatic expiration</li>\n<li>📊 <strong>Metadata</strong> - Custom key metadata</li>\n<li>📄 <strong>Pagination</strong> - Cursor-based list()</li>\n<li>🔄 <strong>Bulk Operations</strong> - Batch get/put/delete</li>\n<li>🔍 <strong>Range Queries</strong> - Key range scans</li>\n</ul>\n<h3 id=\"implementation-notes\">Implementation Notes</h3>\n<p><strong>TTL (expirationTtl/expiration):</strong></p>\n<pre><code class=\"language-sql\">-- PostgreSQL schema addition\nALTER TABLE kv_storage ADD COLUMN expires_at TIMESTAMP;\nCREATE INDEX idx_kv_expires ON kv_storage(expires_at) WHERE expires_at IS NOT NULL;\n</code></pre><p><strong>Metadata:</strong></p>\n<pre><code class=\"language-sql\">ALTER TABLE kv_storage ADD COLUMN metadata JSONB;\n</code></pre><p><strong>Pagination:</strong></p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Return cursor in list() results</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">return</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  keys: [</span><span style=\"color:#F97583\">...</span><span style=\"color:#E1E4E8\">],</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  list_complete: </span><span style=\"color:#79B8FF\">false</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  cursor: </span><span style=\"color:#9ECBFF\">\"offset:1000\"</span><span style=\"color:#6A737D\"> // For next page</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h2 id=\"testing\">Testing</h2>\n<p>Run KV storage tests:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># tana-runtime</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">./target/release/tana-runtime</span><span style=\"color:#9ECBFF\"> examples/kv-test.ts</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># tana-edge</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">./target/release/tana-edge</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -X</span><span style=\"color:#9ECBFF\"> POST</span><span style=\"color:#9ECBFF\"> http://localhost:8082/test</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -H</span><span style=\"color:#9ECBFF\"> \"Content-Type: text/plain\"</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -d</span><span style=\"color:#9ECBFF\"> \"$(</span><span style=\"color:#B392F0\">cat</span><span style=\"color:#9ECBFF\"> examples/kv-test.ts)\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># playground</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Open browser, paste code from examples/kv-test.ts</span></span></code></pre>\n</code></pre><h2 id=\"common-issues\">Common Issues</h2>\n<p><strong>&quot;KV key too long&quot;</strong></p>\n<ul>\n<li>Key exceeds 512 bytes</li>\n<li>Solution: Use shorter keys or hash long identifiers</li>\n</ul>\n<p><strong>&quot;KV value too large&quot;</strong></p>\n<ul>\n<li>Value exceeds 25 MB</li>\n<li>Solution: Split large data across multiple keys</li>\n</ul>\n<p><strong>Namespace collision</strong></p>\n<ul>\n<li>Different contracts trying to access same data</li>\n<li>This is prevented by automatic namespacing</li>\n</ul>\n<p><strong>list() returns empty</strong></p>\n<ul>\n<li>No keys match prefix</li>\n<li>Check prefix syntax (no wildcards, exact string match)</li>\n</ul>\n<h2 id=\"migration-guide\">Migration Guide</h2>\n<h3 id=\"from-tanadata-to-tanakv\">From tana/data to tana/kv</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// OLD: tana/data (synchronous)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { data } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/data'</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">data.</span><span style=\"color:#B392F0\">set</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'key'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'value'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> value</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'key'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// NEW: tana/kv (async)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { kv } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/kv'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'key'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'value'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> value</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'key'</span><span style=\"color:#E1E4E8\">)</span></span></code></pre>\n</code></pre><p><strong>Key differences:</strong></p>\n<ul>\n<li><code>kv.*</code> is async (returns Promises)</li>\n<li><code>kv.put()</code> auto-serializes objects</li>\n<li><code>kv.list()</code> provides structured results</li>\n<li><code>kv.get()</code> supports type hints</li>\n</ul>\n<p>Both modules remain available. Use <code>tana/data</code> for simple synchronous storage, <code>tana/kv</code> for Cloudflare-compatible async patterns.</p>\n"
  },
  {
    "slug": [
      "contributing",
      "env-vars"
    ],
    "metadata": {
      "title": "Environment Variables",
      "description": "Configuration via environment variables",
      "sidebar": {
        "order": 3
      }
    },
    "content": "\nTana uses environment variables for configuration across all components. This provides a simple, consistent way to configure development, testing, and production environments.\n\n## TANA_LEDGER_URL\n\n**Purpose:** Configures the ledger API endpoint for all Tana components\n\n**Default:** `http://localhost:8080`\n\n**Usage:**\n```bash\n# Development (default - no env var needed)\ntana new user @alice\n\n# Remote chain\nexport TANA_LEDGER_URL=https://mainnet.tana.network\ntana new user @alice\n\n# Per-command override\nTANA_LEDGER_URL=https://testnet.tana.network tana deploy user @alice\n```\n\n### Components That Use This Variable\n\n**CLI (TypeScript/Bun):**\n```typescript\n// cli/utils/config.ts\nexport function getLedgerUrl(): string {\n  return process.env.TANA_LEDGER_URL || 'http://localhost:8080'\n}\n```\n\n**Contract Runner Script:**\n```typescript\n// scripts/run-contract.ts\nconst LEDGER_URL = process.env.TANA_LEDGER_URL || 'http://localhost:8080';\n```\n\n**Edge Server (Rust):**\n```rust\n// tana-edge/src/main.rs\nuse std::env;\nlet ledger_url = env::var(\"TANA_LEDGER_URL\")\n    .unwrap_or_else(|_| \"http://localhost:8080\".to_string());\n```\n\n**Mobile App (React Native/Expo):**\n```javascript\n// mobile/app.config.js\nextra: {\n  ledgerApiUrl: process.env.TANA_LEDGER_URL || 'http://localhost:8080'\n}\n```\n\n### Framework-Specific Considerations\n\nDifferent frameworks access environment variables differently:\n\n**Bun/Node.js:**\n```typescript\nprocess.env.TANA_LEDGER_URL\n```\n\n**Astro:**\n```typescript\nimport.meta.env.TANA_LEDGER_URL\n// Add to .env file in project root\n```\n\n**Next.js:**\n```typescript\n// Server-side\nprocess.env.TANA_LEDGER_URL\n\n// Client-side (requires NEXT_PUBLIC_ prefix)\nprocess.env.NEXT_PUBLIC_TANA_LEDGER_URL\n```\n\n**Vite:**\n```typescript\nimport.meta.env.VITE_TANA_LEDGER_URL\n// Add to .env file with VITE_ prefix\n```\n\n**Rust:**\n```rust\nuse std::env;\nenv::var(\"TANA_LEDGER_URL\").unwrap_or_else(|_| \"default\".to_string())\n```\n\n## Development Workflows\n\n### Local Development\n\nFor local development, the default value (`http://localhost:8080`) works automatically:\n\n```bash\n# Start the ledger\ntana start\n\n# Use CLI (automatically connects to localhost:8080)\ntana new user @alice\ntana deploy user @alice\n```\n\n### Multi-Chain Development\n\nSwitch between chains by setting the environment variable:\n\n```bash\n# Work on local development chain\nTANA_LEDGER_URL=http://localhost:8080 tana status\n\n# Work on testnet\nTANA_LEDGER_URL=https://testnet.tana.network tana status\n\n# Work on custom community chain\nTANA_LEDGER_URL=https://my-chain.example.com tana status\n```\n\n### Docker/Container Deployment\n\n**Dockerfile:**\n```dockerfile\nENV TANA_LEDGER_URL=https://mainnet.tana.network\n```\n\n**docker-compose.yml:**\n```yaml\nservices:\n  tana-edge:\n    environment:\n      - TANA_LEDGER_URL=https://mainnet.tana.network\n```\n\n**Kubernetes:**\n```yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: tana-config\ndata:\n  TANA_LEDGER_URL: \"https://mainnet.tana.network\"\n```\n\n### CI/CD Pipelines\n\n**GitHub Actions:**\n```yaml\nenv:\n  TANA_LEDGER_URL: https://testnet.tana.network\n\nsteps:\n  - name: Run tests\n    run: bun test\n    env:\n      TANA_LEDGER_URL: http://localhost:8080\n```\n\n**GitLab CI:**\n```yaml\nvariables:\n  TANA_LEDGER_URL: \"https://testnet.tana.network\"\n```\n\n## Production Configuration\n\n### Managed Hosting (tana.network)\n\nWhen using the official tana.network hosted service:\n\n```bash\nexport TANA_LEDGER_URL=https://api.tana.network\n```\n\n### Self-Hosted\n\nWhen running your own blockchain infrastructure:\n\n```bash\n# Single instance\nexport TANA_LEDGER_URL=https://ledger.mycompany.com\n\n# Load balanced\nexport TANA_LEDGER_URL=https://ledger-lb.mycompany.com\n\n# Internal network\nexport TANA_LEDGER_URL=http://ledger.internal:8080\n```\n\n## Validation and Debugging\n\n### Check Current Configuration\n\n**CLI Status:**\n```bash\ntana status\n# Shows: Ledger: ● Running on http://localhost:8080\n```\n\n**Environment Check:**\n```bash\necho $TANA_LEDGER_URL\n# Should output the URL or be empty (uses default)\n```\n\n### Common Issues\n\n**Issue:** CLI can't connect to ledger\n```bash\n# Check if ledger is reachable\ncurl $TANA_LEDGER_URL/health\n\n# Verify environment variable is set correctly\necho $TANA_LEDGER_URL\n```\n\n**Issue:** Wrong chain being targeted\n```bash\n# Check current configuration\ntana status\n\n# Override temporarily\nTANA_LEDGER_URL=https://correct-chain.com tana status\n```\n\n**Issue:** Docker container can't reach localhost\n```bash\n# In Docker, localhost refers to the container\n# Use host.docker.internal on Mac/Windows or host network mode on Linux\n\n# Docker for Mac/Windows\nexport TANA_LEDGER_URL=http://host.docker.internal:8080\n\n# Docker for Linux (use host network)\ndocker run --network host -e TANA_LEDGER_URL=http://localhost:8080 ...\n```\n\n## DATABASE_URL\n\n**Purpose:** PostgreSQL connection string for blockchain data (ledger service)\n\n**Default:** None (required for ledger service)\n\n**Format:** `postgres://username:password@host:port/database`\n\n**Usage:**\n```bash\n# Development\nexport DATABASE_URL='postgres://tana:tana_dev_password@localhost:5432/tana'\n\n# Production\nexport DATABASE_URL='postgres://prod_user:secure_password@db.example.com:5432/tana_prod'\n```\n\n**Used by:**\n- Ledger service (blockchain state storage)\n- Block producer scripts\n- Database migration tools\n\n## IDENTITY_DB_URL\n\n**Purpose:** PostgreSQL connection string for authentication data (identity service)\n\n**Default:** Falls back to `DATABASE_URL` if not set\n\n**Format:** `postgres://username:password@host:port/database`\n\n**Usage:**\n```bash\n# Development (can use same database as blockchain)\nexport IDENTITY_DB_URL='postgres://tana:tana_dev_password@localhost:5432/tana'\n\n# Production (recommended: separate database for security)\nexport IDENTITY_DB_URL='postgres://identity_user:secure_password@identity-db.example.com:5432/tana_identity'\n```\n\n**Notes:**\n- Authentication tables are separate from blockchain data\n- NOT replicated across validators\n- Can use same database as `DATABASE_URL` (tables don't overlap)\n- Identity service only runs on API nodes (not validators)\n\n**Used by:**\n- Identity service (QR authentication, session management)\n\n## REDIS_URL\n\n**Purpose:** Redis connection string for transaction queue\n\n**Default:** `redis://localhost:6379`\n\n**Format:** `redis://[username:password@]host:port[/database]`\n\n**Usage:**\n```bash\n# Development\nexport REDIS_URL='redis://localhost:6379'\n\n# Production with authentication\nexport REDIS_URL='redis://username:password@redis.example.com:6379'\n\n# Redis Cluster\nexport REDIS_URL='redis://redis-cluster.example.com:6379'\n```\n\n**Requirements:**\n- Redis 7+ required (Redis Streams support)\n- Must support XADD, XREADGROUP, XACK commands\n- Shared by all validators in the network\n\n**Used by:**\n- Ledger service (transaction submission)\n- Queue service (transaction queueing)\n- Block producer scripts (transaction consumption)\n\n## PORT\n\n**Purpose:** HTTP port for ledger service API\n\n**Default:** `8080`\n\n**Usage:**\n```bash\n# Development (default)\nexport PORT=8080\n\n# Production (custom port)\nexport PORT=3000\n```\n\n**Used by:**\n- Ledger service HTTP server\n\n## IDENTITY_PORT\n\n**Purpose:** HTTP port for identity service API\n\n**Default:** `8090`\n\n**Usage:**\n```bash\n# Development (default)\nexport IDENTITY_PORT=8090\n\n# Production (custom port)\nexport IDENTITY_PORT=3001\n```\n\n**Used by:**\n- Identity service HTTP server\n\n## EDGE_PORT\n\n**Purpose:** HTTP port for edge server (contract execution)\n\n**Default:** `8180`\n\n**Usage:**\n```bash\n# Development (default)\nexport EDGE_PORT=8180\n\n# Production (custom port)\nexport EDGE_PORT=8000\n```\n\n**Used by:**\n- Tana Edge server (Rust binary)\n\n## Service URLs for Client Applications\n\n**Purpose:** Configure client apps to connect to Tana services\n\n### TANA_IDENTITY_URL\n\n**Default:** `http://localhost:8090`\n\n**Usage:**\n```bash\n# Development\nexport TANA_IDENTITY_URL=http://localhost:8090\n\n# Production\nexport TANA_IDENTITY_URL=https://auth.tana.network\n```\n\n**Used by:**\n- Website applications (QR login pages)\n- Mobile apps (authentication flows)\n\n### TANA_EDGE_URL\n\n**Default:** `http://localhost:8180`\n\n**Usage:**\n```bash\n# Development\nexport TANA_EDGE_URL=http://localhost:8180\n\n# Production\nexport TANA_EDGE_URL=https://edge.tana.network\n```\n\n**Used by:**\n- Applications calling contract endpoints\n- Edge function deployments\n\n## Complete Development Setup\n\nFor local development, create a `.env` file in your project root:\n\n```bash\n# .env\n\n# Database connections\nDATABASE_URL='postgres://tana:tana_dev_password@localhost:5432/tana'\nIDENTITY_DB_URL='postgres://tana:tana_dev_password@localhost:5432/tana'\nREDIS_URL='redis://localhost:6379'\n\n# Service ports\nPORT=8080                    # Ledger service\nIDENTITY_PORT=8090           # Identity service\nEDGE_PORT=8180              # Edge server\n\n# Client URLs (for connecting to services)\nTANA_LEDGER_URL=http://localhost:8080\nTANA_IDENTITY_URL=http://localhost:8090\nTANA_EDGE_URL=http://localhost:8180\n\n# Environment\nNODE_ENV=development\n```\n\n## Complete Production Setup\n\nFor production deployment:\n\n```bash\n# .env.production\n\n# Database connections (use secure passwords!)\nDATABASE_URL='postgres://prod_user:SECURE_PASSWORD@db.internal:5432/tana_prod'\nIDENTITY_DB_URL='postgres://identity_user:SECURE_PASSWORD@identity-db.internal:5432/tana_identity'\nREDIS_URL='redis://redis_user:SECURE_PASSWORD@redis.internal:6379'\n\n# Service ports (behind reverse proxy)\nPORT=8080\nIDENTITY_PORT=8090\nEDGE_PORT=8180\n\n# Public URLs (with SSL)\nTANA_LEDGER_URL=https://api.tana.network\nTANA_IDENTITY_URL=https://auth.tana.network\nTANA_EDGE_URL=https://edge.tana.network\n\n# Environment\nNODE_ENV=production\n```\n\n## Best Practices\n\n1. **Never commit `.env` files with secrets** - Use `.env.example` instead\n2. **Use different values per environment** - dev, staging, production\n3. **Validate URLs before deployment** - Ensure endpoints are reachable\n4. **Document custom chains** - Keep track of which URL points where\n5. **Use HTTPS in production** - Never use `http://` for production chains\n6. **Set sensible defaults** - localhost:8080 works for most development\n\n## Related Documentation\n\n- [Development Setup](/contributing/setup/) - Initial environment configuration\n- [Architecture](/contributing/architecture/) - System design overview\n- [Deployment Guide](#) - Production deployment best practices (coming soon)\n",
    "html": "<p>Tana uses environment variables for configuration across all components. This provides a simple, consistent way to configure development, testing, and production environments.</p>\n<h2 id=\"tana_ledger_url\">TANA_LEDGER_URL</h2>\n<p><strong>Purpose:</strong> Configures the ledger API endpoint for all Tana components</p>\n<p><strong>Default:</strong> <code>http://localhost:8080</code></p>\n<p><strong>Usage:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Development (default - no env var needed)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> new</span><span style=\"color:#9ECBFF\"> user</span><span style=\"color:#9ECBFF\"> @alice</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Remote chain</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#E1E4E8\"> TANA_LEDGER_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\">https://mainnet.tana.network</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> new</span><span style=\"color:#9ECBFF\"> user</span><span style=\"color:#9ECBFF\"> @alice</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Per-command override</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">TANA_LEDGER_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">https://testnet.tana.network</span><span style=\"color:#B392F0\"> tana</span><span style=\"color:#9ECBFF\"> deploy</span><span style=\"color:#9ECBFF\"> user</span><span style=\"color:#9ECBFF\"> @alice</span></span></code></pre>\n</code></pre><h3 id=\"components-that-use-this-variable\">Components That Use This Variable</h3>\n<p><strong>CLI (TypeScript/Bun):</strong></p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// cli/utils/config.ts</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> getLedgerUrl</span><span style=\"color:#E1E4E8\">()</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> process.env.</span><span style=\"color:#79B8FF\">TANA_LEDGER_URL</span><span style=\"color:#F97583\"> ||</span><span style=\"color:#9ECBFF\"> 'http://localhost:8080'</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Contract Runner Script:</strong></p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// scripts/run-contract.ts</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> LEDGER_URL</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> process.env.</span><span style=\"color:#79B8FF\">TANA_LEDGER_URL</span><span style=\"color:#F97583\"> ||</span><span style=\"color:#9ECBFF\"> 'http://localhost:8080'</span><span style=\"color:#E1E4E8\">;</span></span></code></pre>\n</code></pre><p><strong>Edge Server (Rust):</strong></p>\n<pre><code class=\"language-rust\">// tana-edge/src/main.rs\nuse std::env;\nlet ledger_url = env::var(&quot;TANA_LEDGER_URL&quot;)\n    .unwrap_or_else(|_| &quot;http://localhost:8080&quot;.to_string());\n</code></pre><p><strong>Mobile App (React Native/Expo):</strong></p>\n<pre><code class=\"language-javascript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// mobile/app.config.js</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">extra</span><span style=\"color:#E1E4E8\">: {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  ledgerApiUrl</span><span style=\"color:#E1E4E8\">: process.env.</span><span style=\"color:#79B8FF\">TANA_LEDGER_URL</span><span style=\"color:#F97583\"> ||</span><span style=\"color:#9ECBFF\"> 'http://localhost:8080'</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h3 id=\"framework-specific-considerations\">Framework-Specific Considerations</h3>\n<p>Different frameworks access environment variables differently:</p>\n<p><strong>Bun/Node.js:</strong></p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">process.env.</span><span style=\"color:#79B8FF\">TANA_LEDGER_URL</span></span></code></pre>\n</code></pre><p><strong>Astro:</strong></p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#79B8FF\">meta</span><span style=\"color:#E1E4E8\">.env.</span><span style=\"color:#79B8FF\">TANA_LEDGER_URL</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Add to .env file in project root</span></span></code></pre>\n</code></pre><p><strong>Next.js:</strong></p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Server-side</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">process.env.</span><span style=\"color:#79B8FF\">TANA_LEDGER_URL</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Client-side (requires NEXT_PUBLIC_ prefix)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">process.env.</span><span style=\"color:#79B8FF\">NEXT_PUBLIC_TANA_LEDGER_URL</span></span></code></pre>\n</code></pre><p><strong>Vite:</strong></p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#79B8FF\">meta</span><span style=\"color:#E1E4E8\">.env.</span><span style=\"color:#79B8FF\">VITE_TANA_LEDGER_URL</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Add to .env file with VITE_ prefix</span></span></code></pre>\n</code></pre><p><strong>Rust:</strong></p>\n<pre><code class=\"language-rust\">use std::env;\nenv::var(&quot;TANA_LEDGER_URL&quot;).unwrap_or_else(|_| &quot;default&quot;.to_string())\n</code></pre><h2 id=\"development-workflows\">Development Workflows</h2>\n<h3 id=\"local-development\">Local Development</h3>\n<p>For local development, the default value (<code>http://localhost:8080</code>) works automatically:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Start the ledger</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> start</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Use CLI (automatically connects to localhost:8080)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> new</span><span style=\"color:#9ECBFF\"> user</span><span style=\"color:#9ECBFF\"> @alice</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> deploy</span><span style=\"color:#9ECBFF\"> user</span><span style=\"color:#9ECBFF\"> @alice</span></span></code></pre>\n</code></pre><h3 id=\"multi-chain-development\">Multi-Chain Development</h3>\n<p>Switch between chains by setting the environment variable:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Work on local development chain</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">TANA_LEDGER_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">http://localhost:8080</span><span style=\"color:#B392F0\"> tana</span><span style=\"color:#9ECBFF\"> status</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Work on testnet</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">TANA_LEDGER_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">https://testnet.tana.network</span><span style=\"color:#B392F0\"> tana</span><span style=\"color:#9ECBFF\"> status</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Work on custom community chain</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">TANA_LEDGER_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">https://my-chain.example.com</span><span style=\"color:#B392F0\"> tana</span><span style=\"color:#9ECBFF\"> status</span></span></code></pre>\n</code></pre><h3 id=\"dockercontainer-deployment\">Docker/Container Deployment</h3>\n<p><strong>Dockerfile:</strong></p>\n<pre><code class=\"language-dockerfile\">ENV TANA_LEDGER_URL=https://mainnet.tana.network\n</code></pre><p><strong>docker-compose.yml:</strong></p>\n<pre><code class=\"language-yaml\">services:\n  tana-edge:\n    environment:\n      - TANA_LEDGER_URL=https://mainnet.tana.network\n</code></pre><p><strong>Kubernetes:</strong></p>\n<pre><code class=\"language-yaml\">apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: tana-config\ndata:\n  TANA_LEDGER_URL: &quot;https://mainnet.tana.network&quot;\n</code></pre><h3 id=\"cicd-pipelines\">CI/CD Pipelines</h3>\n<p><strong>GitHub Actions:</strong></p>\n<pre><code class=\"language-yaml\">env:\n  TANA_LEDGER_URL: https://testnet.tana.network\n\nsteps:\n  - name: Run tests\n    run: bun test\n    env:\n      TANA_LEDGER_URL: http://localhost:8080\n</code></pre><p><strong>GitLab CI:</strong></p>\n<pre><code class=\"language-yaml\">variables:\n  TANA_LEDGER_URL: &quot;https://testnet.tana.network&quot;\n</code></pre><h2 id=\"production-configuration\">Production Configuration</h2>\n<h3 id=\"managed-hosting-tananetwork\">Managed Hosting (tana.network)</h3>\n<p>When using the official tana.network hosted service:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#E1E4E8\"> TANA_LEDGER_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\">https://api.tana.network</span></span></code></pre>\n</code></pre><h3 id=\"self-hosted\">Self-Hosted</h3>\n<p>When running your own blockchain infrastructure:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Single instance</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#E1E4E8\"> TANA_LEDGER_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\">https://ledger.mycompany.com</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Load balanced</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#E1E4E8\"> TANA_LEDGER_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\">https://ledger-lb.mycompany.com</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Internal network</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#E1E4E8\"> TANA_LEDGER_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\">http://ledger.internal:8080</span></span></code></pre>\n</code></pre><h2 id=\"validation-and-debugging\">Validation and Debugging</h2>\n<h3 id=\"check-current-configuration\">Check Current Configuration</h3>\n<p><strong>CLI Status:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> status</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Shows: Ledger: ● Running on http://localhost:8080</span></span></code></pre>\n</code></pre><p><strong>Environment Check:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#79B8FF\">echo</span><span style=\"color:#E1E4E8\"> $TANA_LEDGER_URL</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Should output the URL or be empty (uses default)</span></span></code></pre>\n</code></pre><h3 id=\"common-issues\">Common Issues</h3>\n<p><strong>Issue:</strong> CLI can&#39;t connect to ledger</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Check if ledger is reachable</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#E1E4E8\"> $TANA_LEDGER_URL</span><span style=\"color:#9ECBFF\">/health</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Verify environment variable is set correctly</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">echo</span><span style=\"color:#E1E4E8\"> $TANA_LEDGER_URL</span></span></code></pre>\n</code></pre><p><strong>Issue:</strong> Wrong chain being targeted</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Check current configuration</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> status</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Override temporarily</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">TANA_LEDGER_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">https://correct-chain.com</span><span style=\"color:#B392F0\"> tana</span><span style=\"color:#9ECBFF\"> status</span></span></code></pre>\n</code></pre><p><strong>Issue:</strong> Docker container can&#39;t reach localhost</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># In Docker, localhost refers to the container</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Use host.docker.internal on Mac/Windows or host network mode on Linux</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Docker for Mac/Windows</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#E1E4E8\"> TANA_LEDGER_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\">http://host.docker.internal:8080</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Docker for Linux (use host network)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#79B8FF\"> --network</span><span style=\"color:#9ECBFF\"> host</span><span style=\"color:#79B8FF\"> -e</span><span style=\"color:#9ECBFF\"> TANA_LEDGER_URL=http://localhost:8080</span><span style=\"color:#9ECBFF\"> ...</span></span></code></pre>\n</code></pre><h2 id=\"database_url\">DATABASE_URL</h2>\n<p><strong>Purpose:</strong> PostgreSQL connection string for blockchain data (ledger service)</p>\n<p><strong>Default:</strong> None (required for ledger service)</p>\n<p><strong>Format:</strong> <code>postgres://username:password@host:port/database</code></p>\n<p><strong>Usage:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Development</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#E1E4E8\"> DATABASE_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">'postgres://tana:tana_dev_password@localhost:5432/tana'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Production</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#E1E4E8\"> DATABASE_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">'postgres://prod_user:secure_password@db.example.com:5432/tana_prod'</span></span></code></pre>\n</code></pre><p><strong>Used by:</strong></p>\n<ul>\n<li>Ledger service (blockchain state storage)</li>\n<li>Block producer scripts</li>\n<li>Database migration tools</li>\n</ul>\n<h2 id=\"identity_db_url\">IDENTITY_DB_URL</h2>\n<p><strong>Purpose:</strong> PostgreSQL connection string for authentication data (identity service)</p>\n<p><strong>Default:</strong> Falls back to <code>DATABASE_URL</code> if not set</p>\n<p><strong>Format:</strong> <code>postgres://username:password@host:port/database</code></p>\n<p><strong>Usage:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Development (can use same database as blockchain)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#E1E4E8\"> IDENTITY_DB_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">'postgres://tana:tana_dev_password@localhost:5432/tana'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Production (recommended: separate database for security)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#E1E4E8\"> IDENTITY_DB_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">'postgres://identity_user:secure_password@identity-db.example.com:5432/tana_identity'</span></span></code></pre>\n</code></pre><p><strong>Notes:</strong></p>\n<ul>\n<li>Authentication tables are separate from blockchain data</li>\n<li>NOT replicated across validators</li>\n<li>Can use same database as <code>DATABASE_URL</code> (tables don&#39;t overlap)</li>\n<li>Identity service only runs on API nodes (not validators)</li>\n</ul>\n<p><strong>Used by:</strong></p>\n<ul>\n<li>Identity service (QR authentication, session management)</li>\n</ul>\n<h2 id=\"redis_url\">REDIS_URL</h2>\n<p><strong>Purpose:</strong> Redis connection string for transaction queue</p>\n<p><strong>Default:</strong> <code>redis://localhost:6379</code></p>\n<p><strong>Format:</strong> <code>redis://[username:password@]host:port[/database]</code></p>\n<p><strong>Usage:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Development</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#E1E4E8\"> REDIS_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">'redis://localhost:6379'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Production with authentication</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#E1E4E8\"> REDIS_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">'redis://username:password@redis.example.com:6379'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Redis Cluster</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#E1E4E8\"> REDIS_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">'redis://redis-cluster.example.com:6379'</span></span></code></pre>\n</code></pre><p><strong>Requirements:</strong></p>\n<ul>\n<li>Redis 7+ required (Redis Streams support)</li>\n<li>Must support XADD, XREADGROUP, XACK commands</li>\n<li>Shared by all validators in the network</li>\n</ul>\n<p><strong>Used by:</strong></p>\n<ul>\n<li>Ledger service (transaction submission)</li>\n<li>Queue service (transaction queueing)</li>\n<li>Block producer scripts (transaction consumption)</li>\n</ul>\n<h2 id=\"port\">PORT</h2>\n<p><strong>Purpose:</strong> HTTP port for ledger service API</p>\n<p><strong>Default:</strong> <code>8080</code></p>\n<p><strong>Usage:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Development (default)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#E1E4E8\"> PORT</span><span style=\"color:#F97583\">=</span><span style=\"color:#79B8FF\">8080</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Production (custom port)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#E1E4E8\"> PORT</span><span style=\"color:#F97583\">=</span><span style=\"color:#79B8FF\">3000</span></span></code></pre>\n</code></pre><p><strong>Used by:</strong></p>\n<ul>\n<li>Ledger service HTTP server</li>\n</ul>\n<h2 id=\"identity_port\">IDENTITY_PORT</h2>\n<p><strong>Purpose:</strong> HTTP port for identity service API</p>\n<p><strong>Default:</strong> <code>8090</code></p>\n<p><strong>Usage:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Development (default)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#E1E4E8\"> IDENTITY_PORT</span><span style=\"color:#F97583\">=</span><span style=\"color:#79B8FF\">8090</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Production (custom port)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#E1E4E8\"> IDENTITY_PORT</span><span style=\"color:#F97583\">=</span><span style=\"color:#79B8FF\">3001</span></span></code></pre>\n</code></pre><p><strong>Used by:</strong></p>\n<ul>\n<li>Identity service HTTP server</li>\n</ul>\n<h2 id=\"edge_port\">EDGE_PORT</h2>\n<p><strong>Purpose:</strong> HTTP port for edge server (contract execution)</p>\n<p><strong>Default:</strong> <code>8180</code></p>\n<p><strong>Usage:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Development (default)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#E1E4E8\"> EDGE_PORT</span><span style=\"color:#F97583\">=</span><span style=\"color:#79B8FF\">8180</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Production (custom port)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#E1E4E8\"> EDGE_PORT</span><span style=\"color:#F97583\">=</span><span style=\"color:#79B8FF\">8000</span></span></code></pre>\n</code></pre><p><strong>Used by:</strong></p>\n<ul>\n<li>Tana Edge server (Rust binary)</li>\n</ul>\n<h2 id=\"service-urls-for-client-applications\">Service URLs for Client Applications</h2>\n<p><strong>Purpose:</strong> Configure client apps to connect to Tana services</p>\n<h3 id=\"tana_identity_url\">TANA_IDENTITY_URL</h3>\n<p><strong>Default:</strong> <code>http://localhost:8090</code></p>\n<p><strong>Usage:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Development</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#E1E4E8\"> TANA_IDENTITY_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\">http://localhost:8090</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Production</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#E1E4E8\"> TANA_IDENTITY_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\">https://auth.tana.network</span></span></code></pre>\n</code></pre><p><strong>Used by:</strong></p>\n<ul>\n<li>Website applications (QR login pages)</li>\n<li>Mobile apps (authentication flows)</li>\n</ul>\n<h3 id=\"tana_edge_url\">TANA_EDGE_URL</h3>\n<p><strong>Default:</strong> <code>http://localhost:8180</code></p>\n<p><strong>Usage:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Development</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#E1E4E8\"> TANA_EDGE_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\">http://localhost:8180</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Production</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#E1E4E8\"> TANA_EDGE_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\">https://edge.tana.network</span></span></code></pre>\n</code></pre><p><strong>Used by:</strong></p>\n<ul>\n<li>Applications calling contract endpoints</li>\n<li>Edge function deployments</li>\n</ul>\n<h2 id=\"complete-development-setup\">Complete Development Setup</h2>\n<p>For local development, create a <code>.env</code> file in your project root:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># .env</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Database connections</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">DATABASE_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">'postgres://tana:tana_dev_password@localhost:5432/tana'</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">IDENTITY_DB_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">'postgres://tana:tana_dev_password@localhost:5432/tana'</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">REDIS_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">'redis://localhost:6379'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Service ports</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">PORT</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">8080</span><span style=\"color:#6A737D\">                    # Ledger service</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">IDENTITY_PORT</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">8090</span><span style=\"color:#6A737D\">           # Identity service</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">EDGE_PORT</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">8180</span><span style=\"color:#6A737D\">              # Edge server</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Client URLs (for connecting to services)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">TANA_LEDGER_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">http://localhost:8080</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">TANA_IDENTITY_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">http://localhost:8090</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">TANA_EDGE_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">http://localhost:8180</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Environment</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">NODE_ENV</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">development</span></span></code></pre>\n</code></pre><h2 id=\"complete-production-setup\">Complete Production Setup</h2>\n<p>For production deployment:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># .env.production</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Database connections (use secure passwords!)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">DATABASE_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">'postgres://prod_user:SECURE_PASSWORD@db.internal:5432/tana_prod'</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">IDENTITY_DB_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">'postgres://identity_user:SECURE_PASSWORD@identity-db.internal:5432/tana_identity'</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">REDIS_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">'redis://redis_user:SECURE_PASSWORD@redis.internal:6379'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Service ports (behind reverse proxy)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">PORT</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">8080</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">IDENTITY_PORT</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">8090</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">EDGE_PORT</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">8180</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Public URLs (with SSL)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">TANA_LEDGER_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">https://api.tana.network</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">TANA_IDENTITY_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">https://auth.tana.network</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">TANA_EDGE_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">https://edge.tana.network</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Environment</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">NODE_ENV</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">production</span></span></code></pre>\n</code></pre><h2 id=\"best-practices\">Best Practices</h2>\n<ol>\n<li><strong>Never commit <code>.env</code> files with secrets</strong> - Use <code>.env.example</code> instead</li>\n<li><strong>Use different values per environment</strong> - dev, staging, production</li>\n<li><strong>Validate URLs before deployment</strong> - Ensure endpoints are reachable</li>\n<li><strong>Document custom chains</strong> - Keep track of which URL points where</li>\n<li><strong>Use HTTPS in production</strong> - Never use <code>http://</code> for production chains</li>\n<li><strong>Set sensible defaults</strong> - localhost:8080 works for most development</li>\n</ol>\n<h2 id=\"related-documentation\">Related Documentation</h2>\n<ul>\n<li><a href=\"/contributing/setup/\">Development Setup</a> - Initial environment configuration</li>\n<li><a href=\"/contributing/architecture/\">Architecture</a> - System design overview</li>\n<li><a href=\"#\">Deployment Guide</a> - Production deployment best practices (coming soon)</li>\n</ul>\n"
  },
  {
    "slug": [],
    "metadata": {
      "title": "Tana Documentation",
      "description": "A blockchain with smart contracts written in TypeScript",
      "template": "splash",
      "hero": {
        "tagline": "User-owned blockchain with TypeScript smart contracts. No native token required.",
        "image": {
          "file": "../../assets/houston.webp"
        },
        "actions": [
          {
            "text": "Quick Start",
            "link": "/guides/quickstart/",
            "icon": "right-arrow",
            "variant": "primary"
          },
          {
            "text": "View on GitHub",
            "link": "https://github.com/conoda/tana",
            "icon": "external",
            "variant": "minimal"
          }
        ]
      }
    },
    "content": "\nimport { Card, CardGrid } from '@astrojs/starlight/components';\n\n## What is Tana?\n\nTana is a blockchain platform designed to be **user-owned and operated**. Anyone can start their own blockchain or join existing networks as a validator node. Smart contracts are written in familiar **TypeScript** and executed in a sandboxed V8 environment.\n\n## Key Features\n\n<CardGrid>\n  <Card title=\"TypeScript Contracts\" icon=\"seti:typescript\">\n    Write smart contracts in TypeScript - no new language to learn. Full type safety and familiar tooling.\n  </Card>\n\n  <Card title=\"Multi-Currency Support\" icon=\"puzzle\">\n    No native token required. Create and manage any currency directly in your contracts.\n  </Card>\n\n  <Card title=\"CLI-First Design\" icon=\"laptop\">\n    Everything controllable from the terminal. Deploy, manage, and monitor your blockchain from the command line.\n  </Card>\n\n  <Card title=\"Decentralized Nodes\" icon=\"setting\">\n    Start your own chain or join existing networks. Full validator node capabilities.\n  </Card>\n</CardGrid>\n\n## Quick Example\n\n```typescript\nimport { console } from 'tana/core'\n\n// Simple counter contract\nconst current = await data.get('counter')\nconst count = current ? parseInt(current) : 0\n\nawait data.set('counter', String(count + 1))\nawait data.commit()\n\nconsole.log('Counter:', count + 1)\n```\n\n## For Users\n\n<CardGrid>\n  <Card title=\"Quick Start\" icon=\"rocket\">\n    Install Tana and start using the blockchain.\n\n    [Get Started →](/guides/quickstart/)\n  </Card>\n\n  <Card title=\"CLI Reference\" icon=\"laptop\">\n    Complete command reference for the Tana CLI.\n\n    [View Commands →](/tana-cli/intro/)\n  </Card>\n\n  <Card title=\"API Reference\" icon=\"open-book\">\n    REST API documentation for the ledger service.\n\n    [View API →](/tana-api/intro/)\n  </Card>\n</CardGrid>\n\n## For Contributors\n\n<CardGrid>\n  <Card title=\"Development Setup\" icon=\"setting\">\n    Build Tana from source and set up your dev environment.\n\n    [Get Started →](/contributing/setup/)\n  </Card>\n\n  <Card title=\"System Architecture\" icon=\"puzzle\">\n    Learn how Tana's components work together internally.\n\n    [Learn More →](/contributing/architecture/)\n  </Card>\n\n  <Card title=\"Core Concepts\" icon=\"document\">\n    Deep dive into data models, blocks, and system flows.\n\n    [Technical Docs →](/contributing/core/data-model/)\n  </Card>\n</CardGrid>\n\n## Architecture Overview\n\nTana consists of **three compiled binaries** and integrated services:\n\n- **`tana-cli`** - Main user interface built with TypeScript/Bun\n- **`tana-runtime`** - Rust-based V8 execution engine for CLI contract execution\n- **`tana-edge`** - High-performance HTTP server for off-chain contract APIs\n- **Ledger Service** - Integrated blockchain state management\n\nAll orchestrated through a simple, powerful CLI:\n\n```bash\n# Create a new blockchain\ntana new chain my-chain\n\n# Start your chain\ntana start\n\n# Deploy a smart contract\ntana deploy contract ./my-contract.ts\n```\n\n---\n\n**Status:** Early development - Not production ready\n\nBuilt with Rust (deno_core), TypeScript, Bun, PostgreSQL, and Astro.\n",
    "html": "<p>import { Card, CardGrid } from &#39;@astrojs/starlight/components&#39;;</p>\n<h2 id=\"what-is-tana\">What is Tana?</h2>\n<p>Tana is a blockchain platform designed to be <strong>user-owned and operated</strong>. Anyone can start their own blockchain or join existing networks as a validator node. Smart contracts are written in familiar <strong>TypeScript</strong> and executed in a sandboxed V8 environment.</p>\n<h2 id=\"key-features\">Key Features</h2>\n<CardGrid>\n  <Card title=\"TypeScript Contracts\" icon=\"seti:typescript\">\n    Write smart contracts in TypeScript - no new language to learn. Full type safety and familiar tooling.\n  </Card>\n\n  <Card title=\"Multi-Currency Support\" icon=\"puzzle\">\n    No native token required. Create and manage any currency directly in your contracts.\n  </Card>\n\n  <Card title=\"CLI-First Design\" icon=\"laptop\">\n    Everything controllable from the terminal. Deploy, manage, and monitor your blockchain from the command line.\n  </Card>\n\n  <Card title=\"Decentralized Nodes\" icon=\"setting\">\n    Start your own chain or join existing networks. Full validator node capabilities.\n  </Card>\n</CardGrid>\n\n<h2 id=\"quick-example\">Quick Example</h2>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { console } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/core'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Simple counter contract</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> current</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'counter'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> count</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> current </span><span style=\"color:#F97583\">?</span><span style=\"color:#B392F0\"> parseInt</span><span style=\"color:#E1E4E8\">(current) </span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> 0</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">set</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'counter'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">String</span><span style=\"color:#E1E4E8\">(count </span><span style=\"color:#F97583\">+</span><span style=\"color:#79B8FF\"> 1</span><span style=\"color:#E1E4E8\">))</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">commit</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Counter:'</span><span style=\"color:#E1E4E8\">, count </span><span style=\"color:#F97583\">+</span><span style=\"color:#79B8FF\"> 1</span><span style=\"color:#E1E4E8\">)</span></span></code></pre>\n</code></pre><h2 id=\"for-users\">For Users</h2>\n<CardGrid>\n  <Card title=\"Quick Start\" icon=\"rocket\">\n    Install Tana and start using the blockchain.\n\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>[Get Started →](/guides/quickstart/)</span></span></code></pre>\n</code></pre>  </Card>\n\n  <Card title=\"CLI Reference\" icon=\"laptop\">\n    Complete command reference for the Tana CLI.\n\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>[View Commands →](/tana-cli/intro/)</span></span></code></pre>\n</code></pre>  </Card>\n\n  <Card title=\"API Reference\" icon=\"open-book\">\n    REST API documentation for the ledger service.\n\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>[View API →](/tana-api/intro/)</span></span></code></pre>\n</code></pre>  </Card>\n</CardGrid>\n\n<h2 id=\"for-contributors\">For Contributors</h2>\n<CardGrid>\n  <Card title=\"Development Setup\" icon=\"setting\">\n    Build Tana from source and set up your dev environment.\n\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>[Get Started →](/contributing/setup/)</span></span></code></pre>\n</code></pre>  </Card>\n\n  <Card title=\"System Architecture\" icon=\"puzzle\">\n    Learn how Tana's components work together internally.\n\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>[Learn More →](/contributing/architecture/)</span></span></code></pre>\n</code></pre>  </Card>\n\n  <Card title=\"Core Concepts\" icon=\"document\">\n    Deep dive into data models, blocks, and system flows.\n\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>[Technical Docs →](/contributing/core/data-model/)</span></span></code></pre>\n</code></pre>  </Card>\n</CardGrid>\n\n<h2 id=\"architecture-overview\">Architecture Overview</h2>\n<p>Tana consists of <strong>three compiled binaries</strong> and integrated services:</p>\n<ul>\n<li><strong><code>tana-cli</code></strong> - Main user interface built with TypeScript/Bun</li>\n<li><strong><code>tana-runtime</code></strong> - Rust-based V8 execution engine for CLI contract execution</li>\n<li><strong><code>tana-edge</code></strong> - High-performance HTTP server for off-chain contract APIs</li>\n<li><strong>Ledger Service</strong> - Integrated blockchain state management</li>\n</ul>\n<p>All orchestrated through a simple, powerful CLI:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Create a new blockchain</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> new</span><span style=\"color:#9ECBFF\"> chain</span><span style=\"color:#9ECBFF\"> my-chain</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Start your chain</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> start</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Deploy a smart contract</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> deploy</span><span style=\"color:#9ECBFF\"> contract</span><span style=\"color:#9ECBFF\"> ./my-contract.ts</span></span></code></pre>\n</code></pre><hr>\n<p><strong>Status:</strong> Early development - Not production ready</p>\n<p>Built with Rust (deno_core), TypeScript, Bun, PostgreSQL, and Astro.</p>\n"
  },
  {
    "slug": [
      "cli",
      "commands"
    ],
    "metadata": {
      "title": "CLI Commands",
      "description": "Complete reference for all tana CLI commands"
    },
    "content": "\n# CLI Commands\n\nThe tana CLI provides commands for managing your blockchain, deploying contracts, and interacting with the network.\n\n## Installation\n\nInstall the tana CLI globally:\n\n```bash\nnpm install -g @tana/cli\n```\n\n## Global Options\n\nThese options work with all commands:\n\n- `--help` - Show help for a command\n- `--version` - Show CLI version\n- `--config <path>` - Use custom config file\n\n## Commands\n\n### `tana new`\n\nCreate new blockchain entities.\n\n#### `tana new chain`\n\nInitialize a new blockchain.\n\n```bash\ntana new chain [name]\n```\n\n**Options:**\n- `--port <number>` - HTTP port (default: 8080)\n- `--no-autostart` - Don't start services automatically\n\n**Example:**\n```bash\ntana new chain my-blockchain\n```\n\n#### `tana new user`\n\nCreate a new user account.\n\n```bash\ntana new user <username>\n```\n\n**Example:**\n```bash\ntana new user alice\n```\n\n#### `tana new contract`\n\nGenerate a contract template.\n\n```bash\ntana new contract <name>\n```\n\n**Example:**\n```bash\ntana new contract token\n```\n\n### `tana deploy`\n\nDeploy entities to the blockchain.\n\n#### `tana deploy user`\n\nDeploy a user to the blockchain.\n\n```bash\ntana deploy user <username>\n```\n\n**Example:**\n```bash\ntana deploy user alice\n```\n\n#### `tana deploy contract`\n\nDeploy a smart contract.\n\n```bash\ntana deploy contract <file>\n```\n\n**Options:**\n- `--owner <userId>` - Contract owner (default: current user)\n\n**Example:**\n```bash\ntana deploy contract ./token.ts\n```\n\n### `tana start`\n\nStart all tana services.\n\n```bash\ntana start\n```\n\nThis starts:\n- Ledger service (port 8080)\n- Identity service (port 8090)\n- Edge server (port 8180)\n- Block producer\n- Event listener\n\n**Options:**\n- `--ledger-port <number>` - Ledger port\n- `--identity-port <number>` - Identity port\n- `--edge-port <number>` - Edge server port\n\n### `tana stop`\n\nStop all running services.\n\n```bash\ntana stop\n```\n\n### `tana status`\n\nCheck service status.\n\n```bash\ntana status\n```\n\nShows:\n- Running services\n- Port numbers\n- Process IDs\n\n### `tana call`\n\nCall a contract function.\n\n```bash\ntana call <contractId> [input]\n```\n\n**Example:**\n```bash\ntana call ctr_abc123 '{\"amount\": 100}'\n```\n\n## Configuration\n\nConfig file location: `~/.config/tana/config.json`\n\n**Example config:**\n```json\n{\n  \"ledgerPort\": 8080,\n  \"identityPort\": 8090,\n  \"edgePort\": 8180,\n  \"databaseUrl\": \"postgres://localhost:5432/tana\"\n}\n```\n\n## Environment Variables\n\n- `DATABASE_URL` - PostgreSQL connection string\n- `REDIS_URL` - Redis connection string\n- `PORT` - Default service port\n- `NODE_ENV` - Environment (development/production)\n\n## Next Steps\n\n- [Deploy your first contract](/docs/guides/quickstart)\n- [Smart contract structure](/docs/guides/smart-contracts)\n- [API Reference](/docs/api/intro)\n",
    "html": "<h1 id=\"cli-commands\">CLI Commands</h1>\n<p>The tana CLI provides commands for managing your blockchain, deploying contracts, and interacting with the network.</p>\n<h2 id=\"installation\">Installation</h2>\n<p>Install the tana CLI globally:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> install</span><span style=\"color:#79B8FF\"> -g</span><span style=\"color:#9ECBFF\"> @tana/cli</span></span></code></pre>\n</code></pre><h2 id=\"global-options\">Global Options</h2>\n<p>These options work with all commands:</p>\n<ul>\n<li><code>--help</code> - Show help for a command</li>\n<li><code>--version</code> - Show CLI version</li>\n<li><code>--config &lt;path&gt;</code> - Use custom config file</li>\n</ul>\n<h2 id=\"commands\">Commands</h2>\n<h3 id=\"tana-new\"><code>tana new</code></h3>\n<p>Create new blockchain entities.</p>\n<h4 id=\"tana-new-chain\"><code>tana new chain</code></h4>\n<p>Initialize a new blockchain.</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> new</span><span style=\"color:#9ECBFF\"> chain</span><span style=\"color:#E1E4E8\"> [name]</span></span></code></pre>\n</code></pre><p><strong>Options:</strong></p>\n<ul>\n<li><code>--port &lt;number&gt;</code> - HTTP port (default: 8080)</li>\n<li><code>--no-autostart</code> - Don&#39;t start services automatically</li>\n</ul>\n<p><strong>Example:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> new</span><span style=\"color:#9ECBFF\"> chain</span><span style=\"color:#9ECBFF\"> my-blockchain</span></span></code></pre>\n</code></pre><h4 id=\"tana-new-user\"><code>tana new user</code></h4>\n<p>Create a new user account.</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> new</span><span style=\"color:#9ECBFF\"> user</span><span style=\"color:#F97583\"> &#x3C;</span><span style=\"color:#9ECBFF\">usernam</span><span style=\"color:#E1E4E8\">e</span><span style=\"color:#F97583\">></span></span></code></pre>\n</code></pre><p><strong>Example:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> new</span><span style=\"color:#9ECBFF\"> user</span><span style=\"color:#9ECBFF\"> alice</span></span></code></pre>\n</code></pre><h4 id=\"tana-new-contract\"><code>tana new contract</code></h4>\n<p>Generate a contract template.</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> new</span><span style=\"color:#9ECBFF\"> contract</span><span style=\"color:#F97583\"> &#x3C;</span><span style=\"color:#9ECBFF\">nam</span><span style=\"color:#E1E4E8\">e</span><span style=\"color:#F97583\">></span></span></code></pre>\n</code></pre><p><strong>Example:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> new</span><span style=\"color:#9ECBFF\"> contract</span><span style=\"color:#9ECBFF\"> token</span></span></code></pre>\n</code></pre><h3 id=\"tana-deploy\"><code>tana deploy</code></h3>\n<p>Deploy entities to the blockchain.</p>\n<h4 id=\"tana-deploy-user\"><code>tana deploy user</code></h4>\n<p>Deploy a user to the blockchain.</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> deploy</span><span style=\"color:#9ECBFF\"> user</span><span style=\"color:#F97583\"> &#x3C;</span><span style=\"color:#9ECBFF\">usernam</span><span style=\"color:#E1E4E8\">e</span><span style=\"color:#F97583\">></span></span></code></pre>\n</code></pre><p><strong>Example:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> deploy</span><span style=\"color:#9ECBFF\"> user</span><span style=\"color:#9ECBFF\"> alice</span></span></code></pre>\n</code></pre><h4 id=\"tana-deploy-contract\"><code>tana deploy contract</code></h4>\n<p>Deploy a smart contract.</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> deploy</span><span style=\"color:#9ECBFF\"> contract</span><span style=\"color:#F97583\"> &#x3C;</span><span style=\"color:#9ECBFF\">fil</span><span style=\"color:#E1E4E8\">e</span><span style=\"color:#F97583\">></span></span></code></pre>\n</code></pre><p><strong>Options:</strong></p>\n<ul>\n<li><code>--owner &lt;userId&gt;</code> - Contract owner (default: current user)</li>\n</ul>\n<p><strong>Example:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> deploy</span><span style=\"color:#9ECBFF\"> contract</span><span style=\"color:#9ECBFF\"> ./token.ts</span></span></code></pre>\n</code></pre><h3 id=\"tana-start\"><code>tana start</code></h3>\n<p>Start all tana services.</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> start</span></span></code></pre>\n</code></pre><p>This starts:</p>\n<ul>\n<li>Ledger service (port 8080)</li>\n<li>Identity service (port 8090)</li>\n<li>Edge server (port 8180)</li>\n<li>Block producer</li>\n<li>Event listener</li>\n</ul>\n<p><strong>Options:</strong></p>\n<ul>\n<li><code>--ledger-port &lt;number&gt;</code> - Ledger port</li>\n<li><code>--identity-port &lt;number&gt;</code> - Identity port</li>\n<li><code>--edge-port &lt;number&gt;</code> - Edge server port</li>\n</ul>\n<h3 id=\"tana-stop\"><code>tana stop</code></h3>\n<p>Stop all running services.</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> stop</span></span></code></pre>\n</code></pre><h3 id=\"tana-status\"><code>tana status</code></h3>\n<p>Check service status.</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> status</span></span></code></pre>\n</code></pre><p>Shows:</p>\n<ul>\n<li>Running services</li>\n<li>Port numbers</li>\n<li>Process IDs</li>\n</ul>\n<h3 id=\"tana-call\"><code>tana call</code></h3>\n<p>Call a contract function.</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> call</span><span style=\"color:#F97583\"> &#x3C;</span><span style=\"color:#9ECBFF\">contractI</span><span style=\"color:#E1E4E8\">d</span><span style=\"color:#F97583\">></span><span style=\"color:#E1E4E8\"> [input]</span></span></code></pre>\n</code></pre><p><strong>Example:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> call</span><span style=\"color:#9ECBFF\"> ctr_abc123</span><span style=\"color:#9ECBFF\"> '{\"amount\": 100}'</span></span></code></pre>\n</code></pre><h2 id=\"configuration\">Configuration</h2>\n<p>Config file location: <code>~/.config/tana/config.json</code></p>\n<p><strong>Example config:</strong></p>\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"ledgerPort\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">8080</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"identityPort\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">8090</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"edgePort\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">8180</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"databaseUrl\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"postgres://localhost:5432/tana\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h2 id=\"environment-variables\">Environment Variables</h2>\n<ul>\n<li><code>DATABASE_URL</code> - PostgreSQL connection string</li>\n<li><code>REDIS_URL</code> - Redis connection string</li>\n<li><code>PORT</code> - Default service port</li>\n<li><code>NODE_ENV</code> - Environment (development/production)</li>\n</ul>\n<h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li><a href=\"/docs/guides/quickstart\">Deploy your first contract</a></li>\n<li><a href=\"/docs/guides/smart-contracts\">Smart contract structure</a></li>\n<li><a href=\"/docs/api/intro\">API Reference</a></li>\n</ul>\n"
  },
  {
    "slug": [
      "tana-app",
      "intro"
    ],
    "metadata": {
      "title": "Mobile App",
      "description": "Secure wallet and signing approvals for Tana",
      "sidebar": {
        "order": 1
      }
    },
    "content": "\nTana Mobile is a React Native application built with Expo that provides secure wallet storage, balance visibility, and transaction signing for the Tana blockchain.\n\n## Features\n\n- **Secure Key Storage** - Ed25519 wallet keys stored entirely on-device using secure storage\n- **Balance Visibility** - View your current ledger balances linked to wallet addresses\n- **Transaction Signing** - Authorize external requests (web, CLI) by signing challenge payloads\n- **Automatic Registration** - Wallets are automatically registered on the blockchain when created\n- **Multi-Platform** - iOS, Android, and Web support via Expo\n\n## Getting Started\n\n### Installation\n\n```bash\ncd mobile\nnpm install\nnpm run start  # Opens Expo Dev Tools\n```\n\nLaunch directly on a platform:\n```bash\nnpm run ios      # iOS simulator\nnpm run android  # Android emulator\nnpm run web      # Web browser\n```\n\n### Environment Configuration\n\nBy default, the app connects to your local development ledger at `http://localhost:8080`.\n\nMake sure your local ledger service is running:\n\n```bash\n# Start the app (defaults to localhost:8080)\nnpm start\n```\n\nThen press `i` for iOS simulator or `a` for Android emulator.\n\n**To connect to production:**\n\n```bash\n# Option 1: Use the convenience script\nnpm run start:prod\n\n# Option 2: Set TANA_LEDGER_URL manually\nTANA_LEDGER_URL=https://mainnet.tana.network npm start\n```\n\nSee [Environment Variables](/contributing/env-vars/) for more configuration options.\n\n## Using the App\n\n### Creating a Wallet\n\n1. **Open the Vault screen** - Your main wallet dashboard\n2. **Tap \"Add Wallet\"**\n3. **Choose an option:**\n   - **Generate New** - Creates a new Ed25519 keypair\n   - **Import Existing** - Import from private key\n4. **Enter details:**\n   - Display name (your public blockchain name)\n   - Username (unique blockchain handle, must start with @)\n5. **Tap \"Generate & Register\" or \"Import & Register\"**\n\nYour wallet is automatically registered on the blockchain with your public key!\n\n### Blockchain Registration\n\nEvery wallet creation automatically registers on the blockchain:\n- Username must be unique (app will error if taken)\n- Display name and username are required fields\n- Backend creates a `user_creation` transaction immediately\n- **Registration completes when the next block is produced**\n\n**Transaction Flow:**\n- Wallet is saved locally immediately with a pre-assigned user ID\n- The user creation transaction is marked as \"pending\"\n- User appears on blockchain after block production\n- In production, blocks are produced automatically (e.g., every 6 seconds)\n\n### Viewing Balances\n\nFrom the Vault screen:\n- See all your wallets and their balances\n- Tap a wallet to view details\n- Copy public keys or export private keys (securely!)\n\n### Signing Transactions\n\nThe approval screen accepts QR codes or manual challenges:\n1. Scan a QR code or paste a challenge\n2. Choose which wallet to sign with\n3. Review the transaction details\n4. Approve to generate an Ed25519 signature\n\nYour signature can then be used to authorize transactions on the blockchain.\n\n## Security\n\n- **Wallet metadata** stored in `AsyncStorage`\n- **Private keys** stored in secure storage (`expo-secure-store`)\n- **Keys never leave your device** - all signing happens locally\n- **Export keys before uninstalling** - secure storage is cleared on uninstall\n\n:::caution\nAlways back up your private keys! If you lose your device and haven't exported your keys, they cannot be recovered.\n:::\n\n## Troubleshooting\n\n### White Screen on Launch\n\nIf you see a white screen, ensure all dependencies are installed:\n\n```bash\nnpx expo-doctor  # Check for issues\nnpx expo install --fix  # Fix package versions\n```\n\nCommon fixes:\n- Install `expo-font`: `npx expo install expo-font`\n- Remove `@types/react-native` if installed (types are included with react-native)\n\n### Xcode Version\n\nExpo SDK 51+ requires Xcode ≤16.2.0. If you have a newer version:\n- Downgrade Xcode for iOS builds\n- Use the Expo Go app for testing instead of building locally\n\n### Connection Issues\n\nIf the app can't connect to the ledger:\n- Verify the ledger is running: `tana status`\n- Check the `TANA_LEDGER_URL` environment variable\n- For local development on a physical device, use your computer's IP address instead of `localhost`\n\n## Technical Details\n\n### Project Structure\n\n```\nmobile/\n├── App.tsx                     # Entry point with navigation\n├── app.config.js               # Expo configuration + env vars\n├── src/\n│   ├── components/\n│   │   └── KeyCard.tsx         # Wallet summary display\n│   ├── contexts/\n│   │   └── KeyStoreContext.tsx # Wallet vault + secure storage\n│   ├── lib/\n│   │   └── ledgerApi.ts        # REST API client\n│   ├── screens/\n│   │   ├── AddKeyScreen.tsx    # Generate/import wallets\n│   │   ├── LoginApprovalScreen.tsx # Challenge signing\n│   │   └── VaultScreen.tsx     # Wallet list, balances\n│   └── utils/\n│       └── crypto.ts           # Ed25519 cryptography\n```\n\n### Compatibility\n\n- React Native 0.81 / Expo SDK 54\n- TypeScript strict mode enabled\n- Ed25519 via `@noble/ed25519`\n- QR scanning via `expo-camera`\n\n## Future Enhancements\n\n- Biometric authentication for transaction signing\n- QR-powered challenges for easier approvals\n- Push/deep link handling for automatic approval requests\n- Encrypted backup/export flows for device migration\n- Multi-network support with configurable endpoints\n\n## Related Documentation\n\n- [CLI Commands](/tana-cli/commands/) - Command-line interface\n- [API Reference](/tana-api/intro/) - Ledger API endpoints\n- [Environment Variables](/contributing/env-vars/) - Configuration options\n",
    "html": "<p>Tana Mobile is a React Native application built with Expo that provides secure wallet storage, balance visibility, and transaction signing for the Tana blockchain.</p>\n<h2 id=\"features\">Features</h2>\n<ul>\n<li><strong>Secure Key Storage</strong> - Ed25519 wallet keys stored entirely on-device using secure storage</li>\n<li><strong>Balance Visibility</strong> - View your current ledger balances linked to wallet addresses</li>\n<li><strong>Transaction Signing</strong> - Authorize external requests (web, CLI) by signing challenge payloads</li>\n<li><strong>Automatic Registration</strong> - Wallets are automatically registered on the blockchain when created</li>\n<li><strong>Multi-Platform</strong> - iOS, Android, and Web support via Expo</li>\n</ul>\n<h2 id=\"getting-started\">Getting Started</h2>\n<h3 id=\"installation\">Installation</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#79B8FF\">cd</span><span style=\"color:#9ECBFF\"> mobile</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> install</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> start</span><span style=\"color:#6A737D\">  # Opens Expo Dev Tools</span></span></code></pre>\n</code></pre><p>Launch directly on a platform:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> ios</span><span style=\"color:#6A737D\">      # iOS simulator</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> android</span><span style=\"color:#6A737D\">  # Android emulator</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> web</span><span style=\"color:#6A737D\">      # Web browser</span></span></code></pre>\n</code></pre><h3 id=\"environment-configuration\">Environment Configuration</h3>\n<p>By default, the app connects to your local development ledger at <code>http://localhost:8080</code>.</p>\n<p>Make sure your local ledger service is running:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Start the app (defaults to localhost:8080)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> start</span></span></code></pre>\n</code></pre><p>Then press <code>i</code> for iOS simulator or <code>a</code> for Android emulator.</p>\n<p><strong>To connect to production:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Option 1: Use the convenience script</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> start:prod</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Option 2: Set TANA_LEDGER_URL manually</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">TANA_LEDGER_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">https://mainnet.tana.network</span><span style=\"color:#B392F0\"> npm</span><span style=\"color:#9ECBFF\"> start</span></span></code></pre>\n</code></pre><p>See <a href=\"/contributing/env-vars/\">Environment Variables</a> for more configuration options.</p>\n<h2 id=\"using-the-app\">Using the App</h2>\n<h3 id=\"creating-a-wallet\">Creating a Wallet</h3>\n<ol>\n<li><strong>Open the Vault screen</strong> - Your main wallet dashboard</li>\n<li><strong>Tap &quot;Add Wallet&quot;</strong></li>\n<li><strong>Choose an option:</strong><ul>\n<li><strong>Generate New</strong> - Creates a new Ed25519 keypair</li>\n<li><strong>Import Existing</strong> - Import from private key</li>\n</ul>\n</li>\n<li><strong>Enter details:</strong><ul>\n<li>Display name (your public blockchain name)</li>\n<li>Username (unique blockchain handle, must start with @)</li>\n</ul>\n</li>\n<li><strong>Tap &quot;Generate &amp; Register&quot; or &quot;Import &amp; Register&quot;</strong></li>\n</ol>\n<p>Your wallet is automatically registered on the blockchain with your public key!</p>\n<h3 id=\"blockchain-registration\">Blockchain Registration</h3>\n<p>Every wallet creation automatically registers on the blockchain:</p>\n<ul>\n<li>Username must be unique (app will error if taken)</li>\n<li>Display name and username are required fields</li>\n<li>Backend creates a <code>user_creation</code> transaction immediately</li>\n<li><strong>Registration completes when the next block is produced</strong></li>\n</ul>\n<p><strong>Transaction Flow:</strong></p>\n<ul>\n<li>Wallet is saved locally immediately with a pre-assigned user ID</li>\n<li>The user creation transaction is marked as &quot;pending&quot;</li>\n<li>User appears on blockchain after block production</li>\n<li>In production, blocks are produced automatically (e.g., every 6 seconds)</li>\n</ul>\n<h3 id=\"viewing-balances\">Viewing Balances</h3>\n<p>From the Vault screen:</p>\n<ul>\n<li>See all your wallets and their balances</li>\n<li>Tap a wallet to view details</li>\n<li>Copy public keys or export private keys (securely!)</li>\n</ul>\n<h3 id=\"signing-transactions\">Signing Transactions</h3>\n<p>The approval screen accepts QR codes or manual challenges:</p>\n<ol>\n<li>Scan a QR code or paste a challenge</li>\n<li>Choose which wallet to sign with</li>\n<li>Review the transaction details</li>\n<li>Approve to generate an Ed25519 signature</li>\n</ol>\n<p>Your signature can then be used to authorize transactions on the blockchain.</p>\n<h2 id=\"security\">Security</h2>\n<ul>\n<li><strong>Wallet metadata</strong> stored in <code>AsyncStorage</code></li>\n<li><strong>Private keys</strong> stored in secure storage (<code>expo-secure-store</code>)</li>\n<li><strong>Keys never leave your device</strong> - all signing happens locally</li>\n<li><strong>Export keys before uninstalling</strong> - secure storage is cleared on uninstall</li>\n</ul>\n<p>:::caution\nAlways back up your private keys! If you lose your device and haven&#39;t exported your keys, they cannot be recovered.\n:::</p>\n<h2 id=\"troubleshooting\">Troubleshooting</h2>\n<h3 id=\"white-screen-on-launch\">White Screen on Launch</h3>\n<p>If you see a white screen, ensure all dependencies are installed:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">npx</span><span style=\"color:#9ECBFF\"> expo-doctor</span><span style=\"color:#6A737D\">  # Check for issues</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">npx</span><span style=\"color:#9ECBFF\"> expo</span><span style=\"color:#9ECBFF\"> install</span><span style=\"color:#79B8FF\"> --fix</span><span style=\"color:#6A737D\">  # Fix package versions</span></span></code></pre>\n</code></pre><p>Common fixes:</p>\n<ul>\n<li>Install <code>expo-font</code>: <code>npx expo install expo-font</code></li>\n<li>Remove <code>@types/react-native</code> if installed (types are included with react-native)</li>\n</ul>\n<h3 id=\"xcode-version\">Xcode Version</h3>\n<p>Expo SDK 51+ requires Xcode ≤16.2.0. If you have a newer version:</p>\n<ul>\n<li>Downgrade Xcode for iOS builds</li>\n<li>Use the Expo Go app for testing instead of building locally</li>\n</ul>\n<h3 id=\"connection-issues\">Connection Issues</h3>\n<p>If the app can&#39;t connect to the ledger:</p>\n<ul>\n<li>Verify the ledger is running: <code>tana status</code></li>\n<li>Check the <code>TANA_LEDGER_URL</code> environment variable</li>\n<li>For local development on a physical device, use your computer&#39;s IP address instead of <code>localhost</code></li>\n</ul>\n<h2 id=\"technical-details\">Technical Details</h2>\n<h3 id=\"project-structure\">Project Structure</h3>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>mobile/</span></span>\n<span class=\"line\"><span>├── App.tsx                     # Entry point with navigation</span></span>\n<span class=\"line\"><span>├── app.config.js               # Expo configuration + env vars</span></span>\n<span class=\"line\"><span>├── src/</span></span>\n<span class=\"line\"><span>│   ├── components/</span></span>\n<span class=\"line\"><span>│   │   └── KeyCard.tsx         # Wallet summary display</span></span>\n<span class=\"line\"><span>│   ├── contexts/</span></span>\n<span class=\"line\"><span>│   │   └── KeyStoreContext.tsx # Wallet vault + secure storage</span></span>\n<span class=\"line\"><span>│   ├── lib/</span></span>\n<span class=\"line\"><span>│   │   └── ledgerApi.ts        # REST API client</span></span>\n<span class=\"line\"><span>│   ├── screens/</span></span>\n<span class=\"line\"><span>│   │   ├── AddKeyScreen.tsx    # Generate/import wallets</span></span>\n<span class=\"line\"><span>│   │   ├── LoginApprovalScreen.tsx # Challenge signing</span></span>\n<span class=\"line\"><span>│   │   └── VaultScreen.tsx     # Wallet list, balances</span></span>\n<span class=\"line\"><span>│   └── utils/</span></span>\n<span class=\"line\"><span>│       └── crypto.ts           # Ed25519 cryptography</span></span></code></pre>\n</code></pre><h3 id=\"compatibility\">Compatibility</h3>\n<ul>\n<li>React Native 0.81 / Expo SDK 54</li>\n<li>TypeScript strict mode enabled</li>\n<li>Ed25519 via <code>@noble/ed25519</code></li>\n<li>QR scanning via <code>expo-camera</code></li>\n</ul>\n<h2 id=\"future-enhancements\">Future Enhancements</h2>\n<ul>\n<li>Biometric authentication for transaction signing</li>\n<li>QR-powered challenges for easier approvals</li>\n<li>Push/deep link handling for automatic approval requests</li>\n<li>Encrypted backup/export flows for device migration</li>\n<li>Multi-network support with configurable endpoints</li>\n</ul>\n<h2 id=\"related-documentation\">Related Documentation</h2>\n<ul>\n<li><a href=\"/tana-cli/commands/\">CLI Commands</a> - Command-line interface</li>\n<li><a href=\"/tana-api/intro/\">API Reference</a> - Ledger API endpoints</li>\n<li><a href=\"/contributing/env-vars/\">Environment Variables</a> - Configuration options</li>\n</ul>\n"
  },
  {
    "slug": [
      "guides",
      "patterns",
      "kv-patterns"
    ],
    "metadata": {
      "title": "KV Design Patterns",
      "description": "Advanced patterns and techniques for KV storage"
    },
    "content": "\nCommon patterns and techniques for building sophisticated applications with KV storage.\n\n## Indexing with Prefixes\n\nUse key prefixes to create queryable \"indexes\" without a separate index system.\n\n```typescript\nimport { kv } from 'tana/kv'\n\n// Store user data with multiple access patterns\nasync function createUser(id: string, email: string, username: string) {\n  const user = { id, email, username, created: Date.now() }\n\n  // Primary key: user ID\n  await kv.put(`user:${id}`, user)\n\n  // Secondary indexes\n  await kv.put(`email:${email}`, id)  // Email → ID lookup\n  await kv.put(`username:${username}`, id)  // Username → ID lookup\n\n  return user\n}\n\n// Lookup by email\nasync function getUserByEmail(email: string) {\n  const userId = await kv.get(`email:${email}`)\n  if (!userId) return null\n\n  return await kv.get(`user:${userId}`, { type: 'json' })\n}\n\n// List all users\nasync function listUsers() {\n  const result = await kv.list({ prefix: 'user:' })\n  const users = []\n\n  for (const key of result.keys) {\n    const user = await kv.get(key.name, { type: 'json' })\n    users.push(user)\n  }\n\n  return users\n}\n```\n\n## Atomic Counters\n\nImplement counters that increment atomically.\n\n```typescript\nimport { kv } from 'tana/kv'\n\nasync function incrementCounter(name: string): Promise<number> {\n  const current = await kv.get(`counter:${name}`, { type: 'json' })\n  const newCount = (current?.value || 0) + 1\n\n  await kv.put(`counter:${name}`, {\n    value: newCount,\n    lastUpdated: Date.now()\n  })\n\n  return newCount\n}\n\n// Track page views\nexport async function get(req: Request) {\n  const page = req.url\n  const views = await incrementCounter(`views:${page}`)\n\n  return { page, views }\n}\n```\n\n## TTL Simulation\n\nManually implement time-to-live expiration.\n\n```typescript\nimport { kv } from 'tana/kv'\n\nasync function putWithTTL(key: string, value: any, ttlSeconds: number) {\n  const expiresAt = Date.now() + (ttlSeconds * 1000)\n\n  await kv.put(key, {\n    value,\n    expiresAt\n  })\n}\n\nasync function getWithTTL(key: string) {\n  const data = await kv.get(key, { type: 'json' })\n\n  if (!data) return null\n\n  // Check expiration\n  if (data.expiresAt && Date.now() > data.expiresAt) {\n    await kv.delete(key)  // Clean up expired key\n    return null\n  }\n\n  return data.value\n}\n\n// Cache with 5 minute TTL\nawait putWithTTL('cache:api:users', users, 300)\n```\n\n## Pagination\n\nImplement cursor-based pagination for large datasets.\n\n```typescript\nimport { kv } from 'tana/kv'\n\ninterface PaginatedResult<T> {\n  items: T[]\n  nextCursor: string | null\n  hasMore: boolean\n}\n\nasync function paginateUsers(\n  cursor: string | null,\n  limit: number = 10\n): Promise<PaginatedResult<any>> {\n  // List with limit + 1 to detect if more items exist\n  const result = await kv.list({\n    prefix: 'user:',\n    limit: limit + 1\n  })\n\n  // Fetch actual data\n  const items = []\n  for (let i = 0; i < Math.min(limit, result.keys.length); i++) {\n    const user = await kv.get(result.keys[i].name, { type: 'json' })\n    items.push(user)\n  }\n\n  // Check if more items exist\n  const hasMore = result.keys.length > limit\n  const nextCursor = hasMore ? result.keys[limit - 1].name : null\n\n  return { items, nextCursor, hasMore }\n}\n\n// Usage\nexport async function get(req: Request) {\n  const cursor = req.query.cursor || null\n  const page = await paginateUsers(cursor, 10)\n\n  return page\n}\n```\n\n## Rate Limiting\n\nTrack request rates per user or IP.\n\n```typescript\nimport { kv } from 'tana/kv'\n\nasync function checkRateLimit(\n  identifier: string,\n  maxRequests: number,\n  windowSeconds: number\n): Promise<{ allowed: boolean; remaining: number }> {\n  const key = `ratelimit:${identifier}`\n  const now = Date.now()\n  const windowStart = now - (windowSeconds * 1000)\n\n  // Get request log\n  const data = await kv.get(key, { type: 'json' })\n  const requests = data?.requests || []\n\n  // Filter to current window\n  const recentRequests = requests.filter((ts: number) => ts > windowStart)\n\n  // Check limit\n  const allowed = recentRequests.length < maxRequests\n\n  if (allowed) {\n    recentRequests.push(now)\n    await kv.put(key, { requests: recentRequests })\n  }\n\n  return {\n    allowed,\n    remaining: Math.max(0, maxRequests - recentRequests.length)\n  }\n}\n\n// Apply rate limit\nexport async function post(req: Request, body: any) {\n  const userId = req.tana.caller?.id\n\n  if (!userId) {\n    return { error: 'Login required' }\n  }\n\n  const limit = await checkRateLimit(userId, 100, 60)  // 100 req/min\n\n  if (!limit.allowed) {\n    return {\n      error: 'Rate limit exceeded',\n      remaining: limit.remaining\n    }\n  }\n\n  // Process request...\n  return { success: true }\n}\n```\n\n## Cache Invalidation\n\nImplement cache with manual invalidation.\n\n```typescript\nimport { kv } from 'tana/kv'\n\nclass Cache {\n  // Set with version tag\n  async set(key: string, value: any, tags: string[] = []) {\n    await kv.put(`cache:${key}`, { value, tags, cachedAt: Date.now() })\n\n    // Track keys by tag\n    for (const tag of tags) {\n      const tagData = await kv.get(`tag:${tag}`, { type: 'json' })\n      const keys = tagData?.keys || []\n\n      if (!keys.includes(key)) {\n        keys.push(key)\n        await kv.put(`tag:${tag}`, { keys })\n      }\n    }\n  }\n\n  // Get from cache\n  async get(key: string) {\n    const data = await kv.get(`cache:${key}`, { type: 'json' })\n    return data?.value || null\n  }\n\n  // Invalidate by tag\n  async invalidateTag(tag: string) {\n    const tagData = await kv.get(`tag:${tag}`, { type: 'json' })\n    if (!tagData) return\n\n    // Delete all keys with this tag\n    for (const key of tagData.keys) {\n      await kv.delete(`cache:${key}`)\n    }\n\n    await kv.delete(`tag:${tag}`)\n  }\n}\n\nconst cache = new Cache()\n\n// Cache user data with tag\nawait cache.set('user:123', userData, ['users', 'user:123'])\n\n// Invalidate all user caches\nawait cache.invalidateTag('users')\n```\n\n## Batch Operations\n\nEfficiently handle multiple KV operations.\n\n```typescript\nimport { kv } from 'tana/kv'\n\nasync function batchGet(keys: string[]) {\n  const promises = keys.map(key => kv.get(key, { type: 'json' }))\n  return await Promise.all(promises)\n}\n\nasync function batchPut(entries: Record<string, any>) {\n  const promises = Object.entries(entries).map(([key, value]) =>\n    kv.put(key, value)\n  )\n  await Promise.all(promises)\n}\n\nasync function batchDelete(keys: string[]) {\n  const promises = keys.map(key => kv.delete(key))\n  await Promise.all(promises)\n}\n\n// Usage\nexport async function post(req: Request, body: any) {\n  // Batch create users\n  await batchPut({\n    'user:1': { name: 'alice' },\n    'user:2': { name: 'bob' },\n    'user:3': { name: 'charlie' }\n  })\n\n  // Batch fetch\n  const users = await batchGet(['user:1', 'user:2', 'user:3'])\n\n  return { users }\n}\n```\n\n## Session Storage\n\nComplete session management implementation.\n\n```typescript\nimport { kv } from 'tana/kv'\nimport { randomBytes } from 'crypto'\n\nclass SessionStore {\n  private ttl = 3600  // 1 hour\n\n  async create(userId: string): Promise<string> {\n    const sessionId = randomBytes(32).toString('hex')\n    const session = {\n      id: sessionId,\n      userId,\n      createdAt: Date.now(),\n      expiresAt: Date.now() + (this.ttl * 1000)\n    }\n\n    await kv.put(`session:${sessionId}`, session)\n    await kv.put(`user_session:${userId}`, sessionId)\n\n    return sessionId\n  }\n\n  async get(sessionId: string) {\n    const session = await kv.get(`session:${sessionId}`, { type: 'json' })\n\n    if (!session) return null\n\n    // Check expiration\n    if (Date.now() > session.expiresAt) {\n      await this.destroy(sessionId)\n      return null\n    }\n\n    return session\n  }\n\n  async refresh(sessionId: string) {\n    const session = await this.get(sessionId)\n    if (!session) return false\n\n    session.expiresAt = Date.now() + (this.ttl * 1000)\n    await kv.put(`session:${sessionId}`, session)\n\n    return true\n  }\n\n  async destroy(sessionId: string) {\n    const session = await this.get(sessionId)\n    if (session) {\n      await kv.delete(`user_session:${session.userId}`)\n    }\n    await kv.delete(`session:${sessionId}`)\n  }\n\n  async getByUserId(userId: string): Promise<string | null> {\n    return await kv.get(`user_session:${userId}`)\n  }\n}\n```\n\n## Feature Flags\n\nDynamic feature flag system.\n\n```typescript\nimport { kv } from 'tana/kv'\n\nasync function setFlag(name: string, enabled: boolean, config: any = {}) {\n  await kv.put(`flag:${name}`, {\n    enabled,\n    config,\n    updatedAt: Date.now()\n  })\n}\n\nasync function isEnabled(name: string, context: any = {}): Promise<boolean> {\n  const flag = await kv.get(`flag:${name}`, { type: 'json' })\n\n  if (!flag) return false\n  if (!flag.enabled) return false\n\n  // Percentage rollout\n  if (flag.config.percentage) {\n    const hash = hashString(context.userId || '')\n    return (hash % 100) < flag.config.percentage\n  }\n\n  // User whitelist\n  if (flag.config.userIds) {\n    return flag.config.userIds.includes(context.userId)\n  }\n\n  return true\n}\n\n// Usage\nexport async function get(req: Request) {\n  const userId = req.tana.caller?.id\n\n  const newUIEnabled = await isEnabled('new_ui', { userId })\n\n  return {\n    features: {\n      newUI: newUIEnabled\n    }\n  }\n}\n```\n\n## Best Practices\n\n### ✅ Key Naming Conventions\n\n```typescript\n// Good: Hierarchical, predictable\n'user:123'\n'user:123:profile'\n'user:123:settings'\n'cache:api:users'\n'session:abc123'\n\n// Bad: Inconsistent, hard to query\n'123_user'\n'user_profile_123'\n'apiCacheUsers'\n```\n\n### ✅ Efficient Listing\n\n```typescript\n// Good: Use prefix to limit scope\nconst users = await kv.list({ prefix: 'user:', limit: 100 })\n\n// Bad: List everything then filter\nconst all = await kv.list()\nconst users = all.keys.filter(k => k.name.startsWith('user:'))\n```\n\n### ✅ Error Handling\n\n```typescript\n// Good: Handle null and errors\ntry {\n  const data = await kv.get('key', { type: 'json' })\n  if (!data) {\n    return { error: 'Not found' }\n  }\n  // Use data\n} catch (err) {\n  return { error: 'Invalid JSON' }\n}\n\n// Bad: Assume data exists\nconst data = await kv.get('key', { type: 'json' })\nreturn { value: data.someField }  // Crashes if null\n```\n\n### ✅ Avoid Large Values\n\n```typescript\n// Good: Split large objects\nawait kv.put('user:123:profile', profile)\nawait kv.put('user:123:preferences', prefs)\nawait kv.put('user:123:activity', activity)\n\n// Bad: Store everything together\nawait kv.put('user:123', {\n  profile,\n  preferences,\n  activity,\n  history,  // This could grow unbounded\n  logs      // This could exceed 25MB limit\n})\n```\n\n## See Also\n\n- [KV Storage Guide](/guides/kv-storage) - Basic usage\n- [KV API Reference](/tana-api/modules/kv) - Complete API documentation\n- [Smart Contracts](/guides/smart-contracts) - Contract development\n",
    "html": "<p>Common patterns and techniques for building sophisticated applications with KV storage.</p>\n<h2 id=\"indexing-with-prefixes\">Indexing with Prefixes</h2>\n<p>Use key prefixes to create queryable &quot;indexes&quot; without a separate index system.</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { kv } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/kv'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Store user data with multiple access patterns</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> createUser</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">id</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">email</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">username</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> user</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> { id, email, username, created: Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">() }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Primary key: user ID</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`user:${</span><span style=\"color:#E1E4E8\">id</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, user)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Secondary indexes</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`email:${</span><span style=\"color:#E1E4E8\">email</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, id)  </span><span style=\"color:#6A737D\">// Email → ID lookup</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`username:${</span><span style=\"color:#E1E4E8\">username</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, id)  </span><span style=\"color:#6A737D\">// Username → ID lookup</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> user</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Lookup by email</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> getUserByEmail</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">email</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> userId</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`email:${</span><span style=\"color:#E1E4E8\">email</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">userId) </span><span style=\"color:#F97583\">return</span><span style=\"color:#79B8FF\"> null</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`user:${</span><span style=\"color:#E1E4E8\">userId</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// List all users</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> listUsers</span><span style=\"color:#E1E4E8\">() {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> result</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">list</span><span style=\"color:#E1E4E8\">({ prefix: </span><span style=\"color:#9ECBFF\">'user:'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> users</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> []</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  for</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> key</span><span style=\"color:#F97583\"> of</span><span style=\"color:#E1E4E8\"> result.keys) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> user</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(key.name, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    users.</span><span style=\"color:#B392F0\">push</span><span style=\"color:#E1E4E8\">(user)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> users</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h2 id=\"atomic-counters\">Atomic Counters</h2>\n<p>Implement counters that increment atomically.</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { kv } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/kv'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> incrementCounter</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">name</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Promise</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#79B8FF\">number</span><span style=\"color:#E1E4E8\">> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> current</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`counter:${</span><span style=\"color:#E1E4E8\">name</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> newCount</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> (current?.value </span><span style=\"color:#F97583\">||</span><span style=\"color:#79B8FF\"> 0</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">+</span><span style=\"color:#79B8FF\"> 1</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`counter:${</span><span style=\"color:#E1E4E8\">name</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    value: newCount,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    lastUpdated: Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> newCount</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Track page views</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Request</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> page</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> req.url</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> views</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> incrementCounter</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`views:${</span><span style=\"color:#E1E4E8\">page</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> { page, views }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h2 id=\"ttl-simulation\">TTL Simulation</h2>\n<p>Manually implement time-to-live expiration.</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { kv } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/kv'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> putWithTTL</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">key</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">value</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> any</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">ttlSeconds</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> expiresAt</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">() </span><span style=\"color:#F97583\">+</span><span style=\"color:#E1E4E8\"> (ttlSeconds </span><span style=\"color:#F97583\">*</span><span style=\"color:#79B8FF\"> 1000</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(key, {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    value,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    expiresAt</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> getWithTTL</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">key</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> data</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(key, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">data) </span><span style=\"color:#F97583\">return</span><span style=\"color:#79B8FF\"> null</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Check expiration</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (data.expiresAt </span><span style=\"color:#F97583\">&#x26;&#x26;</span><span style=\"color:#E1E4E8\"> Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">() </span><span style=\"color:#F97583\">></span><span style=\"color:#E1E4E8\"> data.expiresAt) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">delete</span><span style=\"color:#E1E4E8\">(key)  </span><span style=\"color:#6A737D\">// Clean up expired key</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#79B8FF\"> null</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> data.value</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Cache with 5 minute TTL</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#B392F0\"> putWithTTL</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'cache:api:users'</span><span style=\"color:#E1E4E8\">, users, </span><span style=\"color:#79B8FF\">300</span><span style=\"color:#E1E4E8\">)</span></span></code></pre>\n</code></pre><h2 id=\"pagination\">Pagination</h2>\n<p>Implement cursor-based pagination for large datasets.</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { kv } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/kv'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">interface</span><span style=\"color:#B392F0\"> PaginatedResult</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">T</span><span style=\"color:#E1E4E8\">> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  items</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> T</span><span style=\"color:#E1E4E8\">[]</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  nextCursor</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#F97583\"> |</span><span style=\"color:#79B8FF\"> null</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  hasMore</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> boolean</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> paginateUsers</span><span style=\"color:#E1E4E8\">(</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  cursor</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#F97583\"> |</span><span style=\"color:#79B8FF\"> null</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  limit</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#F97583\"> =</span><span style=\"color:#79B8FF\"> 10</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Promise</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">PaginatedResult</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#79B8FF\">any</span><span style=\"color:#E1E4E8\">>> {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // List with limit + 1 to detect if more items exist</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> result</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">list</span><span style=\"color:#E1E4E8\">({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    prefix: </span><span style=\"color:#9ECBFF\">'user:'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    limit: limit </span><span style=\"color:#F97583\">+</span><span style=\"color:#79B8FF\"> 1</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Fetch actual data</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> items</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> []</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  for</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">let</span><span style=\"color:#E1E4E8\"> i </span><span style=\"color:#F97583\">=</span><span style=\"color:#79B8FF\"> 0</span><span style=\"color:#E1E4E8\">; i </span><span style=\"color:#F97583\">&#x3C;</span><span style=\"color:#E1E4E8\"> Math.</span><span style=\"color:#B392F0\">min</span><span style=\"color:#E1E4E8\">(limit, result.keys.</span><span style=\"color:#79B8FF\">length</span><span style=\"color:#E1E4E8\">); i</span><span style=\"color:#F97583\">++</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> user</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(result.keys[i].name, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    items.</span><span style=\"color:#B392F0\">push</span><span style=\"color:#E1E4E8\">(user)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Check if more items exist</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> hasMore</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> result.keys.</span><span style=\"color:#79B8FF\">length</span><span style=\"color:#F97583\"> ></span><span style=\"color:#E1E4E8\"> limit</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> nextCursor</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> hasMore </span><span style=\"color:#F97583\">?</span><span style=\"color:#E1E4E8\"> result.keys[limit </span><span style=\"color:#F97583\">-</span><span style=\"color:#79B8FF\"> 1</span><span style=\"color:#E1E4E8\">].name </span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> null</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> { items, nextCursor, hasMore }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Usage</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Request</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> cursor</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> req.query.cursor </span><span style=\"color:#F97583\">||</span><span style=\"color:#79B8FF\"> null</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> page</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> paginateUsers</span><span style=\"color:#E1E4E8\">(cursor, </span><span style=\"color:#79B8FF\">10</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> page</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h2 id=\"rate-limiting\">Rate Limiting</h2>\n<p>Track request rates per user or IP.</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { kv } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/kv'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> checkRateLimit</span><span style=\"color:#E1E4E8\">(</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  identifier</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  maxRequests</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  windowSeconds</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Promise</span><span style=\"color:#E1E4E8\">&#x3C;{ </span><span style=\"color:#FFAB70\">allowed</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> boolean</span><span style=\"color:#E1E4E8\">; </span><span style=\"color:#FFAB70\">remaining</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\"> }> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> key</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> `ratelimit:${</span><span style=\"color:#E1E4E8\">identifier</span><span style=\"color:#9ECBFF\">}`</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> now</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> windowStart</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> now </span><span style=\"color:#F97583\">-</span><span style=\"color:#E1E4E8\"> (windowSeconds </span><span style=\"color:#F97583\">*</span><span style=\"color:#79B8FF\"> 1000</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Get request log</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> data</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(key, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> requests</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> data?.requests </span><span style=\"color:#F97583\">||</span><span style=\"color:#E1E4E8\"> []</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Filter to current window</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> recentRequests</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> requests.</span><span style=\"color:#B392F0\">filter</span><span style=\"color:#E1E4E8\">((</span><span style=\"color:#FFAB70\">ts</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> ts </span><span style=\"color:#F97583\">></span><span style=\"color:#E1E4E8\"> windowStart)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Check limit</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> allowed</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> recentRequests.</span><span style=\"color:#79B8FF\">length</span><span style=\"color:#F97583\"> &#x3C;</span><span style=\"color:#E1E4E8\"> maxRequests</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (allowed) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    recentRequests.</span><span style=\"color:#B392F0\">push</span><span style=\"color:#E1E4E8\">(now)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(key, { requests: recentRequests })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    allowed,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    remaining: Math.</span><span style=\"color:#B392F0\">max</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">0</span><span style=\"color:#E1E4E8\">, maxRequests </span><span style=\"color:#F97583\">-</span><span style=\"color:#E1E4E8\"> recentRequests.</span><span style=\"color:#79B8FF\">length</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Apply rate limit</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> post</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Request</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">body</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> any</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> userId</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> req.tana.caller?.id</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">userId) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> { error: </span><span style=\"color:#9ECBFF\">'Login required'</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> limit</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> checkRateLimit</span><span style=\"color:#E1E4E8\">(userId, </span><span style=\"color:#79B8FF\">100</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">60</span><span style=\"color:#E1E4E8\">)  </span><span style=\"color:#6A737D\">// 100 req/min</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">limit.allowed) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      error: </span><span style=\"color:#9ECBFF\">'Rate limit exceeded'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      remaining: limit.remaining</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Process request...</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> { success: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h2 id=\"cache-invalidation\">Cache Invalidation</h2>\n<p>Implement cache with manual invalidation.</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { kv } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/kv'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">class</span><span style=\"color:#B392F0\"> Cache</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Set with version tag</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  async</span><span style=\"color:#B392F0\"> set</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">key</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">value</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> any</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">tags</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">[] </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> []) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`cache:${</span><span style=\"color:#E1E4E8\">key</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, { value, tags, cachedAt: Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">() })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Track keys by tag</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    for</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> tag</span><span style=\"color:#F97583\"> of</span><span style=\"color:#E1E4E8\"> tags) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      const</span><span style=\"color:#79B8FF\"> tagData</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`tag:${</span><span style=\"color:#E1E4E8\">tag</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      const</span><span style=\"color:#79B8FF\"> keys</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> tagData?.keys </span><span style=\"color:#F97583\">||</span><span style=\"color:#E1E4E8\"> []</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">      if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">keys.</span><span style=\"color:#B392F0\">includes</span><span style=\"color:#E1E4E8\">(key)) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        keys.</span><span style=\"color:#B392F0\">push</span><span style=\"color:#E1E4E8\">(key)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`tag:${</span><span style=\"color:#E1E4E8\">tag</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, { keys })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Get from cache</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  async</span><span style=\"color:#B392F0\"> get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">key</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> data</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`cache:${</span><span style=\"color:#E1E4E8\">key</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> data?.value </span><span style=\"color:#F97583\">||</span><span style=\"color:#79B8FF\"> null</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Invalidate by tag</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  async</span><span style=\"color:#B392F0\"> invalidateTag</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">tag</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> tagData</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`tag:${</span><span style=\"color:#E1E4E8\">tag</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">tagData) </span><span style=\"color:#F97583\">return</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Delete all keys with this tag</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    for</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> key</span><span style=\"color:#F97583\"> of</span><span style=\"color:#E1E4E8\"> tagData.keys) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">delete</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`cache:${</span><span style=\"color:#E1E4E8\">key</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">    await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">delete</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`tag:${</span><span style=\"color:#E1E4E8\">tag</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> cache</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> new</span><span style=\"color:#B392F0\"> Cache</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Cache user data with tag</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> cache.</span><span style=\"color:#B392F0\">set</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'user:123'</span><span style=\"color:#E1E4E8\">, userData, [</span><span style=\"color:#9ECBFF\">'users'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'user:123'</span><span style=\"color:#E1E4E8\">])</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Invalidate all user caches</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> cache.</span><span style=\"color:#B392F0\">invalidateTag</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'users'</span><span style=\"color:#E1E4E8\">)</span></span></code></pre>\n</code></pre><h2 id=\"batch-operations\">Batch Operations</h2>\n<p>Efficiently handle multiple KV operations.</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { kv } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/kv'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> batchGet</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">keys</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">[]) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> promises</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> keys.</span><span style=\"color:#B392F0\">map</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">key</span><span style=\"color:#F97583\"> =></span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(key, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> }))</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#F97583\"> await</span><span style=\"color:#79B8FF\"> Promise</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">all</span><span style=\"color:#E1E4E8\">(promises)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> batchPut</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">entries</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Record</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#79B8FF\">string</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">any</span><span style=\"color:#E1E4E8\">>) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> promises</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> Object.</span><span style=\"color:#B392F0\">entries</span><span style=\"color:#E1E4E8\">(entries).</span><span style=\"color:#B392F0\">map</span><span style=\"color:#E1E4E8\">(([</span><span style=\"color:#FFAB70\">key</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">value</span><span style=\"color:#E1E4E8\">]) </span><span style=\"color:#F97583\">=></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(key, value)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  )</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#79B8FF\"> Promise</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">all</span><span style=\"color:#E1E4E8\">(promises)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> batchDelete</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">keys</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">[]) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> promises</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> keys.</span><span style=\"color:#B392F0\">map</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">key</span><span style=\"color:#F97583\"> =></span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">delete</span><span style=\"color:#E1E4E8\">(key))</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#79B8FF\"> Promise</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">all</span><span style=\"color:#E1E4E8\">(promises)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Usage</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> post</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Request</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">body</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> any</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Batch create users</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#B392F0\"> batchPut</span><span style=\"color:#E1E4E8\">({</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'user:1'</span><span style=\"color:#E1E4E8\">: { name: </span><span style=\"color:#9ECBFF\">'alice'</span><span style=\"color:#E1E4E8\"> },</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'user:2'</span><span style=\"color:#E1E4E8\">: { name: </span><span style=\"color:#9ECBFF\">'bob'</span><span style=\"color:#E1E4E8\"> },</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'user:3'</span><span style=\"color:#E1E4E8\">: { name: </span><span style=\"color:#9ECBFF\">'charlie'</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Batch fetch</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> users</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> batchGet</span><span style=\"color:#E1E4E8\">([</span><span style=\"color:#9ECBFF\">'user:1'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'user:2'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'user:3'</span><span style=\"color:#E1E4E8\">])</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> { users }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h2 id=\"session-storage\">Session Storage</h2>\n<p>Complete session management implementation.</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { kv } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/kv'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { randomBytes } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'crypto'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">class</span><span style=\"color:#B392F0\"> SessionStore</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  private</span><span style=\"color:#FFAB70\"> ttl</span><span style=\"color:#F97583\"> =</span><span style=\"color:#79B8FF\"> 3600</span><span style=\"color:#6A737D\">  // 1 hour</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  async</span><span style=\"color:#B392F0\"> create</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">userId</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Promise</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#79B8FF\">string</span><span style=\"color:#E1E4E8\">> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> sessionId</span><span style=\"color:#F97583\"> =</span><span style=\"color:#B392F0\"> randomBytes</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">32</span><span style=\"color:#E1E4E8\">).</span><span style=\"color:#B392F0\">toString</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'hex'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> session</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      id: sessionId,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      userId,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      createdAt: Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">(),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      expiresAt: Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">() </span><span style=\"color:#F97583\">+</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#79B8FF\">this</span><span style=\"color:#E1E4E8\">.ttl </span><span style=\"color:#F97583\">*</span><span style=\"color:#79B8FF\"> 1000</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">    await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`session:${</span><span style=\"color:#E1E4E8\">sessionId</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, session)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`user_session:${</span><span style=\"color:#E1E4E8\">userId</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, sessionId)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> sessionId</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  async</span><span style=\"color:#B392F0\"> get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">sessionId</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> session</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`session:${</span><span style=\"color:#E1E4E8\">sessionId</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">    if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">session) </span><span style=\"color:#F97583\">return</span><span style=\"color:#79B8FF\"> null</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Check expiration</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    if</span><span style=\"color:#E1E4E8\"> (Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">() </span><span style=\"color:#F97583\">></span><span style=\"color:#E1E4E8\"> session.expiresAt) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      await</span><span style=\"color:#79B8FF\"> this</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">destroy</span><span style=\"color:#E1E4E8\">(sessionId)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      return</span><span style=\"color:#79B8FF\"> null</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> session</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  async</span><span style=\"color:#B392F0\"> refresh</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">sessionId</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> session</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#79B8FF\"> this</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(sessionId)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">session) </span><span style=\"color:#F97583\">return</span><span style=\"color:#79B8FF\"> false</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    session.expiresAt </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">() </span><span style=\"color:#F97583\">+</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#79B8FF\">this</span><span style=\"color:#E1E4E8\">.ttl </span><span style=\"color:#F97583\">*</span><span style=\"color:#79B8FF\"> 1000</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`session:${</span><span style=\"color:#E1E4E8\">sessionId</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, session)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#79B8FF\"> true</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  async</span><span style=\"color:#B392F0\"> destroy</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">sessionId</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> session</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#79B8FF\"> this</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(sessionId)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    if</span><span style=\"color:#E1E4E8\"> (session) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">delete</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`user_session:${</span><span style=\"color:#E1E4E8\">session</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">userId</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">delete</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`session:${</span><span style=\"color:#E1E4E8\">sessionId</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  async</span><span style=\"color:#B392F0\"> getByUserId</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">userId</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Promise</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#79B8FF\">string</span><span style=\"color:#F97583\"> |</span><span style=\"color:#79B8FF\"> null</span><span style=\"color:#E1E4E8\">> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`user_session:${</span><span style=\"color:#E1E4E8\">userId</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h2 id=\"feature-flags\">Feature Flags</h2>\n<p>Dynamic feature flag system.</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { kv } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/kv'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> setFlag</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">name</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">enabled</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> boolean</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">config</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> any</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {}) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`flag:${</span><span style=\"color:#E1E4E8\">name</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    enabled,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    config,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    updatedAt: Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> isEnabled</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">name</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">context</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> any</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {})</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Promise</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#79B8FF\">boolean</span><span style=\"color:#E1E4E8\">> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> flag</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`flag:${</span><span style=\"color:#E1E4E8\">name</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">flag) </span><span style=\"color:#F97583\">return</span><span style=\"color:#79B8FF\"> false</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">flag.enabled) </span><span style=\"color:#F97583\">return</span><span style=\"color:#79B8FF\"> false</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Percentage rollout</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (flag.config.percentage) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> hash</span><span style=\"color:#F97583\"> =</span><span style=\"color:#B392F0\"> hashString</span><span style=\"color:#E1E4E8\">(context.userId </span><span style=\"color:#F97583\">||</span><span style=\"color:#9ECBFF\"> ''</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> (hash </span><span style=\"color:#F97583\">%</span><span style=\"color:#79B8FF\"> 100</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">&#x3C;</span><span style=\"color:#E1E4E8\"> flag.config.percentage</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // User whitelist</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (flag.config.userIds) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> flag.config.userIds.</span><span style=\"color:#B392F0\">includes</span><span style=\"color:#E1E4E8\">(context.userId)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#79B8FF\"> true</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Usage</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Request</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> userId</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> req.tana.caller?.id</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> newUIEnabled</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> isEnabled</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'new_ui'</span><span style=\"color:#E1E4E8\">, { userId })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    features: {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      newUI: newUIEnabled</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h2 id=\"best-practices\">Best Practices</h2>\n<h3 id=\"-key-naming-conventions\">✅ Key Naming Conventions</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Good: Hierarchical, predictable</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">'user:123'</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">'user:123:profile'</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">'user:123:settings'</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">'cache:api:users'</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">'session:abc123'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Bad: Inconsistent, hard to query</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">'123_user'</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">'user_profile_123'</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">'apiCacheUsers'</span></span></code></pre>\n</code></pre><h3 id=\"-efficient-listing\">✅ Efficient Listing</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Good: Use prefix to limit scope</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> users</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">list</span><span style=\"color:#E1E4E8\">({ prefix: </span><span style=\"color:#9ECBFF\">'user:'</span><span style=\"color:#E1E4E8\">, limit: </span><span style=\"color:#79B8FF\">100</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Bad: List everything then filter</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> all</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">list</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> users</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> all.keys.</span><span style=\"color:#B392F0\">filter</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">k</span><span style=\"color:#F97583\"> =></span><span style=\"color:#E1E4E8\"> k.name.</span><span style=\"color:#B392F0\">startsWith</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'user:'</span><span style=\"color:#E1E4E8\">))</span></span></code></pre>\n</code></pre><h3 id=\"-error-handling\">✅ Error Handling</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Good: Handle null and errors</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">try</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> data</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'key'</span><span style=\"color:#E1E4E8\">, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">data) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> { error: </span><span style=\"color:#9ECBFF\">'Not found'</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Use data</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">} </span><span style=\"color:#F97583\">catch</span><span style=\"color:#E1E4E8\"> (err) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> { error: </span><span style=\"color:#9ECBFF\">'Invalid JSON'</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Bad: Assume data exists</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> data</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'key'</span><span style=\"color:#E1E4E8\">, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">return</span><span style=\"color:#E1E4E8\"> { value: data.someField }  </span><span style=\"color:#6A737D\">// Crashes if null</span></span></code></pre>\n</code></pre><h3 id=\"-avoid-large-values\">✅ Avoid Large Values</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Good: Split large objects</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'user:123:profile'</span><span style=\"color:#E1E4E8\">, profile)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'user:123:preferences'</span><span style=\"color:#E1E4E8\">, prefs)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'user:123:activity'</span><span style=\"color:#E1E4E8\">, activity)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Bad: Store everything together</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'user:123'</span><span style=\"color:#E1E4E8\">, {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  profile,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  preferences,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  activity,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  history,  </span><span style=\"color:#6A737D\">// This could grow unbounded</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  logs      </span><span style=\"color:#6A737D\">// This could exceed 25MB limit</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">})</span></span></code></pre>\n</code></pre><h2 id=\"see-also\">See Also</h2>\n<ul>\n<li><a href=\"/guides/kv-storage\">KV Storage Guide</a> - Basic usage</li>\n<li><a href=\"/tana-api/modules/kv\">KV API Reference</a> - Complete API documentation</li>\n<li><a href=\"/guides/smart-contracts\">Smart Contracts</a> - Contract development</li>\n</ul>\n"
  },
  {
    "slug": [
      "guides",
      "quickstart"
    ],
    "metadata": {
      "title": "Quick Start",
      "description": "Get up and running with Tana in minutes"
    },
    "content": "\n## Prerequisites\n\n- macOS, Linux, or Windows (WSL)\n- [Docker](https://docker.com) (for PostgreSQL database)\n\n## Installation\n\n### Download Binaries\n\n**Coming soon:** Pre-built binaries for all platforms.\n\nFor now, see the [Contributing Guide](/contributing/setup/) for building from source.\n\n## Usage\n\nOnce you have the `tana` binary installed:\n\n```bash\n# Start the ledger service\ntana start\n\n# In another terminal, create a user\ntana new user @alice --name \"Alice Johnson\"\n\n# Deploy user to blockchain\ntana deploy user @alice\n\n# Check status\ntana status\n```\n\n## Basic Workflow\n\n### 1. Start the Ledger\n\n```bash\ntana start\n```\n\nThis starts the ledger service on port 8080.\n\n### 2. Create a User\n\n```bash\ntana new user @alice --name \"Alice Johnson\"\n```\n\nThis creates a user configuration locally with a generated keypair.\n\n### 3. Deploy User to Blockchain\n\n```bash\ntana deploy user @alice\n```\n\nThis creates a transaction on the blockchain to register the user.\n\n### 4. Check Balance\n\n```bash\ntana balance @alice USD\n```\n\nView the user's balance in a specific currency.\n\n### 5. Transfer Funds\n\n```bash\ntana transfer @alice @bob 100 USD\n```\n\nTransfer currency between users.\n\n## Using the API\n\nThe ledger service provides a REST API:\n\n```bash\n# Health check\ncurl http://localhost:8080/health\n\n# List users\ncurl http://localhost:8080/users\n\n# Get latest block\ncurl http://localhost:8080/blocks/latest\n```\n\nSee the [API Reference](/tana-api/intro/) for complete documentation.\n\n## Next Steps\n\n1. ✅ Ledger service is working\n2. 🔨 Build CLI commands to interact with ledger\n3. 🔨 Implement smart contracts service\n4. 🔨 Create blockchain node with P2P\n5. 🔨 Build landing pages feature\n\nCheck out the [CLI Reference](/tana-cli/intro/) to learn more about available commands.\n",
    "html": "<h2 id=\"prerequisites\">Prerequisites</h2>\n<ul>\n<li>macOS, Linux, or Windows (WSL)</li>\n<li><a href=\"https://docker.com\">Docker</a> (for PostgreSQL database)</li>\n</ul>\n<h2 id=\"installation\">Installation</h2>\n<h3 id=\"download-binaries\">Download Binaries</h3>\n<p><strong>Coming soon:</strong> Pre-built binaries for all platforms.</p>\n<p>For now, see the <a href=\"/contributing/setup/\">Contributing Guide</a> for building from source.</p>\n<h2 id=\"usage\">Usage</h2>\n<p>Once you have the <code>tana</code> binary installed:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Start the ledger service</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> start</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># In another terminal, create a user</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> new</span><span style=\"color:#9ECBFF\"> user</span><span style=\"color:#9ECBFF\"> @alice</span><span style=\"color:#79B8FF\"> --name</span><span style=\"color:#9ECBFF\"> \"Alice Johnson\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Deploy user to blockchain</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> deploy</span><span style=\"color:#9ECBFF\"> user</span><span style=\"color:#9ECBFF\"> @alice</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Check status</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> status</span></span></code></pre>\n</code></pre><h2 id=\"basic-workflow\">Basic Workflow</h2>\n<h3 id=\"1-start-the-ledger\">1. Start the Ledger</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> start</span></span></code></pre>\n</code></pre><p>This starts the ledger service on port 8080.</p>\n<h3 id=\"2-create-a-user\">2. Create a User</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> new</span><span style=\"color:#9ECBFF\"> user</span><span style=\"color:#9ECBFF\"> @alice</span><span style=\"color:#79B8FF\"> --name</span><span style=\"color:#9ECBFF\"> \"Alice Johnson\"</span></span></code></pre>\n</code></pre><p>This creates a user configuration locally with a generated keypair.</p>\n<h3 id=\"3-deploy-user-to-blockchain\">3. Deploy User to Blockchain</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> deploy</span><span style=\"color:#9ECBFF\"> user</span><span style=\"color:#9ECBFF\"> @alice</span></span></code></pre>\n</code></pre><p>This creates a transaction on the blockchain to register the user.</p>\n<h3 id=\"4-check-balance\">4. Check Balance</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> balance</span><span style=\"color:#9ECBFF\"> @alice</span><span style=\"color:#9ECBFF\"> USD</span></span></code></pre>\n</code></pre><p>View the user&#39;s balance in a specific currency.</p>\n<h3 id=\"5-transfer-funds\">5. Transfer Funds</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> transfer</span><span style=\"color:#9ECBFF\"> @alice</span><span style=\"color:#9ECBFF\"> @bob</span><span style=\"color:#79B8FF\"> 100</span><span style=\"color:#9ECBFF\"> USD</span></span></code></pre>\n</code></pre><p>Transfer currency between users.</p>\n<h2 id=\"using-the-api\">Using the API</h2>\n<p>The ledger service provides a REST API:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Health check</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8080/health</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># List users</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8080/users</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Get latest block</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8080/blocks/latest</span></span></code></pre>\n</code></pre><p>See the <a href=\"/tana-api/intro/\">API Reference</a> for complete documentation.</p>\n<h2 id=\"next-steps\">Next Steps</h2>\n<ol>\n<li>✅ Ledger service is working</li>\n<li>🔨 Build CLI commands to interact with ledger</li>\n<li>🔨 Implement smart contracts service</li>\n<li>🔨 Create blockchain node with P2P</li>\n<li>🔨 Build landing pages feature</li>\n</ol>\n<p>Check out the <a href=\"/tana-cli/intro/\">CLI Reference</a> to learn more about available commands.</p>\n"
  },
  {
    "slug": [
      "guides",
      "smart-contracts"
    ],
    "metadata": {
      "title": "Smart Contracts",
      "description": "Learn to write TypeScript smart contracts for Tana",
      "sidebar": {
        "order": 3
      }
    },
    "content": "\nTana smart contracts are TypeScript files that export up to 4 functions: `init()`, `contract()`, `get()`, and `post()`. All functions must return JSON-serializable data.\n\n## Quick Start\n\n### 1. Create a Contract\n\nCreate a single TypeScript file with your contract logic:\n\n```typescript\n// mycontract.ts\nimport type { Request, JsonValue } from 'tana/net'\nimport { context } from 'tana/context'\nimport { console } from 'tana/core'\nimport { data } from 'tana/data'\n\nexport function init(): JsonValue {\n  console.log('Contract initialized')\n  data.set('deployed_at', Date.now().toString())\n\n  return { initialized: true }\n}\n\nexport function contract(): JsonValue {\n  const caller = context.caller()\n  const owner = context.owner()\n\n  if (!caller || caller.id !== owner.id) {\n    return { error: 'Unauthorized' }\n  }\n\n  return { success: true, caller: caller.username }\n}\n\nexport function get(req: Request): JsonValue {\n  const caller = req.tana.caller\n\n  return {\n    message: 'Hello from Tana!',\n    caller: caller?.username || 'anonymous',\n    timestamp: Date.now()\n  }\n}\n\nexport function post(req: Request): JsonValue {\n  if (!req.tana.caller) {\n    return { error: 'Authentication required' }\n  }\n\n  return {\n    success: true,\n    received: req.body\n  }\n}\n```\n\n### 2. Deploy to Blockchain\n\n```bash\ntana deploy contract mycontract.ts\n```\n\n### 3. Call Your Contract\n\n**HTTP Requests (get/post):**\n```bash\n# GET request\ncurl http://localhost:8180/mycontract\n\n# POST request\ncurl -X POST http://localhost:8180/mycontract \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"data\":\"test\"}'\n```\n\n**On-Chain Execution (contract):**\n```bash\n# Via transaction (coming soon via CLI)\ntana call contract mycontract\n```\n\n## Contract Structure\n\nEvery contract exports up to 4 functions. Only `contract()` is required.\n\n### init() - Optional\nRuns **once** when the contract is deployed to the blockchain.\n\n**Use for:**\n- Setting initial state\n- Storing deployment metadata\n- One-time configuration\n\n```typescript\nexport function init(): JsonValue {\n  const owner = context.owner()\n  const block = context.block()\n\n  // Store deployment info\n  data.set('owner_id', owner.id)\n  data.set('deployed_at', block.timestamp.toString())\n\n  return {\n    initialized: true,\n    owner: owner.username,\n    block: block.height\n  }\n}\n```\n\n**Context Available:**\n- `context.owner()` - Contract owner (same as deployer)\n- `context.block()` - Deployment block info\n- `context.caller()` - Returns null (no caller in init)\n- `context.input()` - Returns null (no input in init)\n\n### contract() - Required\nRuns on-chain via blockchain transactions.\n\n**Use for:**\n- State-changing operations\n- Authorization checks\n- Business logic that needs consensus\n\n```typescript\nexport function contract(): JsonValue {\n  const caller = context.caller()\n  const owner = context.owner()\n  const input = context.input()\n\n  // Authorization\n  if (!caller || caller.id !== owner.id) {\n    return { error: 'Unauthorized: owner only' }\n  }\n\n  // Business logic\n  const count = parseInt(data.get('count') || '0')\n  data.set('count', (count + 1).toString())\n\n  return {\n    success: true,\n    count: count + 1,\n    caller: caller.username,\n    input\n  }\n}\n```\n\n**Context Available:**\n- `context.owner()` - Contract owner\n- `context.caller()` - Transaction sender\n- `context.block()` - Current block info\n- `context.input()` - Contract call parameters\n\n### get() - Optional\nHandles HTTP GET requests via tana-edge.\n\n**Use for:**\n- Reading contract state\n- Public APIs\n- Query endpoints\n\n```typescript\nexport function get(req: Request): JsonValue {\n  // Parse query parameters\n  const url = new URL(req.url)\n  const name = url.searchParams.get('name')\n\n  // Access Tana context\n  const caller = req.tana.caller\n  const owner = req.tana.contract.owner\n\n  // Read state\n  const count = data.get('count') || '0'\n\n  return {\n    message: name ? `Hello, ${name}!` : 'Hello!',\n    count: parseInt(count),\n    caller: caller?.username || 'anonymous',\n    isOwner: caller?.id === owner.id\n  }\n}\n```\n\n**Request Object:**\n- `req.url` - Full URL\n- `req.method` - HTTP method\n- `req.headers` - Request headers\n- `req.tana.caller` - Authenticated user (or null)\n- `req.tana.contract` - Contract metadata\n- `req.tana.session` - Session info (or null)\n\n### post() - Optional\nHandles HTTP POST requests via tana-edge.\n\n**Use for:**\n- Creating resources\n- Submitting data\n- Authenticated actions\n\n```typescript\nexport function post(req: Request): JsonValue {\n  const caller = req.tana.caller\n\n  // Require authentication\n  if (!caller) {\n    return { error: 'Login required' }\n  }\n\n  // Only owner can post\n  const owner = req.tana.contract.owner\n  if (caller.id !== owner.id) {\n    return { error: 'Unauthorized: owner only' }\n  }\n\n  // Process body\n  const body = req.body as any\n\n  // Update state\n  data.set('last_post', JSON.stringify(body))\n\n  return {\n    success: true,\n    received: body,\n    caller: caller.username\n  }\n}\n```\n\n**Request Object:**\nSame as `get()`, plus:\n- `req.body` - Parsed JSON body\n\n## JSON-Only Returns\n\n**All functions MUST return JSON-serializable data.** This is enforced for security and simplicity.\n\n```typescript\n// ✅ Valid JSON returns\nreturn { success: true }\nreturn { items: [1, 2, 3], count: 3 }\nreturn { user: { name: 'Alice', age: 30 } }\nreturn { value: null }  // null is valid\n\n// ❌ Invalid (will cause errors)\nreturn { fn: () => {} }  // Functions not allowed\nreturn { undef: undefined }  // undefined not allowed\nreturn { date: new Date() }  // Objects must be plain\nreturn undefined  // Use null instead\n```\n\n## Available Modules\n\n### tana/net - HTTP APIs\n```typescript\nimport type { Request, JsonValue } from 'tana/net'\n\n// Type definitions for HTTP functions\n```\n\n### tana/context - On-Chain Context\n```typescript\nimport { context } from 'tana/context'\n\nconst owner = context.owner()      // Contract owner\nconst caller = context.caller()    // Transaction sender\nconst block = context.block()      // Block info\nconst input = context.input()      // Call parameters\n```\n\n### tana/core - Console Logging\n```typescript\nimport { console } from 'tana/core'\n\nconsole.log('Message')  // Appears in logs\n```\n\n### tana/kv - Cloudflare Workers KV Storage\n```typescript\nimport { kv } from 'tana/kv'\n\nawait kv.put('username', 'alice')\nconst name = await kv.get('username')\n\n// JSON support\nawait kv.put('user', { id: 1, balance: 100 })\nconst user = await kv.get('user', { type: 'json' })\n\n// List and delete\nconst keys = await kv.list({ prefix: 'user:' })\nawait kv.delete('username')\n```\n\nSee [KV Storage Guide](/guides/kv-storage) for complete documentation.\n\n### tana/utils - External HTTP (Coming Soon)\n```typescript\nimport { fetch } from 'tana/utils'\n\nconst response = await fetch('https://api.example.com')\nconst json = await response.json()\n```\n\n## Validation with Zod\n\nUse Zod for type-safe input validation:\n\n```typescript\nimport { z } from 'zod'\n\nconst UserSchema = z.object({\n  username: z.string().min(2).max(50),\n  email: z.string().email(),\n  age: z.number().int().min(13)\n})\n\nexport function contract(): JsonValue {\n  const input = context.input()\n\n  // Validate input\n  const validation = UserSchema.safeParse(input)\n\n  if (!validation.success) {\n    return {\n      error: 'Invalid input',\n      details: validation.error.flatten()\n    }\n  }\n\n  // Use validated data\n  const user = validation.data\n\n  return {\n    success: true,\n    user\n  }\n}\n```\n\n## Authorization Patterns\n\n### Owner-Only Contract\n```typescript\nexport function contract(): JsonValue {\n  const caller = context.caller()\n  const owner = context.owner()\n\n  if (!caller || caller.id !== owner.id) {\n    return { error: 'Unauthorized' }\n  }\n\n  // Owner-only logic\n  return { success: true }\n}\n```\n\n### Authenticated HTTP\n```typescript\nexport function post(req: Request): JsonValue {\n  if (!req.tana.caller) {\n    return { error: 'Login required' }\n  }\n\n  // Authenticated logic\n  return { success: true }\n}\n```\n\n### Public Read, Private Write\n```typescript\nexport function get(req: Request): JsonValue {\n  // Anyone can read\n  return { data: data.get('public_data') }\n}\n\nexport function post(req: Request): JsonValue {\n  const caller = req.tana.caller\n  const owner = req.tana.contract.owner\n\n  // Only owner can write\n  if (!caller || caller.id !== owner.id) {\n    return { error: 'Unauthorized' }\n  }\n\n  data.set('public_data', req.body.data)\n  return { success: true }\n}\n```\n\n## Example Contracts\n\n### Hello World\nBasic contract with all 4 functions:\n\n```bash\n# View source\ncat contracts/examples/hello-world.ts\n\n# Deploy\ntana deploy contract contracts/examples/hello-world.ts\n```\n\n### User Registry\nAdvanced contract with Zod validation:\n\n```bash\n# View source\ncat contracts/examples/user-registry.ts\n\n# Deploy\ntana deploy contract contracts/examples/user-registry.ts\n```\n\n## Best Practices\n\n### ✅ Do\n\n- **Validate all input** - Use Zod schemas\n- **Return JSON only** - No undefined, functions, or complex objects\n- **Check authorization** - Verify caller permissions\n- **Handle errors gracefully** - Return error objects with messages\n- **Use storage wisely** - data.get/set for persistence\n- **Log important events** - console.log() for debugging\n\n### ❌ Don't\n\n- **Don't return undefined** - Use null instead\n- **Don't assume caller exists** - Always check for null\n- **Don't hardcode IDs** - Use context/req.tana for dynamic values\n- **Don't skip validation** - Always validate untrusted input\n- **Don't expose secrets** - Never log or return sensitive data\n\n## Testing Locally\n\n```bash\n# 1. Start local chain\ntana start\n\n# 2. Deploy contract\ntana deploy contract mycontract.ts\n\n# 3. Test HTTP endpoints\ncurl http://localhost:8180/mycontract\ncurl -X POST http://localhost:8180/mycontract -d '{\"test\":\"data\"}'\n\n# 4. View logs\n# Contract console.log() appears in block producer logs\n```\n\n## Deployment Flow\n\n1. **Write contract** - Single TypeScript file with exports\n2. **CLI validates** - Checks for required exports, validates structure\n3. **CLI extracts** - Separates init/contract/get/post functions\n4. **CLI signs** - Creates signed transaction with Ed25519\n5. **Ledger stores** - Saves to PostgreSQL with all extracted functions\n6. **Block producer** - Executes init() on deployment\n7. **Filesystem write** - Writes get.ts/post.ts for tana-edge\n8. **Ready** - Contract available for execution\n\n## Security\n\n### Sandboxed Execution\n- No filesystem access\n- Limited network access (whitelisted only)\n- No system calls\n- Memory limits enforced\n- Gas metering (coming soon)\n\n### Transaction Signing\n- All deployments require Ed25519 signatures\n- Owner tracked in database\n- Replay protection via nonces\n- Timestamp validation\n\n### JSON Enforcement\n- Runtime validates all returns are JSON\n- Prevents serialization bugs\n- Easy to audit and inspect\n- Consistent API surface\n\n## Next Steps\n\n- [Transaction Signing](/guides/transaction-signing/) - How signatures work\n- [API Reference](/tana-api/contracts/) - Contract API endpoints\n- [CLI Commands](/tana-cli/commands/) - Deploy and manage contracts\n- [Example Contracts](/contracts/examples/README.md) - More examples\n",
    "html": "<p>Tana smart contracts are TypeScript files that export up to 4 functions: <code>init()</code>, <code>contract()</code>, <code>get()</code>, and <code>post()</code>. All functions must return JSON-serializable data.</p>\n<h2 id=\"quick-start\">Quick Start</h2>\n<h3 id=\"1-create-a-contract\">1. Create a Contract</h3>\n<p>Create a single TypeScript file with your contract logic:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// mycontract.ts</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#F97583\"> type</span><span style=\"color:#E1E4E8\"> { Request, JsonValue } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/net'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { context } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/context'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { console } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/core'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { data } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/data'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> init</span><span style=\"color:#E1E4E8\">()</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> JsonValue</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Contract initialized'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  data.</span><span style=\"color:#B392F0\">set</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'deployed_at'</span><span style=\"color:#E1E4E8\">, Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">().</span><span style=\"color:#B392F0\">toString</span><span style=\"color:#E1E4E8\">())</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> { initialized: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> contract</span><span style=\"color:#E1E4E8\">()</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> JsonValue</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> caller</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> context.</span><span style=\"color:#B392F0\">caller</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> owner</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> context.</span><span style=\"color:#B392F0\">owner</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">caller </span><span style=\"color:#F97583\">||</span><span style=\"color:#E1E4E8\"> caller.id </span><span style=\"color:#F97583\">!==</span><span style=\"color:#E1E4E8\"> owner.id) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> { error: </span><span style=\"color:#9ECBFF\">'Unauthorized'</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> { success: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\">, caller: caller.username }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Request</span><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> JsonValue</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> caller</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> req.tana.caller</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    message: </span><span style=\"color:#9ECBFF\">'Hello from Tana!'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    caller: caller?.username </span><span style=\"color:#F97583\">||</span><span style=\"color:#9ECBFF\"> 'anonymous'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    timestamp: Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> post</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Request</span><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> JsonValue</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">req.tana.caller) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> { error: </span><span style=\"color:#9ECBFF\">'Authentication required'</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    success: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    received: req.body</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h3 id=\"2-deploy-to-blockchain\">2. Deploy to Blockchain</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> deploy</span><span style=\"color:#9ECBFF\"> contract</span><span style=\"color:#9ECBFF\"> mycontract.ts</span></span></code></pre>\n</code></pre><h3 id=\"3-call-your-contract\">3. Call Your Contract</h3>\n<p><strong>HTTP Requests (get/post):</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># GET request</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8180/mycontract</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># POST request</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -X</span><span style=\"color:#9ECBFF\"> POST</span><span style=\"color:#9ECBFF\"> http://localhost:8180/mycontract</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -H</span><span style=\"color:#9ECBFF\"> \"Content-Type: application/json\"</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -d</span><span style=\"color:#9ECBFF\"> '{\"data\":\"test\"}'</span></span></code></pre>\n</code></pre><p><strong>On-Chain Execution (contract):</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Via transaction (coming soon via CLI)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> call</span><span style=\"color:#9ECBFF\"> contract</span><span style=\"color:#9ECBFF\"> mycontract</span></span></code></pre>\n</code></pre><h2 id=\"contract-structure\">Contract Structure</h2>\n<p>Every contract exports up to 4 functions. Only <code>contract()</code> is required.</p>\n<h3 id=\"init---optional\">init() - Optional</h3>\n<p>Runs <strong>once</strong> when the contract is deployed to the blockchain.</p>\n<p><strong>Use for:</strong></p>\n<ul>\n<li>Setting initial state</li>\n<li>Storing deployment metadata</li>\n<li>One-time configuration</li>\n</ul>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> init</span><span style=\"color:#E1E4E8\">()</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> JsonValue</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> owner</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> context.</span><span style=\"color:#B392F0\">owner</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> block</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> context.</span><span style=\"color:#B392F0\">block</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Store deployment info</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  data.</span><span style=\"color:#B392F0\">set</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'owner_id'</span><span style=\"color:#E1E4E8\">, owner.id)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  data.</span><span style=\"color:#B392F0\">set</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'deployed_at'</span><span style=\"color:#E1E4E8\">, block.timestamp.</span><span style=\"color:#B392F0\">toString</span><span style=\"color:#E1E4E8\">())</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    initialized: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    owner: owner.username,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    block: block.height</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Context Available:</strong></p>\n<ul>\n<li><code>context.owner()</code> - Contract owner (same as deployer)</li>\n<li><code>context.block()</code> - Deployment block info</li>\n<li><code>context.caller()</code> - Returns null (no caller in init)</li>\n<li><code>context.input()</code> - Returns null (no input in init)</li>\n</ul>\n<h3 id=\"contract---required\">contract() - Required</h3>\n<p>Runs on-chain via blockchain transactions.</p>\n<p><strong>Use for:</strong></p>\n<ul>\n<li>State-changing operations</li>\n<li>Authorization checks</li>\n<li>Business logic that needs consensus</li>\n</ul>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> contract</span><span style=\"color:#E1E4E8\">()</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> JsonValue</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> caller</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> context.</span><span style=\"color:#B392F0\">caller</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> owner</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> context.</span><span style=\"color:#B392F0\">owner</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> input</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> context.</span><span style=\"color:#B392F0\">input</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Authorization</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">caller </span><span style=\"color:#F97583\">||</span><span style=\"color:#E1E4E8\"> caller.id </span><span style=\"color:#F97583\">!==</span><span style=\"color:#E1E4E8\"> owner.id) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> { error: </span><span style=\"color:#9ECBFF\">'Unauthorized: owner only'</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Business logic</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> count</span><span style=\"color:#F97583\"> =</span><span style=\"color:#B392F0\"> parseInt</span><span style=\"color:#E1E4E8\">(data.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'count'</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">||</span><span style=\"color:#9ECBFF\"> '0'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  data.</span><span style=\"color:#B392F0\">set</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'count'</span><span style=\"color:#E1E4E8\">, (count </span><span style=\"color:#F97583\">+</span><span style=\"color:#79B8FF\"> 1</span><span style=\"color:#E1E4E8\">).</span><span style=\"color:#B392F0\">toString</span><span style=\"color:#E1E4E8\">())</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    success: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    count: count </span><span style=\"color:#F97583\">+</span><span style=\"color:#79B8FF\"> 1</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    caller: caller.username,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    input</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Context Available:</strong></p>\n<ul>\n<li><code>context.owner()</code> - Contract owner</li>\n<li><code>context.caller()</code> - Transaction sender</li>\n<li><code>context.block()</code> - Current block info</li>\n<li><code>context.input()</code> - Contract call parameters</li>\n</ul>\n<h3 id=\"get---optional\">get() - Optional</h3>\n<p>Handles HTTP GET requests via tana-edge.</p>\n<p><strong>Use for:</strong></p>\n<ul>\n<li>Reading contract state</li>\n<li>Public APIs</li>\n<li>Query endpoints</li>\n</ul>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Request</span><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> JsonValue</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Parse query parameters</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> url</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> new</span><span style=\"color:#B392F0\"> URL</span><span style=\"color:#E1E4E8\">(req.url)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> name</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> url.searchParams.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'name'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Access Tana context</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> caller</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> req.tana.caller</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> owner</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> req.tana.contract.owner</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Read state</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> count</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'count'</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">||</span><span style=\"color:#9ECBFF\"> '0'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    message: name </span><span style=\"color:#F97583\">?</span><span style=\"color:#9ECBFF\"> `Hello, ${</span><span style=\"color:#E1E4E8\">name</span><span style=\"color:#9ECBFF\">}!`</span><span style=\"color:#F97583\"> :</span><span style=\"color:#9ECBFF\"> 'Hello!'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    count: </span><span style=\"color:#B392F0\">parseInt</span><span style=\"color:#E1E4E8\">(count),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    caller: caller?.username </span><span style=\"color:#F97583\">||</span><span style=\"color:#9ECBFF\"> 'anonymous'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    isOwner: caller?.id </span><span style=\"color:#F97583\">===</span><span style=\"color:#E1E4E8\"> owner.id</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Request Object:</strong></p>\n<ul>\n<li><code>req.url</code> - Full URL</li>\n<li><code>req.method</code> - HTTP method</li>\n<li><code>req.headers</code> - Request headers</li>\n<li><code>req.tana.caller</code> - Authenticated user (or null)</li>\n<li><code>req.tana.contract</code> - Contract metadata</li>\n<li><code>req.tana.session</code> - Session info (or null)</li>\n</ul>\n<h3 id=\"post---optional\">post() - Optional</h3>\n<p>Handles HTTP POST requests via tana-edge.</p>\n<p><strong>Use for:</strong></p>\n<ul>\n<li>Creating resources</li>\n<li>Submitting data</li>\n<li>Authenticated actions</li>\n</ul>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> post</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Request</span><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> JsonValue</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> caller</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> req.tana.caller</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Require authentication</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">caller) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> { error: </span><span style=\"color:#9ECBFF\">'Login required'</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Only owner can post</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> owner</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> req.tana.contract.owner</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (caller.id </span><span style=\"color:#F97583\">!==</span><span style=\"color:#E1E4E8\"> owner.id) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> { error: </span><span style=\"color:#9ECBFF\">'Unauthorized: owner only'</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Process body</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> body</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> req.body </span><span style=\"color:#F97583\">as</span><span style=\"color:#79B8FF\"> any</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Update state</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  data.</span><span style=\"color:#B392F0\">set</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'last_post'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">JSON</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">stringify</span><span style=\"color:#E1E4E8\">(body))</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    success: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    received: body,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    caller: caller.username</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Request Object:</strong>\nSame as <code>get()</code>, plus:</p>\n<ul>\n<li><code>req.body</code> - Parsed JSON body</li>\n</ul>\n<h2 id=\"json-only-returns\">JSON-Only Returns</h2>\n<p><strong>All functions MUST return JSON-serializable data.</strong> This is enforced for security and simplicity.</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// ✅ Valid JSON returns</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">return</span><span style=\"color:#E1E4E8\"> { success: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">return</span><span style=\"color:#E1E4E8\"> { items: [</span><span style=\"color:#79B8FF\">1</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">2</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">3</span><span style=\"color:#E1E4E8\">], count: </span><span style=\"color:#79B8FF\">3</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">return</span><span style=\"color:#E1E4E8\"> { user: { name: </span><span style=\"color:#9ECBFF\">'Alice'</span><span style=\"color:#E1E4E8\">, age: </span><span style=\"color:#79B8FF\">30</span><span style=\"color:#E1E4E8\"> } }</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">return</span><span style=\"color:#E1E4E8\"> { value: </span><span style=\"color:#79B8FF\">null</span><span style=\"color:#E1E4E8\"> }  </span><span style=\"color:#6A737D\">// null is valid</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// ❌ Invalid (will cause errors)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">return</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#B392F0\">fn</span><span style=\"color:#E1E4E8\">: () </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {} }  </span><span style=\"color:#6A737D\">// Functions not allowed</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">return</span><span style=\"color:#E1E4E8\"> { undef: </span><span style=\"color:#79B8FF\">undefined</span><span style=\"color:#E1E4E8\"> }  </span><span style=\"color:#6A737D\">// undefined not allowed</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">return</span><span style=\"color:#E1E4E8\"> { date: </span><span style=\"color:#F97583\">new</span><span style=\"color:#B392F0\"> Date</span><span style=\"color:#E1E4E8\">() }  </span><span style=\"color:#6A737D\">// Objects must be plain</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">return</span><span style=\"color:#79B8FF\"> undefined</span><span style=\"color:#6A737D\">  // Use null instead</span></span></code></pre>\n</code></pre><h2 id=\"available-modules\">Available Modules</h2>\n<h3 id=\"tananet---http-apis\">tana/net - HTTP APIs</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#F97583\"> type</span><span style=\"color:#E1E4E8\"> { Request, JsonValue } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/net'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Type definitions for HTTP functions</span></span></code></pre>\n</code></pre><h3 id=\"tanacontext---on-chain-context\">tana/context - On-Chain Context</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { context } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/context'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> owner</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> context.</span><span style=\"color:#B392F0\">owner</span><span style=\"color:#E1E4E8\">()      </span><span style=\"color:#6A737D\">// Contract owner</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> caller</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> context.</span><span style=\"color:#B392F0\">caller</span><span style=\"color:#E1E4E8\">()    </span><span style=\"color:#6A737D\">// Transaction sender</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> block</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> context.</span><span style=\"color:#B392F0\">block</span><span style=\"color:#E1E4E8\">()      </span><span style=\"color:#6A737D\">// Block info</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> input</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> context.</span><span style=\"color:#B392F0\">input</span><span style=\"color:#E1E4E8\">()      </span><span style=\"color:#6A737D\">// Call parameters</span></span></code></pre>\n</code></pre><h3 id=\"tanacore---console-logging\">tana/core - Console Logging</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { console } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/core'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Message'</span><span style=\"color:#E1E4E8\">)  </span><span style=\"color:#6A737D\">// Appears in logs</span></span></code></pre>\n</code></pre><h3 id=\"tanakv---cloudflare-workers-kv-storage\">tana/kv - Cloudflare Workers KV Storage</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { kv } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/kv'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'username'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'alice'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> name</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'username'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// JSON support</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'user'</span><span style=\"color:#E1E4E8\">, { id: </span><span style=\"color:#79B8FF\">1</span><span style=\"color:#E1E4E8\">, balance: </span><span style=\"color:#79B8FF\">100</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> user</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'user'</span><span style=\"color:#E1E4E8\">, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// List and delete</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> keys</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">list</span><span style=\"color:#E1E4E8\">({ prefix: </span><span style=\"color:#9ECBFF\">'user:'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">delete</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'username'</span><span style=\"color:#E1E4E8\">)</span></span></code></pre>\n</code></pre><p>See <a href=\"/guides/kv-storage\">KV Storage Guide</a> for complete documentation.</p>\n<h3 id=\"tanautils---external-http-coming-soon\">tana/utils - External HTTP (Coming Soon)</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { fetch } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/utils'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> response</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> fetch</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'https://api.example.com'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> json</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> response.</span><span style=\"color:#B392F0\">json</span><span style=\"color:#E1E4E8\">()</span></span></code></pre>\n</code></pre><h2 id=\"validation-with-zod\">Validation with Zod</h2>\n<p>Use Zod for type-safe input validation:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { z } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'zod'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> UserSchema</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> z.</span><span style=\"color:#B392F0\">object</span><span style=\"color:#E1E4E8\">({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  username: z.</span><span style=\"color:#B392F0\">string</span><span style=\"color:#E1E4E8\">().</span><span style=\"color:#B392F0\">min</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">2</span><span style=\"color:#E1E4E8\">).</span><span style=\"color:#B392F0\">max</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">50</span><span style=\"color:#E1E4E8\">),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  email: z.</span><span style=\"color:#B392F0\">string</span><span style=\"color:#E1E4E8\">().</span><span style=\"color:#B392F0\">email</span><span style=\"color:#E1E4E8\">(),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  age: z.</span><span style=\"color:#B392F0\">number</span><span style=\"color:#E1E4E8\">().</span><span style=\"color:#B392F0\">int</span><span style=\"color:#E1E4E8\">().</span><span style=\"color:#B392F0\">min</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">13</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">})</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> contract</span><span style=\"color:#E1E4E8\">()</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> JsonValue</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> input</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> context.</span><span style=\"color:#B392F0\">input</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Validate input</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> validation</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> UserSchema.</span><span style=\"color:#B392F0\">safeParse</span><span style=\"color:#E1E4E8\">(input)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">validation.success) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      error: </span><span style=\"color:#9ECBFF\">'Invalid input'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      details: validation.error.</span><span style=\"color:#B392F0\">flatten</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Use validated data</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> user</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> validation.data</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    success: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    user</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h2 id=\"authorization-patterns\">Authorization Patterns</h2>\n<h3 id=\"owner-only-contract\">Owner-Only Contract</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> contract</span><span style=\"color:#E1E4E8\">()</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> JsonValue</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> caller</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> context.</span><span style=\"color:#B392F0\">caller</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> owner</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> context.</span><span style=\"color:#B392F0\">owner</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">caller </span><span style=\"color:#F97583\">||</span><span style=\"color:#E1E4E8\"> caller.id </span><span style=\"color:#F97583\">!==</span><span style=\"color:#E1E4E8\"> owner.id) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> { error: </span><span style=\"color:#9ECBFF\">'Unauthorized'</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Owner-only logic</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> { success: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h3 id=\"authenticated-http\">Authenticated HTTP</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> post</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Request</span><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> JsonValue</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">req.tana.caller) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> { error: </span><span style=\"color:#9ECBFF\">'Login required'</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Authenticated logic</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> { success: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h3 id=\"public-read-private-write\">Public Read, Private Write</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Request</span><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> JsonValue</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Anyone can read</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> { data: data.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'public_data'</span><span style=\"color:#E1E4E8\">) }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> post</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Request</span><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> JsonValue</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> caller</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> req.tana.caller</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> owner</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> req.tana.contract.owner</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Only owner can write</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">caller </span><span style=\"color:#F97583\">||</span><span style=\"color:#E1E4E8\"> caller.id </span><span style=\"color:#F97583\">!==</span><span style=\"color:#E1E4E8\"> owner.id) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> { error: </span><span style=\"color:#9ECBFF\">'Unauthorized'</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  data.</span><span style=\"color:#B392F0\">set</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'public_data'</span><span style=\"color:#E1E4E8\">, req.body.data)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> { success: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h2 id=\"example-contracts\">Example Contracts</h2>\n<h3 id=\"hello-world\">Hello World</h3>\n<p>Basic contract with all 4 functions:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># View source</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">cat</span><span style=\"color:#9ECBFF\"> contracts/examples/hello-world.ts</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Deploy</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> deploy</span><span style=\"color:#9ECBFF\"> contract</span><span style=\"color:#9ECBFF\"> contracts/examples/hello-world.ts</span></span></code></pre>\n</code></pre><h3 id=\"user-registry\">User Registry</h3>\n<p>Advanced contract with Zod validation:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># View source</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">cat</span><span style=\"color:#9ECBFF\"> contracts/examples/user-registry.ts</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Deploy</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> deploy</span><span style=\"color:#9ECBFF\"> contract</span><span style=\"color:#9ECBFF\"> contracts/examples/user-registry.ts</span></span></code></pre>\n</code></pre><h2 id=\"best-practices\">Best Practices</h2>\n<h3 id=\"-do\">✅ Do</h3>\n<ul>\n<li><strong>Validate all input</strong> - Use Zod schemas</li>\n<li><strong>Return JSON only</strong> - No undefined, functions, or complex objects</li>\n<li><strong>Check authorization</strong> - Verify caller permissions</li>\n<li><strong>Handle errors gracefully</strong> - Return error objects with messages</li>\n<li><strong>Use storage wisely</strong> - data.get/set for persistence</li>\n<li><strong>Log important events</strong> - console.log() for debugging</li>\n</ul>\n<h3 id=\"-dont\">❌ Don&#39;t</h3>\n<ul>\n<li><strong>Don&#39;t return undefined</strong> - Use null instead</li>\n<li><strong>Don&#39;t assume caller exists</strong> - Always check for null</li>\n<li><strong>Don&#39;t hardcode IDs</strong> - Use context/req.tana for dynamic values</li>\n<li><strong>Don&#39;t skip validation</strong> - Always validate untrusted input</li>\n<li><strong>Don&#39;t expose secrets</strong> - Never log or return sensitive data</li>\n</ul>\n<h2 id=\"testing-locally\">Testing Locally</h2>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># 1. Start local chain</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> start</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># 2. Deploy contract</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> deploy</span><span style=\"color:#9ECBFF\"> contract</span><span style=\"color:#9ECBFF\"> mycontract.ts</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># 3. Test HTTP endpoints</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8180/mycontract</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -X</span><span style=\"color:#9ECBFF\"> POST</span><span style=\"color:#9ECBFF\"> http://localhost:8180/mycontract</span><span style=\"color:#79B8FF\"> -d</span><span style=\"color:#9ECBFF\"> '{\"test\":\"data\"}'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># 4. View logs</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Contract console.log() appears in block producer logs</span></span></code></pre>\n</code></pre><h2 id=\"deployment-flow\">Deployment Flow</h2>\n<ol>\n<li><strong>Write contract</strong> - Single TypeScript file with exports</li>\n<li><strong>CLI validates</strong> - Checks for required exports, validates structure</li>\n<li><strong>CLI extracts</strong> - Separates init/contract/get/post functions</li>\n<li><strong>CLI signs</strong> - Creates signed transaction with Ed25519</li>\n<li><strong>Ledger stores</strong> - Saves to PostgreSQL with all extracted functions</li>\n<li><strong>Block producer</strong> - Executes init() on deployment</li>\n<li><strong>Filesystem write</strong> - Writes get.ts/post.ts for tana-edge</li>\n<li><strong>Ready</strong> - Contract available for execution</li>\n</ol>\n<h2 id=\"security\">Security</h2>\n<h3 id=\"sandboxed-execution\">Sandboxed Execution</h3>\n<ul>\n<li>No filesystem access</li>\n<li>Limited network access (whitelisted only)</li>\n<li>No system calls</li>\n<li>Memory limits enforced</li>\n<li>Gas metering (coming soon)</li>\n</ul>\n<h3 id=\"transaction-signing\">Transaction Signing</h3>\n<ul>\n<li>All deployments require Ed25519 signatures</li>\n<li>Owner tracked in database</li>\n<li>Replay protection via nonces</li>\n<li>Timestamp validation</li>\n</ul>\n<h3 id=\"json-enforcement\">JSON Enforcement</h3>\n<ul>\n<li>Runtime validates all returns are JSON</li>\n<li>Prevents serialization bugs</li>\n<li>Easy to audit and inspect</li>\n<li>Consistent API surface</li>\n</ul>\n<h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li><a href=\"/guides/transaction-signing/\">Transaction Signing</a> - How signatures work</li>\n<li><a href=\"/tana-api/contracts/\">API Reference</a> - Contract API endpoints</li>\n<li><a href=\"/tana-cli/commands/\">CLI Commands</a> - Deploy and manage contracts</li>\n<li><a href=\"/contracts/examples/README.md\">Example Contracts</a> - More examples</li>\n</ul>\n"
  },
  {
    "slug": [
      "guides",
      "install"
    ],
    "metadata": {
      "title": "install coco",
      "description": "A guide in my new Starlight docs site."
    },
    "content": "\nGuides lead a user through a specific task they want to accomplish, often with a sequence of steps.\nWriting a good guide requires thinking about what your users are trying to do.\n\n## Further reading\n\n- Read [about how-to guides](https://diataxis.fr/how-to-guides/) in the Diátaxis framework\n",
    "html": "<p>Guides lead a user through a specific task they want to accomplish, often with a sequence of steps.\nWriting a good guide requires thinking about what your users are trying to do.</p>\n<h2 id=\"further-reading\">Further reading</h2>\n<ul>\n<li>Read <a href=\"https://diataxis.fr/how-to-guides/\">about how-to guides</a> in the Diátaxis framework</li>\n</ul>\n"
  },
  {
    "slug": [
      "guides",
      "transaction-signing"
    ],
    "metadata": {
      "title": "Transaction Signing",
      "description": "How to sign and verify transactions with Ed25519",
      "sidebar": {
        "order": 4
      }
    },
    "content": "\nAll transactions on Tana require Ed25519 cryptographic signatures to ensure authenticity and prevent unauthorized actions.\n\n## Overview\n\nEvery transaction must be signed by the private key of the account initiating the transaction. This prevents:\n\n- **Impersonation** - No one can create transactions on your behalf\n- **Replay attacks** - Transactions cannot be reused (thanks to nonces)\n- **Tampering** - Transaction data cannot be modified after signing\n\n## Signature Requirements\n\nEvery transaction (except user creation) must include:\n\n1. **Signature** - Ed25519 signature (hex string with `ed25519_` prefix)\n2. **Timestamp** - Unix timestamp in milliseconds (must be within 5 minutes of current time)\n3. **Nonce** - Sequential number that increments with each transaction\n\n## How Signing Works\n\n### 1. Get Your Current Nonce\n\nBefore creating a transaction, fetch your current nonce:\n\n```bash\n# Get nonce for user\ncurl http://localhost:8080/users/{userId}/nonce\n\n# Response:\n{\n  \"userId\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"username\": \"@alice\",\n  \"currentNonce\": 5,\n  \"nextNonce\": 6,\n  \"message\": \"Use nextNonce for your next transaction\"\n}\n```\n\n**Important:** Use `nextNonce` for your transaction, not `currentNonce`.\n\n### 2. Create Transaction Message\n\nBuild a canonical message for signing:\n\n```typescript\nimport { createTransactionMessage } from '@tana/cli/utils/crypto'\n\nconst transactionData = {\n  type: 'transfer',\n  from: '550e8400-e29b-41d4-a716-446655440000', // Your user ID\n  to: '7c9e6679-7425-40de-944b-e07fc1f90ae7',   // Recipient ID\n  amount: '100.00',\n  currencyCode: 'USD',\n  timestamp: Date.now(),\n  nonce: 6 // The nextNonce from step 1\n}\n\nconst message = createTransactionMessage(transactionData)\n```\n\n### 3. Sign the Message\n\nSign with your private key:\n\n```typescript\nimport { signMessage } from '@tana/cli/utils/crypto'\n\nconst signature = await signMessage(\n  message,\n  userConfig.privateKey // From ~/.config/tana/users/@alice.json\n)\n\n// signature: \"ed25519_a7f3b2c1d4e5f6a7b8c9d0e1f2a3b4c5...\"\n```\n\n### 4. Submit Transaction\n\nSend the signed transaction to the ledger:\n\n```typescript\nconst response = await fetch('http://localhost:8080/transactions', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({\n    type: 'transfer',\n    from: '550e8400-e29b-41d4-a716-446655440000',\n    to: '7c9e6679-7425-40de-944b-e07fc1f90ae7',\n    amount: '100.00',\n    currencyCode: 'USD',\n    signature, // Include the signature\n    timestamp: transactionData.timestamp,\n    nonce: transactionData.nonce\n  })\n})\n```\n\n## Signature Verification\n\nWhen the ledger receives a transaction, it:\n\n1. **Validates timestamp** - Must be within 5 minutes\n2. **Fetches user** - Gets user record by `from` field\n3. **Checks nonce** - Must be exactly `currentNonce + 1`\n4. **Verifies signature** - Recreates message and verifies with user's public key\n5. **Checks balances** - Ensures sufficient funds (for transfers)\n\nIf any check fails, the transaction is rejected.\n\n## Transaction Types\n\n### User Creation\n\n**Special case:** User creation doesn't require signature verification (no user exists yet to verify against). Instead:\n\n- Nonce is always `0`\n- Signature is verified against the `publicKey` field in the request itself\n- This proves you control the private key for the public key you're registering\n\n```typescript\nconst transactionData = {\n  type: 'user_creation',\n  from: '00000000-0000-0000-0000-000000000000', // System\n  to: '00000000-0000-0000-0000-000000000000',   // Will be assigned\n  timestamp: Date.now(),\n  nonce: 0, // Always 0 for user creation\n  contractInput: {\n    username: '@alice',\n    displayName: 'Alice',\n    publicKey: 'ed25519_abc123...',\n    bio: '',\n    role: 'user'\n  }\n}\n```\n\n### Transfers\n\nTransfer currency between accounts:\n\n```typescript\n{\n  type: 'transfer',\n  from: userId,\n  to: recipientId,\n  amount: '50.00',\n  currencyCode: 'USD',\n  signature: 'ed25519_...',\n  timestamp: Date.now(),\n  nonce: nextNonce\n}\n```\n\n### Deposits\n\nRequest to deposit fiat currency into blockchain:\n\n```typescript\n{\n  type: 'deposit',\n  from: userId, // The requestor\n  to: userId,   // Same (depositing to self)\n  amount: '1000.00',\n  currencyCode: 'CAD',\n  signature: 'ed25519_...',\n  timestamp: Date.now(),\n  nonce: nextNonce,\n  metadata: {\n    // Optional: e-transfer details\n  }\n}\n```\n\n**Note:** Deposits create a pending transaction that must be confirmed by the sovereign user after receiving the actual fiat currency.\n\n### Withdraws\n\nRequest to withdraw currency from blockchain to fiat:\n\n```typescript\n{\n  type: 'withdraw',\n  from: userId, // Your account (will be debited)\n  to: userId,   // Same\n  amount: '500.00',\n  currencyCode: 'USD',\n  signature: 'ed25519_...',\n  timestamp: Date.now(),\n  nonce: nextNonce,\n  metadata: {\n    email: 'alice@example.com' // Where to send e-transfer\n  }\n}\n```\n\n**Note:** Withdraws also require sovereign confirmation before the fiat currency is sent.\n\n## Nonce Management\n\n### What is a Nonce?\n\nA **nonce** (number used once) is a counter that prevents replay attacks. Each user has their own nonce that:\n\n- Starts at `0` when the user is created\n- Increments by `1` every time a transaction is confirmed\n- Must be sequential (can't skip numbers)\n\n### Why Nonces Matter\n\nWithout nonces, an attacker could:\n1. Capture a valid signed transaction\n2. Re-submit it multiple times\n3. Drain your account\n\nWith nonces, each transaction has a unique sequence number, so replays are detected and rejected.\n\n### Handling Nonce Errors\n\nIf you get a nonce mismatch error:\n\n```json\n{\n  \"error\": \"Invalid nonce. Expected 7, got 6\"\n}\n```\n\n**Solutions:**\n\n1. **Fetch fresh nonce** - Call `GET /users/:id/nonce` again\n2. **Don't parallelize** - Wait for each transaction to be confirmed before submitting the next\n3. **Check pending transactions** - Your transaction might be pending, increasing the nonce\n\n### Pending Transactions\n\nNonces only increment when transactions are **confirmed** in a block. If you have pending transactions:\n\n- Your `currentNonce` hasn't changed yet\n- Use `nextNonce` based on the pending transaction count\n- Wait for block production to confirm transactions\n\n## CLI Signing Example\n\nThe `tana-cli` handles all signing automatically:\n\n```bash\n# Create user (signs automatically)\ntana new user @alice\ntana deploy user @alice\n\n# Transfers (coming soon - will sign automatically)\ntana transfer @alice @bob 50 USD\n```\n\n## TypeScript Library Example\n\n```typescript\nimport * as ed from '@noble/ed25519'\nimport { createTransactionMessage, signMessage } from '@tana/cli/utils/crypto'\n\n// 1. Load user config\nconst userConfig = readUserConfig('@alice')\n\n// 2. Get current nonce\nconst nonceResponse = await fetch(`http://localhost:8080/users/${userConfig.id}/nonce`)\nconst { nextNonce } = await nonceResponse.json()\n\n// 3. Create transaction data\nconst txData = {\n  type: 'transfer',\n  from: userConfig.id,\n  to: recipientId,\n  amount: '100.00',\n  currencyCode: 'USD',\n  timestamp: Date.now(),\n  nonce: nextNonce\n}\n\n// 4. Sign the transaction\nconst message = createTransactionMessage(txData)\nconst signature = await signMessage(message, userConfig.privateKey)\n\n// 5. Submit\nawait fetch('http://localhost:8080/transactions', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({ ...txData, signature })\n})\n```\n\n## Security Best Practices\n\n### Keep Private Keys Safe\n\n- **Never share** your private key\n- **Never commit** private keys to git\n- **Store securely** in `~/.config/tana/users/` with proper permissions\n- **Backup** to encrypted storage\n\n### Verify Timestamps\n\nAlways use current timestamps:\n\n```typescript\nconst timestamp = Date.now() // Current time in milliseconds\n```\n\n**Don't:**\n- Use hardcoded timestamps\n- Reuse old timestamps\n- Set timestamps in the future\n\n### Handle Nonces Carefully\n\n- Always fetch fresh nonces before signing\n- Wait for transactions to confirm before submitting more\n- Don't parallelize transactions from the same account\n\n### Verify Before Signing\n\nAlways review transaction details before signing:\n\n```typescript\nconsole.log('Transaction to sign:')\nconsole.log(`  Type: ${txData.type}`)\nconsole.log(`  To: ${txData.to}`)\nconsole.log(`  Amount: ${txData.amount} ${txData.currencyCode}`)\nconsole.log(`  Nonce: ${txData.nonce}`)\n\n// Only sign if everything looks correct\nconst signature = await signMessage(message, privateKey)\n```\n\n## Error Reference\n\nCommon signature-related errors:\n\n| Error | Cause | Solution |\n|-------|-------|----------|\n| `Invalid transaction signature` | Signature doesn't match | Regenerate signature with correct private key |\n| `Invalid nonce. Expected X, got Y` | Wrong nonce | Fetch fresh nonce from `/users/:id/nonce` |\n| `Transaction timestamp is too old` | Timestamp > 5 minutes old | Use current timestamp `Date.now()` |\n| `Sender user not found` | Invalid `from` user ID | Verify user ID is correct |\n| `Insufficient balance` | Not enough funds | Check balance before transferring |\n\n## Next Steps\n\n- **[Smart Contracts](/guides/smart-contracts/)** - Sign and deploy contracts\n- **[API Reference](/tana-api/transactions/)** - Full transaction API docs\n- **[CLI Commands](/tana-cli/intro/)** - Using the CLI for signed operations\n",
    "html": "<p>All transactions on Tana require Ed25519 cryptographic signatures to ensure authenticity and prevent unauthorized actions.</p>\n<h2 id=\"overview\">Overview</h2>\n<p>Every transaction must be signed by the private key of the account initiating the transaction. This prevents:</p>\n<ul>\n<li><strong>Impersonation</strong> - No one can create transactions on your behalf</li>\n<li><strong>Replay attacks</strong> - Transactions cannot be reused (thanks to nonces)</li>\n<li><strong>Tampering</strong> - Transaction data cannot be modified after signing</li>\n</ul>\n<h2 id=\"signature-requirements\">Signature Requirements</h2>\n<p>Every transaction (except user creation) must include:</p>\n<ol>\n<li><strong>Signature</strong> - Ed25519 signature (hex string with <code>ed25519_</code> prefix)</li>\n<li><strong>Timestamp</strong> - Unix timestamp in milliseconds (must be within 5 minutes of current time)</li>\n<li><strong>Nonce</strong> - Sequential number that increments with each transaction</li>\n</ol>\n<h2 id=\"how-signing-works\">How Signing Works</h2>\n<h3 id=\"1-get-your-current-nonce\">1. Get Your Current Nonce</h3>\n<p>Before creating a transaction, fetch your current nonce:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Get nonce for user</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8080/users/{userId}/nonce</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Response:</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  \"userId\"</span><span style=\"color:#79B8FF\">:</span><span style=\"color:#9ECBFF\"> \"550e8400-e29b-41d4-a716-446655440000\",</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  \"username\"</span><span style=\"color:#79B8FF\">:</span><span style=\"color:#9ECBFF\"> \"@alice\",</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  \"currentNonce\"</span><span style=\"color:#79B8FF\">:</span><span style=\"color:#9ECBFF\"> 5,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  \"nextNonce\"</span><span style=\"color:#79B8FF\">:</span><span style=\"color:#9ECBFF\"> 6,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  \"message\"</span><span style=\"color:#79B8FF\">:</span><span style=\"color:#9ECBFF\"> \"Use nextNonce for your next transaction\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Important:</strong> Use <code>nextNonce</code> for your transaction, not <code>currentNonce</code>.</p>\n<h3 id=\"2-create-transaction-message\">2. Create Transaction Message</h3>\n<p>Build a canonical message for signing:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { createTransactionMessage } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> '@tana/cli/utils/crypto'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> transactionData</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  type: </span><span style=\"color:#9ECBFF\">'transfer'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  from: </span><span style=\"color:#9ECBFF\">'550e8400-e29b-41d4-a716-446655440000'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// Your user ID</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  to: </span><span style=\"color:#9ECBFF\">'7c9e6679-7425-40de-944b-e07fc1f90ae7'</span><span style=\"color:#E1E4E8\">,   </span><span style=\"color:#6A737D\">// Recipient ID</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  amount: </span><span style=\"color:#9ECBFF\">'100.00'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  currencyCode: </span><span style=\"color:#9ECBFF\">'USD'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  timestamp: Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">(),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  nonce: </span><span style=\"color:#79B8FF\">6</span><span style=\"color:#6A737D\"> // The nextNonce from step 1</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> message</span><span style=\"color:#F97583\"> =</span><span style=\"color:#B392F0\"> createTransactionMessage</span><span style=\"color:#E1E4E8\">(transactionData)</span></span></code></pre>\n</code></pre><h3 id=\"3-sign-the-message\">3. Sign the Message</h3>\n<p>Sign with your private key:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { signMessage } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> '@tana/cli/utils/crypto'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> signature</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> signMessage</span><span style=\"color:#E1E4E8\">(</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  message,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  userConfig.privateKey </span><span style=\"color:#6A737D\">// From ~/.config/tana/users/@alice.json</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// signature: \"ed25519_a7f3b2c1d4e5f6a7b8c9d0e1f2a3b4c5...\"</span></span></code></pre>\n</code></pre><h3 id=\"4-submit-transaction\">4. Submit Transaction</h3>\n<p>Send the signed transaction to the ledger:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> response</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> fetch</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'http://localhost:8080/transactions'</span><span style=\"color:#E1E4E8\">, {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  method: </span><span style=\"color:#9ECBFF\">'POST'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  headers: { </span><span style=\"color:#9ECBFF\">'Content-Type'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'application/json'</span><span style=\"color:#E1E4E8\"> },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  body: </span><span style=\"color:#79B8FF\">JSON</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">stringify</span><span style=\"color:#E1E4E8\">({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    type: </span><span style=\"color:#9ECBFF\">'transfer'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    from: </span><span style=\"color:#9ECBFF\">'550e8400-e29b-41d4-a716-446655440000'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    to: </span><span style=\"color:#9ECBFF\">'7c9e6679-7425-40de-944b-e07fc1f90ae7'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    amount: </span><span style=\"color:#9ECBFF\">'100.00'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    currencyCode: </span><span style=\"color:#9ECBFF\">'USD'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    signature, </span><span style=\"color:#6A737D\">// Include the signature</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    timestamp: transactionData.timestamp,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    nonce: transactionData.nonce</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">})</span></span></code></pre>\n</code></pre><h2 id=\"signature-verification\">Signature Verification</h2>\n<p>When the ledger receives a transaction, it:</p>\n<ol>\n<li><strong>Validates timestamp</strong> - Must be within 5 minutes</li>\n<li><strong>Fetches user</strong> - Gets user record by <code>from</code> field</li>\n<li><strong>Checks nonce</strong> - Must be exactly <code>currentNonce + 1</code></li>\n<li><strong>Verifies signature</strong> - Recreates message and verifies with user&#39;s public key</li>\n<li><strong>Checks balances</strong> - Ensures sufficient funds (for transfers)</li>\n</ol>\n<p>If any check fails, the transaction is rejected.</p>\n<h2 id=\"transaction-types\">Transaction Types</h2>\n<h3 id=\"user-creation\">User Creation</h3>\n<p><strong>Special case:</strong> User creation doesn&#39;t require signature verification (no user exists yet to verify against). Instead:</p>\n<ul>\n<li>Nonce is always <code>0</code></li>\n<li>Signature is verified against the <code>publicKey</code> field in the request itself</li>\n<li>This proves you control the private key for the public key you&#39;re registering</li>\n</ul>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> transactionData</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  type: </span><span style=\"color:#9ECBFF\">'user_creation'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  from: </span><span style=\"color:#9ECBFF\">'00000000-0000-0000-0000-000000000000'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// System</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  to: </span><span style=\"color:#9ECBFF\">'00000000-0000-0000-0000-000000000000'</span><span style=\"color:#E1E4E8\">,   </span><span style=\"color:#6A737D\">// Will be assigned</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  timestamp: Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">(),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  nonce: </span><span style=\"color:#79B8FF\">0</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// Always 0 for user creation</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  contractInput: {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    username: </span><span style=\"color:#9ECBFF\">'@alice'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    displayName: </span><span style=\"color:#9ECBFF\">'Alice'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    publicKey: </span><span style=\"color:#9ECBFF\">'ed25519_abc123...'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    bio: </span><span style=\"color:#9ECBFF\">''</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    role: </span><span style=\"color:#9ECBFF\">'user'</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h3 id=\"transfers\">Transfers</h3>\n<p>Transfer currency between accounts:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  type</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'transfer'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  from</span><span style=\"color:#E1E4E8\">: userId,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  to</span><span style=\"color:#E1E4E8\">: recipientId,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  amount</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'50.00'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  currencyCode</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'USD'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  signature</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'ed25519_...'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  timestamp</span><span style=\"color:#E1E4E8\">: Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">(),</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  nonce</span><span style=\"color:#E1E4E8\">: nextNonce</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h3 id=\"deposits\">Deposits</h3>\n<p>Request to deposit fiat currency into blockchain:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  type</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'deposit'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  from</span><span style=\"color:#E1E4E8\">: userId, </span><span style=\"color:#6A737D\">// The requestor</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  to</span><span style=\"color:#E1E4E8\">: userId,   </span><span style=\"color:#6A737D\">// Same (depositing to self)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  amount</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'1000.00'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  currencyCode</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'CAD'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  signature</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'ed25519_...'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  timestamp</span><span style=\"color:#E1E4E8\">: Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">(),</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  nonce</span><span style=\"color:#E1E4E8\">: nextNonce,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  metadata</span><span style=\"color:#E1E4E8\">: {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Optional: e-transfer details</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Note:</strong> Deposits create a pending transaction that must be confirmed by the sovereign user after receiving the actual fiat currency.</p>\n<h3 id=\"withdraws\">Withdraws</h3>\n<p>Request to withdraw currency from blockchain to fiat:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  type</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'withdraw'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  from</span><span style=\"color:#E1E4E8\">: userId, </span><span style=\"color:#6A737D\">// Your account (will be debited)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  to</span><span style=\"color:#E1E4E8\">: userId,   </span><span style=\"color:#6A737D\">// Same</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  amount</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'500.00'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  currencyCode</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'USD'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  signature</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'ed25519_...'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  timestamp</span><span style=\"color:#E1E4E8\">: Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">(),</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  nonce</span><span style=\"color:#E1E4E8\">: nextNonce,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  metadata</span><span style=\"color:#E1E4E8\">: {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">    email</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'alice@example.com'</span><span style=\"color:#6A737D\"> // Where to send e-transfer</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Note:</strong> Withdraws also require sovereign confirmation before the fiat currency is sent.</p>\n<h2 id=\"nonce-management\">Nonce Management</h2>\n<h3 id=\"what-is-a-nonce\">What is a Nonce?</h3>\n<p>A <strong>nonce</strong> (number used once) is a counter that prevents replay attacks. Each user has their own nonce that:</p>\n<ul>\n<li>Starts at <code>0</code> when the user is created</li>\n<li>Increments by <code>1</code> every time a transaction is confirmed</li>\n<li>Must be sequential (can&#39;t skip numbers)</li>\n</ul>\n<h3 id=\"why-nonces-matter\">Why Nonces Matter</h3>\n<p>Without nonces, an attacker could:</p>\n<ol>\n<li>Capture a valid signed transaction</li>\n<li>Re-submit it multiple times</li>\n<li>Drain your account</li>\n</ol>\n<p>With nonces, each transaction has a unique sequence number, so replays are detected and rejected.</p>\n<h3 id=\"handling-nonce-errors\">Handling Nonce Errors</h3>\n<p>If you get a nonce mismatch error:</p>\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"error\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Invalid nonce. Expected 7, got 6\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Solutions:</strong></p>\n<ol>\n<li><strong>Fetch fresh nonce</strong> - Call <code>GET /users/:id/nonce</code> again</li>\n<li><strong>Don&#39;t parallelize</strong> - Wait for each transaction to be confirmed before submitting the next</li>\n<li><strong>Check pending transactions</strong> - Your transaction might be pending, increasing the nonce</li>\n</ol>\n<h3 id=\"pending-transactions\">Pending Transactions</h3>\n<p>Nonces only increment when transactions are <strong>confirmed</strong> in a block. If you have pending transactions:</p>\n<ul>\n<li>Your <code>currentNonce</code> hasn&#39;t changed yet</li>\n<li>Use <code>nextNonce</code> based on the pending transaction count</li>\n<li>Wait for block production to confirm transactions</li>\n</ul>\n<h2 id=\"cli-signing-example\">CLI Signing Example</h2>\n<p>The <code>tana-cli</code> handles all signing automatically:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Create user (signs automatically)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> new</span><span style=\"color:#9ECBFF\"> user</span><span style=\"color:#9ECBFF\"> @alice</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> deploy</span><span style=\"color:#9ECBFF\"> user</span><span style=\"color:#9ECBFF\"> @alice</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Transfers (coming soon - will sign automatically)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> transfer</span><span style=\"color:#9ECBFF\"> @alice</span><span style=\"color:#9ECBFF\"> @bob</span><span style=\"color:#79B8FF\"> 50</span><span style=\"color:#9ECBFF\"> USD</span></span></code></pre>\n</code></pre><h2 id=\"typescript-library-example\">TypeScript Library Example</h2>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#79B8FF\"> *</span><span style=\"color:#F97583\"> as</span><span style=\"color:#E1E4E8\"> ed </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> '@noble/ed25519'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { createTransactionMessage, signMessage } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> '@tana/cli/utils/crypto'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// 1. Load user config</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> userConfig</span><span style=\"color:#F97583\"> =</span><span style=\"color:#B392F0\"> readUserConfig</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'@alice'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// 2. Get current nonce</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> nonceResponse</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> fetch</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`http://localhost:8080/users/${</span><span style=\"color:#E1E4E8\">userConfig</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">id</span><span style=\"color:#9ECBFF\">}/nonce`</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#79B8FF\">nextNonce</span><span style=\"color:#E1E4E8\"> } </span><span style=\"color:#F97583\">=</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> nonceResponse.</span><span style=\"color:#B392F0\">json</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// 3. Create transaction data</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> txData</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  type: </span><span style=\"color:#9ECBFF\">'transfer'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  from: userConfig.id,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  to: recipientId,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  amount: </span><span style=\"color:#9ECBFF\">'100.00'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  currencyCode: </span><span style=\"color:#9ECBFF\">'USD'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  timestamp: Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">(),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  nonce: nextNonce</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// 4. Sign the transaction</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> message</span><span style=\"color:#F97583\"> =</span><span style=\"color:#B392F0\"> createTransactionMessage</span><span style=\"color:#E1E4E8\">(txData)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> signature</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> signMessage</span><span style=\"color:#E1E4E8\">(message, userConfig.privateKey)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// 5. Submit</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#B392F0\"> fetch</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'http://localhost:8080/transactions'</span><span style=\"color:#E1E4E8\">, {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  method: </span><span style=\"color:#9ECBFF\">'POST'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  headers: { </span><span style=\"color:#9ECBFF\">'Content-Type'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'application/json'</span><span style=\"color:#E1E4E8\"> },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  body: </span><span style=\"color:#79B8FF\">JSON</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">stringify</span><span style=\"color:#E1E4E8\">({ </span><span style=\"color:#F97583\">...</span><span style=\"color:#E1E4E8\">txData, signature })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">})</span></span></code></pre>\n</code></pre><h2 id=\"security-best-practices\">Security Best Practices</h2>\n<h3 id=\"keep-private-keys-safe\">Keep Private Keys Safe</h3>\n<ul>\n<li><strong>Never share</strong> your private key</li>\n<li><strong>Never commit</strong> private keys to git</li>\n<li><strong>Store securely</strong> in <code>~/.config/tana/users/</code> with proper permissions</li>\n<li><strong>Backup</strong> to encrypted storage</li>\n</ul>\n<h3 id=\"verify-timestamps\">Verify Timestamps</h3>\n<p>Always use current timestamps:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> timestamp</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">() </span><span style=\"color:#6A737D\">// Current time in milliseconds</span></span></code></pre>\n</code></pre><p><strong>Don&#39;t:</strong></p>\n<ul>\n<li>Use hardcoded timestamps</li>\n<li>Reuse old timestamps</li>\n<li>Set timestamps in the future</li>\n</ul>\n<h3 id=\"handle-nonces-carefully\">Handle Nonces Carefully</h3>\n<ul>\n<li>Always fetch fresh nonces before signing</li>\n<li>Wait for transactions to confirm before submitting more</li>\n<li>Don&#39;t parallelize transactions from the same account</li>\n</ul>\n<h3 id=\"verify-before-signing\">Verify Before Signing</h3>\n<p>Always review transaction details before signing:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Transaction to sign:'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`  Type: ${</span><span style=\"color:#E1E4E8\">txData</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">type</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`  To: ${</span><span style=\"color:#E1E4E8\">txData</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">to</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`  Amount: ${</span><span style=\"color:#E1E4E8\">txData</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">amount</span><span style=\"color:#9ECBFF\">} ${</span><span style=\"color:#E1E4E8\">txData</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">currencyCode</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`  Nonce: ${</span><span style=\"color:#E1E4E8\">txData</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">nonce</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Only sign if everything looks correct</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> signature</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> signMessage</span><span style=\"color:#E1E4E8\">(message, privateKey)</span></span></code></pre>\n</code></pre><h2 id=\"error-reference\">Error Reference</h2>\n<p>Common signature-related errors:</p>\n<table>\n<thead>\n<tr>\n<th>Error</th>\n<th>Cause</th>\n<th>Solution</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>Invalid transaction signature</code></td>\n<td>Signature doesn&#39;t match</td>\n<td>Regenerate signature with correct private key</td>\n</tr>\n<tr>\n<td><code>Invalid nonce. Expected X, got Y</code></td>\n<td>Wrong nonce</td>\n<td>Fetch fresh nonce from <code>/users/:id/nonce</code></td>\n</tr>\n<tr>\n<td><code>Transaction timestamp is too old</code></td>\n<td>Timestamp &gt; 5 minutes old</td>\n<td>Use current timestamp <code>Date.now()</code></td>\n</tr>\n<tr>\n<td><code>Sender user not found</code></td>\n<td>Invalid <code>from</code> user ID</td>\n<td>Verify user ID is correct</td>\n</tr>\n<tr>\n<td><code>Insufficient balance</code></td>\n<td>Not enough funds</td>\n<td>Check balance before transferring</td>\n</tr>\n</tbody></table>\n<h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li><strong><a href=\"/guides/smart-contracts/\">Smart Contracts</a></strong> - Sign and deploy contracts</li>\n<li><strong><a href=\"/tana-api/transactions/\">API Reference</a></strong> - Full transaction API docs</li>\n<li><strong><a href=\"/tana-cli/intro/\">CLI Commands</a></strong> - Using the CLI for signed operations</li>\n</ul>\n"
  },
  {
    "slug": [
      "guides",
      "deployment"
    ],
    "metadata": {
      "title": "Production Deployment",
      "description": "Deploy Tana blockchain to production",
      "sidebar": {
        "order": 4
      }
    },
    "content": "\nThis guide covers deploying the Tana blockchain infrastructure to production.\n\n## Prerequisites\n\n### Server Requirements\n- **CPU:** 4+ cores\n- **RAM:** 8GB+ minimum, 16GB recommended\n- **Storage:** 100GB+ SSD\n- **OS:** Ubuntu 22.04 LTS (recommended)\n- **Network:** Static IP, ports 80/443/8080 accessible\n\n### Software Requirements\n- Docker 24.0+\n- Docker Compose 2.0+\n- Bun 1.1.38+ (for migrations)\n- PostgreSQL 16 (via Docker)\n- Redis 7 (via Docker)\n\n### Domain Configuration\nConfigure DNS records for your domain:\n```\nA     blockchain.yourdomain.com    → <SERVER_IP>\nAAAA  blockchain.yourdomain.com    → <SERVER_IPv6>  (optional)\n```\n\n## Architecture\n\n```\n┌─────────────────────────────────────────────────────────────┐\n│                     yourdomain.com                           │\n│                  (Main Website/Playground)                   │\n└─────────────────────────────────────────────────────────────┘\n                            │\n                            ↓ HTTPS\n┌─────────────────────────────────────────────────────────────┐\n│         blockchain.yourdomain.com (Load Balancer)           │\n└─────────────────────────────────────────────────────────────┘\n                            │\n           ┌────────────────┼────────────────┐\n           ↓                ↓                ↓\n    ┌──────────┐    ┌──────────┐    ┌──────────┐\n    │ Ledger   │    │  Edge    │    │ Runtime  │\n    │ Service  │    │ Server   │    │ Service  │\n    │  :8080   │    │  :8180   │    │          │\n    └──────────┘    └──────────┘    └──────────┘\n           │                │\n           └────────────────┘\n                    ↓\n            ┌──────────────┐\n            │  PostgreSQL  │\n            │     :5432    │\n            └──────────────┘\n                    │\n            ┌──────────────┐\n            │    Redis     │\n            │     :6379    │\n            └──────────────┘\n```\n\n## Services Overview\n\n### Ledger Service (Port 8080)\n**Purpose:** Blockchain data API - users, balances, transactions\n\n**Key Endpoints:**\n- `GET /health` - Health check\n- `GET /users` - List all users\n- `POST /users` - Create user\n- `GET /balances` - Get all balances\n- `GET /transactions` - Get all transactions\n- `POST /transactions` - Create transaction\n\n### Edge Server (Port 8180)\n**Purpose:** Fast HTTP execution of smart contracts\n\n**Features:**\n- TypeScript contract execution\n- V8 isolate per request\n- Cloudflare Workers-style architecture\n- Sub-100ms response times\n\n## Installation\n\n### 1. Clone Repository\n```bash\ngit clone https://github.com/yourusername/tana.git\ncd tana\n```\n\n### 2. Create Production Environment File\n```bash\ncp .env.example .env.production\n```\n\nEdit `.env.production`:\n```bash\n# Database Configuration\nPOSTGRES_DB=tana\nPOSTGRES_USER=tana\nPOSTGRES_PASSWORD=<STRONG_PASSWORD_HERE>\n\n# Ledger URL (for all services)\nTANA_LEDGER_URL=https://blockchain.yourdomain.com\n\n# Service Configuration\nNODE_ENV=production\nLOG_LEVEL=info\n\n# CORS Origins\nALLOWED_ORIGINS=https://yourdomain.com,https://blockchain.yourdomain.com\n```\n\n### 3. Build Docker Images\n```bash\n# Build all services\ndocker-compose -f docker-compose.prod.yml build\n\n# Or build specific service\ndocker-compose -f docker-compose.prod.yml build tana-ledger\n```\n\n### 4. Initialize Database\n```bash\n# Start database services\ndocker-compose -f docker-compose.prod.yml up -d postgres redis\n\n# Wait for postgres to be ready\ndocker-compose -f docker-compose.prod.yml exec postgres pg_isready\n\n# Run migrations\ncd ledger\nbun run db:migrate\n\n# Seed default data\ncurl -X POST http://localhost:8080/balances/currencies/seed\n```\n\n### 5. Start Services\n```bash\n# Start all services\ndocker-compose -f docker-compose.prod.yml up -d\n\n# Check status\ndocker-compose -f docker-compose.prod.yml ps\n\n# View logs\ndocker-compose -f docker-compose.prod.yml logs -f\n```\n\n### 6. Verify Deployment\n```bash\n# Test ledger service\ncurl http://localhost:8080/health\ncurl http://localhost:8080/\n\n# Test endpoints\ncurl http://localhost:8080/users\ncurl http://localhost:8080/balances\ncurl http://localhost:8080/transactions\n```\n\n## Reverse Proxy Configuration\n\n### Using Nginx\n\nCreate `/etc/nginx/sites-available/blockchain.yourdomain.com`:\n\n```nginx\n# HTTP -> HTTPS redirect\nserver {\n    listen 80;\n    listen [::]:80;\n    server_name blockchain.yourdomain.com;\n\n    location / {\n        return 301 https://$server_name$request_uri;\n    }\n}\n\n# HTTPS\nserver {\n    listen 443 ssl http2;\n    listen [::]:443 ssl http2;\n    server_name blockchain.yourdomain.com;\n\n    # SSL certificates (Let's Encrypt)\n    ssl_certificate /etc/letsencrypt/live/blockchain.yourdomain.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/blockchain.yourdomain.com/privkey.pem;\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers HIGH:!aNULL:!MD5;\n\n    # Security headers\n    add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\" always;\n    add_header X-Frame-Options \"SAMEORIGIN\" always;\n    add_header X-Content-Type-Options \"nosniff\" always;\n    add_header X-XSS-Protection \"1; mode=block\" always;\n\n    # CORS headers\n    add_header Access-Control-Allow-Origin \"https://yourdomain.com\" always;\n    add_header Access-Control-Allow-Methods \"GET, POST, OPTIONS\" always;\n    add_header Access-Control-Allow-Headers \"Content-Type, Authorization\" always;\n\n    # Rate limiting\n    limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;\n    limit_req zone=api_limit burst=20 nodelay;\n\n    # Proxy to ledger service\n    location / {\n        proxy_pass http://localhost:8080;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_cache_bypass $http_upgrade;\n\n        # Timeouts\n        proxy_connect_timeout 30s;\n        proxy_send_timeout 30s;\n        proxy_read_timeout 30s;\n    }\n\n    # Health check endpoint (no rate limiting)\n    location /health {\n        proxy_pass http://localhost:8080/health;\n        access_log off;\n    }\n}\n```\n\nEnable and test:\n```bash\n# Enable site\nsudo ln -s /etc/nginx/sites-available/blockchain.yourdomain.com /etc/nginx/sites-enabled/\n\n# Test configuration\nsudo nginx -t\n\n# Reload nginx\nsudo systemctl reload nginx\n```\n\n### SSL Certificate (Let's Encrypt)\n```bash\n# Install certbot\nsudo apt update\nsudo apt install certbot python3-certbot-nginx\n\n# Get certificate\nsudo certbot --nginx -d blockchain.yourdomain.com\n\n# Auto-renewal is enabled by default\n# Test renewal\nsudo certbot renew --dry-run\n```\n\n## Monitoring & Maintenance\n\n### View Logs\n```bash\n# All services\ndocker-compose -f docker-compose.prod.yml logs -f\n\n# Specific service\ndocker-compose -f docker-compose.prod.yml logs -f tana-ledger\n\n# Last 100 lines\ndocker-compose -f docker-compose.prod.yml logs --tail=100 tana-ledger\n```\n\n### Database Backups\nCreate a backup script `/usr/local/bin/backup-tana.sh`:\n\n```bash\n#!/bin/bash\nBACKUP_DIR=\"/var/backups/tana\"\nTIMESTAMP=$(date +%Y%m%d_%H%M%S)\nmkdir -p $BACKUP_DIR\n\n# Backup database\ndocker-compose -f /path/to/tana/docker-compose.prod.yml exec -T postgres \\\n  pg_dump -U tana tana | gzip > \"$BACKUP_DIR/tana_$TIMESTAMP.sql.gz\"\n\n# Keep only last 7 days\nfind $BACKUP_DIR -name \"tana_*.sql.gz\" -mtime +7 -delete\n```\n\nAdd to crontab:\n```bash\n# Daily backup at 2 AM\n0 2 * * * /usr/local/bin/backup-tana.sh\n```\n\n### Health Monitoring\n```bash\n# Check service health\ncurl https://blockchain.yourdomain.com/health\n\n# Monitor container stats\ndocker stats\n\n# Check service status\ndocker-compose -f docker-compose.prod.yml ps\n```\n\n### Updates & Upgrades\n```bash\n# Pull latest code\ngit pull origin main\n\n# Rebuild images\ndocker-compose -f docker-compose.prod.yml build\n\n# Run database migrations\ncd ledger && bun run db:migrate && cd ..\n\n# Restart services (zero downtime)\ndocker-compose -f docker-compose.prod.yml up -d --no-deps --build tana-ledger\ndocker-compose -f docker-compose.prod.yml up -d --no-deps --build tana-edge\n```\n\n## Security Checklist\n\n- [ ] Strong PostgreSQL password set\n- [ ] SSL certificates installed and valid\n- [ ] Firewall configured (UFW or iptables)\n- [ ] Rate limiting enabled in Nginx\n- [ ] Services running as non-root user\n- [ ] Database not exposed to public internet\n- [ ] Redis not exposed to public internet\n- [ ] CORS properly configured\n- [ ] Security headers enabled\n- [ ] Regular backups configured\n- [ ] Monitoring and alerting set up\n- [ ] Secrets stored securely (not in git)\n- [ ] `TANA_LEDGER_URL` environment variable set correctly\n\n## Troubleshooting\n\n### Service Won't Start\n```bash\n# Check logs\ndocker-compose -f docker-compose.prod.yml logs tana-ledger\n\n# Check container status\ndocker-compose -f docker-compose.prod.yml ps\n\n# Restart specific service\ndocker-compose -f docker-compose.prod.yml restart tana-ledger\n```\n\n### Database Connection Issues\n```bash\n# Check postgres is running\ndocker-compose -f docker-compose.prod.yml ps postgres\n\n# Test connection manually\ndocker-compose -f docker-compose.prod.yml exec postgres \\\n  psql -U tana -d tana -c \"SELECT version();\"\n```\n\n### High Memory Usage\n```bash\n# Check resource usage\ndocker stats\n\n# Adjust resource limits in docker-compose.prod.yml\nservices:\n  tana-ledger:\n    deploy:\n      resources:\n        limits:\n          memory: 512M\n```\n\n### CORS Errors\nCheck `ALLOWED_ORIGINS` in `.env.production` includes all necessary domains:\n```bash\nALLOWED_ORIGINS=https://yourdomain.com,https://blockchain.yourdomain.com\n```\n\n## Performance Tuning\n\n### PostgreSQL Optimization\nEdit `docker-compose.prod.yml` to add PostgreSQL performance settings:\n\n```yaml\npostgres:\n  command: >\n    postgres\n    -c shared_buffers=256MB\n    -c effective_cache_size=1GB\n    -c maintenance_work_mem=128MB\n    -c checkpoint_completion_target=0.9\n    -c wal_buffers=16MB\n    -c default_statistics_target=100\n    -c random_page_cost=1.1\n    -c effective_io_concurrency=200\n    -c work_mem=16MB\n    -c min_wal_size=1GB\n    -c max_wal_size=4GB\n```\n\n## Cost Estimation\n\n### Minimum Setup (2 core VPS)\n- **DigitalOcean:** $12-24/month\n- **Hetzner:** €5-15/month\n- **Linode:** $12-24/month\n\n### Recommended Setup (4 core VPS)\n- **DigitalOcean:** $48/month\n- **Hetzner:** €20/month\n- **AWS Lightsail:** $40/month\n\n### Additional Costs\n- Domain: $10-20/year\n- Backups: $5-10/month (optional)\n- Monitoring: Free (self-hosted) or $20/month\n\n## Next Steps\n\nAfter successful deployment:\n1. Monitor logs for the first 24 hours\n2. Set up automated backups\n3. Configure uptime monitoring\n4. Test all API endpoints from your application\n5. Review and optimize performance\n\n## Related Documentation\n\n- [Environment Variables](/contributing/env-vars/) - Configuration options\n- [API Reference](/tana-api/intro/) - Ledger API endpoints\n- [Edge Server](/tana-edge/intro/) - Edge server documentation\n- [Development Setup](/contributing/setup/) - Local development guide\n",
    "html": "<p>This guide covers deploying the Tana blockchain infrastructure to production.</p>\n<h2 id=\"prerequisites\">Prerequisites</h2>\n<h3 id=\"server-requirements\">Server Requirements</h3>\n<ul>\n<li><strong>CPU:</strong> 4+ cores</li>\n<li><strong>RAM:</strong> 8GB+ minimum, 16GB recommended</li>\n<li><strong>Storage:</strong> 100GB+ SSD</li>\n<li><strong>OS:</strong> Ubuntu 22.04 LTS (recommended)</li>\n<li><strong>Network:</strong> Static IP, ports 80/443/8080 accessible</li>\n</ul>\n<h3 id=\"software-requirements\">Software Requirements</h3>\n<ul>\n<li>Docker 24.0+</li>\n<li>Docker Compose 2.0+</li>\n<li>Bun 1.1.38+ (for migrations)</li>\n<li>PostgreSQL 16 (via Docker)</li>\n<li>Redis 7 (via Docker)</li>\n</ul>\n<h3 id=\"domain-configuration\">Domain Configuration</h3>\n<p>Configure DNS records for your domain:</p>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>A     blockchain.yourdomain.com    → &#x3C;SERVER_IP></span></span>\n<span class=\"line\"><span>AAAA  blockchain.yourdomain.com    → &#x3C;SERVER_IPv6>  (optional)</span></span></code></pre>\n</code></pre><h2 id=\"architecture\">Architecture</h2>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>┌─────────────────────────────────────────────────────────────┐</span></span>\n<span class=\"line\"><span>│                     yourdomain.com                           │</span></span>\n<span class=\"line\"><span>│                  (Main Website/Playground)                   │</span></span>\n<span class=\"line\"><span>└─────────────────────────────────────────────────────────────┘</span></span>\n<span class=\"line\"><span>                            │</span></span>\n<span class=\"line\"><span>                            ↓ HTTPS</span></span>\n<span class=\"line\"><span>┌─────────────────────────────────────────────────────────────┐</span></span>\n<span class=\"line\"><span>│         blockchain.yourdomain.com (Load Balancer)           │</span></span>\n<span class=\"line\"><span>└─────────────────────────────────────────────────────────────┘</span></span>\n<span class=\"line\"><span>                            │</span></span>\n<span class=\"line\"><span>           ┌────────────────┼────────────────┐</span></span>\n<span class=\"line\"><span>           ↓                ↓                ↓</span></span>\n<span class=\"line\"><span>    ┌──────────┐    ┌──────────┐    ┌──────────┐</span></span>\n<span class=\"line\"><span>    │ Ledger   │    │  Edge    │    │ Runtime  │</span></span>\n<span class=\"line\"><span>    │ Service  │    │ Server   │    │ Service  │</span></span>\n<span class=\"line\"><span>    │  :8080   │    │  :8180   │    │          │</span></span>\n<span class=\"line\"><span>    └──────────┘    └──────────┘    └──────────┘</span></span>\n<span class=\"line\"><span>           │                │</span></span>\n<span class=\"line\"><span>           └────────────────┘</span></span>\n<span class=\"line\"><span>                    ↓</span></span>\n<span class=\"line\"><span>            ┌──────────────┐</span></span>\n<span class=\"line\"><span>            │  PostgreSQL  │</span></span>\n<span class=\"line\"><span>            │     :5432    │</span></span>\n<span class=\"line\"><span>            └──────────────┘</span></span>\n<span class=\"line\"><span>                    │</span></span>\n<span class=\"line\"><span>            ┌──────────────┐</span></span>\n<span class=\"line\"><span>            │    Redis     │</span></span>\n<span class=\"line\"><span>            │     :6379    │</span></span>\n<span class=\"line\"><span>            └──────────────┘</span></span></code></pre>\n</code></pre><h2 id=\"services-overview\">Services Overview</h2>\n<h3 id=\"ledger-service-port-8080\">Ledger Service (Port 8080)</h3>\n<p><strong>Purpose:</strong> Blockchain data API - users, balances, transactions</p>\n<p><strong>Key Endpoints:</strong></p>\n<ul>\n<li><code>GET /health</code> - Health check</li>\n<li><code>GET /users</code> - List all users</li>\n<li><code>POST /users</code> - Create user</li>\n<li><code>GET /balances</code> - Get all balances</li>\n<li><code>GET /transactions</code> - Get all transactions</li>\n<li><code>POST /transactions</code> - Create transaction</li>\n</ul>\n<h3 id=\"edge-server-port-8180\">Edge Server (Port 8180)</h3>\n<p><strong>Purpose:</strong> Fast HTTP execution of smart contracts</p>\n<p><strong>Features:</strong></p>\n<ul>\n<li>TypeScript contract execution</li>\n<li>V8 isolate per request</li>\n<li>Cloudflare Workers-style architecture</li>\n<li>Sub-100ms response times</li>\n</ul>\n<h2 id=\"installation\">Installation</h2>\n<h3 id=\"1-clone-repository\">1. Clone Repository</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">git</span><span style=\"color:#9ECBFF\"> clone</span><span style=\"color:#9ECBFF\"> https://github.com/yourusername/tana.git</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">cd</span><span style=\"color:#9ECBFF\"> tana</span></span></code></pre>\n</code></pre><h3 id=\"2-create-production-environment-file\">2. Create Production Environment File</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">cp</span><span style=\"color:#9ECBFF\"> .env.example</span><span style=\"color:#9ECBFF\"> .env.production</span></span></code></pre>\n</code></pre><p>Edit <code>.env.production</code>:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Database Configuration</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">POSTGRES_DB</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">tana</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">POSTGRES_USER</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">tana</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">POSTGRES_PASSWORD</span><span style=\"color:#F97583\">=&#x3C;</span><span style=\"color:#9ECBFF\">STRONG_PASSWORD_HERE</span><span style=\"color:#F97583\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Ledger URL (for all services)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">TANA_LEDGER_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">https://blockchain.yourdomain.com</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Service Configuration</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">NODE_ENV</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">production</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">LOG_LEVEL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">info</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># CORS Origins</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">ALLOWED_ORIGINS</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">https://yourdomain.com,https://blockchain.yourdomain.com</span></span></code></pre>\n</code></pre><h3 id=\"3-build-docker-images\">3. Build Docker Images</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Build all services</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker-compose</span><span style=\"color:#79B8FF\"> -f</span><span style=\"color:#9ECBFF\"> docker-compose.prod.yml</span><span style=\"color:#9ECBFF\"> build</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Or build specific service</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker-compose</span><span style=\"color:#79B8FF\"> -f</span><span style=\"color:#9ECBFF\"> docker-compose.prod.yml</span><span style=\"color:#9ECBFF\"> build</span><span style=\"color:#9ECBFF\"> tana-ledger</span></span></code></pre>\n</code></pre><h3 id=\"4-initialize-database\">4. Initialize Database</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Start database services</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker-compose</span><span style=\"color:#79B8FF\"> -f</span><span style=\"color:#9ECBFF\"> docker-compose.prod.yml</span><span style=\"color:#9ECBFF\"> up</span><span style=\"color:#79B8FF\"> -d</span><span style=\"color:#9ECBFF\"> postgres</span><span style=\"color:#9ECBFF\"> redis</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Wait for postgres to be ready</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker-compose</span><span style=\"color:#79B8FF\"> -f</span><span style=\"color:#9ECBFF\"> docker-compose.prod.yml</span><span style=\"color:#9ECBFF\"> exec</span><span style=\"color:#9ECBFF\"> postgres</span><span style=\"color:#9ECBFF\"> pg_isready</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Run migrations</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">cd</span><span style=\"color:#9ECBFF\"> ledger</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> db:migrate</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Seed default data</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -X</span><span style=\"color:#9ECBFF\"> POST</span><span style=\"color:#9ECBFF\"> http://localhost:8080/balances/currencies/seed</span></span></code></pre>\n</code></pre><h3 id=\"5-start-services\">5. Start Services</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Start all services</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker-compose</span><span style=\"color:#79B8FF\"> -f</span><span style=\"color:#9ECBFF\"> docker-compose.prod.yml</span><span style=\"color:#9ECBFF\"> up</span><span style=\"color:#79B8FF\"> -d</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Check status</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker-compose</span><span style=\"color:#79B8FF\"> -f</span><span style=\"color:#9ECBFF\"> docker-compose.prod.yml</span><span style=\"color:#9ECBFF\"> ps</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># View logs</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker-compose</span><span style=\"color:#79B8FF\"> -f</span><span style=\"color:#9ECBFF\"> docker-compose.prod.yml</span><span style=\"color:#9ECBFF\"> logs</span><span style=\"color:#79B8FF\"> -f</span></span></code></pre>\n</code></pre><h3 id=\"6-verify-deployment\">6. Verify Deployment</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Test ledger service</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8080/health</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8080/</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Test endpoints</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8080/users</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8080/balances</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8080/transactions</span></span></code></pre>\n</code></pre><h2 id=\"reverse-proxy-configuration\">Reverse Proxy Configuration</h2>\n<h3 id=\"using-nginx\">Using Nginx</h3>\n<p>Create <code>/etc/nginx/sites-available/blockchain.yourdomain.com</code>:</p>\n<pre><code class=\"language-nginx\"># HTTP -&gt; HTTPS redirect\nserver {\n    listen 80;\n    listen [::]:80;\n    server_name blockchain.yourdomain.com;\n\n    location / {\n        return 301 https://$server_name$request_uri;\n    }\n}\n\n# HTTPS\nserver {\n    listen 443 ssl http2;\n    listen [::]:443 ssl http2;\n    server_name blockchain.yourdomain.com;\n\n    # SSL certificates (Let&#39;s Encrypt)\n    ssl_certificate /etc/letsencrypt/live/blockchain.yourdomain.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/blockchain.yourdomain.com/privkey.pem;\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers HIGH:!aNULL:!MD5;\n\n    # Security headers\n    add_header Strict-Transport-Security &quot;max-age=31536000; includeSubDomains&quot; always;\n    add_header X-Frame-Options &quot;SAMEORIGIN&quot; always;\n    add_header X-Content-Type-Options &quot;nosniff&quot; always;\n    add_header X-XSS-Protection &quot;1; mode=block&quot; always;\n\n    # CORS headers\n    add_header Access-Control-Allow-Origin &quot;https://yourdomain.com&quot; always;\n    add_header Access-Control-Allow-Methods &quot;GET, POST, OPTIONS&quot; always;\n    add_header Access-Control-Allow-Headers &quot;Content-Type, Authorization&quot; always;\n\n    # Rate limiting\n    limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;\n    limit_req zone=api_limit burst=20 nodelay;\n\n    # Proxy to ledger service\n    location / {\n        proxy_pass http://localhost:8080;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection &#39;upgrade&#39;;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_cache_bypass $http_upgrade;\n\n        # Timeouts\n        proxy_connect_timeout 30s;\n        proxy_send_timeout 30s;\n        proxy_read_timeout 30s;\n    }\n\n    # Health check endpoint (no rate limiting)\n    location /health {\n        proxy_pass http://localhost:8080/health;\n        access_log off;\n    }\n}\n</code></pre><p>Enable and test:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Enable site</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> ln</span><span style=\"color:#79B8FF\"> -s</span><span style=\"color:#9ECBFF\"> /etc/nginx/sites-available/blockchain.yourdomain.com</span><span style=\"color:#9ECBFF\"> /etc/nginx/sites-enabled/</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Test configuration</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> nginx</span><span style=\"color:#79B8FF\"> -t</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Reload nginx</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> systemctl</span><span style=\"color:#9ECBFF\"> reload</span><span style=\"color:#9ECBFF\"> nginx</span></span></code></pre>\n</code></pre><h3 id=\"ssl-certificate-lets-encrypt\">SSL Certificate (Let&#39;s Encrypt)</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Install certbot</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> apt</span><span style=\"color:#9ECBFF\"> update</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> apt</span><span style=\"color:#9ECBFF\"> install</span><span style=\"color:#9ECBFF\"> certbot</span><span style=\"color:#9ECBFF\"> python3-certbot-nginx</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Get certificate</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> certbot</span><span style=\"color:#79B8FF\"> --nginx</span><span style=\"color:#79B8FF\"> -d</span><span style=\"color:#9ECBFF\"> blockchain.yourdomain.com</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Auto-renewal is enabled by default</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Test renewal</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> certbot</span><span style=\"color:#9ECBFF\"> renew</span><span style=\"color:#79B8FF\"> --dry-run</span></span></code></pre>\n</code></pre><h2 id=\"monitoring--maintenance\">Monitoring &amp; Maintenance</h2>\n<h3 id=\"view-logs\">View Logs</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># All services</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker-compose</span><span style=\"color:#79B8FF\"> -f</span><span style=\"color:#9ECBFF\"> docker-compose.prod.yml</span><span style=\"color:#9ECBFF\"> logs</span><span style=\"color:#79B8FF\"> -f</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Specific service</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker-compose</span><span style=\"color:#79B8FF\"> -f</span><span style=\"color:#9ECBFF\"> docker-compose.prod.yml</span><span style=\"color:#9ECBFF\"> logs</span><span style=\"color:#79B8FF\"> -f</span><span style=\"color:#9ECBFF\"> tana-ledger</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Last 100 lines</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker-compose</span><span style=\"color:#79B8FF\"> -f</span><span style=\"color:#9ECBFF\"> docker-compose.prod.yml</span><span style=\"color:#9ECBFF\"> logs</span><span style=\"color:#79B8FF\"> --tail=100</span><span style=\"color:#9ECBFF\"> tana-ledger</span></span></code></pre>\n</code></pre><h3 id=\"database-backups\">Database Backups</h3>\n<p>Create a backup script <code>/usr/local/bin/backup-tana.sh</code>:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">#!/bin/bash</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">BACKUP_DIR</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">\"/var/backups/tana\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">TIMESTAMP</span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\">$(</span><span style=\"color:#B392F0\">date</span><span style=\"color:#9ECBFF\"> +%Y%m%d_%H%M%S</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">mkdir</span><span style=\"color:#79B8FF\"> -p</span><span style=\"color:#E1E4E8\"> $BACKUP_DIR</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Backup database</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker-compose</span><span style=\"color:#79B8FF\"> -f</span><span style=\"color:#9ECBFF\"> /path/to/tana/docker-compose.prod.yml</span><span style=\"color:#9ECBFF\"> exec</span><span style=\"color:#79B8FF\"> -T</span><span style=\"color:#9ECBFF\"> postgres</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  pg_dump</span><span style=\"color:#79B8FF\"> -U</span><span style=\"color:#9ECBFF\"> tana</span><span style=\"color:#9ECBFF\"> tana</span><span style=\"color:#F97583\"> |</span><span style=\"color:#B392F0\"> gzip</span><span style=\"color:#F97583\"> ></span><span style=\"color:#9ECBFF\"> \"</span><span style=\"color:#E1E4E8\">$BACKUP_DIR</span><span style=\"color:#9ECBFF\">/tana_</span><span style=\"color:#E1E4E8\">$TIMESTAMP</span><span style=\"color:#9ECBFF\">.sql.gz\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Keep only last 7 days</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">find</span><span style=\"color:#E1E4E8\"> $BACKUP_DIR </span><span style=\"color:#79B8FF\">-name</span><span style=\"color:#9ECBFF\"> \"tana_*.sql.gz\"</span><span style=\"color:#79B8FF\"> -mtime</span><span style=\"color:#9ECBFF\"> +7</span><span style=\"color:#79B8FF\"> -delete</span></span></code></pre>\n</code></pre><p>Add to crontab:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Daily backup at 2 AM</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">0</span><span style=\"color:#79B8FF\"> 2</span><span style=\"color:#79B8FF\"> *</span><span style=\"color:#79B8FF\"> *</span><span style=\"color:#79B8FF\"> *</span><span style=\"color:#9ECBFF\"> /usr/local/bin/backup-tana.sh</span></span></code></pre>\n</code></pre><h3 id=\"health-monitoring\">Health Monitoring</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Check service health</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> https://blockchain.yourdomain.com/health</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Monitor container stats</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker</span><span style=\"color:#9ECBFF\"> stats</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Check service status</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker-compose</span><span style=\"color:#79B8FF\"> -f</span><span style=\"color:#9ECBFF\"> docker-compose.prod.yml</span><span style=\"color:#9ECBFF\"> ps</span></span></code></pre>\n</code></pre><h3 id=\"updates--upgrades\">Updates &amp; Upgrades</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Pull latest code</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">git</span><span style=\"color:#9ECBFF\"> pull</span><span style=\"color:#9ECBFF\"> origin</span><span style=\"color:#9ECBFF\"> main</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Rebuild images</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker-compose</span><span style=\"color:#79B8FF\"> -f</span><span style=\"color:#9ECBFF\"> docker-compose.prod.yml</span><span style=\"color:#9ECBFF\"> build</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Run database migrations</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">cd</span><span style=\"color:#9ECBFF\"> ledger</span><span style=\"color:#E1E4E8\"> &#x26;&#x26; </span><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> db:migrate</span><span style=\"color:#E1E4E8\"> &#x26;&#x26; </span><span style=\"color:#79B8FF\">cd</span><span style=\"color:#9ECBFF\"> ..</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Restart services (zero downtime)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker-compose</span><span style=\"color:#79B8FF\"> -f</span><span style=\"color:#9ECBFF\"> docker-compose.prod.yml</span><span style=\"color:#9ECBFF\"> up</span><span style=\"color:#79B8FF\"> -d</span><span style=\"color:#79B8FF\"> --no-deps</span><span style=\"color:#79B8FF\"> --build</span><span style=\"color:#9ECBFF\"> tana-ledger</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker-compose</span><span style=\"color:#79B8FF\"> -f</span><span style=\"color:#9ECBFF\"> docker-compose.prod.yml</span><span style=\"color:#9ECBFF\"> up</span><span style=\"color:#79B8FF\"> -d</span><span style=\"color:#79B8FF\"> --no-deps</span><span style=\"color:#79B8FF\"> --build</span><span style=\"color:#9ECBFF\"> tana-edge</span></span></code></pre>\n</code></pre><h2 id=\"security-checklist\">Security Checklist</h2>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> Strong PostgreSQL password set</li>\n<li><input disabled=\"\" type=\"checkbox\"> SSL certificates installed and valid</li>\n<li><input disabled=\"\" type=\"checkbox\"> Firewall configured (UFW or iptables)</li>\n<li><input disabled=\"\" type=\"checkbox\"> Rate limiting enabled in Nginx</li>\n<li><input disabled=\"\" type=\"checkbox\"> Services running as non-root user</li>\n<li><input disabled=\"\" type=\"checkbox\"> Database not exposed to public internet</li>\n<li><input disabled=\"\" type=\"checkbox\"> Redis not exposed to public internet</li>\n<li><input disabled=\"\" type=\"checkbox\"> CORS properly configured</li>\n<li><input disabled=\"\" type=\"checkbox\"> Security headers enabled</li>\n<li><input disabled=\"\" type=\"checkbox\"> Regular backups configured</li>\n<li><input disabled=\"\" type=\"checkbox\"> Monitoring and alerting set up</li>\n<li><input disabled=\"\" type=\"checkbox\"> Secrets stored securely (not in git)</li>\n<li><input disabled=\"\" type=\"checkbox\"> <code>TANA_LEDGER_URL</code> environment variable set correctly</li>\n</ul>\n<h2 id=\"troubleshooting\">Troubleshooting</h2>\n<h3 id=\"service-wont-start\">Service Won&#39;t Start</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Check logs</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker-compose</span><span style=\"color:#79B8FF\"> -f</span><span style=\"color:#9ECBFF\"> docker-compose.prod.yml</span><span style=\"color:#9ECBFF\"> logs</span><span style=\"color:#9ECBFF\"> tana-ledger</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Check container status</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker-compose</span><span style=\"color:#79B8FF\"> -f</span><span style=\"color:#9ECBFF\"> docker-compose.prod.yml</span><span style=\"color:#9ECBFF\"> ps</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Restart specific service</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker-compose</span><span style=\"color:#79B8FF\"> -f</span><span style=\"color:#9ECBFF\"> docker-compose.prod.yml</span><span style=\"color:#9ECBFF\"> restart</span><span style=\"color:#9ECBFF\"> tana-ledger</span></span></code></pre>\n</code></pre><h3 id=\"database-connection-issues\">Database Connection Issues</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Check postgres is running</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker-compose</span><span style=\"color:#79B8FF\"> -f</span><span style=\"color:#9ECBFF\"> docker-compose.prod.yml</span><span style=\"color:#9ECBFF\"> ps</span><span style=\"color:#9ECBFF\"> postgres</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Test connection manually</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker-compose</span><span style=\"color:#79B8FF\"> -f</span><span style=\"color:#9ECBFF\"> docker-compose.prod.yml</span><span style=\"color:#9ECBFF\"> exec</span><span style=\"color:#9ECBFF\"> postgres</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  psql</span><span style=\"color:#79B8FF\"> -U</span><span style=\"color:#9ECBFF\"> tana</span><span style=\"color:#79B8FF\"> -d</span><span style=\"color:#9ECBFF\"> tana</span><span style=\"color:#79B8FF\"> -c</span><span style=\"color:#9ECBFF\"> \"SELECT version();\"</span></span></code></pre>\n</code></pre><h3 id=\"high-memory-usage\">High Memory Usage</h3>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Check resource usage</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker</span><span style=\"color:#9ECBFF\"> stats</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Adjust resource limits in docker-compose.prod.yml</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">services:</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  tana-ledger:</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">    deploy:</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">      resources:</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        limits:</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">          memory:</span><span style=\"color:#9ECBFF\"> 512M</span></span></code></pre>\n</code></pre><h3 id=\"cors-errors\">CORS Errors</h3>\n<p>Check <code>ALLOWED_ORIGINS</code> in <code>.env.production</code> includes all necessary domains:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">ALLOWED_ORIGINS</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">https://yourdomain.com,https://blockchain.yourdomain.com</span></span></code></pre>\n</code></pre><h2 id=\"performance-tuning\">Performance Tuning</h2>\n<h3 id=\"postgresql-optimization\">PostgreSQL Optimization</h3>\n<p>Edit <code>docker-compose.prod.yml</code> to add PostgreSQL performance settings:</p>\n<pre><code class=\"language-yaml\">postgres:\n  command: &gt;\n    postgres\n    -c shared_buffers=256MB\n    -c effective_cache_size=1GB\n    -c maintenance_work_mem=128MB\n    -c checkpoint_completion_target=0.9\n    -c wal_buffers=16MB\n    -c default_statistics_target=100\n    -c random_page_cost=1.1\n    -c effective_io_concurrency=200\n    -c work_mem=16MB\n    -c min_wal_size=1GB\n    -c max_wal_size=4GB\n</code></pre><h2 id=\"cost-estimation\">Cost Estimation</h2>\n<h3 id=\"minimum-setup-2-core-vps\">Minimum Setup (2 core VPS)</h3>\n<ul>\n<li><strong>DigitalOcean:</strong> $12-24/month</li>\n<li><strong>Hetzner:</strong> €5-15/month</li>\n<li><strong>Linode:</strong> $12-24/month</li>\n</ul>\n<h3 id=\"recommended-setup-4-core-vps\">Recommended Setup (4 core VPS)</h3>\n<ul>\n<li><strong>DigitalOcean:</strong> $48/month</li>\n<li><strong>Hetzner:</strong> €20/month</li>\n<li><strong>AWS Lightsail:</strong> $40/month</li>\n</ul>\n<h3 id=\"additional-costs\">Additional Costs</h3>\n<ul>\n<li>Domain: $10-20/year</li>\n<li>Backups: $5-10/month (optional)</li>\n<li>Monitoring: Free (self-hosted) or $20/month</li>\n</ul>\n<h2 id=\"next-steps\">Next Steps</h2>\n<p>After successful deployment:</p>\n<ol>\n<li>Monitor logs for the first 24 hours</li>\n<li>Set up automated backups</li>\n<li>Configure uptime monitoring</li>\n<li>Test all API endpoints from your application</li>\n<li>Review and optimize performance</li>\n</ol>\n<h2 id=\"related-documentation\">Related Documentation</h2>\n<ul>\n<li><a href=\"/contributing/env-vars/\">Environment Variables</a> - Configuration options</li>\n<li><a href=\"/tana-api/intro/\">API Reference</a> - Ledger API endpoints</li>\n<li><a href=\"/tana-edge/intro/\">Edge Server</a> - Edge server documentation</li>\n<li><a href=\"/contributing/setup/\">Development Setup</a> - Local development guide</li>\n</ul>\n"
  },
  {
    "slug": [
      "guides",
      "quickstart"
    ],
    "metadata": {
      "title": "Quick Start",
      "description": "Deploy your first tana smart contract in 5 minutes"
    },
    "content": "\n# Quick Start\n\nThis guide will help you deploy your first tana smart contract in just a few minutes.\n\n## Prerequisites\n\nBefore you begin, make sure you have:\n\n- Node.js 18+ installed\n- Bun runtime installed\n- A terminal/command line\n\n## Installation\n\nInstall the tana CLI globally:\n\n```bash\nnpm install -g @tana/cli\n```\n\nVerify the installation:\n\n```bash\ntana --version\n```\n\n## Create Your First Contract\n\nCreate a new file called `hello.ts`:\n\n```typescript\n// hello.ts\nexport async function contract() {\n  const caller = context.caller()\n  return {\n    message: `Hello, ${caller.username}!`,\n    timestamp: Date.now()\n  }\n}\n\nexport async function get(req: Request) {\n  return {\n    message: \"Hello from HTTP GET!\"\n  }\n}\n```\n\n## Deploy the Contract\n\nDeploy your contract to the blockchain:\n\n```bash\ntana deploy contract hello.ts\n```\n\nYou'll see output like:\n\n```\n✓ Contract deployed successfully\n  Contract ID: ctr_abc123\n  Owner: usr_youruser\n  Block: 42\n```\n\n## Test Your Contract\n\nCall your contract:\n\n```bash\ntana call ctr_abc123\n```\n\nOutput:\n\n```json\n{\n  \"message\": \"Hello, youruser!\",\n  \"timestamp\": 1699564800000\n}\n```\n\n## Next Steps\n\nNow that you've deployed your first contract, learn more:\n\n- [Smart Contract Guide](/docs/guides/smart-contracts) - Learn the 4-function structure\n- [CLI Commands](/docs/cli/commands) - Explore all CLI commands\n- [API Reference](/docs/api/contracts) - Use the REST API\n\n## Common Issues\n\n### \"Command not found: tana\"\n\nMake sure you installed the CLI globally with the `-g` flag:\n\n```bash\nnpm install -g @tana/cli\n```\n\n### \"No blockchain running\"\n\nStart the ledger service:\n\n```bash\ntana start\n```\n\nThis starts all required services on your local machine.\n",
    "html": "<h1 id=\"quick-start\">Quick Start</h1>\n<p>This guide will help you deploy your first tana smart contract in just a few minutes.</p>\n<h2 id=\"prerequisites\">Prerequisites</h2>\n<p>Before you begin, make sure you have:</p>\n<ul>\n<li>Node.js 18+ installed</li>\n<li>Bun runtime installed</li>\n<li>A terminal/command line</li>\n</ul>\n<h2 id=\"installation\">Installation</h2>\n<p>Install the tana CLI globally:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> install</span><span style=\"color:#79B8FF\"> -g</span><span style=\"color:#9ECBFF\"> @tana/cli</span></span></code></pre>\n</code></pre><p>Verify the installation:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#79B8FF\"> --version</span></span></code></pre>\n</code></pre><h2 id=\"create-your-first-contract\">Create Your First Contract</h2>\n<p>Create a new file called <code>hello.ts</code>:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// hello.ts</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> contract</span><span style=\"color:#E1E4E8\">() {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> caller</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> context.</span><span style=\"color:#B392F0\">caller</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    message: </span><span style=\"color:#9ECBFF\">`Hello, ${</span><span style=\"color:#E1E4E8\">caller</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">username</span><span style=\"color:#9ECBFF\">}!`</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    timestamp: Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Request</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    message: </span><span style=\"color:#9ECBFF\">\"Hello from HTTP GET!\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h2 id=\"deploy-the-contract\">Deploy the Contract</h2>\n<p>Deploy your contract to the blockchain:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> deploy</span><span style=\"color:#9ECBFF\"> contract</span><span style=\"color:#9ECBFF\"> hello.ts</span></span></code></pre>\n</code></pre><p>You&#39;ll see output like:</p>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>✓ Contract deployed successfully</span></span>\n<span class=\"line\"><span>  Contract ID: ctr_abc123</span></span>\n<span class=\"line\"><span>  Owner: usr_youruser</span></span>\n<span class=\"line\"><span>  Block: 42</span></span></code></pre>\n</code></pre><h2 id=\"test-your-contract\">Test Your Contract</h2>\n<p>Call your contract:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> call</span><span style=\"color:#9ECBFF\"> ctr_abc123</span></span></code></pre>\n</code></pre><p>Output:</p>\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"message\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"Hello, youruser!\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"timestamp\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">1699564800000</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h2 id=\"next-steps\">Next Steps</h2>\n<p>Now that you&#39;ve deployed your first contract, learn more:</p>\n<ul>\n<li><a href=\"/docs/guides/smart-contracts\">Smart Contract Guide</a> - Learn the 4-function structure</li>\n<li><a href=\"/docs/cli/commands\">CLI Commands</a> - Explore all CLI commands</li>\n<li><a href=\"/docs/api/contracts\">API Reference</a> - Use the REST API</li>\n</ul>\n<h2 id=\"common-issues\">Common Issues</h2>\n<h3 id=\"command-not-found-tana\">&quot;Command not found: tana&quot;</h3>\n<p>Make sure you installed the CLI globally with the <code>-g</code> flag:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> install</span><span style=\"color:#79B8FF\"> -g</span><span style=\"color:#9ECBFF\"> @tana/cli</span></span></code></pre>\n</code></pre><h3 id=\"no-blockchain-running\">&quot;No blockchain running&quot;</h3>\n<p>Start the ledger service:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> start</span></span></code></pre>\n</code></pre><p>This starts all required services on your local machine.</p>\n"
  },
  {
    "slug": [
      "guides",
      "kv-storage"
    ],
    "metadata": {
      "title": "KV Storage",
      "description": "Fast key-value storage for smart contracts"
    },
    "content": "\nTana provides Cloudflare Workers-compatible KV storage for smart contracts. Each contract gets isolated storage with automatic namespacing.\n\n## Quick Start\n\n```typescript\nimport { kv } from 'tana/kv'\n\n// Store text\nawait kv.put('username', 'alice')\n\n// Retrieve text\nconst name = await kv.get('username')\nconsole.log(name) // \"alice\"\n\n// Store JSON\nawait kv.put('user', { name: 'alice', balance: 1000 })\n\n// Retrieve JSON\nconst user = await kv.get('user', { type: 'json' })\nconsole.log(user.balance) // 1000\n\n// Delete\nawait kv.delete('username')\n\n// List keys\nconst result = await kv.list()\nconsole.log(result.keys) // [{ name: \"user\" }]\n```\n\n## API Reference\n\n### `kv.get(key, options?)`\n\nRetrieve a value.\n\n**Parameters:**\n- `key` (string): Storage key\n- `options.type` ('text' | 'json'): Return type (default: 'text')\n\n**Returns:** `Promise<string | object | null>`\n\n```typescript\n// Get as text (default)\nconst text = await kv.get('message')\n\n// Get as JSON\nconst data = await kv.get('config', { type: 'json' })\n\n// Missing key returns null\nconst missing = await kv.get('nonexistent') // null\n```\n\n### `kv.put(key, value, options?)`\n\nStore a value. Objects are automatically JSON-serialized.\n\n**Parameters:**\n- `key` (string): Storage key (max 512 bytes)\n- `value` (string | object): Value to store (max 25 MB)\n- `options` (optional): Reserved for future features (TTL, metadata)\n\n**Returns:** `Promise<void>`\n\n```typescript\n// Store string\nawait kv.put('status', 'active')\n\n// Store object (auto-serialized)\nawait kv.put('user', { id: 1, name: 'alice' })\n```\n\n### `kv.delete(key)`\n\nDelete a key. No error if key doesn't exist.\n\n**Parameters:**\n- `key` (string): Key to delete\n\n**Returns:** `Promise<void>`\n\n```typescript\nawait kv.delete('session')\n```\n\n### `kv.list(options?)`\n\nList keys, optionally filtered by prefix.\n\n**Parameters:**\n- `options.prefix` (string): Filter by prefix\n- `options.limit` (number): Max keys to return (default: 1000)\n\n**Returns:** `Promise<{ keys: Array<{ name: string }>, list_complete: boolean, cursor: string | null }>`\n\n```typescript\n// List all keys\nconst all = await kv.list()\n\n// List with prefix\nconst users = await kv.list({ prefix: 'user:' })\n\n// Limit results\nconst first10 = await kv.list({ limit: 10 })\n```\n\n## Common Patterns\n\n### Counter\n\n```typescript\nconst current = await kv.get('counter', { type: 'json' })\nconst count = (current?.count || 0) + 1\nawait kv.put('counter', { count })\n```\n\n### Session Storage\n\n```typescript\n// Create session\nawait kv.put(`session:${sessionId}`, {\n  userId: 'alice',\n  createdAt: Date.now()\n})\n\n// Get session\nconst session = await kv.get(`session:${sessionId}`, { type: 'json' })\n\n// Delete session\nawait kv.delete(`session:${sessionId}`)\n```\n\n### Cache with Prefix\n\n```typescript\n// Store multiple items\nawait kv.put('cache:user:1', { name: 'alice' })\nawait kv.put('cache:user:2', { name: 'bob' })\nawait kv.put('cache:post:1', { title: 'Hello' })\n\n// List only cache:user: items\nconst users = await kv.list({ prefix: 'cache:user:' })\n// Result: [{ name: \"cache:user:1\" }, { name: \"cache:user:2\" }]\n```\n\n### User Preferences\n\n```typescript\nimport { context } from 'tana/context'\nimport { kv } from 'tana/kv'\n\nexport async function get() {\n  const caller = context.caller()\n  const prefs = await kv.get(`prefs:${caller}`, { type: 'json' })\n\n  return prefs || { theme: 'dark', notifications: true }\n}\n\nexport async function post(req) {\n  const caller = context.caller()\n  const prefs = req.body\n\n  await kv.put(`prefs:${caller}`, prefs)\n  return { success: true }\n}\n```\n\n## Limits & Constraints\n\n- **Key length:** 512 bytes max\n- **Value size:** 25 MB max\n- **Keys per list():** 1000 max (use prefix to narrow)\n- **Namespace:** Automatic per-contract isolation\n- **TTL:** Not yet supported (coming soon)\n- **Metadata:** Not yet supported (coming soon)\n\n## Storage Backends\n\nKV storage uses different backends depending on environment:\n\n| Environment | Backend | Notes |\n|-------------|---------|-------|\n| tana-runtime | PostgreSQL | Persistent across restarts |\n| tana-edge | In-memory | Fast but not persistent |\n| Playground | localStorage | Browser-based, persistent per-browser |\n\nAll backends provide identical API and behavior.\n\n## Best Practices\n\n✅ **Use prefixes** to organize related keys:\n```typescript\nawait kv.put('user:1:profile', data)\nawait kv.put('user:1:settings', data)\n```\n\n✅ **Check for null** when retrieving:\n```typescript\nconst data = await kv.get('key', { type: 'json' })\nif (!data) {\n  // Handle missing key\n}\n```\n\n✅ **Use type parameter** for JSON to get proper typing:\n```typescript\nconst user = await kv.get('user', { type: 'json' }) as User\n```\n\n❌ **Don't exceed limits:**\n```typescript\n// BAD: Key too long\nawait kv.put('x'.repeat(1000), 'value') // Error!\n\n// GOOD: Keep keys short\nawait kv.put('user:1', 'value')\n```\n\n❌ **Don't store sensitive data** without encryption:\n```typescript\n// BAD: Plain text password\nawait kv.put('password', 'secret123')\n\n// GOOD: Hash or encrypt first\nawait kv.put('password_hash', hashPassword('secret123'))\n```\n\n## Next Steps\n\n- See [Smart Contracts](/guides/smart-contracts) for full contract development guide\n- Check [examples/kv-demo.ts](https://github.com/yourusername/tana/blob/main/examples/kv-demo.ts) for complete examples\n- Read [KV Patterns](/guides/patterns/kv-patterns) for advanced techniques\n",
    "html": "<p>Tana provides Cloudflare Workers-compatible KV storage for smart contracts. Each contract gets isolated storage with automatic namespacing.</p>\n<h2 id=\"quick-start\">Quick Start</h2>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { kv } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/kv'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Store text</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'username'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'alice'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Retrieve text</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> name</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'username'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(name) </span><span style=\"color:#6A737D\">// \"alice\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Store JSON</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'user'</span><span style=\"color:#E1E4E8\">, { name: </span><span style=\"color:#9ECBFF\">'alice'</span><span style=\"color:#E1E4E8\">, balance: </span><span style=\"color:#79B8FF\">1000</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Retrieve JSON</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> user</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'user'</span><span style=\"color:#E1E4E8\">, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(user.balance) </span><span style=\"color:#6A737D\">// 1000</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Delete</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">delete</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'username'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// List keys</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> result</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">list</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(result.keys) </span><span style=\"color:#6A737D\">// [{ name: \"user\" }]</span></span></code></pre>\n</code></pre><h2 id=\"api-reference\">API Reference</h2>\n<h3 id=\"kvgetkey-options\"><code>kv.get(key, options?)</code></h3>\n<p>Retrieve a value.</p>\n<p><strong>Parameters:</strong></p>\n<ul>\n<li><code>key</code> (string): Storage key</li>\n<li><code>options.type</code> (&#39;text&#39; | &#39;json&#39;): Return type (default: &#39;text&#39;)</li>\n</ul>\n<p><strong>Returns:</strong> <code>Promise&lt;string | object | null&gt;</code></p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Get as text (default)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> text</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'message'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Get as JSON</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> data</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'config'</span><span style=\"color:#E1E4E8\">, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Missing key returns null</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> missing</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'nonexistent'</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#6A737D\">// null</span></span></code></pre>\n</code></pre><h3 id=\"kvputkey-value-options\"><code>kv.put(key, value, options?)</code></h3>\n<p>Store a value. Objects are automatically JSON-serialized.</p>\n<p><strong>Parameters:</strong></p>\n<ul>\n<li><code>key</code> (string): Storage key (max 512 bytes)</li>\n<li><code>value</code> (string | object): Value to store (max 25 MB)</li>\n<li><code>options</code> (optional): Reserved for future features (TTL, metadata)</li>\n</ul>\n<p><strong>Returns:</strong> <code>Promise&lt;void&gt;</code></p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Store string</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'status'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'active'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Store object (auto-serialized)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'user'</span><span style=\"color:#E1E4E8\">, { id: </span><span style=\"color:#79B8FF\">1</span><span style=\"color:#E1E4E8\">, name: </span><span style=\"color:#9ECBFF\">'alice'</span><span style=\"color:#E1E4E8\"> })</span></span></code></pre>\n</code></pre><h3 id=\"kvdeletekey\"><code>kv.delete(key)</code></h3>\n<p>Delete a key. No error if key doesn&#39;t exist.</p>\n<p><strong>Parameters:</strong></p>\n<ul>\n<li><code>key</code> (string): Key to delete</li>\n</ul>\n<p><strong>Returns:</strong> <code>Promise&lt;void&gt;</code></p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">delete</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'session'</span><span style=\"color:#E1E4E8\">)</span></span></code></pre>\n</code></pre><h3 id=\"kvlistoptions\"><code>kv.list(options?)</code></h3>\n<p>List keys, optionally filtered by prefix.</p>\n<p><strong>Parameters:</strong></p>\n<ul>\n<li><code>options.prefix</code> (string): Filter by prefix</li>\n<li><code>options.limit</code> (number): Max keys to return (default: 1000)</li>\n</ul>\n<p><strong>Returns:</strong> <code>Promise&lt;{ keys: Array&lt;{ name: string }&gt;, list_complete: boolean, cursor: string | null }&gt;</code></p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// List all keys</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> all</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">list</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// List with prefix</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> users</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">list</span><span style=\"color:#E1E4E8\">({ prefix: </span><span style=\"color:#9ECBFF\">'user:'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Limit results</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> first10</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">list</span><span style=\"color:#E1E4E8\">({ limit: </span><span style=\"color:#79B8FF\">10</span><span style=\"color:#E1E4E8\"> })</span></span></code></pre>\n</code></pre><h2 id=\"common-patterns\">Common Patterns</h2>\n<h3 id=\"counter\">Counter</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> current</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'counter'</span><span style=\"color:#E1E4E8\">, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> count</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> (current?.count </span><span style=\"color:#F97583\">||</span><span style=\"color:#79B8FF\"> 0</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">+</span><span style=\"color:#79B8FF\"> 1</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'counter'</span><span style=\"color:#E1E4E8\">, { count })</span></span></code></pre>\n</code></pre><h3 id=\"session-storage\">Session Storage</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Create session</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`session:${</span><span style=\"color:#E1E4E8\">sessionId</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  userId: </span><span style=\"color:#9ECBFF\">'alice'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  createdAt: Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">})</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Get session</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> session</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`session:${</span><span style=\"color:#E1E4E8\">sessionId</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Delete session</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">delete</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`session:${</span><span style=\"color:#E1E4E8\">sessionId</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">)</span></span></code></pre>\n</code></pre><h3 id=\"cache-with-prefix\">Cache with Prefix</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Store multiple items</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'cache:user:1'</span><span style=\"color:#E1E4E8\">, { name: </span><span style=\"color:#9ECBFF\">'alice'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'cache:user:2'</span><span style=\"color:#E1E4E8\">, { name: </span><span style=\"color:#9ECBFF\">'bob'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'cache:post:1'</span><span style=\"color:#E1E4E8\">, { title: </span><span style=\"color:#9ECBFF\">'Hello'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// List only cache:user: items</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> users</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">list</span><span style=\"color:#E1E4E8\">({ prefix: </span><span style=\"color:#9ECBFF\">'cache:user:'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Result: [{ name: \"cache:user:1\" }, { name: \"cache:user:2\" }]</span></span></code></pre>\n</code></pre><h3 id=\"user-preferences\">User Preferences</h3>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { context } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/context'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { kv } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/kv'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> get</span><span style=\"color:#E1E4E8\">() {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> caller</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> context.</span><span style=\"color:#B392F0\">caller</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> prefs</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`prefs:${</span><span style=\"color:#E1E4E8\">caller</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> prefs </span><span style=\"color:#F97583\">||</span><span style=\"color:#E1E4E8\"> { theme: </span><span style=\"color:#9ECBFF\">'dark'</span><span style=\"color:#E1E4E8\">, notifications: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> post</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> caller</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> context.</span><span style=\"color:#B392F0\">caller</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> prefs</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> req.body</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`prefs:${</span><span style=\"color:#E1E4E8\">caller</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, prefs)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> { success: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h2 id=\"limits--constraints\">Limits &amp; Constraints</h2>\n<ul>\n<li><strong>Key length:</strong> 512 bytes max</li>\n<li><strong>Value size:</strong> 25 MB max</li>\n<li><strong>Keys per list():</strong> 1000 max (use prefix to narrow)</li>\n<li><strong>Namespace:</strong> Automatic per-contract isolation</li>\n<li><strong>TTL:</strong> Not yet supported (coming soon)</li>\n<li><strong>Metadata:</strong> Not yet supported (coming soon)</li>\n</ul>\n<h2 id=\"storage-backends\">Storage Backends</h2>\n<p>KV storage uses different backends depending on environment:</p>\n<table>\n<thead>\n<tr>\n<th>Environment</th>\n<th>Backend</th>\n<th>Notes</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>tana-runtime</td>\n<td>PostgreSQL</td>\n<td>Persistent across restarts</td>\n</tr>\n<tr>\n<td>tana-edge</td>\n<td>In-memory</td>\n<td>Fast but not persistent</td>\n</tr>\n<tr>\n<td>Playground</td>\n<td>localStorage</td>\n<td>Browser-based, persistent per-browser</td>\n</tr>\n</tbody></table>\n<p>All backends provide identical API and behavior.</p>\n<h2 id=\"best-practices\">Best Practices</h2>\n<p>✅ <strong>Use prefixes</strong> to organize related keys:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'user:1:profile'</span><span style=\"color:#E1E4E8\">, data)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'user:1:settings'</span><span style=\"color:#E1E4E8\">, data)</span></span></code></pre>\n</code></pre><p>✅ <strong>Check for null</strong> when retrieving:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> data</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'key'</span><span style=\"color:#E1E4E8\">, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">data) {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Handle missing key</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p>✅ <strong>Use type parameter</strong> for JSON to get proper typing:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> user</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'user'</span><span style=\"color:#E1E4E8\">, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> }) </span><span style=\"color:#F97583\">as</span><span style=\"color:#B392F0\"> User</span></span></code></pre>\n</code></pre><p>❌ <strong>Don&#39;t exceed limits:</strong></p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// BAD: Key too long</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'x'</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">repeat</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">1000</span><span style=\"color:#E1E4E8\">), </span><span style=\"color:#9ECBFF\">'value'</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#6A737D\">// Error!</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// GOOD: Keep keys short</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'user:1'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'value'</span><span style=\"color:#E1E4E8\">)</span></span></code></pre>\n</code></pre><p>❌ <strong>Don&#39;t store sensitive data</strong> without encryption:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// BAD: Plain text password</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'password'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'secret123'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// GOOD: Hash or encrypt first</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'password_hash'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">hashPassword</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'secret123'</span><span style=\"color:#E1E4E8\">))</span></span></code></pre>\n</code></pre><h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li>See <a href=\"/guides/smart-contracts\">Smart Contracts</a> for full contract development guide</li>\n<li>Check <a href=\"https://github.com/yourusername/tana/blob/main/examples/kv-demo.ts\">examples/kv-demo.ts</a> for complete examples</li>\n<li>Read <a href=\"/guides/patterns/kv-patterns\">KV Patterns</a> for advanced techniques</li>\n</ul>\n"
  },
  {
    "slug": [
      "tana-cli",
      "intro"
    ],
    "metadata": {
      "title": "CLI Overview",
      "description": "Introduction to the Tana command-line interface",
      "sidebar": {
        "order": 1
      }
    },
    "content": "\nThe Tana CLI is your primary tool for managing blockchains, user accounts, and TypeScript smart contracts. It provides everything you need to create, deploy, and interact with the Tana blockchain.\n\n## Installation\n\n```bash\n# Clone repository\ngit clone https://github.com/conoda/tana.git\ncd tana\n\n# Install dependencies\nbun install\n\n# Build CLI (optional - for standalone binary)\ncd cli\nbun run make\n```\n\n## Usage\n\n```bash\n# Development (from project root)\nbun cli/main.ts <command> [options]\n\n# Or after building standalone binary\n./cli/dist/tana <command> [options]\n```\n\n## Quick Start\n\n```bash\n# 1. Start the ledger service\nbun cli/main.ts start\n\n# 2. Create a new user\nbun cli/main.ts new user @alice --name \"Alice Johnson\"\n\n# 3. Deploy the user to blockchain\nbun cli/main.ts deploy user @alice\n\n# 4. Check status\nbun cli/main.ts status\n```\n\n## Command Categories\n\nThe CLI is organized into logical groups:\n\n- **Service Management** - Start, stop, and monitor the ledger service\n- **Creation** - Create chains, users, nodes, and contracts\n- **Deployment** - Deploy users and contracts to the blockchain\n- **Blockchain Operations** - Run contracts, check balances, transfer funds\n- **System** - Validate configuration and requirements\n\nSee the [Commands](/tana-cli/commands/) reference for detailed documentation of all available commands.\n\n## Configuration\n\nTana stores its configuration in `~/.config/tana/`:\n\n```\n~/.config/tana/\n├── config.json              # Global settings (default chain, user)\n├── chains/\n│   └── *.json              # Chain configurations\n├── users/\n│   └── *.json              # User credentials and keys\n└── nodes/\n    └── *.json              # Node configurations\n```\n\n**Environment Variables:**\n\n```bash\nDATABASE_URL='postgres://tana:[PASSWORD]@localhost:5432/tana'\nLEDGER_PORT=8080\nNODE_ENV=development\n```\n\n## Next Steps\n\n- **[Commands Reference](/tana-cli/commands/)** - Complete command documentation\n- **[API Reference](/tana-api/intro/)** - REST API endpoints\n- **[Quick Start Guide](/guides/quickstart/)** - Get up and running\n- **[System Architecture](/guides/architecture/)** - Understand how Tana works\n",
    "html": "<p>The Tana CLI is your primary tool for managing blockchains, user accounts, and TypeScript smart contracts. It provides everything you need to create, deploy, and interact with the Tana blockchain.</p>\n<h2 id=\"installation\">Installation</h2>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Clone repository</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">git</span><span style=\"color:#9ECBFF\"> clone</span><span style=\"color:#9ECBFF\"> https://github.com/conoda/tana.git</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">cd</span><span style=\"color:#9ECBFF\"> tana</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Install dependencies</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> install</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Build CLI (optional - for standalone binary)</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">cd</span><span style=\"color:#9ECBFF\"> cli</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> make</span></span></code></pre>\n</code></pre><h2 id=\"usage\">Usage</h2>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Development (from project root)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> cli/main.ts</span><span style=\"color:#F97583\"> &#x3C;</span><span style=\"color:#9ECBFF\">comman</span><span style=\"color:#E1E4E8\">d</span><span style=\"color:#F97583\">></span><span style=\"color:#E1E4E8\"> [options]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Or after building standalone binary</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">./cli/dist/tana</span><span style=\"color:#F97583\"> &#x3C;</span><span style=\"color:#9ECBFF\">comman</span><span style=\"color:#E1E4E8\">d</span><span style=\"color:#F97583\">></span><span style=\"color:#E1E4E8\"> [options]</span></span></code></pre>\n</code></pre><h2 id=\"quick-start\">Quick Start</h2>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># 1. Start the ledger service</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> cli/main.ts</span><span style=\"color:#9ECBFF\"> start</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># 2. Create a new user</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> cli/main.ts</span><span style=\"color:#9ECBFF\"> new</span><span style=\"color:#9ECBFF\"> user</span><span style=\"color:#9ECBFF\"> @alice</span><span style=\"color:#79B8FF\"> --name</span><span style=\"color:#9ECBFF\"> \"Alice Johnson\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># 3. Deploy the user to blockchain</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> cli/main.ts</span><span style=\"color:#9ECBFF\"> deploy</span><span style=\"color:#9ECBFF\"> user</span><span style=\"color:#9ECBFF\"> @alice</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># 4. Check status</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bun</span><span style=\"color:#9ECBFF\"> cli/main.ts</span><span style=\"color:#9ECBFF\"> status</span></span></code></pre>\n</code></pre><h2 id=\"command-categories\">Command Categories</h2>\n<p>The CLI is organized into logical groups:</p>\n<ul>\n<li><strong>Service Management</strong> - Start, stop, and monitor the ledger service</li>\n<li><strong>Creation</strong> - Create chains, users, nodes, and contracts</li>\n<li><strong>Deployment</strong> - Deploy users and contracts to the blockchain</li>\n<li><strong>Blockchain Operations</strong> - Run contracts, check balances, transfer funds</li>\n<li><strong>System</strong> - Validate configuration and requirements</li>\n</ul>\n<p>See the <a href=\"/tana-cli/commands/\">Commands</a> reference for detailed documentation of all available commands.</p>\n<h2 id=\"configuration\">Configuration</h2>\n<p>Tana stores its configuration in <code>~/.config/tana/</code>:</p>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>~/.config/tana/</span></span>\n<span class=\"line\"><span>├── config.json              # Global settings (default chain, user)</span></span>\n<span class=\"line\"><span>├── chains/</span></span>\n<span class=\"line\"><span>│   └── *.json              # Chain configurations</span></span>\n<span class=\"line\"><span>├── users/</span></span>\n<span class=\"line\"><span>│   └── *.json              # User credentials and keys</span></span>\n<span class=\"line\"><span>└── nodes/</span></span>\n<span class=\"line\"><span>    └── *.json              # Node configurations</span></span></code></pre>\n</code></pre><p><strong>Environment Variables:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">DATABASE_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">'postgres://tana:[PASSWORD]@localhost:5432/tana'</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">LEDGER_PORT</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">8080</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">NODE_ENV</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">development</span></span></code></pre>\n</code></pre><h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li><strong><a href=\"/tana-cli/commands/\">Commands Reference</a></strong> - Complete command documentation</li>\n<li><strong><a href=\"/tana-api/intro/\">API Reference</a></strong> - REST API endpoints</li>\n<li><strong><a href=\"/guides/quickstart/\">Quick Start Guide</a></strong> - Get up and running</li>\n<li><strong><a href=\"/guides/architecture/\">System Architecture</a></strong> - Understand how Tana works</li>\n</ul>\n"
  },
  {
    "slug": [
      "tana-cli",
      "commands"
    ],
    "metadata": {
      "title": "Commands",
      "description": "Complete reference for all Tana CLI commands",
      "sidebar": {
        "order": 2
      }
    },
    "content": "\nComplete reference for the Tana command-line interface.\n\n## Service Management\n\n### start\n\nStart the ledger service.\n\n```bash\ntana start\n```\n\n**Options:**\n- `-c, --chain <name>` - Specific chain to start (default: local)\n\n**Examples:**\n\n```bash\ntana start\n```\n\n```bash\ntana start --chain my-chain\n```\n\n**Output:**\n```\n🚀 Starting Tana...\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nStarting Ledger Service...\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n✓ Ledger service started\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nService Running:\n  URL:     http://localhost:8080\n  Chain:   local\n  PID:     12345\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\nPress Ctrl+C to stop\n```\n\n### stop\n\nStop all running services.\n\n```bash\ntana stop\n```\n\n**Output:**\n```\nStopping services...\n✓ Ledger service stopped\n```\n\n### status\n\nShow status of running services and chains.\n\n```bash\ntana status\n```\n\n**Output:**\n```\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTana Status\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\nServices:\n  ✓ Ledger running on http://localhost:8080\n\nChains:\n  • local (default)\n    Genesis: 0x1a2b3c...\n\nUsers:\n  • @alice (Alice Johnson)\n  • @bob (Bob Smith)\n\nDefault Chain: local\nDefault User: @alice\n```\n\n## Creation\n\n### new chain\n\nCreate a new blockchain (you become the genesis leader).\n\n```bash\ntana new chain <name>\n```\n\n**Arguments:**\n- `<name>` - Chain name\n\n**Examples:**\n\n```bash\ntana new chain my-chain\n```\n\n```bash\ntana new chain testnet\n```\n\n**Output:**\n```\nCreating new blockchain: my-chain\n\n✓ Genesis block created\n✓ Chain config saved to ~/.config/tana/chains/my-chain.json\n✓ Set as default chain\n\nChain ID: my-chain\nGenesis Hash: 0x1a2b3c4d5e6f7890...\n```\n\n### new node\n\nCreate a new node to join an existing chain.\n\n```bash\ntana new node\n```\n\n**Options:**\n- `--connect <url>` - Chain URL to connect to\n\n**Examples:**\n```bash\ntana new node --connect https://chain.example.com\n```\n\n**Output:**\n```\nConnecting to chain at https://chain.example.com...\n\n✓ Chain validated\n✓ Node config saved to ~/.config/tana/nodes/node-xyz.json\n\nNode ID: node-xyz\nChain: mainnet\nReady to start syncing\n```\n\n### new user\n\nCreate a new user account locally.\n\n```bash\ntana new user <username>\n```\n\n**Arguments:**\n- `<username>` - Username (must start with @)\n\n**Options:**\n- `-n, --name <name>` - Display name\n- `-b, --bio <bio>` - User bio\n\n**Examples:**\n\n```bash\ntana new user @alice --name \"Alice Johnson\"\n```\n\n```bash\ntana new user @bob --name \"Bob Smith\" --bio \"Developer\"\n```\n\n**Output:**\n```\nCreating user: @alice\n\n✓ Keypair generated\n✓ User config saved to ~/.config/tana/users/@alice.json\n\nUsername: @alice\nDisplay Name: Alice Johnson\nPublic Key: ed25519_abc123...\n\n⚠ User created locally. Run 'tana deploy user @alice' to add to blockchain.\n```\n\n### new contract\n\nScaffold a new smart contract.\n\n```bash\ntana new contract [name]\n```\n\n**Arguments:**\n- `[name]` - Contract name (optional)\n\n**Examples:**\n\n```bash\ntana new contract\n```\n\n```bash\ntana new contract token-transfer\n```\n\n**Output:**\n```\nCreating smart contract...\n\n✓ Created contract.ts\n✓ Created contract.json\n\nContract template includes:\n  • tana:core (console, version)\n  • tana:data (key-value storage)\n  • tana:block (blockchain queries)\n  • tana:tx (transaction staging)\n```\n\n## Deployment\n\n### deploy user\n\nDeploy user account to blockchain.\n\n```bash\ntana deploy user <username>\n```\n\n**Arguments:**\n- `<username>` - Username to deploy\n\n**Options:**\n- `-t, --target <url>` - Target chain URL\n\n**Examples:**\n\n```bash\ntana deploy user @alice\n```\n\n```bash\ntana deploy user @alice --target https://chain.example.com\n```\n\n**Output:**\n```\nDeploying user @alice to blockchain...\n\n✓ Transaction created\n✓ Transaction submitted\n⏳ Waiting for block confirmation...\n✓ User deployed successfully\n\nUser ID: usr_1a2b3c4d5e6f\nTransaction ID: tx_7g8h9i0j1k2l\nBlock: #42\n```\n\n### deploy contract\n\nDeploy smart contract to blockchain.\n\n```bash\ntana deploy contract <path>\n```\n\n**Arguments:**\n- `<path>` - Path to contract file\n\n**Options:**\n- `-t, --target <url>` - Target chain URL\n\n**Examples:**\n\n```bash\ntana deploy contract ./contract.ts\n```\n\n```bash\ntana deploy contract ./token.ts --target https://chain.example.com\n```\n\n**Output:**\n```\nDeploying contract: ./contract.ts\n\n✓ Contract validated\n✓ Transaction created\n✓ Transaction submitted\n⏳ Waiting for block confirmation...\n✓ Contract deployed successfully\n\nContract ID: cnt_xyz789\nTransaction ID: tx_abc123\nBlock: #43\nContract Address: @alice/token-transfer\n```\n\n## Blockchain Operations\n\n### run\n\nTest run a contract locally.\n\n```bash\ntana run <contract>\n```\n\n**Arguments:**\n- `<contract>` - Path to contract file\n\n**Examples:**\n\n```bash\ntana run examples/alice-to-bob.ts\n```\n\n```bash\ntana run ./my-contract.ts\n```\n\n**Output:**\n```\nRunning contract: examples/alice-to-bob.ts\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nContract Output:\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\nTransferring 100 USD from @alice to @bob\n✓ Balance checked\n✓ Transaction staged\n✓ Transfer complete\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nExecution Summary:\n  Status: Success\n  Runtime: 45ms\n  Gas Used: 0.002\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n```\n\n### balance\n\nCheck user balance.\n\n```bash\ntana balance <user>\n```\n\n**Arguments:**\n- `<user>` - Username or user ID\n\n**Options:**\n- `-c, --currency <code>` - Currency code (default: USD)\n\n**Examples:**\n\n```bash\ntana balance @alice\n```\n\n```bash\ntana balance @alice --currency ETH\n```\n\n**Output:**\n```\nBalances for @alice:\n\n  USD    1,000.50\n  ETH    2.5\n  BTC    0.01\n\nTotal currencies: 3\n```\n\n### transfer\n\nTransfer funds between users.\n\n```bash\ntana transfer <from> <to> <amount> <currency>\n```\n\n**Arguments:**\n- `<from>` - Sender username\n- `<to>` - Recipient username\n- `<amount>` - Amount to transfer\n- `<currency>` - Currency code\n\n**Examples:**\n\n```bash\ntana transfer @alice @bob 100 USD\n```\n\n```bash\ntana transfer @alice @bob 0.5 ETH\n```\n\n**Output:**\n```\nTransferring 100 USD from @alice to @bob...\n\n✓ Balance verified\n✓ Transaction created\n✓ Transaction submitted\n⏳ Waiting for block confirmation...\n✓ Transfer complete\n\nTransaction ID: tx_1a2b3c4d\nBlock: #44\nNew Balances:\n  @alice: 900.50 USD\n  @bob: 100.00 USD\n```\n\n## System\n\n### check\n\nValidate system requirements and configuration.\n\n```bash\ntana check\n```\n\n**Output:**\n```\nChecking system requirements...\n\n✓ Bun installed (v1.0.25)\n✓ PostgreSQL running (v15.3)\n✓ Database connected\n✓ Rust toolchain available (v1.75.0)\n✓ Configuration valid\n\nSystem ready for Tana\n```\n\n## Global Options\n\nAll commands support these options:\n\n- `--help` - Show help for a command\n- `--version` - Show version information\n",
    "html": "<p>Complete reference for the Tana command-line interface.</p>\n<h2 id=\"service-management\">Service Management</h2>\n<h3 id=\"start\">start</h3>\n<p>Start the ledger service.</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> start</span></span></code></pre>\n</code></pre><p><strong>Options:</strong></p>\n<ul>\n<li><code>-c, --chain &lt;name&gt;</code> - Specific chain to start (default: local)</li>\n</ul>\n<p><strong>Examples:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> start</span></span></code></pre>\n</code></pre><pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> start</span><span style=\"color:#79B8FF\"> --chain</span><span style=\"color:#9ECBFF\"> my-chain</span></span></code></pre>\n</code></pre><p><strong>Output:</strong></p>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>🚀 Starting Tana...</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span></span>\n<span class=\"line\"><span>Starting Ledger Service...</span></span>\n<span class=\"line\"><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>✓ Ledger service started</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span></span>\n<span class=\"line\"><span>Service Running:</span></span>\n<span class=\"line\"><span>  URL:     http://localhost:8080</span></span>\n<span class=\"line\"><span>  Chain:   local</span></span>\n<span class=\"line\"><span>  PID:     12345</span></span>\n<span class=\"line\"><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>Press Ctrl+C to stop</span></span></code></pre>\n</code></pre><h3 id=\"stop\">stop</h3>\n<p>Stop all running services.</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> stop</span></span></code></pre>\n</code></pre><p><strong>Output:</strong></p>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Stopping services...</span></span>\n<span class=\"line\"><span>✓ Ledger service stopped</span></span></code></pre>\n</code></pre><h3 id=\"status\">status</h3>\n<p>Show status of running services and chains.</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> status</span></span></code></pre>\n</code></pre><p><strong>Output:</strong></p>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span></span>\n<span class=\"line\"><span>Tana Status</span></span>\n<span class=\"line\"><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>Services:</span></span>\n<span class=\"line\"><span>  ✓ Ledger running on http://localhost:8080</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>Chains:</span></span>\n<span class=\"line\"><span>  • local (default)</span></span>\n<span class=\"line\"><span>    Genesis: 0x1a2b3c...</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>Users:</span></span>\n<span class=\"line\"><span>  • @alice (Alice Johnson)</span></span>\n<span class=\"line\"><span>  • @bob (Bob Smith)</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>Default Chain: local</span></span>\n<span class=\"line\"><span>Default User: @alice</span></span></code></pre>\n</code></pre><h2 id=\"creation\">Creation</h2>\n<h3 id=\"new-chain\">new chain</h3>\n<p>Create a new blockchain (you become the genesis leader).</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> new</span><span style=\"color:#9ECBFF\"> chain</span><span style=\"color:#F97583\"> &#x3C;</span><span style=\"color:#9ECBFF\">nam</span><span style=\"color:#E1E4E8\">e</span><span style=\"color:#F97583\">></span></span></code></pre>\n</code></pre><p><strong>Arguments:</strong></p>\n<ul>\n<li><code>&lt;name&gt;</code> - Chain name</li>\n</ul>\n<p><strong>Examples:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> new</span><span style=\"color:#9ECBFF\"> chain</span><span style=\"color:#9ECBFF\"> my-chain</span></span></code></pre>\n</code></pre><pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> new</span><span style=\"color:#9ECBFF\"> chain</span><span style=\"color:#9ECBFF\"> testnet</span></span></code></pre>\n</code></pre><p><strong>Output:</strong></p>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Creating new blockchain: my-chain</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>✓ Genesis block created</span></span>\n<span class=\"line\"><span>✓ Chain config saved to ~/.config/tana/chains/my-chain.json</span></span>\n<span class=\"line\"><span>✓ Set as default chain</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>Chain ID: my-chain</span></span>\n<span class=\"line\"><span>Genesis Hash: 0x1a2b3c4d5e6f7890...</span></span></code></pre>\n</code></pre><h3 id=\"new-node\">new node</h3>\n<p>Create a new node to join an existing chain.</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> new</span><span style=\"color:#9ECBFF\"> node</span></span></code></pre>\n</code></pre><p><strong>Options:</strong></p>\n<ul>\n<li><code>--connect &lt;url&gt;</code> - Chain URL to connect to</li>\n</ul>\n<p><strong>Examples:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> new</span><span style=\"color:#9ECBFF\"> node</span><span style=\"color:#79B8FF\"> --connect</span><span style=\"color:#9ECBFF\"> https://chain.example.com</span></span></code></pre>\n</code></pre><p><strong>Output:</strong></p>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Connecting to chain at https://chain.example.com...</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>✓ Chain validated</span></span>\n<span class=\"line\"><span>✓ Node config saved to ~/.config/tana/nodes/node-xyz.json</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>Node ID: node-xyz</span></span>\n<span class=\"line\"><span>Chain: mainnet</span></span>\n<span class=\"line\"><span>Ready to start syncing</span></span></code></pre>\n</code></pre><h3 id=\"new-user\">new user</h3>\n<p>Create a new user account locally.</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> new</span><span style=\"color:#9ECBFF\"> user</span><span style=\"color:#F97583\"> &#x3C;</span><span style=\"color:#9ECBFF\">usernam</span><span style=\"color:#E1E4E8\">e</span><span style=\"color:#F97583\">></span></span></code></pre>\n</code></pre><p><strong>Arguments:</strong></p>\n<ul>\n<li><code>&lt;username&gt;</code> - Username (must start with @)</li>\n</ul>\n<p><strong>Options:</strong></p>\n<ul>\n<li><code>-n, --name &lt;name&gt;</code> - Display name</li>\n<li><code>-b, --bio &lt;bio&gt;</code> - User bio</li>\n</ul>\n<p><strong>Examples:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> new</span><span style=\"color:#9ECBFF\"> user</span><span style=\"color:#9ECBFF\"> @alice</span><span style=\"color:#79B8FF\"> --name</span><span style=\"color:#9ECBFF\"> \"Alice Johnson\"</span></span></code></pre>\n</code></pre><pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> new</span><span style=\"color:#9ECBFF\"> user</span><span style=\"color:#9ECBFF\"> @bob</span><span style=\"color:#79B8FF\"> --name</span><span style=\"color:#9ECBFF\"> \"Bob Smith\"</span><span style=\"color:#79B8FF\"> --bio</span><span style=\"color:#9ECBFF\"> \"Developer\"</span></span></code></pre>\n</code></pre><p><strong>Output:</strong></p>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Creating user: @alice</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>✓ Keypair generated</span></span>\n<span class=\"line\"><span>✓ User config saved to ~/.config/tana/users/@alice.json</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>Username: @alice</span></span>\n<span class=\"line\"><span>Display Name: Alice Johnson</span></span>\n<span class=\"line\"><span>Public Key: ed25519_abc123...</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>⚠ User created locally. Run 'tana deploy user @alice' to add to blockchain.</span></span></code></pre>\n</code></pre><h3 id=\"new-contract\">new contract</h3>\n<p>Scaffold a new smart contract.</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> new</span><span style=\"color:#9ECBFF\"> contract</span><span style=\"color:#E1E4E8\"> [name]</span></span></code></pre>\n</code></pre><p><strong>Arguments:</strong></p>\n<ul>\n<li><code>[name]</code> - Contract name (optional)</li>\n</ul>\n<p><strong>Examples:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> new</span><span style=\"color:#9ECBFF\"> contract</span></span></code></pre>\n</code></pre><pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> new</span><span style=\"color:#9ECBFF\"> contract</span><span style=\"color:#9ECBFF\"> token-transfer</span></span></code></pre>\n</code></pre><p><strong>Output:</strong></p>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Creating smart contract...</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>✓ Created contract.ts</span></span>\n<span class=\"line\"><span>✓ Created contract.json</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>Contract template includes:</span></span>\n<span class=\"line\"><span>  • tana:core (console, version)</span></span>\n<span class=\"line\"><span>  • tana:data (key-value storage)</span></span>\n<span class=\"line\"><span>  • tana:block (blockchain queries)</span></span>\n<span class=\"line\"><span>  • tana:tx (transaction staging)</span></span></code></pre>\n</code></pre><h2 id=\"deployment\">Deployment</h2>\n<h3 id=\"deploy-user\">deploy user</h3>\n<p>Deploy user account to blockchain.</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> deploy</span><span style=\"color:#9ECBFF\"> user</span><span style=\"color:#F97583\"> &#x3C;</span><span style=\"color:#9ECBFF\">usernam</span><span style=\"color:#E1E4E8\">e</span><span style=\"color:#F97583\">></span></span></code></pre>\n</code></pre><p><strong>Arguments:</strong></p>\n<ul>\n<li><code>&lt;username&gt;</code> - Username to deploy</li>\n</ul>\n<p><strong>Options:</strong></p>\n<ul>\n<li><code>-t, --target &lt;url&gt;</code> - Target chain URL</li>\n</ul>\n<p><strong>Examples:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> deploy</span><span style=\"color:#9ECBFF\"> user</span><span style=\"color:#9ECBFF\"> @alice</span></span></code></pre>\n</code></pre><pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> deploy</span><span style=\"color:#9ECBFF\"> user</span><span style=\"color:#9ECBFF\"> @alice</span><span style=\"color:#79B8FF\"> --target</span><span style=\"color:#9ECBFF\"> https://chain.example.com</span></span></code></pre>\n</code></pre><p><strong>Output:</strong></p>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Deploying user @alice to blockchain...</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>✓ Transaction created</span></span>\n<span class=\"line\"><span>✓ Transaction submitted</span></span>\n<span class=\"line\"><span>⏳ Waiting for block confirmation...</span></span>\n<span class=\"line\"><span>✓ User deployed successfully</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>User ID: usr_1a2b3c4d5e6f</span></span>\n<span class=\"line\"><span>Transaction ID: tx_7g8h9i0j1k2l</span></span>\n<span class=\"line\"><span>Block: #42</span></span></code></pre>\n</code></pre><h3 id=\"deploy-contract\">deploy contract</h3>\n<p>Deploy smart contract to blockchain.</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> deploy</span><span style=\"color:#9ECBFF\"> contract</span><span style=\"color:#F97583\"> &#x3C;</span><span style=\"color:#9ECBFF\">pat</span><span style=\"color:#E1E4E8\">h</span><span style=\"color:#F97583\">></span></span></code></pre>\n</code></pre><p><strong>Arguments:</strong></p>\n<ul>\n<li><code>&lt;path&gt;</code> - Path to contract file</li>\n</ul>\n<p><strong>Options:</strong></p>\n<ul>\n<li><code>-t, --target &lt;url&gt;</code> - Target chain URL</li>\n</ul>\n<p><strong>Examples:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> deploy</span><span style=\"color:#9ECBFF\"> contract</span><span style=\"color:#9ECBFF\"> ./contract.ts</span></span></code></pre>\n</code></pre><pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> deploy</span><span style=\"color:#9ECBFF\"> contract</span><span style=\"color:#9ECBFF\"> ./token.ts</span><span style=\"color:#79B8FF\"> --target</span><span style=\"color:#9ECBFF\"> https://chain.example.com</span></span></code></pre>\n</code></pre><p><strong>Output:</strong></p>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Deploying contract: ./contract.ts</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>✓ Contract validated</span></span>\n<span class=\"line\"><span>✓ Transaction created</span></span>\n<span class=\"line\"><span>✓ Transaction submitted</span></span>\n<span class=\"line\"><span>⏳ Waiting for block confirmation...</span></span>\n<span class=\"line\"><span>✓ Contract deployed successfully</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>Contract ID: cnt_xyz789</span></span>\n<span class=\"line\"><span>Transaction ID: tx_abc123</span></span>\n<span class=\"line\"><span>Block: #43</span></span>\n<span class=\"line\"><span>Contract Address: @alice/token-transfer</span></span></code></pre>\n</code></pre><h2 id=\"blockchain-operations\">Blockchain Operations</h2>\n<h3 id=\"run\">run</h3>\n<p>Test run a contract locally.</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#F97583\"> &#x3C;</span><span style=\"color:#9ECBFF\">contrac</span><span style=\"color:#E1E4E8\">t</span><span style=\"color:#F97583\">></span></span></code></pre>\n</code></pre><p><strong>Arguments:</strong></p>\n<ul>\n<li><code>&lt;contract&gt;</code> - Path to contract file</li>\n</ul>\n<p><strong>Examples:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> examples/alice-to-bob.ts</span></span></code></pre>\n</code></pre><pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> ./my-contract.ts</span></span></code></pre>\n</code></pre><p><strong>Output:</strong></p>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Running contract: examples/alice-to-bob.ts</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span></span>\n<span class=\"line\"><span>Contract Output:</span></span>\n<span class=\"line\"><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>Transferring 100 USD from @alice to @bob</span></span>\n<span class=\"line\"><span>✓ Balance checked</span></span>\n<span class=\"line\"><span>✓ Transaction staged</span></span>\n<span class=\"line\"><span>✓ Transfer complete</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span></span>\n<span class=\"line\"><span>Execution Summary:</span></span>\n<span class=\"line\"><span>  Status: Success</span></span>\n<span class=\"line\"><span>  Runtime: 45ms</span></span>\n<span class=\"line\"><span>  Gas Used: 0.002</span></span>\n<span class=\"line\"><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span></span></code></pre>\n</code></pre><h3 id=\"balance\">balance</h3>\n<p>Check user balance.</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> balance</span><span style=\"color:#F97583\"> &#x3C;</span><span style=\"color:#9ECBFF\">use</span><span style=\"color:#E1E4E8\">r</span><span style=\"color:#F97583\">></span></span></code></pre>\n</code></pre><p><strong>Arguments:</strong></p>\n<ul>\n<li><code>&lt;user&gt;</code> - Username or user ID</li>\n</ul>\n<p><strong>Options:</strong></p>\n<ul>\n<li><code>-c, --currency &lt;code&gt;</code> - Currency code (default: USD)</li>\n</ul>\n<p><strong>Examples:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> balance</span><span style=\"color:#9ECBFF\"> @alice</span></span></code></pre>\n</code></pre><pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> balance</span><span style=\"color:#9ECBFF\"> @alice</span><span style=\"color:#79B8FF\"> --currency</span><span style=\"color:#9ECBFF\"> ETH</span></span></code></pre>\n</code></pre><p><strong>Output:</strong></p>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Balances for @alice:</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>  USD    1,000.50</span></span>\n<span class=\"line\"><span>  ETH    2.5</span></span>\n<span class=\"line\"><span>  BTC    0.01</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>Total currencies: 3</span></span></code></pre>\n</code></pre><h3 id=\"transfer\">transfer</h3>\n<p>Transfer funds between users.</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> transfer</span><span style=\"color:#F97583\"> &#x3C;</span><span style=\"color:#9ECBFF\">fro</span><span style=\"color:#E1E4E8\">m</span><span style=\"color:#F97583\">></span><span style=\"color:#F97583\"> &#x3C;</span><span style=\"color:#9ECBFF\">t</span><span style=\"color:#E1E4E8\">o</span><span style=\"color:#F97583\">></span><span style=\"color:#F97583\"> &#x3C;</span><span style=\"color:#9ECBFF\">amoun</span><span style=\"color:#E1E4E8\">t</span><span style=\"color:#F97583\">></span><span style=\"color:#F97583\"> &#x3C;</span><span style=\"color:#9ECBFF\">currenc</span><span style=\"color:#E1E4E8\">y</span><span style=\"color:#F97583\">></span></span></code></pre>\n</code></pre><p><strong>Arguments:</strong></p>\n<ul>\n<li><code>&lt;from&gt;</code> - Sender username</li>\n<li><code>&lt;to&gt;</code> - Recipient username</li>\n<li><code>&lt;amount&gt;</code> - Amount to transfer</li>\n<li><code>&lt;currency&gt;</code> - Currency code</li>\n</ul>\n<p><strong>Examples:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> transfer</span><span style=\"color:#9ECBFF\"> @alice</span><span style=\"color:#9ECBFF\"> @bob</span><span style=\"color:#79B8FF\"> 100</span><span style=\"color:#9ECBFF\"> USD</span></span></code></pre>\n</code></pre><pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> transfer</span><span style=\"color:#9ECBFF\"> @alice</span><span style=\"color:#9ECBFF\"> @bob</span><span style=\"color:#79B8FF\"> 0.5</span><span style=\"color:#9ECBFF\"> ETH</span></span></code></pre>\n</code></pre><p><strong>Output:</strong></p>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Transferring 100 USD from @alice to @bob...</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>✓ Balance verified</span></span>\n<span class=\"line\"><span>✓ Transaction created</span></span>\n<span class=\"line\"><span>✓ Transaction submitted</span></span>\n<span class=\"line\"><span>⏳ Waiting for block confirmation...</span></span>\n<span class=\"line\"><span>✓ Transfer complete</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>Transaction ID: tx_1a2b3c4d</span></span>\n<span class=\"line\"><span>Block: #44</span></span>\n<span class=\"line\"><span>New Balances:</span></span>\n<span class=\"line\"><span>  @alice: 900.50 USD</span></span>\n<span class=\"line\"><span>  @bob: 100.00 USD</span></span></code></pre>\n</code></pre><h2 id=\"system\">System</h2>\n<h3 id=\"check\">check</h3>\n<p>Validate system requirements and configuration.</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">tana</span><span style=\"color:#9ECBFF\"> check</span></span></code></pre>\n</code></pre><p><strong>Output:</strong></p>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Checking system requirements...</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>✓ Bun installed (v1.0.25)</span></span>\n<span class=\"line\"><span>✓ PostgreSQL running (v15.3)</span></span>\n<span class=\"line\"><span>✓ Database connected</span></span>\n<span class=\"line\"><span>✓ Rust toolchain available (v1.75.0)</span></span>\n<span class=\"line\"><span>✓ Configuration valid</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>System ready for Tana</span></span></code></pre>\n</code></pre><h2 id=\"global-options\">Global Options</h2>\n<p>All commands support these options:</p>\n<ul>\n<li><code>--help</code> - Show help for a command</li>\n<li><code>--version</code> - Show version information</li>\n</ul>\n"
  },
  {
    "slug": [
      "tana-edge",
      "examples"
    ],
    "metadata": {
      "title": "Edge Examples",
      "description": "Complete examples for building contracts with tana-edge",
      "sidebar": {
        "order": 2
      }
    },
    "content": "\nReal-world examples of building HTTP APIs with tana-edge.\n\n## Hello World\n\nThe simplest possible edge contract:\n\n```typescript title=\"contracts/hello/get.ts\"\nimport { Request, Response } from 'tana/net'\n\nexport function Get(req: Request) {\n  return Response.json({\n    message: 'Hello from tana-edge!',\n    timestamp: Date.now()\n  })\n}\n```\n\n**Test it:**\n```bash\ncurl http://localhost:8082/hello\n```\n\n## POST with JSON Body\n\nHandle POST requests with JSON data:\n\n```typescript title=\"contracts/echo/post.ts\"\nimport { Request, Response } from 'tana/net'\nimport { console } from 'tana/core'\n\nexport function Post(req: Request, body: any) {\n  console.log('Received:', body)\n\n  return Response.json({\n    echo: body,\n    received: Date.now()\n  })\n}\n```\n\n**Test it:**\n```bash\ncurl -X POST http://localhost:8082/echo \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"name\":\"test\",\"value\":42}'\n```\n\n## Blockchain Queries\n\nQuery blockchain state from your contract:\n\n```typescript title=\"contracts/account/get.ts\"\nimport { Request, Response } from 'tana/net'\nimport { block } from 'tana/block'\n\nexport async function Get(req: Request) {\n  // Get user balance from blockchain\n  const balance = await block.getBalance('alice', 'USD')\n\n  // Get blockchain context\n  const height = block.getHeight()\n  const timestamp = block.getTimestamp()\n\n  return Response.json({\n    user: 'alice',\n    balance,\n    blockHeight: Number(height),\n    timestamp\n  })\n}\n```\n\n**Response:**\n```json\n{\n  \"status\": 200,\n  \"body\": {\n    \"user\": \"alice\",\n    \"balance\": 1000,\n    \"blockHeight\": 12345,\n    \"timestamp\": 1762631458341\n  }\n}\n```\n\n## Persistent Storage\n\n\n```typescript title=\"contracts/counter/get.ts\"\nimport { Request, Response } from 'tana/net'\n\nexport async function Get(req: Request) {\n  // Get current count\n  const count = await data.get('count') || 0\n\n  // Increment\n  await data.set('count', count + 1)\n  await data.commit()\n\n  return Response.json({\n    count: count + 1,\n    message: 'Counter incremented!'\n  })\n}\n```\n\nEvery request increments the counter, and the value persists!\n\n## KV Storage\n\nModern key-value storage with Cloudflare Workers API:\n\n```typescript title=\"contracts/sessions/get.ts\"\nimport { Request, Response } from 'tana/net'\nimport { kv } from 'tana/kv'\n\nexport async function Get(req: Request) {\n  const sessionId = req.query.id\n\n  if (!sessionId) {\n    return Response.json({ error: 'Missing session ID' }, 400)\n  }\n\n  // Get session from KV\n  const session = await kv.get(`session:${sessionId}`, { type: 'json' })\n\n  if (!session) {\n    return Response.json({ error: 'Session not found' }, 404)\n  }\n\n  return Response.json({ session })\n}\n```\n\n```typescript title=\"contracts/sessions/post.ts\"\nimport { Request, Response } from 'tana/net'\nimport { kv } from 'tana/kv'\n\nexport async function Post(req: Request, body: any) {\n  const { action, sessionId, userId } = body\n\n  if (action === 'create') {\n    const session = {\n      userId,\n      createdAt: Date.now(),\n      lastActivity: Date.now()\n    }\n    await kv.put(`session:${sessionId}`, session)\n    return Response.json({ success: true, session })\n  }\n\n  if (action === 'delete') {\n    await kv.delete(`session:${sessionId}`)\n    return Response.json({ success: true })\n  }\n\n  return Response.json({ error: 'Unknown action' }, 400)\n}\n```\n\n**Test it:**\n```bash\n# Create session\ncurl -X POST http://localhost:8082/sessions \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"action\":\"create\",\"sessionId\":\"xyz123\",\"userId\":\"alice\"}'\n\n# Get session\ncurl http://localhost:8082/sessions?id=xyz123\n\n# Delete session\ncurl -X POST http://localhost:8082/sessions \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"action\":\"delete\",\"sessionId\":\"xyz123\"}'\n```\n\n## Transaction Staging\n\nStage blockchain transactions from edge:\n\n```typescript title=\"contracts/transfer/post.ts\"\nimport { Request, Response } from 'tana/net'\nimport { tx } from 'tana/tx'\nimport { console } from 'tana/core'\n\nexport function Post(req: Request, body: any) {\n  const { from, to, amount, currency } = body\n\n  // Stage a transfer transaction\n  tx.transfer(from, to, amount, currency)\n\n  // Get staged changes\n  const changes = tx.getChanges()\n\n  console.log('Staged changes:', changes)\n\n  return Response.json({\n    message: 'Transfer staged',\n    changes,\n    note: 'Call tx.execute() to commit to blockchain'\n  })\n}\n```\n\n**Test it:**\n```bash\ncurl -X POST http://localhost:8082/transfer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"from\":\"alice\",\"to\":\"bob\",\"amount\":100,\"currency\":\"USD\"}'\n```\n\n## External API Calls\n\nFetch data from external services:\n\n```typescript title=\"contracts/pokemon/get.ts\"\nimport { Request, Response } from 'tana/net'\nimport { fetch } from 'tana/utils'\n\nexport async function Get(req: Request) {\n  // Fetch from external API (whitelisted domain)\n  const response = await fetch('https://pokeapi.co/api/v2/pokemon/pikachu')\n  const pokemon = await response.json()\n\n  return Response.json({\n    name: pokemon.name,\n    height: pokemon.height,\n    weight: pokemon.weight,\n    abilities: pokemon.abilities.map(a => a.ability.name)\n  })\n}\n```\n\n**Note:** Only whitelisted domains are allowed (pokeapi.co, tana.dev, localhost)\n\n## Custom Status Codes\n\nReturn appropriate HTTP status codes:\n\n```typescript title=\"contracts/users/get.ts\"\nimport { Request, Response } from 'tana/net'\nimport { block } from 'tana/block'\n\nexport async function Get(req: Request) {\n  const userId = req.query.id\n\n  if (!userId) {\n    return Response.json(\n      { error: 'Missing user ID' },\n      400  // Bad Request\n    )\n  }\n\n  const user = await block.getUser(userId)\n\n  if (!user) {\n    return Response.json(\n      { error: 'User not found' },\n      404  // Not Found\n    )\n  }\n\n  return Response.json({ user })  // 200 OK\n}\n```\n\n## Complete Example: API with All Features\n\nA full-featured contract using all available modules:\n\n```typescript title=\"contracts/api/get.ts\"\nimport { Request, Response } from 'tana/net'\nimport { console } from 'tana/core'\nimport { block } from 'tana/block'\nimport { tx } from 'tana/tx'\n\nexport async function Get(req: Request) {\n  console.log('API request received')\n\n  try {\n    // 1. Read analytics (read-only in GET)\n    const visits = (await kv.get('visits', { type: 'json' })) || 0\n    const lastVisit = await kv.get('lastVisit', { type: 'json' })\n\n    // 2. Get blockchain context\n    const height = Number(block.getHeight())\n    const gasLimit = Number(block.getGasLimit())\n    const timestamp = block.getTimestamp()\n\n    // 3. Query user balance\n    const balance = await block.getBalance('alice', 'USD')\n\n    // 4. Stage a transaction (for demo)\n    tx.transfer('alice', 'bob', 10, 'USD')\n    const stagedTx = tx.getChanges()\n\n    // 5. Return comprehensive response\n    return Response.json({\n      api: {\n        version: '1.0.0',\n        totalVisits: visits + 1,\n        lastVisit: Date.now()\n      },\n      blockchain: {\n        height,\n        timestamp,\n        gasLimit\n      },\n      user: {\n        id: 'alice',\n        balance\n      },\n      transactions: {\n        staged: stagedTx.length,\n        preview: stagedTx\n      }\n    })\n  } catch (error) {\n    console.error('Error:', error)\n    return Response.json(\n      { error: error.message },\n      500\n    )\n  }\n}\n```\n\n**Response:**\n```json\n{\n  \"status\": 200,\n  \"body\": {\n    \"api\": {\n      \"version\": \"1.0.0\",\n      \"totalVisits\": 5,\n      \"lastVisit\": 1762631458341\n    },\n    \"blockchain\": {\n      \"height\": 12345,\n      \"timestamp\": 1762631458341,\n      \"gasLimit\": 1000000\n    },\n    \"user\": {\n      \"id\": \"alice\",\n      \"balance\": 1000\n    },\n    \"transactions\": {\n      \"staged\": 1,\n      \"preview\": [\n        {\n          \"type\": \"transfer\",\n          \"from\": \"alice\",\n          \"to\": \"bob\",\n          \"amount\": 10,\n          \"currency\": \"USD\"\n        }\n      ]\n    }\n  }\n}\n```\n\n## Module Reference\n\nQuick reference for all available modules:\n\n```typescript\n// tana/core - Logging and version info\nimport { console } from 'tana/core'\nconsole.log('message')\nconsole.error('error')\n\n// tana/net - HTTP primitives\nimport { Request, Response } from 'tana/net'\nResponse.json(data, 200)\nResponse.text('hello', 200)\n\n// tana/block - Blockchain queries\nimport { block } from 'tana/block'\nawait block.getBalance(userId, currency)\nawait block.getUser(userId)\nawait block.getTransaction(txId)\nblock.getHeight()\nblock.getTimestamp()\nblock.getHash()\n\n// tana/kv - Cloudflare Workers KV\nimport { kv } from 'tana/kv'\nawait kv.put(key, value)\nawait kv.get(key, { type: 'json' })\nawait kv.delete(key)\nawait kv.list({ prefix: 'user:' })\n\n// tana/tx - Transaction staging\nimport { tx } from 'tana/tx'\ntx.transfer(from, to, amount, currency)\ntx.setBalance(userId, amount, currency)\ntx.getChanges()\ntx.execute()\n\n// tana/utils - External HTTP\nimport { fetch } from 'tana/utils'\nconst response = await fetch(url)\nconst data = await response.json()\n```\n\n## Next Steps\n\n- **[API Reference](/tana-api/modules/)** - Detailed module documentation\n- **[Architecture](/guides/architecture/)** - Understanding the hybrid model\n- **[CLI Guide](/tana-cli/intro/)** - Deploy contracts to blockchain\n",
    "html": "<p>Real-world examples of building HTTP APIs with tana-edge.</p>\n<h2 id=\"hello-world\">Hello World</h2>\n<p>The simplest possible edge contract:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { Request, Response } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/net'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> Get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Request</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> Response.</span><span style=\"color:#B392F0\">json</span><span style=\"color:#E1E4E8\">({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    message: </span><span style=\"color:#9ECBFF\">'Hello from tana-edge!'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    timestamp: Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Test it:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8082/hello</span></span></code></pre>\n</code></pre><h2 id=\"post-with-json-body\">POST with JSON Body</h2>\n<p>Handle POST requests with JSON data:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { Request, Response } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/net'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { console } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/core'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> Post</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Request</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">body</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> any</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Received:'</span><span style=\"color:#E1E4E8\">, body)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> Response.</span><span style=\"color:#B392F0\">json</span><span style=\"color:#E1E4E8\">({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    echo: body,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    received: Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Test it:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -X</span><span style=\"color:#9ECBFF\"> POST</span><span style=\"color:#9ECBFF\"> http://localhost:8082/echo</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -H</span><span style=\"color:#9ECBFF\"> \"Content-Type: application/json\"</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -d</span><span style=\"color:#9ECBFF\"> '{\"name\":\"test\",\"value\":42}'</span></span></code></pre>\n</code></pre><h2 id=\"blockchain-queries\">Blockchain Queries</h2>\n<p>Query blockchain state from your contract:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { Request, Response } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/net'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { block } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/block'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> Get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Request</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Get user balance from blockchain</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> balance</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> block.</span><span style=\"color:#B392F0\">getBalance</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'alice'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'USD'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Get blockchain context</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> height</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> block.</span><span style=\"color:#B392F0\">getHeight</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> timestamp</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> block.</span><span style=\"color:#B392F0\">getTimestamp</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> Response.</span><span style=\"color:#B392F0\">json</span><span style=\"color:#E1E4E8\">({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    user: </span><span style=\"color:#9ECBFF\">'alice'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    balance,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    blockHeight: </span><span style=\"color:#B392F0\">Number</span><span style=\"color:#E1E4E8\">(height),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    timestamp</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Response:</strong></p>\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"status\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">200</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"body\"</span><span style=\"color:#E1E4E8\">: {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"user\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"alice\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"balance\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">1000</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"blockHeight\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">12345</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"timestamp\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">1762631458341</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h2 id=\"persistent-storage\">Persistent Storage</h2>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { Request, Response } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/net'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> Get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Request</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Get current count</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> count</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'count'</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">||</span><span style=\"color:#79B8FF\"> 0</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Increment</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">set</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'count'</span><span style=\"color:#E1E4E8\">, count </span><span style=\"color:#F97583\">+</span><span style=\"color:#79B8FF\"> 1</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> data.</span><span style=\"color:#B392F0\">commit</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> Response.</span><span style=\"color:#B392F0\">json</span><span style=\"color:#E1E4E8\">({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    count: count </span><span style=\"color:#F97583\">+</span><span style=\"color:#79B8FF\"> 1</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    message: </span><span style=\"color:#9ECBFF\">'Counter incremented!'</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p>Every request increments the counter, and the value persists!</p>\n<h2 id=\"kv-storage\">KV Storage</h2>\n<p>Modern key-value storage with Cloudflare Workers API:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { Request, Response } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/net'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { kv } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/kv'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> Get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Request</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> sessionId</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> req.query.id</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">sessionId) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> Response.</span><span style=\"color:#B392F0\">json</span><span style=\"color:#E1E4E8\">({ error: </span><span style=\"color:#9ECBFF\">'Missing session ID'</span><span style=\"color:#E1E4E8\"> }, </span><span style=\"color:#79B8FF\">400</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Get session from KV</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> session</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`session:${</span><span style=\"color:#E1E4E8\">sessionId</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">session) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> Response.</span><span style=\"color:#B392F0\">json</span><span style=\"color:#E1E4E8\">({ error: </span><span style=\"color:#9ECBFF\">'Session not found'</span><span style=\"color:#E1E4E8\"> }, </span><span style=\"color:#79B8FF\">404</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> Response.</span><span style=\"color:#B392F0\">json</span><span style=\"color:#E1E4E8\">({ session })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { Request, Response } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/net'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { kv } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/kv'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> Post</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Request</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">body</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> any</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#79B8FF\">action</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">sessionId</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">userId</span><span style=\"color:#E1E4E8\"> } </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> body</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (action </span><span style=\"color:#F97583\">===</span><span style=\"color:#9ECBFF\"> 'create'</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> session</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      userId,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      createdAt: Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">(),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      lastActivity: Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`session:${</span><span style=\"color:#E1E4E8\">sessionId</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">, session)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> Response.</span><span style=\"color:#B392F0\">json</span><span style=\"color:#E1E4E8\">({ success: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\">, session })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (action </span><span style=\"color:#F97583\">===</span><span style=\"color:#9ECBFF\"> 'delete'</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">delete</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`session:${</span><span style=\"color:#E1E4E8\">sessionId</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> Response.</span><span style=\"color:#B392F0\">json</span><span style=\"color:#E1E4E8\">({ success: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> Response.</span><span style=\"color:#B392F0\">json</span><span style=\"color:#E1E4E8\">({ error: </span><span style=\"color:#9ECBFF\">'Unknown action'</span><span style=\"color:#E1E4E8\"> }, </span><span style=\"color:#79B8FF\">400</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Test it:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Create session</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -X</span><span style=\"color:#9ECBFF\"> POST</span><span style=\"color:#9ECBFF\"> http://localhost:8082/sessions</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -H</span><span style=\"color:#9ECBFF\"> \"Content-Type: application/json\"</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -d</span><span style=\"color:#9ECBFF\"> '{\"action\":\"create\",\"sessionId\":\"xyz123\",\"userId\":\"alice\"}'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Get session</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8082/sessions?id=xyz123</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Delete session</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -X</span><span style=\"color:#9ECBFF\"> POST</span><span style=\"color:#9ECBFF\"> http://localhost:8082/sessions</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -H</span><span style=\"color:#9ECBFF\"> \"Content-Type: application/json\"</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -d</span><span style=\"color:#9ECBFF\"> '{\"action\":\"delete\",\"sessionId\":\"xyz123\"}'</span></span></code></pre>\n</code></pre><h2 id=\"transaction-staging\">Transaction Staging</h2>\n<p>Stage blockchain transactions from edge:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { Request, Response } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/net'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { tx } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/tx'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { console } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/core'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> Post</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Request</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">body</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> any</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#79B8FF\">from</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">to</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">amount</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">currency</span><span style=\"color:#E1E4E8\"> } </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> body</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Stage a transfer transaction</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  tx.</span><span style=\"color:#B392F0\">transfer</span><span style=\"color:#E1E4E8\">(from, to, amount, currency)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Get staged changes</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> changes</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> tx.</span><span style=\"color:#B392F0\">getChanges</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Staged changes:'</span><span style=\"color:#E1E4E8\">, changes)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> Response.</span><span style=\"color:#B392F0\">json</span><span style=\"color:#E1E4E8\">({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    message: </span><span style=\"color:#9ECBFF\">'Transfer staged'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    changes,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    note: </span><span style=\"color:#9ECBFF\">'Call tx.execute() to commit to blockchain'</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Test it:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -X</span><span style=\"color:#9ECBFF\"> POST</span><span style=\"color:#9ECBFF\"> http://localhost:8082/transfer</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -H</span><span style=\"color:#9ECBFF\"> \"Content-Type: application/json\"</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -d</span><span style=\"color:#9ECBFF\"> '{\"from\":\"alice\",\"to\":\"bob\",\"amount\":100,\"currency\":\"USD\"}'</span></span></code></pre>\n</code></pre><h2 id=\"external-api-calls\">External API Calls</h2>\n<p>Fetch data from external services:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { Request, Response } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/net'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { fetch } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/utils'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> Get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Request</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Fetch from external API (whitelisted domain)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> response</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> fetch</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'https://pokeapi.co/api/v2/pokemon/pikachu'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> pokemon</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> response.</span><span style=\"color:#B392F0\">json</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> Response.</span><span style=\"color:#B392F0\">json</span><span style=\"color:#E1E4E8\">({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    name: pokemon.name,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    height: pokemon.height,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    weight: pokemon.weight,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    abilities: pokemon.abilities.</span><span style=\"color:#B392F0\">map</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">a</span><span style=\"color:#F97583\"> =></span><span style=\"color:#E1E4E8\"> a.ability.name)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Note:</strong> Only whitelisted domains are allowed (pokeapi.co, tana.dev, localhost)</p>\n<h2 id=\"custom-status-codes\">Custom Status Codes</h2>\n<p>Return appropriate HTTP status codes:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { Request, Response } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/net'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { block } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/block'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> Get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Request</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> userId</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> req.query.id</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">userId) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> Response.</span><span style=\"color:#B392F0\">json</span><span style=\"color:#E1E4E8\">(</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      { error: </span><span style=\"color:#9ECBFF\">'Missing user ID'</span><span style=\"color:#E1E4E8\"> },</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      400</span><span style=\"color:#6A737D\">  // Bad Request</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    )</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> user</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> block.</span><span style=\"color:#B392F0\">getUser</span><span style=\"color:#E1E4E8\">(userId)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">user) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> Response.</span><span style=\"color:#B392F0\">json</span><span style=\"color:#E1E4E8\">(</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      { error: </span><span style=\"color:#9ECBFF\">'User not found'</span><span style=\"color:#E1E4E8\"> },</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      404</span><span style=\"color:#6A737D\">  // Not Found</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    )</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> Response.</span><span style=\"color:#B392F0\">json</span><span style=\"color:#E1E4E8\">({ user })  </span><span style=\"color:#6A737D\">// 200 OK</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h2 id=\"complete-example-api-with-all-features\">Complete Example: API with All Features</h2>\n<p>A full-featured contract using all available modules:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { Request, Response } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/net'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { console } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/core'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { block } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/block'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { tx } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/tx'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> Get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Request</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'API request received'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  try</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // 1. Read analytics (read-only in GET)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> visits</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'visits'</span><span style=\"color:#E1E4E8\">, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })) </span><span style=\"color:#F97583\">||</span><span style=\"color:#79B8FF\"> 0</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> lastVisit</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'lastVisit'</span><span style=\"color:#E1E4E8\">, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // 2. Get blockchain context</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> height</span><span style=\"color:#F97583\"> =</span><span style=\"color:#B392F0\"> Number</span><span style=\"color:#E1E4E8\">(block.</span><span style=\"color:#B392F0\">getHeight</span><span style=\"color:#E1E4E8\">())</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> gasLimit</span><span style=\"color:#F97583\"> =</span><span style=\"color:#B392F0\"> Number</span><span style=\"color:#E1E4E8\">(block.</span><span style=\"color:#B392F0\">getGasLimit</span><span style=\"color:#E1E4E8\">())</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> timestamp</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> block.</span><span style=\"color:#B392F0\">getTimestamp</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // 3. Query user balance</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> balance</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> block.</span><span style=\"color:#B392F0\">getBalance</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'alice'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'USD'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // 4. Stage a transaction (for demo)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    tx.</span><span style=\"color:#B392F0\">transfer</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'alice'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'bob'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">10</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'USD'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> stagedTx</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> tx.</span><span style=\"color:#B392F0\">getChanges</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // 5. Return comprehensive response</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> Response.</span><span style=\"color:#B392F0\">json</span><span style=\"color:#E1E4E8\">({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      api: {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        version: </span><span style=\"color:#9ECBFF\">'1.0.0'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        totalVisits: visits </span><span style=\"color:#F97583\">+</span><span style=\"color:#79B8FF\"> 1</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        lastVisit: Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      blockchain: {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        height,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        timestamp,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        gasLimit</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      user: {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        id: </span><span style=\"color:#9ECBFF\">'alice'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        balance</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      transactions: {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        staged: stagedTx.</span><span style=\"color:#79B8FF\">length</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        preview: stagedTx</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    })</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  } </span><span style=\"color:#F97583\">catch</span><span style=\"color:#E1E4E8\"> (error) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    console.</span><span style=\"color:#B392F0\">error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Error:'</span><span style=\"color:#E1E4E8\">, error)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> Response.</span><span style=\"color:#B392F0\">json</span><span style=\"color:#E1E4E8\">(</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      { error: error.message },</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      500</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    )</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><p><strong>Response:</strong></p>\n<pre><code class=\"language-json\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"status\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">200</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  \"body\"</span><span style=\"color:#E1E4E8\">: {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"api\"</span><span style=\"color:#E1E4E8\">: {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      \"version\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"1.0.0\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      \"totalVisits\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">5</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      \"lastVisit\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">1762631458341</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    },</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"blockchain\"</span><span style=\"color:#E1E4E8\">: {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      \"height\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">12345</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      \"timestamp\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">1762631458341</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      \"gasLimit\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">1000000</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    },</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"user\"</span><span style=\"color:#E1E4E8\">: {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      \"id\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"alice\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      \"balance\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">1000</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    },</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"transactions\"</span><span style=\"color:#E1E4E8\">: {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      \"staged\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">1</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      \"preview\"</span><span style=\"color:#E1E4E8\">: [</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">          \"type\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"transfer\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">          \"from\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"alice\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">          \"to\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"bob\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">          \"amount\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">10</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">          \"currency\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"USD\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      ]</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n</code></pre><h2 id=\"module-reference\">Module Reference</h2>\n<p>Quick reference for all available modules:</p>\n<pre><code class=\"language-typescript\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// tana/core - Logging and version info</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { console } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/core'</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'message'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'error'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// tana/net - HTTP primitives</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { Request, Response } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/net'</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">Response.</span><span style=\"color:#B392F0\">json</span><span style=\"color:#E1E4E8\">(data, </span><span style=\"color:#79B8FF\">200</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">Response.</span><span style=\"color:#B392F0\">text</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'hello'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">200</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// tana/block - Blockchain queries</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { block } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/block'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> block.</span><span style=\"color:#B392F0\">getBalance</span><span style=\"color:#E1E4E8\">(userId, currency)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> block.</span><span style=\"color:#B392F0\">getUser</span><span style=\"color:#E1E4E8\">(userId)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> block.</span><span style=\"color:#B392F0\">getTransaction</span><span style=\"color:#E1E4E8\">(txId)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">block.</span><span style=\"color:#B392F0\">getHeight</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">block.</span><span style=\"color:#B392F0\">getTimestamp</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">block.</span><span style=\"color:#B392F0\">getHash</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// tana/kv - Cloudflare Workers KV</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { kv } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/kv'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">put</span><span style=\"color:#E1E4E8\">(key, value)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(key, { type: </span><span style=\"color:#9ECBFF\">'json'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">delete</span><span style=\"color:#E1E4E8\">(key)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> kv.</span><span style=\"color:#B392F0\">list</span><span style=\"color:#E1E4E8\">({ prefix: </span><span style=\"color:#9ECBFF\">'user:'</span><span style=\"color:#E1E4E8\"> })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// tana/tx - Transaction staging</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { tx } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/tx'</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">tx.</span><span style=\"color:#B392F0\">transfer</span><span style=\"color:#E1E4E8\">(from, to, amount, currency)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">tx.</span><span style=\"color:#B392F0\">setBalance</span><span style=\"color:#E1E4E8\">(userId, amount, currency)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">tx.</span><span style=\"color:#B392F0\">getChanges</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">tx.</span><span style=\"color:#B392F0\">execute</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// tana/utils - External HTTP</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { fetch } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'tana/utils'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> response</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> fetch</span><span style=\"color:#E1E4E8\">(url)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> data</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> response.</span><span style=\"color:#B392F0\">json</span><span style=\"color:#E1E4E8\">()</span></span></code></pre>\n</code></pre><h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li><strong><a href=\"/tana-api/modules/\">API Reference</a></strong> - Detailed module documentation</li>\n<li><strong><a href=\"/guides/architecture/\">Architecture</a></strong> - Understanding the hybrid model</li>\n<li><strong><a href=\"/tana-cli/intro/\">CLI Guide</a></strong> - Deploy contracts to blockchain</li>\n</ul>\n"
  },
  {
    "slug": [
      "tana-edge",
      "intro"
    ],
    "metadata": {
      "title": "Edge Server Overview",
      "description": "Introduction to the Tana Edge HTTP server for off-chain contract execution",
      "sidebar": {
        "order": 1
      }
    },
    "content": "\nThe Tana Edge server (`tana-edge`) is a high-performance HTTP server that executes TypeScript smart contracts off-chain, enabling fast API endpoints while maintaining blockchain integration for critical operations.\n\n## Architecture\n\nEdge follows a **hybrid on-chain/off-chain model** inspired by Cloudflare Workers:\n\n- **On-chain** (`Init()`, `Contract()`) - Deployed via blockchain consensus, stores critical state\n- **Off-chain** (`Get()`, `Post()`) - Executed on edge servers, handles HTTP requests at millisecond latency\n\nEach HTTP request spawns a fresh V8 isolate (Cloudflare-style), ensuring security and isolation between requests.\n\n## Why Edge?\n\nTraditional blockchains are too slow for real-time applications. Edge solves this by:\n\n- ⚡ **Speed** - HTTP requests complete in <100ms vs blockchain's seconds\n- 💰 **Cost** - No gas fees for queries\n- 🔄 **Flexibility** - Read data, compose responses, call external APIs\n- 🔒 **Security** - Still backed by blockchain for critical operations\n\n**Use Cases:**\n- REST APIs for blockchain data\n- Real-time dashboards and analytics\n- File uploads and processing\n- Comment systems, notifications\n- Anything requiring fast reads with occasional writes\n\n## Installation\n\n```bash\n# Build tana-edge from source\ncd tana-edge\ncargo build --release\n\n# Binary will be at: ./target/release/tana-edge\n```\n\n## Quick Start\n\n**1. Create a contract:**\n\n```bash\n# Create contract directory\nmkdir -p contracts/hello\n\n# Create GET endpoint\ncat > contracts/hello/get.ts << 'EOF'\nimport { Request, Response } from 'tana/net'\nimport { console } from 'tana/core'\n\nexport function Get(req: Request) {\n  console.log('Request received!')\n\n  return Response.json({\n    message: 'Hello from tana-edge!',\n    timestamp: Date.now()\n  })\n}\nEOF\n```\n\n**2. Start the server:**\n\n```bash\ncd tana-edge\n./target/release/tana-edge\n```\n\n**3. Test your endpoint:**\n\n```bash\ncurl http://localhost:8082/hello\n\n# Response:\n# {\n#   \"status\": 200,\n#   \"body\": {\n#     \"message\": \"Hello from tana-edge!\",\n#     \"timestamp\": 1762631458341\n#   }\n# }\n```\n\n## Contract Structure\n\nContracts live in `contracts/{contractId}/`:\n\n```\ncontracts/\n└── myapp/\n    ├── get.ts   # Handles GET  /myapp\n    └── post.ts  # Handles POST /myapp\n```\n\nEach file exports a function that receives a `Request` and returns a `Response`.\n\n## Available Modules\n\nEdge contracts have access to all Tana modules:\n\n| Module | Purpose | Example |\n|--------|---------|---------|\n| `tana/core` | Console, version info | `console.log('hi')` |\n| `tana/net` | HTTP requests/responses | `Response.json({...})` |\n| `tana/block` | Blockchain queries | `block.getHeight()` |\n| `tana/tx` | Transaction staging | `tx.transfer('alice', 'bob', 100)` |\n| `tana/utils` | External HTTP calls | `await fetch('http://...')` |\n\nSee [Examples](/tana-edge/examples/) for complete code samples.\n\n## Configuration\n\n**Default Settings:**\n- **Port:** 8082\n- **Contracts Directory:** `../contracts/` (relative to binary)\n- **CORS:** Permissive (all origins)\n\n**Environment Variables:**\n```bash\nDATABASE_URL='postgres://tana:[PASSWORD]@localhost:5432/tana'  # For blockchain queries\n```\n\n## Production Deployment\n\nEdge is designed for self-hosting:\n\n```bash\n# 1. Build optimized binary\ncargo build --release\n\n# 2. Run as systemd service\nsudo systemctl start tana-edge\n\n# 3. Map subdomains in reverse proxy\n# Production routing:\n# cnt_abc123.tana.network → localhost:8082/cnt_abc123\n```\n\n**Subdomain Routing:**\n\nIn production, contracts are accessed via subdomains:\n- Dev: `localhost:8082/myapp` (path-based)\n- Prod: `myapp.tana.network` (subdomain)\n\n## Performance\n\n- **Latency:** <100ms per request (fresh V8 isolate per request)\n- **Throughput:** Thousands of requests/second\n- **Memory:** Isolated per-request (no state leakage)\n- **Scaling:** Horizontal (stateless design)\n\n## Next Steps\n\n- **[Examples](/tana-edge/examples/)** - Complete code examples\n- **[API Reference](/tana-api/modules/)** - Available Tana modules\n- **[Architecture Guide](/guides/architecture/)** - System design\n",
    "html": "<p>The Tana Edge server (<code>tana-edge</code>) is a high-performance HTTP server that executes TypeScript smart contracts off-chain, enabling fast API endpoints while maintaining blockchain integration for critical operations.</p>\n<h2 id=\"architecture\">Architecture</h2>\n<p>Edge follows a <strong>hybrid on-chain/off-chain model</strong> inspired by Cloudflare Workers:</p>\n<ul>\n<li><strong>On-chain</strong> (<code>Init()</code>, <code>Contract()</code>) - Deployed via blockchain consensus, stores critical state</li>\n<li><strong>Off-chain</strong> (<code>Get()</code>, <code>Post()</code>) - Executed on edge servers, handles HTTP requests at millisecond latency</li>\n</ul>\n<p>Each HTTP request spawns a fresh V8 isolate (Cloudflare-style), ensuring security and isolation between requests.</p>\n<h2 id=\"why-edge\">Why Edge?</h2>\n<p>Traditional blockchains are too slow for real-time applications. Edge solves this by:</p>\n<ul>\n<li>⚡ <strong>Speed</strong> - HTTP requests complete in &lt;100ms vs blockchain&#39;s seconds</li>\n<li>💰 <strong>Cost</strong> - No gas fees for queries</li>\n<li>🔄 <strong>Flexibility</strong> - Read data, compose responses, call external APIs</li>\n<li>🔒 <strong>Security</strong> - Still backed by blockchain for critical operations</li>\n</ul>\n<p><strong>Use Cases:</strong></p>\n<ul>\n<li>REST APIs for blockchain data</li>\n<li>Real-time dashboards and analytics</li>\n<li>File uploads and processing</li>\n<li>Comment systems, notifications</li>\n<li>Anything requiring fast reads with occasional writes</li>\n</ul>\n<h2 id=\"installation\">Installation</h2>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Build tana-edge from source</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">cd</span><span style=\"color:#9ECBFF\"> tana-edge</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">cargo</span><span style=\"color:#9ECBFF\"> build</span><span style=\"color:#79B8FF\"> --release</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Binary will be at: ./target/release/tana-edge</span></span></code></pre>\n</code></pre><h2 id=\"quick-start\">Quick Start</h2>\n<p><strong>1. Create a contract:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Create contract directory</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">mkdir</span><span style=\"color:#79B8FF\"> -p</span><span style=\"color:#9ECBFF\"> contracts/hello</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Create GET endpoint</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">cat</span><span style=\"color:#F97583\"> ></span><span style=\"color:#9ECBFF\"> contracts/hello/get.ts</span><span style=\"color:#F97583\"> &#x3C;&#x3C;</span><span style=\"color:#9ECBFF\"> 'EOF'</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">import { Request, Response } from 'tana/net'</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">import { console } from 'tana/core'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">export function Get(req: Request) {</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  console.log('Request received!')</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  return Response.json({</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    message: 'Hello from tana-edge!',</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    timestamp: Date.now()</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  })</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">}</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">EOF</span></span></code></pre>\n</code></pre><p><strong>2. Start the server:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#79B8FF\">cd</span><span style=\"color:#9ECBFF\"> tana-edge</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">./target/release/tana-edge</span></span></code></pre>\n</code></pre><p><strong>3. Test your endpoint:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#9ECBFF\"> http://localhost:8082/hello</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Response:</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">#   \"status\": 200,</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">#   \"body\": {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">#     \"message\": \"Hello from tana-edge!\",</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">#     \"timestamp\": 1762631458341</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">#   }</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># }</span></span></code></pre>\n</code></pre><h2 id=\"contract-structure\">Contract Structure</h2>\n<p>Contracts live in <code>contracts/{contractId}/</code>:</p>\n<pre><code><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>contracts/</span></span>\n<span class=\"line\"><span>└── myapp/</span></span>\n<span class=\"line\"><span>    ├── get.ts   # Handles GET  /myapp</span></span>\n<span class=\"line\"><span>    └── post.ts  # Handles POST /myapp</span></span></code></pre>\n</code></pre><p>Each file exports a function that receives a <code>Request</code> and returns a <code>Response</code>.</p>\n<h2 id=\"available-modules\">Available Modules</h2>\n<p>Edge contracts have access to all Tana modules:</p>\n<table>\n<thead>\n<tr>\n<th>Module</th>\n<th>Purpose</th>\n<th>Example</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>tana/core</code></td>\n<td>Console, version info</td>\n<td><code>console.log(&#39;hi&#39;)</code></td>\n</tr>\n<tr>\n<td><code>tana/net</code></td>\n<td>HTTP requests/responses</td>\n<td><code>Response.json({...})</code></td>\n</tr>\n<tr>\n<td><code>tana/block</code></td>\n<td>Blockchain queries</td>\n<td><code>block.getHeight()</code></td>\n</tr>\n<tr>\n<td><code>tana/tx</code></td>\n<td>Transaction staging</td>\n<td><code>tx.transfer(&#39;alice&#39;, &#39;bob&#39;, 100)</code></td>\n</tr>\n<tr>\n<td><code>tana/utils</code></td>\n<td>External HTTP calls</td>\n<td><code>await fetch(&#39;http://...&#39;)</code></td>\n</tr>\n</tbody></table>\n<p>See <a href=\"/tana-edge/examples/\">Examples</a> for complete code samples.</p>\n<h2 id=\"configuration\">Configuration</h2>\n<p><strong>Default Settings:</strong></p>\n<ul>\n<li><strong>Port:</strong> 8082</li>\n<li><strong>Contracts Directory:</strong> <code>../contracts/</code> (relative to binary)</li>\n<li><strong>CORS:</strong> Permissive (all origins)</li>\n</ul>\n<p><strong>Environment Variables:</strong></p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">DATABASE_URL</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">'postgres://tana:[PASSWORD]@localhost:5432/tana'</span><span style=\"color:#6A737D\">  # For blockchain queries</span></span></code></pre>\n</code></pre><h2 id=\"production-deployment\">Production Deployment</h2>\n<p>Edge is designed for self-hosting:</p>\n<pre><code class=\"language-bash\"><pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># 1. Build optimized binary</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">cargo</span><span style=\"color:#9ECBFF\"> build</span><span style=\"color:#79B8FF\"> --release</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># 2. Run as systemd service</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> systemctl</span><span style=\"color:#9ECBFF\"> start</span><span style=\"color:#9ECBFF\"> tana-edge</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># 3. Map subdomains in reverse proxy</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Production routing:</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># cnt_abc123.tana.network → localhost:8082/cnt_abc123</span></span></code></pre>\n</code></pre><p><strong>Subdomain Routing:</strong></p>\n<p>In production, contracts are accessed via subdomains:</p>\n<ul>\n<li>Dev: <code>localhost:8082/myapp</code> (path-based)</li>\n<li>Prod: <code>myapp.tana.network</code> (subdomain)</li>\n</ul>\n<h2 id=\"performance\">Performance</h2>\n<ul>\n<li><strong>Latency:</strong> &lt;100ms per request (fresh V8 isolate per request)</li>\n<li><strong>Throughput:</strong> Thousands of requests/second</li>\n<li><strong>Memory:</strong> Isolated per-request (no state leakage)</li>\n<li><strong>Scaling:</strong> Horizontal (stateless design)</li>\n</ul>\n<h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li><strong><a href=\"/tana-edge/examples/\">Examples</a></strong> - Complete code examples</li>\n<li><strong><a href=\"/tana-api/modules/\">API Reference</a></strong> - Available Tana modules</li>\n<li><strong><a href=\"/guides/architecture/\">Architecture Guide</a></strong> - System design</li>\n</ul>\n"
  }
]